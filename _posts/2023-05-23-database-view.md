---
title: DB 뷰(View)
author: keencho
date: 2023-05-15 08:12:00 +0900
categories: [Database]
tags: [Database, PostgreSQL]
---

# **1. 개요**
데이터베이스 뷰는 현대의 데이터 중심 시스템에서 필수적인 요소로 자리잡았습니다. 데이터베이스 뷰는 데이터베이스 시스템에서 사용자들에게 편리한 인터페이스를 제공하고, 데이터를 효율적으로 조작하고 검색할 수 있는 기능을 제공합니다. 특히, PostgreSQL과 같은 강력한 관계형 데이터베이스에서 데이터베이스 뷰는 매우 유용한 도구입니다.

데이터베이스 뷰란 무엇일까요? 간단하게 말하면, 뷰는 하나 이상의 테이블에서 파생된 가상의 테이블입니다. 즉, 실제로 데이터를 저장하지 않고, 기존의 테이블에서 필요한 데이터를 조회하거나 가공하여 보여주는 역할을 합니다. 뷰는 쿼리의 결과를 미리 정의된 구조로 표시하고 필요한 조건에 따라 데이터를 제한하는 등의 기능을 수행할 수 있습니다.

# **2. 뷰의 장점**

## **1. 복잡한 쿼리 단순화**
복잡한 조인이나 계산이 필요한 쿼리를 미리 정의된 뷰로 대체함으로써, 사용자는 간단한 쿼리만 작성하여 데이터를 추출하고 조작할 수 있습니다. 이는 개발자와 데이터 분석가가 작업을 더욱 효율적으로 수행할 수 있게 해줍니다.

## **2. 데이터의 보안과 접근 제어 강화**
뷰를 사용하여 사용자에게 필요한 데이터만 노출하고, 민감한 정보를 숨길 수 있습니다. 데이터베이스의 보안 정책을 더욱 강력하게 구현할 수 있으며, 접근 권한을 통해 특정 사용자 또는 역할에게만 뷰를 제공할 수 있습니다.

## **3. 데이터의 일관성과 중복성을 관리하는데 도움이 됨**
여러 테이블에서 동일한 데이터를 사용해야 할 때, 뷰를 사용하여 중복 데이터를 피하고 일관된 데이터를 제공할 수 있습니다. 이는 데이터의 일관성을 유지하고, 데이터의 변경이 필요한 경우 뷰만 수정하면 되므로 유지 보수와 관리의 편의성을 높입니다.

# **3. 뷰의 단점**

## **1. 성능**
뷰는 가상의 테이블로써, 실제 데이터를 포함하고 있지 않으며 쿼리 실행 시 실제 데이터를 추출하여 결과를 반환합니다. 따라서 복잡한 뷰의 경우 성능 문제가 발생할 수 있습니다. 특히, 뷰에 대한 쿼리가 복잡하거나 데이터 양이 많은 경우에는 성능 저하가 발생할 수 있습니다.

## **2. 복잡성**
뷰는 데이터베이스 시스템의 구조를 복잡하게 만들 수 있습니다. 여러 테이블을 조합하고 조인하여 뷰를 생성하는 경우, 데이터베이스 스키마가 복잡해지고 이해하기 어려워질 수 있습니다. 또한 뷰 자체가 다른 뷰에 의존하는 경우, 변경 사항을 추적하고 유지 관리하기가 어려울 수 있습니다.

## **3. 업데이트 제한**
일부 데이터베이스 시스템에서는 뷰를 통해 데이터를 업데이트하는 것을 제한합니다. 뷰가 여러 테이블의 조합이거나 특정 조건에 따라 데이터를 필터링하는 경우, 뷰를 통해 데이터를 직접 업데이트하는 것이 어려울 수 있습니다. 이 경우에는 대신 뷰를 구성하는 원본 테이블을 직접 업데이트해야 합니다.

# **4. PostgreSQL에서 뷰 생성하기**
PostgreSQL에서 뷰를 생성하는 방법은 간단합니다.

### **1. CREATE VIEW 문을 사용하여 뷰 생성**
PostgreSQL에서는 CREATE VIEW 문을 사용하여 뷰를 생성합니다. 아래의 형식을 따라 뷰를 생성할 수 있습니다.

```sql
CREATE VIEW view_name AS
SELECT column1, column2, ...
FROM table1
WHERE condition;
```

- `view_name`: 생성할 뷰의 이름을 지정합니다.
- `column1, column2, ...`: 뷰에서 표시할 열의 이름을 지정합니다. 필요에 따라 테이블의 열이나 계산된 열을 선택할 수 있습니다.
- `table1`: 뷰를 생성할 기반이 되는 테이블의 이름을 지정합니다.
- `WHERE condition`: 뷰에 적용할 선택적인 조건을 지정합니다. 이를 통해 특정 데이터만 뷰에 표시할 수 있습니다.

예를 들어, `employees` 테이블로부터 이름과 직급 정보만을 포함하는 `employee_view`라는 뷰를 생성하려면 다음과 같이 작성할 수 있습니다.

```sql
CREATE VIEW employee_view AS
SELECT name, title
FROM employees;
```

### **2. 뷰 사용 권한 설정**
뷰를 생성한 후, 해당 뷰에 대한 액세스 권한을 설정해야 합니다. 기본적으로 뷰를 생성한 사용자가 해당 뷰에 대한 액세스 권한을 가지게 됩니다. 그러나 다른 사용자나 역할에게도 뷰를 사용할 수 있는 권한을 주고 싶다면 `GRANT` 문을 사용하여 액세스 권한을 명시적으로 할당할 수 있습니다.

`employee_view`에 대한 읽기 액세스 권한을 `user1` 사용자에게 주려면 다음과 같이 작성합니다.

```sql
GRANT SELECT ON employee_view TO user1;
```

### **3. 뷰 사용**
뷰가 생성되고 권한이 설정되었다면, 해당 뷰를 쿼리에서 사용할 수 있습니다.

```
SELECT * FROM employee_view;
```

뷰를 사용할때는 몇가지 사항을 고려해야 합니다.

- 뷰는 기존의 테이블을 기반으로 생성되므로, 뷰에 대한 변경은 실제 테이블에 영향을 주지 않습니다.
- 뷰는 데이터를 저장하지 않고 실시간으로 데이터를 조회하므로, 뷰를 통해 변경된 데이터는 실제 테이블에 반영되지 않습니다.
- 뷰는 복잡한 쿼리의 단순화나 데이터의 가공을 위해 사용되지만, 성능 저하의 가능성도 있습니다. 큰 데이터셋이나 복잡한 조인이 있는 경우 성능에 영향을 줄 수 있으므로 주의해야 합니다.

# **5. 뷰의 사용 사례**
데이터베이스에서 뷰는 실제로 유용하게 활용됩니다. 몇가지 대표적인 사례를 소개하고 각각에 대한 설명과 실제 쿼리를 살펴보겠습니다.

### **1. 복잡한 쿼리 단순화**
뷰를 사용하면 복잡한 쿼리를 단순화할 수 있습니다. 여러 개의 테이블 간 조인이 필요한 쿼리를 미리 정의된 뷰로 대체하여, 사용자는 간단한 쿼리만 작성하여 결과를 얻을 수 있습니다.

예를 들어, `orders`와 `customers` 테이블이 있을 때, 주문 정보와 고객 정보를 함께 조회하는 복잡한 쿼리를 뷰로 단순화할 수 있습니다.
```sql
CREATE VIEW order_details AS
SELECT o.order_id, o.order_date, c.customer_name
FROM orders o
INNER JOIN customers c ON o.customer_id = c.customer_id;
```

이제 `order_details` 뷰를 사용하여 간단하게 주문 정보와 고객 정보를 조회할 수 있습니다.
```sql
SELECT * FROM order_details;
```

### **2. 데이터 보안 강화**
뷰를 사용하여 데이터의 보안을 강화할 수 있습니다. 민감한 정보가 포함된 테이블을 직접 노출하지 않고, 필요한 열만 포함하여 사용자에게 제공할 수 있습니다.

예를 들어, `employees` 테이블에는 연봉 정보가 포함되어 있습니다. 그러나 일반 사용자에게는 연봉 정보를 숨기고 이름과 직급 정보만을 제공하고 싶다면 다음과 같이 뷰를 생성할 수 있습니다.
```sql
CREATE VIEW employee_info AS
SELECT name, title
FROM employees;
```

이제 `employee_info` 뷰를 통해 직원의 이름과 직급 정보만을 조회할 수 있으며, 연봉 정보는 숨겨져 있습니다.

### **3. 데이터 가공 및 형식 변환**
뷰를 사용하여 데이터를 가공하거나 형식을 변환할 수 있습니다. 특정 형식으로 변환된 데이터를 필요로 하는 경우, 뷰를 사용하여 원본 데이터를 변환된 형식으로 제공할 수 있습니다.

예를 들어, `sales` 테이블에는 날짜와 판매량이 포함되어 있습니다. 특정 형식으로 날짜를 표시하고자 할 때, 뷰를 사용하여 변환된 날짜 형식으로 데이터를 제공할 수 있습니다.
```sql
CREATE VIEW sales_summary AS
SELECT TO_CHAR(sale_date, 'YYYY-MM-DD') AS formatted_date, quantity
FROM sales;
```

이제 `sales_summary` 뷰를 통해 형식이 변환된 날짜와 판매량을 조회할 수 있습니다.

# **6. 성능 고려 사항**
데이터베이스 뷰는 유용한 도구지만, 잘못 사용하거나 설계하지 않으면 성능 저하의 가능성이 있습니다. 이제 데이터베이스 뷰를 사용할 때 고려해야 할 성능 측면에 대해 다루고, 성능을 향상시킬 수 있는 방법에 대해 알아보겠습니다.

### **1. 조인과 쿼리 복잡성**
뷰를 생성할 때 조인 연산이 포함된 복잡한 쿼리를 사용한다면 성능 저하가 발생할 수 있습니다. 조인이 많거나 복잡한 쿼리는 처리 시간을 증가시킬 수 있으므로, 필요한 경우 쿼리를 최적화하고 인덱스를 활용하는 것이 중요합니다.

- 인덱스 활용: 뷰의 성능을 향상시키기 위해 뷰에 사용된 열에 인덱스를 생성할 수 있습니다. 이는 조인 조건이나 필터링 조건에 사용되는 열에 인덱스를 생성하는 것과 동일한 원리입니다. 당연히 뷰 자체에 인덱스를 생성할 순 없습니다.

### **2. 뷰 재작성**
데이터베이스의 기본 테이블이 변경될 때, 뷰의 정의를 재작성하는 것이 성능 향상에 도움이 될 수 있습니다. 변경된 데이터에 대한 최신 정보를 유지하고 뷰의 쿼리 실행 계획을 최적화하기 위해 뷰를 재작성하는 것이 좋습니다.

> 일부 데이터베이스 시스템은 뷰를 자동으로 재작성하는 기능을 제공합니다. 이를 활용하여 데이터 변경 시 자동으로 뷰를 갱신하도록 설정할 수 있습니다.

### **3. 쿼리 최적화**
뷰를 사용하는 쿼리의 성능을 향상시키기 위해 쿼리 최적화를 고려해야 합니다. 쿼리 실행 계획을 분석하고 성능 향상을 위해 적절한 인덱스를 생성하거나 쿼리 튜닝을 수행하는 것이 중요합니다.

> 데이터베이스 시스템은 쿼리 실행 계획을 제공하여 쿼리의 실행 계획을 분석할 수 있습니다. 이를 통해 비효율적인 연산이나 조인을 확인하고 최적화할 수 있습니다.

### **4. 제약 사항 고려**
뷰를 사용할 때 주의해야 할 제약 사항도 고려해야 합니다. 예를 들어, 뷰의 정의에 사용된 테이블이나 열이 변경되거나 삭제되면 뷰가 올바르게 동작하지 않을 수 있습니다. 이에 대비하여 뷰를 사용하기 전에 제약 사항을 확인하고 유지보수에 주의해야 합니다.

# **7. 마무리**
데이터베이스 뷰를 사용하면 복잡한 쿼리를 단순화하고, 보안을 강화하며, 데이터를 가공하거나 형식을 변환할 수 있습니다. 뷰는 사용자에게 필요한 데이터를 간편하게 제공하며, 중복 데이터를 제거하여 일관성을 유지합니다. 또한, 데이터베이스의 성능을 향상시키기 위해 인덱스를 활용하거나 뷰를 재작성하는 등의 방법을 적용할 수 있습니다.

뷰를 적절히 활용하면 데이터베이스 작업을 효율적으로 수행할 수 있습니다. 복잡한 쿼리를 단순화하여 개발자와 사용자 모두의 작업을 간편하게 만들고, 데이터의 보안과 일관성을 유지할 수 있습니다. 또한, 성능을 향상시키기 위해 쿼리를 최적화하고 인덱스를 활용하는 등의 방법을 적용하여 데이터베이스의 응답 시간을 줄일 수 있습니다.

데이터베이스 뷰는 데이터 관리와 분석 작업에 있어 필수적인 도구입니다. 우리는 이제 뷰의 개념, 생성 방법, 사용 사례, 성능 고려 사항 등을 다루며 데이터베이스 뷰의 활용에 대해 배웠습니다. 이제 여러분은 데이터베이스 뷰를 효과적으로 활용하여 더 나은 데이터 관리와 분석을 실현할 수 있을 것입니다.

데이터베이스 뷰의 중요성을 인지하고, 적절한 상황에서 뷰를 적용하여 데이터베이스 작업을 더욱 효율적으로 수행할 수 있도록 노력해보세요. 데이터베이스 뷰는 데이터의 가시성과 일관성을 제공하며, 데이터 관리와 분석의 효율성을 높여줄 것입니다.

# **끄적끄적..**
이 글은 **[Hibernate 'introduce @View annotation' PR](https://github.com/hibernate/hibernate-orm/pull/6614)**을 보고 삘받아서 정리한 글입니다. 2023년에 ORM에서 뷰를 사용할수 있게 될수도 있다는 것에 좋아하는게 맞나 모르겠지만... 일단은 좋습니다. 나오면 얼른 사용해보고 싶네요.
