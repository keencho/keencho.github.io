[ { "title": "JPA Transactional ì ê²€í•˜ê¸°", "url": "/posts/transactional-think/", "categories": "Java", "tags": "Java, JPA", "date": "2025-06-27 20:12:00 +0900", "snippet": "JPA Transactional ì ê²€í•˜ê¸°JPAë¥¼ ë‹¤ë£¨ëŠ” ê°œë°œìë¼ë©´ Transactionalì˜ ë™ì‘ ì›ë¦¬ë¥¼ ì •í™•íˆ ì´í•´í•´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ ì†”ì§íˆ ë§í•˜ë©´, í”„ë¡œì íŠ¸ ì´ˆê¸°ì— ì„¸ìš´ ê°€ì´ë“œë¼ì¸ì„ ì²˜ìŒì—ëŠ” ì˜ ì§€ì¼°ì§€ë§Œ ê°œë°œì´ ì§„í–‰ë˜ë©´ì„œ ì ì  ì¼ë‹¨ @Transactional ë¶™ì´ê³  ë³´ìëŠ” ì‹ìœ¼ë¡œ ìŠµê´€ì ìœ¼ë¡œ ì‚¬ìš©í–ˆë˜ ì ì´ ë§ë‹¤. ë‹¹ì—°íˆ ì´ëŸ° ë¬´ë¶„ë³„í•œ ì‚¬ìš©ì€ ì—¬ëŸ¬ ë¬¸ì œë¥¼ ì•¼ê¸°í–ˆê³ , ì´ë¥¼ ê³„ê¸°ë¡œ JPA Transactional ì‚¬ìš©ë²•ì„ ë‹¤ì‹œ ì ê²€í•˜ê³  ëª…í™•í•œ ì›ì¹™ì„ ì •ë¦½í•´ë³´ê³ ì í•œë‹¤.@Transactional ë‚¨ìš©í•˜ì§€ ì•Šê¸°@Transactionalì„ ë‚¨ìš©í•˜ë©´ ì–´ë–¤ ì¼ì´ ì¼ì–´ë‚  ìˆ˜ ìˆëŠ”ì§€ ì•Œì•„ë³´ì. í…ŒìŠ¤íŠ¸ í™˜ê²½ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.hikari: maximum-pool-size: 1 connection-timeout: 1000jpa: open-in-view: false @GetMapping(\"/concurrent\")public ResponseEntity&lt;?&gt; concurrentTest() { System.out.println(\"ğŸš€ ë™ì‹œ í…ŒìŠ¤íŠ¸ ì‹œì‘!\"); var future1 = CompletableFuture.supplyAsync(() -&gt; { try { System.out.println(\"ğŸ”´ ìŠ¤ë ˆë“œ1 ì‹œì‘: \" + Thread.currentThread().getName()); testService.test(); System.out.println(\"ğŸŸ¢ ìŠ¤ë ˆë“œ1 ì™„ë£Œ: \" + Thread.currentThread().getName()); return \"ì™„ë£Œ1\"; } catch (Exception e) { System.out.println(\"âŒ ìŠ¤ë ˆë“œ1 ì‹¤íŒ¨: \" + e.getMessage()); return \"ì‹¤íŒ¨1: \" + e.getMessage(); } }); var future2 = CompletableFuture.supplyAsync(() -&gt; { try { System.out.println(\"ğŸ”´ ìŠ¤ë ˆë“œ2 ì‹œì‘: \" + Thread.currentThread().getName()); testService.save(); System.out.println(\"ğŸŸ¢ ìŠ¤ë ˆë“œ2 ì™„ë£Œ: \" + Thread.currentThread().getName()); return \"ì™„ë£Œ2\"; } catch (Exception e) { System.out.println(\"âŒ ìŠ¤ë ˆë“œ2 ì‹¤íŒ¨: \" + e.getMessage()); return \"ì‹¤íŒ¨2: \" + e.getMessage(); } }); return ResponseEntity.ok( Map.of( \"result1\", future1.join(), \"result2\", future2.join() ) );} OpenEntityManagerInViewê°€ HTTP ìš”ì²­ë‹¹ í•˜ë‚˜ì˜ EntityManagerë¥¼ ìœ ì§€í•˜ê³ , ì´ëŠ” ì»¤ë„¥ì…˜ì„ ë¨¼ì € ì ìœ í•˜ê¸°ì— open-in-view ë¥¼ ë¹„í™œì„±í™” í•œë‹¤. CompletableFutre.supplyAsync()ë¡œ 2ê°œì˜ ë³„ë„ ìŠ¤ë ˆë“œ í’€ì—ì„œ ë™ì‹œì— bookService.save()ë¥¼ í˜¸ì¶œí•œë‹¤.DB ì‘ì—… ì—†ëŠ” ë©”ì†Œë“œì— @Transactional@SneakyThrows@Transactionalpublic void test() { Thread.sleep(2000); var a = 3; var b = 2; var c = a / b; System.out.println(c);}DB ì‘ì—…ì´ ì—†ë‹¤. ê·¸ëŸ¼ì—ë„ @Transactionalì´ íŠ¸ëœì­ì…˜ ì‹œì‘ë¶€í„° ëê¹Œì§€ ì»¤ë„¥ì…˜ì„ í™€ë”©í•˜ê¸°ì— 2ê°œì˜ í˜¸ì¶œì¤‘ í•œê°œëŠ” 1ì´ˆì˜ ì»¤ë„¥ì…˜ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ì¸í•´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤. ë¬¼ë¡  DB ì‘ì—…ì´ ì—†ê¸°ì— ê·¸ë¦¬ ì‹¬ê°í•˜ì§€ ì•Šì€ ë¬¸ì œì´ê¸´ í• ê²ƒì´ë‹¤.HikariPool-1 - Connection is not available, request timed out after 1010ms (total=1, active=1, idle=0, waiting=0)ê²°ê³¼:{ \"result2\": \"ì™„ë£Œ2\", \"result1\": \"ì‹¤íŒ¨1: Could not open JPA EntityManager for transaction\"}ë‚´ë¶€ DB ì‘ì—…ì´ ìˆëŠ” ë©”ì†Œë“œì— @Transactional@SneakyThrows@Transactionalpublic void test() { var order = apiService.order(); Thread.sleep(2000); var result = new orderResult(); result.setSuccess(order.isSuccess()); result.setMessage(order.getMessage()); result.setOrderNo(order.getOrderNo()); orderResultRepository.save(result);}ì´ë²ˆì—” ì™¸ë¶€ APIë¥¼ í˜¸ì¶œí•˜ê³  ê²°ê³¼ë¥¼ DBì— ì €ì¥í•˜ëŠ” ì˜ˆì œì´ë‹¤. ì™¸ë¶€ API í˜¸ì¶œê¹Œì§„ ì„±ê³µí•˜ê² ìœ¼ë‚˜, ë‚´ë¶€ DBì— ê²°ê³¼ë¥¼ ì‘ì—…í•˜ê¸° ìœ„í•´ ëŒ€ê¸°í•˜ëŠ” 2ì´ˆê°„ ì—ëŸ¬ê°€ ë°œìƒí•  ê²ƒì´ë‹¤. DBì—ëŠ” 1ê°œì˜ ê²°ê³¼ë§Œ ì €ì¥ëœë‹¤.ì´ëŠ” ì™¸ë¶€ ì„œë¹„ìŠ¤ì—ëŠ” ì£¼ë¬¸ ì •ë³´ê°€ ìˆê³  ë‚´ë¶€ ì„œë¹„ìŠ¤ì—ëŠ” ì£¼ë¬¸ ê²°ê³¼ê°€ ì—†ëŠ”, ìƒí™©ì— ë”°ë¼ ì‹¬ê°í•œ ë¬¸ì œë¥¼ ì•¼ê¸°í•  ìˆ˜ ìˆë‹¤.ë˜í•œ ì™¸ë¶€ API ë™ì‘ì— ì˜í•´ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ê°€ ì§€ì—°ë˜ê³  ê·¸ë§Œí¼ ë‚´ë¶€ ì„œë¹„ìŠ¤ DB ì—°ê²°ì‹œê°„ì— ì˜í–¥ì„ ë°›ê¸° ë•Œë¬¸ì— ë§¤ìš° ì¤‘ìš”í•˜ê²Œ ì ‘ê·¼í•´ì•¼í•  í•„ìš”ê°€ ìˆë‹¤.HikariPool-1 - Connection is not available, request timed out after 1011ms (total=1, active=1, idle=0, waiting=0){ \"result2\": \"ì™„ë£Œ2\", \"result1\": \"ì‹¤íŒ¨1: Could not open JPA EntityManager for transaction\"}ë‹¨ìˆœ ì¡°íšŒë§Œ ìˆ˜í–‰í•˜ëŠ” ë©”ì†Œë“œì— @Transactionalë‹¨ìˆœ ì¡°íšŒë§Œ ìˆ˜í–‰í•˜ëŠ” ë©”ì†Œë“œì— @Transactionalì„ ë¶™ì˜€ì„ë•Œ íŠ¸ëœì­ì…˜ì´ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ì.@Componentpublic class TransactionChecker { @Autowired DataSource dataSource; /** * 1. íŠ¸ëœì­ì…˜ ìƒíƒœ í™•ì¸ */ public void checkTransactionStatus(String actionName) { var isTransactionActive = TransactionSynchronizationManager.isActualTransactionActive(); var isSynchronizationActive = TransactionSynchronizationManager.isSynchronizationActive(); var transactionName = TransactionSynchronizationManager.getCurrentTransactionName(); System.out.printf(\"ğŸ” [%s] íŠ¸ëœì­ì…˜ ìƒíƒœ:%n\", actionName); System.out.printf(\" â”œâ”€ í™œì„±í™”: %s%n\", isTransactionActive ? \"âœ… YES\" : \"âŒ NO\"); System.out.printf(\" â”œâ”€ ë™ê¸°í™”: %s%n\", isSynchronizationActive ? \"âœ… YES\" : \"âŒ NO\"); System.out.printf(\" â””â”€ ì´ë¦„: %s%n\", transactionName != null ? transactionName : \"ì—†ìŒ\"); } /** * 2. HikariCP ì»¤ë„¥ì…˜ í’€ ìƒíƒœ í™•ì¸ */ public void checkConnectionPoolStatus(String actionName) { if (dataSource instanceof HikariDataSource hikariDataSource) { var poolBean = hikariDataSource.getHikariPoolMXBean(); System.out.printf(\"ğŸŠâ€â™‚ï¸ [%s] HikariCP ìƒíƒœ:%n\", actionName); System.out.printf(\" â”œâ”€ í™œì„± ì»¤ë„¥ì…˜: %d%n\", poolBean.getActiveConnections()); System.out.printf(\" â”œâ”€ ìœ íœ´ ì»¤ë„¥ì…˜: %d%n\", poolBean.getIdleConnections()); System.out.printf(\" â”œâ”€ ì „ì²´ ì»¤ë„¥ì…˜: %d%n\", poolBean.getTotalConnections()); System.out.printf(\" â”œâ”€ ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œ: %d%n\", poolBean.getThreadsAwaitingConnection()); System.out.printf(\" â””â”€ ìµœëŒ€ í’€ í¬ê¸°: %d%n\", hikariDataSource.getMaximumPoolSize()); } else { System.out.printf(\"ğŸŠâ€â™‚ï¸ [%s] HikariCPê°€ ì•„ë‹˜: %s%n\", actionName, dataSource.getClass().getSimpleName()); } } /** * 3. í•œ ë²ˆì— ëª¨ë“  ìƒíƒœ í™•ì¸ */ public void checkAll(String actionName) { var threadName = Thread.currentThread().getName(); System.out.printf(\"ğŸ“Š === [%s] %s ìƒíƒœ ì²´í¬ ===%n\", actionName, threadName); this.checkTransactionStatus(actionName); this.checkConnectionPoolStatus(actionName); System.out.println(\"ğŸ“Š ========================================\"); }}íŠ¸ëœì­ì…˜ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” í—¬í¼ í´ë˜ìŠ¤ë‹¤.1. @Transactional ì—†ì´ ì¡°íšŒpublic void test() { transactionChecker.checkAll(\"ì½ê¸° ì „\"); var list = authorRepository.findAll(); transactionChecker.checkAll(\"ì½ì€ í›„\");}ğŸ”´ [13:57:07.976] http-nio-8080-exec-1 - ìš”ì²­ ì‹œì‘ğŸ“Š === [ì½ê¸° ì „] http-nio-8080-exec-1 ìƒíƒœ ì²´í¬ ===ğŸ” [ì½ê¸° ì „] íŠ¸ëœì­ì…˜ ìƒíƒœ: â”œâ”€ í™œì„±í™”: âŒ NO â”œâ”€ ë™ê¸°í™”: âŒ NO â””â”€ ì´ë¦„: ì—†ìŒğŸŠâ€â™‚ï¸ [ì½ê¸° ì „] HikariCP ìƒíƒœ: â”œâ”€ í™œì„± ì»¤ë„¥ì…˜: 0 â”œâ”€ ìœ íœ´ ì»¤ë„¥ì…˜: 1 â”œâ”€ ì „ì²´ ì»¤ë„¥ì…˜: 1 â”œâ”€ ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œ: 0 â””â”€ ìµœëŒ€ í’€ í¬ê¸°: 1ğŸ“Š ========================================13:57:07.980 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly13:57:07.980 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1191829786&lt;open&gt;)] for JPA transaction13:57:07.983 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@42c003ac]13:57:08.054 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit13:57:08.054 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1191829786&lt;open&gt;)]13:57:08.055 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1191829786&lt;open&gt;)] after transactionğŸ“Š === [ì½ì€ í›„] http-nio-8080-exec-1 ìƒíƒœ ì²´í¬ ===ğŸ” [ì½ì€ í›„] íŠ¸ëœì­ì…˜ ìƒíƒœ: â”œâ”€ í™œì„±í™”: âŒ NO â”œâ”€ ë™ê¸°í™”: âŒ NO â””â”€ ì´ë¦„: ì—†ìŒğŸŠâ€â™‚ï¸ [ì½ì€ í›„] HikariCP ìƒíƒœ: â”œâ”€ í™œì„± ì»¤ë„¥ì…˜: 0 â”œâ”€ ìœ íœ´ ì»¤ë„¥ì…˜: 1 â”œâ”€ ì „ì²´ ì»¤ë„¥ì…˜: 1 â”œâ”€ ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œ: 0 â””â”€ ìµœëŒ€ í’€ í¬ê¸°: 1ğŸ“Š ========================================ğŸŸ¢ [13:57:08.056] http-nio-8080-exec-1 - ìš”ì²­ ì™„ë£Œ (ì†Œìš”: 80ms)ê²°ê³¼ëŠ” ìœ„ì™€ ê°™ë‹¤. authorRepository.findAll() ë¥¼ ìˆ˜í–‰í• ë•Œ íŠ¸ëœì­ì…˜ì´ ìƒì„±ë˜ê³  ë°”ë¡œ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ëœë‹¤. ë‹¤ì‹œë§í•´, ì´ë•Œ hikari poolì—ì„œ ì»¤ë„¥ì…˜ì„ íšë“í•˜ê³  ë°”ë¡œ ë°˜ë‚©í•œë‹¤ëŠ” ì˜ë¯¸ê°€ ëœë‹¤.2. @Transactional ë¶™ì´ê³  ì¡°íšŒ@Transactionalpublic void test() { transactionChecker.checkAll(\"ì½ê¸° ì „\"); var list = authorRepository.findAll(); transactionChecker.checkAll(\"ì½ì€ í›„\");}ğŸ”´ [13:59:19.626] http-nio-8080-exec-3 - ìš”ì²­ ì‹œì‘13:59:19.628 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.keencho.spring.service.TestService.test]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT13:59:19.628 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(2125691159&lt;open&gt;)] for JPA transaction13:59:19.631 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@27049398]ğŸ“Š === [ì½ê¸° ì „] http-nio-8080-exec-3 ìƒíƒœ ì²´í¬ ===ğŸ” [ì½ê¸° ì „] íŠ¸ëœì­ì…˜ ìƒíƒœ: â”œâ”€ í™œì„±í™”: âœ… YES â”œâ”€ ë™ê¸°í™”: âœ… YES â””â”€ ì´ë¦„: com.keencho.spring.service.TestService.testğŸŠâ€â™‚ï¸ [ì½ê¸° ì „] HikariCP ìƒíƒœ: â”œâ”€ í™œì„± ì»¤ë„¥ì…˜: 1 â”œâ”€ ìœ íœ´ ì»¤ë„¥ì…˜: 0 â”œâ”€ ì „ì²´ ì»¤ë„¥ì…˜: 1 â”œâ”€ ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œ: 0 â””â”€ ìµœëŒ€ í’€ í¬ê¸°: 1ğŸ“Š ========================================13:59:19.634 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2125691159&lt;open&gt;)] for JPA transaction13:59:19.634 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Participating in existing transactionğŸ“Š === [ì½ì€ í›„] http-nio-8080-exec-3 ìƒíƒœ ì²´í¬ ===ğŸ” [ì½ì€ í›„] íŠ¸ëœì­ì…˜ ìƒíƒœ: â”œâ”€ í™œì„±í™”: âœ… YES â”œâ”€ ë™ê¸°í™”: âœ… YES â””â”€ ì´ë¦„: com.keencho.spring.service.TestService.testğŸŠâ€â™‚ï¸ [ì½ì€ í›„] HikariCP ìƒíƒœ: â”œâ”€ í™œì„± ì»¤ë„¥ì…˜: 1 â”œâ”€ ìœ íœ´ ì»¤ë„¥ì…˜: 0 â”œâ”€ ì „ì²´ ì»¤ë„¥ì…˜: 1 â”œâ”€ ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œ: 0 â””â”€ ìµœëŒ€ í’€ í¬ê¸°: 1ğŸ“Š ========================================13:59:19.703 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit13:59:19.704 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(2125691159&lt;open&gt;)]13:59:19.705 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(2125691159&lt;open&gt;)] after transactionğŸŸ¢ [13:59:19.705] http-nio-8080-exec-3 - ìš”ì²­ ì™„ë£Œ (ì†Œìš”: 79ms)ê²°ê³¼ëŠ” ìœ„ì™€ ê°™ë‹¤. http ìš”ì²­ì´ ë“¤ì–´ì˜¤ê³  testService.test() ë©”ì†Œë“œë¥¼ íƒ”ì„ë•Œ íŠ¸ëœì­ì…˜ì´ ìƒì„±ëœë‹¤. ê·¸ í›„ authRepository.findAll() ìˆ˜í–‰ì‹œ ê¸°ì¡´ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•˜ê³  ë©”ì†Œë“œê°€ ì¢…ë£Œë ë•Œ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ê³  ì¢…ë£Œí•œë‹¤.ì •ë¦¬í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.@Transactional ìˆìŒ:ë©”ì†Œë“œ ì‹œì‘ â†’ [ì»¤ë„¥ì…˜ íšë“] â†’ DBì‘ì—…1 â†’ DBì‘ì—…2 â†’ [ì»¤ë„¥ì…˜ ë°˜ë‚©] â† ë©”ì†Œë“œ ë â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì­‰ í™€ë”© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜@Transactional ì—†ìŒ:ë©”ì„œë“œ ì‹œì‘ â†’ [íšë“â†’ë°˜ë‚©] â†’ [íšë“â†’ë°˜ë‚©] â†’ ë©”ì„œë“œ ë DBì‘ì—…1 DBì‘ì—…2ì„±ëŠ¥ ì˜í–¥:- @Transactional: ì»¤ë„¥ì…˜ í™€ë”© ì‹œê°„ â†‘, DB ì‘ì—… ì¼ê´€ì„± âœ“- ì—†ìŒ: ì»¤ë„¥ì…˜ íšë“/ë°˜ë‚© ì˜¤ë²„í—¤ë“œ â†‘, ê°œë³„ ì»¤ë°‹@Transactional rollbackë¡¤ë°± ì²˜ë¦¬ì— ëŒ€í•œ ì „ëµì„ ì˜ ì„¸ì›Œì•¼ í•œë‹¤. í•œ íŠ¸ëœì­ì…˜ ë²”ìœ„ ë‚´ì—ì„œ Unchecked Exceptionì´ ë°œìƒí•˜ë©´ ìë™ ë¡¤ë°±ë˜ì§€ë§Œ, Checked Exceptionì€ ê¸°ë³¸ì ìœ¼ë¡œ ì»¤ë°‹ëœë‹¤. ì´ëŠ” ê¸°ë³¸ì ì¸ ê°œë…ì´ê³ , @Transactionalì„ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠëƒì— ë”°ë¼ ë™ì‘ì´ ì–´ë–»ê²Œ ë‹¬ë¼ì§€ëŠ”ì§€ í™•ì‹¤íˆ ì•Œì•„ì•¼ í•œë‹¤.TransactionAspectSupportì˜ ë™ì‘ ì›ë¦¬TransactionAspectSupportëŠ” @Transactionalì´ ë¶™ì€ ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•  ë•Œ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” í•µì‹¬ í´ë˜ìŠ¤ì´ë‹¤. Springì€ AOP í”„ë¡ì‹œ íŒ¨í„´ì„ í†µí•´ ì‹¤ì œ ë©”ì„œë“œ í˜¸ì¶œ ì „í›„ë¡œ íŠ¸ëœì­ì…˜ ì‹œì‘, ì»¤ë°‹, ë¡¤ë°± ë¡œì§ì„ ì‚½ì…í•œë‹¤.Unchecked Exception ë¡¤ë°± ì •ì±… Unchecked Exception (RuntimeException, Error): ìë™ ë¡¤ë°± Checked Exception (IOException, SQLException ë“±): ë¡¤ë°± ì•ˆí•¨ì´ëŠ” Unchecked Exceptionì´ ì˜ˆìƒì¹˜ ëª»í•œ í”„ë¡œê·¸ë˜ë° ì˜¤ë¥˜ë‚˜ ì‹œìŠ¤í…œ ì¥ì• ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë°˜ë©´, Checked Exceptionì€ ì˜ˆìƒ ê°€ëŠ¥í•œ ìƒí™©ìœ¼ë¡œ ê°œë°œìê°€ ì˜ë„ì ì¸ ì˜ˆì™¸ ì²˜ë¦¬ ë¡œì§ì„ ì‘ì„±í–ˆì„ ê°€ëŠ¥ì„±ì´ ë†’ê¸° ë•Œë¬¸ì´ë‹¤.try-catchë¡œ ê°ì‹¸ë„ ë¡¤ë°±ë˜ëŠ” ì´ìœ RuntimeExceptionì´ ë°œìƒí•˜ëŠ” ìˆœê°„ Springì€ í˜„ì¬ íŠ¸ëœì­ì…˜ì„ â€œrollback-onlyâ€ ìƒíƒœë¡œ ë§ˆí‚¹í•œë‹¤. ì´í›„ try-catchë¡œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•´ì„œ ë©”ì„œë“œê°€ ì •ìƒ ì¢…ë£Œë˜ì–´ë„, ì´ë¯¸ ë§ˆí‚¹ëœ íŠ¸ëœì­ì…˜ì€ ìµœì¢…ì ìœ¼ë¡œ ë¡¤ë°±ëœë‹¤. íŠ¸ëœì­ì…˜ ìƒíƒœëŠ” ì˜ˆì™¸ ë°œìƒ ì‹œì ì— ê²°ì •ë˜ë©°, ì˜ˆì™¸ ì²˜ë¦¬ ì—¬ë¶€ëŠ” ì´ ê²°ì •ì„ ë°”ê¾¸ì§€ ëª»í•œë‹¤.@Transactionalpublic void save() { authorRepository.save(new Author(\"í™ê¸¸ë™\")); try { actionService.doAction(); } catch (Exception ignored) { }}@Transactionalpublic void doAction() throws Exception { throw new Exception(\"Error\"); // Checked Exception: ë¡¤ë°± ì•ˆí•¨}@Transactionalpublic void doAction() { throw new RuntimeException(\"Error\"); // Unchecked Exception: ìë™ ë¡¤ë°± }REQUIRES_NEWë¥¼ í™œìš©í•œ ë…ë¦½ íŠ¸ëœì­ì…˜@Transactional(propagation = Propagation.REQUIRES_NEW)ë¥¼ ì‚¬ìš©í•˜ë©´ ë³„ë„ì˜ ë…ë¦½ì ì¸ íŠ¸ëœì­ì…˜ì´ ìƒì„±ëœë‹¤. ì´ ê²½ìš° ë‚´ë¶€ íŠ¸ëœì­ì…˜ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ í•´ë‹¹ íŠ¸ëœì­ì…˜ë§Œ ë¡¤ë°±ë˜ê³ , ì™¸ë¶€ íŠ¸ëœì­ì…˜ì€ ì˜í–¥ë°›ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ ë¡œê·¸ ì €ì¥ì´ë‚˜ ê°ì‚¬(audit) ê¸°ë¡ì²˜ëŸ¼ ë©”ì¸ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤íŒ¨ì™€ ê´€ê³„ì—†ì´ ë°˜ë“œì‹œ ì €ì¥ë˜ì–´ì•¼ í•˜ëŠ” ë°ì´í„°ì— í™œìš©í•  ìˆ˜ ìˆë‹¤.@Transactional(propagation = Propagation.REQUIRES_NEW)public void doAction() { throw new RuntimeException(\"Error\"); // Unchecked Exception: ìë™ ë¡¤ë°± }ê·¸ëŸ¬ë‚˜ ì´ëŠ” ì»¤ë„¥ì…˜ í’€ì—ì„œ ìƒˆë¡œìš´ ì»¤ë„¥ì…˜ì„ ì–»ì–´ì˜¨ë‹¤ëŠ” ì˜ë¯¸ì´ê¸° ë•Œë¬¸ì—, REQUIRES_NEWê°€ ë¶™ì€ ë©”ì†Œë“œë¥¼ ë°˜ë³µë¬¸ì„ í†µí•´ í˜¸ì¶œí•œë‹¤ë©´ ë¡œì§ì— ë”°ë¼ ì»¤ë„¥ì…˜ í’€ì´ ê³ ê°ˆë˜ì–´ íƒ€ì„ì•„ì›ƒì´ë‚˜ ëŒ€ê¸° ìƒí™©ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤. íŠ¹íˆ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì´ ì»¤ë„¥ì…˜ì„ ì ìœ í•œ ìƒíƒœì—ì„œ ë‚´ë¶€ì ìœ¼ë¡œ ì—¬ëŸ¬ ê°œì˜ ë…ë¦½ íŠ¸ëœì­ì…˜ì„ ë™ì‹œì— ìƒì„±í•˜ë ¤ í•  ë•Œ ì£¼ì˜í•´ì•¼ í•œë‹¤.ë™ì¼í•œ í´ë˜ìŠ¤ ë‚´ë¶€ í˜¸ì¶œ ì‹œ @Transactional ë¬´ì‹œ@Transactionalpublic void save() { authorRepository.save(new Author(\"í™ê¸¸ë™\")); try { this.doAction(); } catch (Exception ignored) { }}@Transactionalpublic void doAction() { throw new RuntimeException(\"Error\");}ì™¸ë¶€ì—ì„œ save() í˜¸ì¶œ ì‹œ í”„ë¡ì‹œë¥¼ í†µí•´ íŠ¸ëœì­ì…˜ì´ ì‹œì‘ë˜ì§€ë§Œ, this.doAction() í˜¸ì¶œì€ ì§ì ‘ì ì¸ Java ë©”ì„œë“œ í˜¸ì¶œì´ë¯€ë¡œ Spring í”„ë¡ì‹œê°€ ê°œì…í•  ìˆ˜ ì—†ë‹¤. ë”°ë¼ì„œ doAction()ì˜ @Transactionalì€ ë¬´ì‹œë˜ê³  Unchecked Exceptionì´ ë°œìƒí•´ë„ ë¡¤ë°±ë˜ì§€ ì•ŠëŠ”ë‹¤.ë¡¤ë°±ì´ ë˜ì–´ì•¼ í•œë‹¤ë©´ ë‹¤ìŒ ë°©ë²•ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ë©´ ëœë‹¤. try-catch ì œê±° ìˆ˜ë™ ë¡¤ë°± (TransactionAspectSupport.currentTransactionStatus().setRollbackOnly()) ë³„ë„ ì„œë¹„ìŠ¤ë¡œ ë¶„ë¦¬ Self Injection ì‚¬ìš© (allow-circular-references: true í•„ìš”) AspectJ ìœ„ë¹™ ì‚¬ìš© (ë¹„ì¶”ì²œ)@Transactional ìœ ë¬´ì— ë”°ë¥¸ ì°¨ì´ì doAction()ì— @Transactionalì´ ìˆë“  ì—†ë“  Repository í˜¸ì¶œ ì‹œ ê¸°ì¡´ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•˜ëŠ” ê±´ ë™ì¼í•˜ë‹¤. í•˜ì§€ë§Œ ì˜ˆì™¸ ì²˜ë¦¬ì—ì„œ ì¤‘ìš”í•œ ì°¨ì´ê°€ ìˆë‹¤.@Transactionalpublic void save() { authorRepository.save(new Author(\"í™ê¸¸ë™\")); try { actionService.doAction(); } catch (Exception ignored) { }}public void doAction() { authorRepository.save(new Author(\"ê±°ë¶ì´\")); // ê¸°ì¡´ íŠ¸ëœì­ì…˜ ì°¸ì—¬ throw new RuntimeException(\"Error\");}doAction()ì— @Transactionalì´ ì—†ë‹¤. ê·¸ë˜ë„ ë‘ ë°ì´í„° ëª¨ë‘ ì €ì¥ëœë‹¤. RuntimeExceptionì´ ë°œìƒí•´ë„ ë‹¨ìˆœíˆ ìƒìœ„ë¡œ ì „íŒŒë  ë¿ì´ë‹¤. try-catchë¡œ ì¡ìœ¼ë©´ save() ë©”ì„œë“œê°€ ì •ìƒ ì¢…ë£Œëœ ê²ƒìœ¼ë¡œ ì¸ì‹í•˜ê³  íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤.@Transactionalì´ ìˆëŠ” ê²½ìš° RuntimeException ë°œìƒ ì‹œ Springì´ í˜„ì¬ íŠ¸ëœì­ì…˜ì„ â€œrollback-onlyâ€ë¡œ ë§ˆí‚¹í•œë‹¤. ì´í›„ try-catchë¡œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•´ì„œ save() ë©”ì„œë“œê°€ ì •ìƒ ì¢…ë£Œë˜ì–´ë„, Springì´ ì»¤ë°‹ì„ ì‹œë„í•  ë•Œ â€œrollback-onlyâ€ ë§ˆí‚¹ì„ ë°œê²¬í•˜ê³  UnexpectedRollbackExceptionì„ ë˜ì§„ë‹¤.ì™œ ì´ëŸ° ì°¨ì´ê°€ ë°œìƒí• ê¹Œ?Springì˜ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ë°©ì‹ì„ ì‚´í´ë³´ì. @Transactional ì—†ëŠ” ê²½ìš°: doAction()ì€ ë‹¨ìˆœí•œ Java ë©”ì„œë“œë‹¤. Repository í˜¸ì¶œí•  ë•Œë§Œ ê¸°ì¡´ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•œë‹¤. RuntimeExceptionì´ ë°œìƒí•´ë„ Springì€ ì´ë¥¼ â€œíŠ¸ëœì­ì…˜ì  ì˜¤ë¥˜â€ë¡œ ì¸ì‹í•˜ì§€ ì•ŠëŠ”ë‹¤. ë‹¨ì§€ ì¼ë°˜ì ì¸ ì˜ˆì™¸ì¼ ë¿ì´ê³ , try-catchë¡œ ì²˜ë¦¬ë˜ë©´ ì•„ë¬´ ë¬¸ì œì—†ì´ ì»¤ë°‹í•œë‹¤. @Transactional ìˆëŠ” ê²½ìš°: doAction()ë„ íŠ¸ëœì­ì…˜ ê´€ë¦¬ ëŒ€ìƒì´ ëœë‹¤. Spring AOPê°€ ë©”ì„œë“œë¥¼ ê°ì‹¸ì„œ ì˜ˆì™¸ë¥¼ ëª¨ë‹ˆí„°ë§í•œë‹¤. RuntimeException ë°œìƒ ì‹œ â€œì´ íŠ¸ëœì­ì…˜ì€ ë¬¸ì œê°€ ìˆë‹¤â€ê³  ë§ˆí‚¹í•´ë‘”ë‹¤. ì´í›„ ìƒìœ„ì—ì„œ try-catchë¡œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•´ë„ Springì€ â€œì–´? ë¬¸ì œê°€ ìˆì—ˆëŠ”ë° ì»¤ë°‹í•˜ë ¤ê³  í•˜ë„¤?â€ë¼ê³  ì¸ì‹í•˜ê³  UnexpectedRollbackExceptionì„ ë˜ì§„ë‹¤.í•µì‹¬ì€ Springì´ ì–¸ì œ íŠ¸ëœì­ì…˜ ìƒíƒœë¥¼ ì¶”ì í•˜ëŠëƒë‹¤. @Transactionalì´ ë¶™ì–´ì•¼ë§Œ Springì´ í•´ë‹¹ ë©”ì„œë“œì˜ ì˜ˆì™¸ë¥¼ â€œíŠ¸ëœì­ì…˜ ê´€ì ì—ì„œâ€ ë°”ë¼ë³¸ë‹¤.@Transactional(readOnly = true)ê°œë°œì„ í•˜ë‹¤ ë³´ë©´ ë‹¨ìˆœí•œ ì¡°íšŒ ë©”ì„œë“œì— @Transactional(readOnly = true)ë¥¼ ë¶™ì¼ì§€ ë§ì§€ ê³ ë¯¼í•˜ê²Œ ëœë‹¤. íŠ¹íˆ OSIVë¥¼ ë¹„í™œì„±í™”í•œ í™˜ê²½ì—ì„œëŠ” ì´ ì„ íƒì´ ë”ìš± ì¤‘ìš”í•˜ë‹¤.PostgreSQL í™˜ê²½ì—ì„œ ì‹¤ì œ ì¿¼ë¦¬ ë¡œê·¸ë¥¼ í†µí•´ ë‘ ë°©ì‹ì˜ ì°¨ì´ì ì„ ìì„¸íˆ ì•Œì•„ë³´ì.# application.ymlspring: jpa: open-in-view: false # postgresql.conflog_statement = 'all'log_line_prefix = '%t [%p] %u@%d: 'logging_collector = onìƒí™©ë³„ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ë¡œê·¸ë¥¼ í™•ì¸í•´ ë³´ì.public void test() { var list = authorRepository.findAll();}[37380] LOG: statement: BEGIN READ ONLY[37380] LOG: execute &lt;unnamed&gt;: select a1_0.id,a1_0.created_at,a1_0.name from author a1_0[37380] LOG: execute S_1: COMMIT@Transactional(readOnly = true) ê°€ ë¶™ì–´ìˆëŠ” ê²½ìš° íŠ¸ëœì­ì…˜ì´ ëª…ì‹œì ìœ¼ë¡œ ì‹œì‘ë˜ê³  ì¢…ë£Œëœë‹¤. íŠ¸ëœì­ì…˜ì„ READ ONLY ë¡œ ì„¸íŒ…í•˜ëŠ” ì¿¼ë¦¬ì™€, ì¡°íšŒ í›„ ì»¤ë°‹í•˜ëŠ” ì¿¼ë¦¬ê°€ ì¶”ê°€ë¡œ ë‚ ë¼ê°„ë‹¤.public void test() { var list = authorRepository.findAllNonTransactional(); // @Query(value = \"SELECT a FROM Author a\") // List&lt;Author&gt; findAllNonTransactional();} [26408] LOG: execute &lt;unnamed&gt;: select a1_0.id,a1_0.created_at,a1_0.name from author a1_0ì–´ë…¸í…Œì´ì…˜ì´ ì—†ëŠ” ê²½ìš° autocommit ëª¨ë“œë¡œ ë™ì‘í•˜ì—¬ ë‹¨ì¼ ì¿¼ë¦¬ë§Œ ì‹¤í–‰ëœë‹¤. CrudRepository ì¸í„°í˜ì´ìŠ¤ì— ì •ì˜ëœ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ê²½ìš° êµ¬í˜„ì²´ì¸ SimpleJpaRepository í´ë˜ìŠ¤ì— @Transactional(readOnly = true) ê°€ ë¶™ì–´ìˆê¸° ë•Œë¬¸ì— ê¸°ë³¸ì ìœ¼ë¡œ readOnly ëª¨ë“œë¡œ ë™ì‘í•œë‹¤.ê¸°ëŠ¥ë³„ ìƒì„¸ ë¹„êµHibernate ì¸¡ë©´@Transactional(readOnly = true)ì¥ì  1ì°¨ ìºì‹œ í™œìš©: ë™ì¼í•œ ì—”í‹°í‹°ë¥¼ ì—¬ëŸ¬ ë²ˆ ì¡°íšŒí•´ë„ ìºì‹œì—ì„œ ê°€ì ¸ì˜¨ë‹¤ Lazy Loading ì§€ì›: ì—°ê´€ê´€ê³„ ì—”í‹°í‹°ë¥¼ í•„ìš”í•  ë•Œ ë¡œë“œí•  ìˆ˜ ìˆë‹¤ FlushMode.MANUAL: ë¶ˆí•„ìš”í•œ flush ì‘ì—…ì„ ë°©ì§€í•œë‹¤ë‹¨ì  ì„¸ì…˜ ì¥ê¸° ë³´ìœ : ë©”ì„œë“œ ì‹¤í–‰ ë™ì•ˆ Hibernate ì„¸ì…˜ì„ ê³„ì† ìœ ì§€í•œë‹¤ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€: 1ì°¨ ìºì‹œì™€ ì„¸ì…˜ ì»¨í…ìŠ¤íŠ¸ë¡œ ì¸í•œ ë©”ëª¨ë¦¬ ì˜¤ë²„í—¤ë“œì–´ë…¸í…Œì´ì…˜ ì œê±°ì¥ì  ì¦‰ì‹œ ì„¸ì…˜ í•´ì œ: ì¿¼ë¦¬ ì‹¤í–‰ í›„ ë°”ë¡œ ì„¸ì…˜ì„ ì •ë¦¬í•œë‹¤ ìµœì†Œ ë©”ëª¨ë¦¬ ì‚¬ìš©: ì„¸ì…˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì˜¤ë˜ ë³´ìœ í•˜ì§€ ì•ŠëŠ”ë‹¤ë‹¨ì  Lazy Loading ë¶ˆê°€: LazyInitializationException ë°œìƒ ìœ„í—˜ 1ì°¨ ìºì‹œ ë¯¸í™œìš©: ë™ì¼í•œ ì—”í‹°í‹°ë¥¼ ì—¬ëŸ¬ ë²ˆ ì¡°íšŒí•˜ë©´ ë§¤ë²ˆ DB ì¿¼ë¦¬ ì„¸ì…˜ ì¬ìƒì„±: ë§¤ë²ˆ ìƒˆë¡œìš´ ì„¸ì…˜ì„ ìƒì„±í•˜ëŠ” ë¹„ìš©Spring ì¸¡ë©´ (í”„ë¡ì‹œ)@Transactional(readOnly = true)ì¥ì  AOP ê¸°ëŠ¥ í™œìš©: ë¡œê¹…, ëª¨ë‹ˆí„°ë§ ë“± íš¡ë‹¨ ê´€ì‹¬ì‚¬ ì²˜ë¦¬ íŠ¸ëœì­ì…˜ ì „íŒŒ ê·œì¹™: ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ê³¼ì˜ ìƒí˜¸ì‘ìš©ì„ ëª…í™•í•˜ê²Œ ì •ì˜ ì¼ê´€ëœ ì˜ˆì™¸ ì²˜ë¦¬: Springì˜ íŠ¸ëœì­ì…˜ ì˜ˆì™¸ ë³€í™˜ ê¸°ëŠ¥ í™œìš©ë‹¨ì  í”„ë¡ì‹œ ìƒì„± ë¹„ìš©: Spring AOP í”„ë¡ì‹œ ìƒì„±ê³¼ ê´€ë¦¬ ë¹„ìš© ì¸í„°ì…‰í„° ì²´ì¸ ì‹¤í–‰: ë©”ì„œë“œ í˜¸ì¶œ ì‹œë§ˆë‹¤ ì¸í„°ì…‰í„° ì²´ì¸ì„ ê±°ì¹¨ ë©”ëª¨ë¦¬ ì˜¤ë²„í—¤ë“œ: í”„ë¡ì‹œ ê°ì²´ì™€ ê´€ë ¨ ë©”íƒ€ë°ì´í„°ì–´ë…¸í…Œì´ì…˜ ì œê±°ì¥ì  í”„ë¡ì‹œ ì˜¤ë²„í—¤ë“œ ì—†ìŒ: ì§ì ‘ì ì¸ ë©”ì„œë“œ í˜¸ì¶œ ë©”ëª¨ë¦¬ íš¨ìœ¨ì : í”„ë¡ì‹œ ê´€ë ¨ ë©”ëª¨ë¦¬ ì‚¬ìš© ì—†ìŒ ë‹¨ìˆœí•œ ì‹¤í–‰ íë¦„: ë³µì¡í•œ AOP ì²˜ë¦¬ ê³¼ì •ì´ ì—†ìŒë‹¨ì  Spring AOP ê¸°ëŠ¥ ë¯¸ì‚¬ìš©: íš¡ë‹¨ ê´€ì‹¬ì‚¬ ì²˜ë¦¬ ë¶ˆê°€ëŠ¥ íŠ¸ëœì­ì…˜ ê´€ë¦¬ ë¶ˆê°€: ëª…ì‹œì ì¸ íŠ¸ëœì­ì…˜ ì œì–´ ì—†ìŒPostgreSQL ì¸¡ë©´BEGIN READ ONLY vs autocommitPostgreSQLì—ì„œ BEGIN READ ONLYëŠ” ë‹¨ìˆœí•œ í”Œë˜ê·¸ ì„¤ì •ì´ ì•„ë‹ˆë¼ ì‹¤ì œë¡œ ë‹¤ìŒê³¼ ê°™ì€ ìµœì í™”ë¥¼ ì œê³µí•œë‹¤. WAL ìƒì„± ë°©ì§€: Write-Ahead Logë¥¼ ìƒì„±í•˜ì§€ ì•Šì•„ I/O ë¶€í•˜ ê°ì†Œ ë½ íšë“ íšŒí”¼: ë¶ˆí•„ìš”í•œ ë½ ìš”ì²­ì„ í•˜ì§€ ì•ŠìŒ ë‚´ë¶€ ìµœì í™”: PostgreSQLì´ ì½ê¸° ì „ìš©ì„ì„ ì•Œê³  ì—¬ëŸ¬ ìµœì í™” ìˆ˜í–‰ë°˜ë©´ autocommit ëª¨ë“œëŠ” ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œ ìµœì†Œí™”: ë‹¨ì¼ ì¿¼ë¦¬ë§Œ ì „ì†¡ ì»¤ë„¥ì…˜ ì¦‰ì‹œ ë°˜í™˜: ì¿¼ë¦¬ ì‹¤í–‰ í›„ ë°”ë¡œ ì»¤í…ì…˜ í’€ì— ë°˜í™˜ìœ„ì™€ê°™ì€ íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆë‹¤.ì„±ëŠ¥ ë¹„êµì¼ë°˜ì ìœ¼ë¡œ ë‹¨ìˆœ ì¡°íšŒì—ì„œëŠ” ì–´ë…¸í…Œì´ì…˜ ì œê±°ê°€ ë” ë¹ ë¥¸ ê²½ìš°ê°€ ë§ì§€ë§Œ, ë³µì¡í•œ ë¡œì§ì—ì„œëŠ” íŠ¸ëœì­ì…˜ì˜ ì´ì ì´ ì„±ëŠ¥ ì˜¤ë²„í—¤ë“œë¥¼ ìƒì‡„í•œë‹¤.ê²°ë¡  ë° ê¶Œì¥ì‚¬í•­@Transactional(readOnly = true) ì–¸ì œ ì‚¬ìš©í• ê¹Œ? ì—°ê´€ê´€ê³„(Lazy Loading)ê°€ í•„ìš”í•œ ëª¨ë“  ê²½ìš° ì—¬ëŸ¬ ì¿¼ë¦¬ì˜ ì¼ê´€ì„±ì´ ì¤‘ìš”í•œ ê²½ìš° ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ìˆëŠ” ê²½ìš° Springì˜ íŠ¸ëœì­ì…˜ ê´€ë¦¬ ê¸°ëŠ¥ì„ í™œìš©í•˜ê³  ì‹¶ì€ ê²½ìš°ì´ëŸ´ë•ŒëŠ” ì œê±°í•´ë„ ë˜ì§€ ì•Šì„ê¹Œ? ì™„ì „íˆ ë‹¨ìˆœí•œ ë‹¨ì¼ ì¡°íšŒ (ì—°ê´€ê´€ê³„ ì—†ìŒ) DTO í”„ë¡œì ì…˜ë§Œ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ê·¹ë„ì˜ ì„±ëŠ¥ ìµœì í™”ê°€ í•„ìš”í•œ ê²½ìš° ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ì—ì„œ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±ì´ ì¤‘ìš”í•œ ê²½ìš°ê°œì¸ì ì¸ ìƒê° (PostgreSQL ê¸°ì¤€) ì•ˆì „ì„±: Lazy Loading ê´€ë ¨ ì˜ˆì™¸ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆë‹¤ í™•ì¥ì„±: ë‚˜ì¤‘ì— ì—°ê´€ê´€ê³„ë‚˜ ë³µì¡í•œ ë¡œì§ì´ ì¶”ê°€ë˜ì–´ë„ ì•ˆì „í•˜ë‹¤ ì¼ê´€ì„±: íŒ€ ì „ì²´ê°€ ë™ì¼í•œ íŒ¨í„´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ PostgreSQL ìµœì í™”: READ ONLY ëª¨ë“œì˜ ì´ì ì„ í™œìš©í•  ìˆ˜ ìˆë‹¤ì„±ëŠ¥ì´ ì •ë§ ì¤‘ìš”í•œ íŠ¹ì • APIì—ë§Œ ì„ ë³„ì ìœ¼ë¡œ ì–´ë…¸í…Œì´ì…˜ì„ ì œê±°í•˜ê³ , ë‚˜ë¨¸ì§€ëŠ” @Transactional(readOnly = true)ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ í˜„ì‹¤ì ì¸ê²ƒ ê°™ë‹¤.ì‹¤ì œ ì„±ëŠ¥ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ íŠ¹ì„±, ë°ì´í„° í¬ê¸°, ì¸í”„ë¼ í™˜ê²½ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ, ì¤‘ìš”í•œ ê²°ì •ì„ ë‚´ë¦¬ê¸° ì „ì—ëŠ” í•­ìƒ ì‹¤ì œ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸í•´ë³´ëŠ” ê²ƒì„ ìŠì§€ ë§ì.ê²©ë¦¬ ìˆ˜ì¤€(Isolation Level) ì‹¤ì „ í™œìš©ê²©ë¦¬ ìˆ˜ì¤€ì€ ë™ì‹œ íŠ¸ëœì­ì…˜ ê°„ì˜ ë°ì´í„° ì¼ê´€ì„±ì„ ì–¼ë§ˆë‚˜ ì—„ê²©í•˜ê²Œ ë³´ì¥í• ì§€ë¥¼ ê²°ì •í•œë‹¤. PostgreSQLì˜ ê¸°ë³¸ ê²©ë¦¬ ìˆ˜ì¤€ì€ READ_COMMITTEDì´ë©°, ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ì ì ˆí•œ ìˆ˜ì¤€ì„ ì„ íƒí•´ì•¼ í•œë‹¤.@Transactional(isolation = Isolation.READ_COMMITTED)public void readCommittedTest() { // PostgreSQL ê¸°ë³¸ ê²©ë¦¬ ìˆ˜ì¤€ - ì„±ëŠ¥ ìš°ì„ }@Transactional(isolation = Isolation.REPEATABLE_READ)public void repeatableReadTest() { // ì¼ê´€ì„± ìš°ì„  - Snapshot Isolation ì œê³µ}ê²©ë¦¬ ìˆ˜ì¤€ë³„ í˜„ìƒê³¼ ë¬¸ì œì  Dirty Read: ì»¤ë°‹ë˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ì„ ì½ëŠ” í˜„ìƒ Non-repeatable Read: ê°™ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ë™ì¼í•œ ë°ì´í„°ë¥¼ ì¬ì¡°íšŒí•  ë•Œ ë‹¤ë¥¸ ê°’ì´ ë‚˜ì˜¤ëŠ” í˜„ìƒ Phantom Read: ë²”ìœ„ ì¡°ê±´ìœ¼ë¡œ ì¡°íšŒ ì‹œ ìƒˆë¡œìš´ í–‰ì´ ì¶”ê°€ë¡œ ì¡°íšŒë˜ëŠ” í˜„ìƒREAD_COMMITTED (ê¸°ë³¸ê°’)@Transactional(isolation = Isolation.READ_COMMITTED)public void processOrderWithReadCommitted() { // ì²« ë²ˆì§¸ ì¡°íšŒ var product = productRepository.findById(1L); System.out.println(\"ì²« ë²ˆì§¸ ì¬ê³ : \" + product.getStock()); // 100 // ì´ ì‹œì ì— ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ì¬ê³ ë¥¼ 50ìœ¼ë¡œ ë³€ê²½í•˜ê³  ì»¤ë°‹ // ë‘ ë²ˆì§¸ ì¡°íšŒ - ë³€ê²½ëœ ê°’ ì½ìŒ (Non-repeatable Read ë°œìƒ) product = productRepository.findById(1L); System.out.println(\"ë‘ ë²ˆì§¸ ì¬ê³ : \" + product.getStock()); // 50 // ë¬¸ì œ: ê°™ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ë°ì´í„°ê°€ ë‹¬ë¼ì§ // ì²« ë²ˆì§¸ ì¡°íšŒë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì‘ì„±í–ˆë‹¤ë©´ ë¬¸ì œê°€ ë  ìˆ˜ ìˆìŒ}READ_COMMITTED íŠ¹ì§•: Dirty Read ë°©ì§€: ì»¤ë°‹ëœ ë°ì´í„°ë§Œ ì½ìŒ Non-repeatable Read í—ˆìš©: ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì˜ ì»¤ë°‹ëœ ë³€ê²½ì‚¬í•­ì´ ì¤‘ê°„ì— ë³´ì„ Phantom Read í—ˆìš©: ë²”ìœ„ ì¡°ê±´ì—ì„œ ìƒˆë¡œìš´ í–‰ì´ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìŒ ì„±ëŠ¥: ê°€ì¥ ë†’ìŒ (ì ê¸ˆì´ ì ìŒ) ì‚¬ìš© ì‹œê¸°: ì„±ëŠ¥ì´ ì¤‘ìš”í•˜ê³  ì•½ê°„ì˜ ë°ì´í„° ë¶ˆì¼ì¹˜ë¥¼ í—ˆìš©í•  ìˆ˜ ìˆëŠ” ê²½ìš°REPEATABLE_READ@Transactional(isolation = Isolation.REPEATABLE_READ)public void processOrderWithRepeatableRead() { // ì²« ë²ˆì§¸ ì¡°íšŒ - ìŠ¤ëƒ…ìƒ· ìƒì„± var product = productRepository.findById(1L); System.out.println(\"ì²« ë²ˆì§¸ ì¬ê³ : \" + product.getStock()); // 100 // ì´ ì‹œì ì— ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ì¬ê³ ë¥¼ 50ìœ¼ë¡œ ë³€ê²½í•˜ê³  ì»¤ë°‹í•´ë„ // ë‘ ë²ˆì§¸ ì¡°íšŒ - ìŠ¤ëƒ…ìƒ·ì— ì˜í•´ ë™ì¼í•œ ê°’ ì½ìŒ product = productRepository.findById(1L); System.out.println(\"ë‘ ë²ˆì§¸ ì¬ê³ : \" + product.getStock()); // 100 (ë™ì¼) // ì¥ì : íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì¼ê´€ëœ ë°ì´í„° ë³´ì¥ // ë‹¨ì : ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì˜ ë³€ê²½ì‚¬í•­ì„ ëª» ë³¼ ìˆ˜ ìˆìŒ (Lost Update ìœ„í—˜)}REPEATABLE_READ íŠ¹ì§•: Snapshot Isolation: íŠ¸ëœì­ì…˜ ì‹œì‘ ì‹œì ì˜ ë°ì´í„° ìŠ¤ëƒ…ìƒ· ìœ ì§€ Non-repeatable Read ë°©ì§€: ë™ì¼í•œ ë°ì´í„° ë°˜ë³µ ì½ê¸° ì‹œ ì¼ê´€ì„± ë³´ì¥ Phantom Read ì¼ë¶€ ë°©ì§€: PostgreSQLì—ì„œëŠ” ëŒ€ë¶€ë¶„ ë°©ì§€ë¨ ì„±ëŠ¥: ì¤‘ê°„ (ìŠ¤ëƒ…ìƒ· ìœ ì§€ ì˜¤ë²„í—¤ë“œ) ì‚¬ìš© ì‹œê¸°: ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ ë°ì´í„° ì¼ê´€ì„±ì´ ì¤‘ìš”í•œ ê²½ìš°ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ í™œìš© ì‚¬ë¡€1. ì¬ê³  ì°¨ê° ë¡œì§ (ë™ì‹œì„± ì œì–´)@Transactional(isolation = Isolation.REPEATABLE_READ)public OrderResult decreaseStock(Long productId, int quantity) { // ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ ì¼ê´€ëœ ë°ì´í„° ë³´ì¥ var product = productRepository.findById(productId).get(); // ì¬ê³  ê²€ì¦ - íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì¼ê´€ëœ ê°’ìœ¼ë¡œ ê²€ì¦ if (product.getStock() &lt; quantity) { return OrderResult.fail(\"ì¬ê³  ë¶€ì¡±: í˜„ì¬ \" + product.getStock() + \"ê°œ\"); } // ì¬ê³  ì°¨ê° product.decreaseStock(quantity); productRepository.save(product); return OrderResult.success(\"ì£¼ë¬¸ ì™„ë£Œ\");}// ì£¼ì˜: REPEATABLE_READì—ì„œë„ Lost UpdateëŠ” ë°œìƒí•  ìˆ˜ ìˆìŒ// ë”°ë¼ì„œ ë‚™ê´€ì  ë½(@Version) ë˜ëŠ” ë¹„ê´€ì  ë½ ì¶”ê°€ ê³ ë ¤ í•„ìš”2. ê¸ˆìœµ ê±°ë˜ ì²˜ë¦¬@Transactional(isolation = Isolation.REPEATABLE_READ)public TransferResult transfer(Long fromAccountId, Long toAccountId, BigDecimal amount) { // ì¼ê´€ëœ ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ ê³„ì¢Œ ì •ë³´ ì¡°íšŒ var fromAccount = accountRepository.findById(fromAccountId).get(); var toAccount = accountRepository.findById(toAccountId).get(); // ì”ì•¡ ê²€ì¦ - ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ ì¼ê´€ì„± ë³´ì¥ if (fromAccount.getBalance().compareTo(amount) &lt; 0) { return TransferResult.fail(\"ì”ì•¡ ë¶€ì¡±\"); } // ì´ì²´ ì²˜ë¦¬ fromAccount.withdraw(amount); toAccount.deposit(amount); accountRepository.saveAll(List.of(fromAccount, toAccount)); return TransferResult.success(\"ì´ì²´ ì™„ë£Œ\");}3. ë³´ê³ ì„œ ìƒì„± (ë°ì´í„° ì •í•©ì„±)@Transactional(readOnly = true, isolation = Isolation.REPEATABLE_READ)public DailySalesReport generateSalesReport(LocalDate date) { // ë³´ê³ ì„œ ìƒì„± ì¤‘ ë°ì´í„° ë³€ê²½ë˜ì–´ë„ ì¼ê´€ëœ ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ ì‘ì—… var orders = orderRepository.findByOrderDate(date); // ì£¼ë¬¸ ì´ì•¡ ê³„ì‚° var totalAmount = orders.stream() .map(Order::getAmount) .reduce(BigDecimal.ZERO, BigDecimal::add); // ì¹´í…Œê³ ë¦¬ë³„ ì§‘ê³„ - ëª¨ë‘ ë™ì¼í•œ ìŠ¤ëƒ…ìƒ· ê¸°ì¤€ var categoryStats = orders.stream() .collect(Collectors.groupingBy( Order::getCategoryId, Collectors.summingDouble(order -&gt; order.getAmount().doubleValue()) )); return new DailySalesReport(date, totalAmount, orders.size(), categoryStats);}4. READ_COMMITTED ì ì ˆí•œ ì‚¬ìš© ì‚¬ë¡€@Transactional(isolation = Isolation.READ_COMMITTED)public void logUserActivity(Long userId, String activity) { // ë¡œê¹…ì€ ì•½ê°„ì˜ ë¶ˆì¼ì¹˜ê°€ ìˆì–´ë„ ë¬´ê´€ // ì„±ëŠ¥ì„ ìš°ì„ ì‹œí•˜ëŠ” ê²ƒì´ ë§ìŒ var user = userRepository.findById(userId).orElse(null); if (user != null) { activityLogRepository.save(new ActivityLog(userId, activity, LocalDateTime.now())); }}ì„±ëŠ¥ vs ì¼ê´€ì„± ì„ íƒ ê°€ì´ë“œ READ_COMMITTED: ë¡œê¹…, ë‹¨ìˆœ ì¡°íšŒ, ì„±ëŠ¥ì´ ì¤‘ìš”í•œ ëŒ€ëŸ‰ ì²˜ë¦¬ REPEATABLE_READ: ê¸ˆìœµ ê±°ë˜, ì¬ê³  ê´€ë¦¬, ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ë³´ê³ ì„œ ìƒì„± SERIALIZABLE: ê·¹ë„ë¡œ ì¤‘ìš”í•œ ë°ì´í„° (ì¼ë°˜ì ìœ¼ë¡œ ì„±ëŠ¥ìƒ ë¹„ì¶”ì²œ)ì£¼ì˜ì‚¬í•­ ê²©ë¦¬ ìˆ˜ì¤€ë§Œìœ¼ë¡œëŠ” ëª¨ë“  ë™ì‹œì„± ë¬¸ì œê°€ í•´ê²°ë˜ì§€ ì•ŠìŒ í•„ìš”ì‹œ ë‚™ê´€ì  ë½(@Version) ë˜ëŠ” ë¹„ê´€ì  ë½(SELECT FOR UPDATE) ì¶”ê°€ ê³ ë ¤ ê²©ë¦¬ ìˆ˜ì¤€ì´ ë†’ì„ìˆ˜ë¡ ë°ë“œë½ ë°œìƒ ê°€ëŠ¥ì„± ì¦ê°€@Transactionalê³¼ LazyInitializationExceptionLazyInitializationExceptionì€ Hibernateë¥¼ ì‚¬ìš©í•  ë•Œ ìì£¼ ë§ˆì£¼ì¹˜ëŠ” ë¬¸ì œë‹¤. íŠ¹íˆ spring.jpa.open-in-view: false ì„¤ì •ì„ ì‚¬ìš©í•˜ëŠ” í™˜ê²½ì—ì„œ íŠ¸ëœì­ì…˜ì´ ëë‚œ í›„ ì§€ì—° ë¡œë”©ì„ ì‹œë„í•  ë•Œ ë°œìƒí•œë‹¤.ë¬¸ì œ ë°œìƒ ì‹œë‚˜ë¦¬ì˜¤@Entitypublic class Author { @Id private Long id; private String name; @OneToMany(mappedBy = \"author\", fetch = FetchType.LAZY) // ê¸°ë³¸ê°’: LAZY private List&lt;Book&gt; books = new ArrayList&lt;&gt;(); // getter, setter...}@Transactional(readOnly = true)public Author findAuthor(Long id) { return authorRepository.findById(id).orElse(null); // íŠ¸ëœì­ì…˜ì´ ì—¬ê¸°ì„œ ì¢…ë£Œë¨}@GetMapping(\"/authors/{id}\")public ResponseEntity&lt;AuthorResponse&gt; getAuthor(@PathVariable Long id) { var author = authorService.findAuthor(id); // íŠ¸ëœì­ì…˜ ì¢…ë£Œ // ì—¬ê¸°ì„œ LazyInitializationException ë°œìƒ! // could not initialize proxy - no Session var bookTitles = author.getBooks().stream() .map(Book::getTitle) .collect(Collectors.toList()); return ResponseEntity.ok(new AuthorResponse(author.getName(), bookTitles));}ì™œ ë°œìƒí•˜ëŠ”ê°€? JPA Session (EntityManager) ì¢…ë£Œ: íŠ¸ëœì­ì…˜ì´ ëë‚˜ë©´ Sessionë„ í•¨ê»˜ ë‹«í˜ í”„ë¡ì‹œ ê°ì²´ì˜ í•œê³„: Lazy ì»¬ë ‰ì…˜ì€ í”„ë¡ì‹œë¡œ ë˜í•‘ë˜ì–´ ìˆì–´ Sessionì´ í•„ìš” open-in-view: false: HTTP ìš”ì²­ ë²”ìœ„ì—ì„œ Sessionì„ ìœ ì§€í•˜ì§€ ì•ŠìŒ// Author ê°ì²´ ë‚´ë¶€ì˜ books í•„ë“œëŠ” ì‹¤ì œë¡œ ì´ëŸ° í”„ë¡ì‹œbooks = new PersistentBag(); // Hibernateì˜ ì§€ì—° ë¡œë”© ì»¬ë ‰ì…˜// Sessionì´ ì—†ìœ¼ë©´ ì‹¤ì œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŒí•´ê²° ë°©ë²•1. íŠ¸ëœì­ì…˜ ë²”ìœ„ í™•ì¥ (Controllerì— @Transactional)@GetMapping(\"/authors/{id}\")@Transactional(readOnly = true) // íŠ¸ëœì­ì…˜ì„ Controllerê¹Œì§€ í™•ì¥public ResponseEntity&lt;AuthorResponse&gt; getAuthor(@PathVariable Long id) { var author = authorService.findAuthor(id); // íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ Lazy Loading ìˆ˜í–‰ - ì •ìƒ ë™ì‘ var bookTitles = author.getBooks().stream() .map(Book::getTitle) .collect(Collectors.toList()); return ResponseEntity.ok(new AuthorResponse(author.getName(), bookTitles));}ì¥ì : ê°„ë‹¨í•œ ìˆ˜ì •ë‹¨ì : Controllerì— íŠ¸ëœì­ì…˜ ë¡œì§ì´ ë“¤ì–´ê°, ë ˆì´ì–´ ê²½ê³„ê°€ ëª¨í˜¸í•´ì§2. Eager Fetch Join ì‚¬ìš©@Repositorypublic interface AuthorRepository extends JpaRepository&lt;Author, Long&gt; { @Query(\"SELECT a FROM Author a JOIN FETCH a.books WHERE a.id = :id\") Optional&lt;Author&gt; findByIdWithBooks(@Param(\"id\") Long id); // ë˜ëŠ” ì—¬ëŸ¬ ì—°ê´€ê´€ê³„ë¥¼ í•œ ë²ˆì— @Query(\"SELECT DISTINCT a FROM Author a \" + \"JOIN FETCH a.books b \" + \"JOIN FETCH b.category \" + \"WHERE a.id = :id\") Optional&lt;Author&gt; findByIdWithBooksAndCategories(@Param(\"id\") Long id);}@Servicepublic class AuthorService { @Transactional(readOnly = true) public Author findAuthorWithBooks(Long id) { return authorRepository.findByIdWithBooks(id).orElse(null); // books ë°ì´í„°ê°€ ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆì–´ì„œ Session ì¢…ë£Œ í›„ì—ë„ ì ‘ê·¼ ê°€ëŠ¥ }}ì¥ì : ëª…í™•í•œ ë°ì´í„° ë¡œë”©, N+1 ë¬¸ì œ í•´ê²°ë‹¨ì : í•­ìƒ ì—°ê´€ ë°ì´í„°ë¥¼ ë¡œë“œí•¨ (ë¶ˆí•„ìš”í•œ ê²½ìš°ì—ë„)3. @EntityGraph í™œìš©@Repositorypublic interface AuthorRepository extends JpaRepository&lt;Author, Long&gt; { @EntityGraph(attributePaths = {\"books\", \"books.category\"}) @Query(\"SELECT a FROM Author a WHERE a.id = :id\") Optional&lt;Author&gt; findByIdWithBooks(@Param(\"id\") Long id); // ì—¬ëŸ¬ ì‹œë‚˜ë¦¬ì˜¤ì— ëŒ€ì‘ @EntityGraph(attributePaths = {\"books\"}) Optional&lt;Author&gt; findById(Long id); // ê¸°ë³¸ ë©”ì„œë“œ ì˜¤ë²„ë¼ì´ë“œ}ì¥ì : ì„ ì–¸ì  ë°©ì‹, ìœ ì—°í•¨ë‹¨ì : ë³µì¡í•œ ê·¸ë˜í”„ì—ì„œëŠ” ì˜ˆì¸¡ì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŒ4. DTO ë³€í™˜ì„ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ (ê¶Œì¥)@Transactional(readOnly = true)public AuthorResponse findAuthorResponse(Long id) { var author = authorRepository.findById(id).orElse(null); if (author == null) { return null; } // íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ëª¨ë‘ ì ‘ê·¼í•˜ì—¬ DTOë¡œ ë³€í™˜ var bookTitles = author.getBooks().stream() .map(Book::getTitle) .collect(Collectors.toList()); var authorStats = AuthorStats.builder() .totalBooks(author.getBooks().size()) .avgRating(calculateAverageRating(author.getBooks())) .build(); return AuthorResponse.builder() .name(author.getName()) .email(author.getEmail()) .bookTitles(bookTitles) .stats(authorStats) .build();}private double calculateAverageRating(List&lt;Book&gt; books) { return books.stream() .mapToDouble(Book::getRating) .average() .orElse(0.0);}@GetMapping(\"/authors/{id}\")public ResponseEntity&lt;AuthorResponse&gt; getAuthor(@PathVariable Long id) { var response = authorService.findAuthorResponse(id); return response != null ? ResponseEntity.ok(response) : ResponseEntity.notFound().build();}ì¥ì : ëª…í™•í•œ ë ˆì´ì–´ ë¶„ë¦¬, í•„ìš”í•œ ë°ì´í„°ë§Œ ë…¸ì¶œ, ì„±ëŠ¥ ìµœì í™”ë‹¨ì : DTO í´ë˜ìŠ¤ ì¶”ê°€ í•„ìš”5. Batch Fetch Size ì„¤ì •ìœ¼ë¡œ N+1 ë¬¸ì œ ì™„í™”spring: jpa: properties: hibernate: default_batch_fetch_size: 100 # í•œ ë²ˆì— 100ê°œì”© ë°°ì¹˜ë¡œ ë¡œë”© jdbc: batch_size: 50 # INSERT/UPDATE ë°°ì¹˜ í¬ê¸°@Transactional(readOnly = true)public List&lt;AuthorResponse&gt; findAllAuthorsWithBooks() { var authors = authorRepository.findAll(); // 1ë²ˆ ì¿¼ë¦¬ return authors.stream() .map(author -&gt; { // Batch Fetch Size ë•ë¶„ì— 100ê°œì”© ë¬¶ì–´ì„œ ì¿¼ë¦¬ ì‹¤í–‰ // N+1ì´ ì•„ë‹ˆë¼ N/100+1 ì¿¼ë¦¬ë¡œ ìµœì í™” var bookTitles = author.getBooks().stream() .map(Book::getTitle) .collect(Collectors.toList()); return new AuthorResponse(author.getName(), bookTitles); }) .collect(Collectors.toList());}6. í”„ë¡œì ì…˜(Projection) í™œìš©public interface AuthorBookProjection { String getName(); String getEmail(); List&lt;BookInfo&gt; getBooks(); interface BookInfo { String getTitle(); String getIsbn(); BigDecimal getPrice(); }}@Repositorypublic interface AuthorRepository extends JpaRepository&lt;Author, Long&gt; { @Query(\"SELECT a.name as name, a.email as email, \" + \"b.title as books_title, b.isbn as books_isbn, b.price as books_price \" + \"FROM Author a LEFT JOIN a.books b WHERE a.id = :id\") AuthorBookProjection findAuthorBookProjection(@Param(\"id\") Long id);}ì„±ëŠ¥ ìµœì í™” ì‹¤ì „ íŒ1. ì—°ê´€ê´€ê³„ ì„¤ê³„ ì‹œ ê³ ë ¤ì‚¬í•­@Entitypublic class Author { // í•„ìˆ˜: ì–‘ë°©í–¥ ê´€ê³„ì—ì„œ ì—°ê´€ê´€ê³„ ì£¼ì¸ ì„¤ì • @OneToMany(mappedBy = \"author\", fetch = FetchType.LAZY) private List&lt;Book&gt; books = new ArrayList&lt;&gt;(); // ì„±ëŠ¥ ìµœì í™”: ì»¬ë ‰ì…˜ ì´ˆê¸°í™” public List&lt;Book&gt; getBooks() { return books != null ? books : Collections.emptyList(); } // í¸ì˜ ë©”ì„œë“œ: Lazy Loadingì„ ìœ„í•œ í¬ê¸° ì²´í¬ public boolean hasBooks() { return books != null &amp;&amp; !books.isEmpty(); } public int getBooksCount() { return books != null ? books.size() : 0; // size() í˜¸ì¶œ ì‹œ ì‹¤ì œ ë¡œë”©ë¨ }}2. ì¡°ê±´ë¶€ Lazy Loading@Servicepublic class AuthorService { @Transactional(readOnly = true) public AuthorResponse findAuthorResponse(Long id, boolean includeBooks) { var author = authorRepository.findById(id).orElse(null); if (author == null) return null; var builder = AuthorResponse.builder() .name(author.getName()) .email(author.getEmail()); // í•„ìš”í•œ ê²½ìš°ì—ë§Œ Lazy Loading ìˆ˜í–‰ if (includeBooks &amp;&amp; author.hasBooks()) { var bookTitles = author.getBooks().stream() .map(Book::getTitle) .collect(Collectors.toList()); builder.bookTitles(bookTitles); } return builder.build(); }}í•µì‹¬ ì›ì¹™ ë°ì´í„° ì ‘ê·¼ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ: Sessionì´ ì—´ë ¤ìˆì„ ë•Œ ëª¨ë“  í•„ìš” ë°ì´í„°ì— ì ‘ê·¼ ëª…ì‹œì  ë°ì´í„° ë¡œë”©: Fetch Join, EntityGraph ë“±ìœ¼ë¡œ ì˜ë„ë¥¼ ëª…í™•íˆ í‘œí˜„ ì ì ˆí•œ DTO í™œìš©: í•„ìš”í•œ ë°ì´í„°ë§Œ ì¶”ì¶œí•˜ì—¬ ë ˆì´ì–´ ê°„ ê²°í•©ë„ ê°ì†Œ ì„±ëŠ¥ ì¸¡ì • ê¸°ë°˜ ìµœì í™”: N+1 ë¬¸ì œì™€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ëª¨ë‹ˆí„°ë§í•˜ë©° ìµœì í™”Dirty Checking ì´í•´í•˜ê¸°Hibernateì˜ í•µì‹¬ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ì¸ Dirty Checkingì— ëŒ€í•´ ì•Œì•„ë³´ì.@Transactionalpublic void updateAuthor(Long id) { var author = authorRepository.findById(id).get(); // ì—”í‹°í‹° ìˆ˜ì • - ëª…ì‹œì ì¸ save() í˜¸ì¶œ ì—†ì´ë„ UPDATE ì¿¼ë¦¬ ì‹¤í–‰ë¨ author.setName(\"ë³€ê²½ëœ ì´ë¦„\"); author.setEmail(\"new@email.com\"); // íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì ì— ìë™ìœ¼ë¡œ UPDATE ì¿¼ë¦¬ ìƒì„±}Dirty Checking ë™ì‘ ì›ë¦¬ 1ì°¨ ìºì‹œ ì €ì¥ ì‹œì : ì—”í‹°í‹° ì¡°íšŒ ì‹œ í˜„ì¬ ìƒíƒœì˜ ìŠ¤ëƒ…ìƒ·ì„ ìƒì„± íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì : í˜„ì¬ ì—”í‹°í‹°ì™€ ìŠ¤ëƒ…ìƒ·ì„ ë¹„êµ ë³€ê²½ ê°ì§€: ë‹¬ë¼ì§„ í•„ë“œê°€ ìˆìœ¼ë©´ UPDATE ì¿¼ë¦¬ ìë™ ìƒì„±// ë‚´ë¶€ ë™ì‘ ê°œë…public class EntityEntry { private Object entity; // í˜„ì¬ ì—”í‹°í‹° private Object[] snapshot; // ì¡°íšŒ ì‹œì ì˜ ìŠ¤ëƒ…ìƒ· public boolean requiresUpdate() { // í˜„ì¬ ì—”í‹°í‹°ì™€ ìŠ¤ëƒ…ìƒ· ë¹„êµ return !Arrays.equals(getCurrentState(), snapshot); }}ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­1. ë¶ˆí•„ìš”í•œ ìŠ¤ëƒ…ìƒ· ìƒì„± ë°©ì§€@Transactional(readOnly = true)public List&lt;AuthorDto&gt; findAllAuthorsForReport() { return authorRepository.findAll().stream() .map(author -&gt; new AuthorDto(author.getName(), author.getEmail())) .collect(Collectors.toList());}ì½ê¸° ì „ìš©ì´ë¯€ë¡œ ìŠ¤ëƒ…ìƒ· ìƒì„±í•˜ì§€ ì•ŠìŒ2. ëŒ€ìš©ëŸ‰ ì¡°íšŒ ì‹œ ì£¼ì˜@Transactionalpublic void processAllAuthors() { var authors = authorRepository.findAll(); // 1ë§Œê±´ ì¡°íšŒ // 1ë§Œê°œì˜ ìŠ¤ëƒ…ìƒ· ìƒì„± â†’ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€ // ì‹¤ì œë¡œëŠ” ìˆ˜ì •í•˜ì§€ ì•Šì•„ë„ ìŠ¤ëƒ…ìƒ·ì€ ìƒì„±ë¨ authors.forEach(author -&gt; { // ë‹¨ìˆœ ì½ê¸° ì‘ì—…ë§Œ ìˆ˜í–‰ generateReport(author); });}3. ì„ íƒì  ì—…ë°ì´íŠ¸ vs ì „ì²´ í•„ë“œ ì—…ë°ì´íŠ¸// @DynamicUpdate ì—†ëŠ” ê²½ìš° - ëª¨ë“  í•„ë“œ UPDATE@Entitypublic class Author { // UPDATE author SET name=?, email=?, created_at=? WHERE id=?}// @DynamicUpdate ìˆëŠ” ê²½ìš° - ë³€ê²½ëœ í•„ë“œë§Œ UPDATE@Entity@DynamicUpdatepublic class Author { // UPDATE author SET name=? WHERE id=?}ìµœì í™” íŒ ë‹¨ìˆœ ì¡°íšŒë§Œ í•˜ëŠ” ê²½ìš°: @Transactional(readOnly = true) ë˜ëŠ” íŠ¸ëœì­ì…˜ ì—†ì´ ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬: ì²­í¬ ë‹¨ìœ„ë¡œ ë¶„í• í•˜ì—¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì œì–´ ë¶€ë¶„ ì—…ë°ì´íŠ¸: @DynamicUpdate í™œìš©" }, { "title": "Application Load Balancerì— ê³ ì • IP ì‚¬ìš©í•˜ê¸° (feat. VPC IPAM í†µí•©)", "url": "/posts/aws-alb-static-ip/", "categories": "AWS", "tags": "AWS", "date": "2025-04-12 20:12:00 +0900", "snippet": "Application Load Balancerì— ê³ ì • IP ì‚¬ìš©í•˜ê¸° (feat. VPC IPAM í†µí•©)aws ì½˜ì†” ë³´ë‹¤ê°€ ì´ëŸ°ê±¸ ë°œê²¬í–ˆë‹¤.ê¶ê¸ˆí•´ì„œ ì°¾ì•„ë³´ë‹ˆê¹Œ ì´ëŸ° ê¸€ì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤. (ë§ˆì°¸ë‚´!)ALBì— ê³ ì •IPë¥¼ ì‚¬ìš©í•˜ë ¤ê³  ì•ì— NLB ë¶™ì´ê¸°, í”„ë¡ì‹œ ì„œë²„ ì‚¬ìš©í•˜ê¸°, Global Acceleratorê³¼ í†µí•©í•˜ê¸°, Lambda ì‚¬ìš©í•˜ê¸° ë“± ë‹¤ì–‘í•œ ë°©ë²•ë“¤ì„ ì‚¬ìš©í•´ì™”ë‹¤. ê·¸ëŸ°ë° ì´ì œ ALBì— ì§ì ‘ì ìœ¼ë¡œ ê³ ì • IPë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ëœ ê²ƒì´ë‹¤.VPC IPAMì´ë€?Amazon VPC IP Address Manager(IPAM)ëŠ” AWS ì›Œí¬ë¡œë“œì˜ IP ì£¼ì†Œë¥¼ ë³´ë‹¤ ì‰½ê²Œ ê³„íš, ì¶”ì  ë° ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” VPC ê¸°ëŠ¥ì´ë‹¤. IPAMì„ ì‚¬ìš©í•˜ë©´ ì¡°ì§, ê³„ì •, VPC ë° AWS ë¦¬ì „ ì „ì²´ì—ì„œ IP ì£¼ì†Œ ë°°ì •ì„ ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•˜ê³  ê°ì‚¬í•  ìˆ˜ ìˆë‹¤. ë²”ìœ„(Scope): IPAMì—ì„œ ê°€ì¥ ìƒìœ„ ì»¨í…Œì´ë„ˆë¡œ, ë‹¨ì¼ ë„¤íŠ¸ì›Œí¬ì˜ IP ê³µê°„ì„ ë‚˜íƒ€ë‚¸ë‹¤. IPAM ìƒì„± ì‹œ í¼ë¸”ë¦­ ë²”ìœ„ì™€ í”„ë¼ì´ë¹— ë²”ìœ„ê°€ ìë™ìœ¼ë¡œ ìƒì„±ëœë‹¤. í’€(Pool): ì—°ì†ëœ IP ì£¼ì†Œ ë²”ìœ„(CIDR)ì˜ ëª¨ìŒìœ¼ë¡œ, ë¼ìš°íŒ… ë° ë³´ì•ˆ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ IP ì£¼ì†Œë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤. ìµœìƒìœ„ í’€ ë‚´ì— ì—¬ëŸ¬ ê°œì˜ í’€ì´ ì¡´ì¬í•  ìˆ˜ ìˆë‹¤. í• ë‹¹(Allocation): IPAM í’€ì—ì„œ AWS ë¦¬ì†ŒìŠ¤ë‚˜ ë‹¤ë¥¸ IPAM í’€ë¡œ CIDRì„ í• ë‹¹í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.Application Load Balancerì™€ VPC IPAMì˜ í†µí•©2025ë…„ 3ì›”ì— AWSëŠ” Application Load Balancer(ALB)ì™€ Amazon VPC IPAMì˜ í†µí•©ì„ ë°œí‘œí–ˆë‹¤. ì´ í†µí•©ì„ í†µí•´ ê³ ê°ì€ ë¡œë“œ ë°¸ëŸ°ì„œ ë…¸ë“œì— IP ì£¼ì†Œë¥¼ í• ë‹¹í•  ë•Œ ì‚¬ìš©í•  í¼ë¸”ë¦­ IPv4 ì£¼ì†Œ í’€ì„ ì§ì ‘ ì œê³µí•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.ì£¼ìš”íŠ¹ì§• IP ì£¼ì†Œ í’€ ì§€ì •: ê³ ê°ì€ í¼ë¸”ë¦­ IPAM í’€ì„ êµ¬ì„±í•  ìˆ˜ ìˆìœ¼ë©°, ì´ í’€ì€ ë‹¤ìŒê³¼ ê°™ì€ ì£¼ì†Œë¡œ êµ¬ì„±ë  ìˆ˜ ìˆë‹¤. ê³ ê° ì†Œìœ  Bring Your Own IP Address(BYOIP) Amazonì´ ì œê³µí•˜ëŠ” ì—°ì† IPv4 ì£¼ì†Œ ë¸”ë¡ ë¹„ìš© ìµœì í™”: BYOIPë¥¼ ì‚¬ìš©í•˜ì—¬ í¼ë¸”ë¦­ IPv4 ë¹„ìš©ì„ ìµœì í™”í•  ìˆ˜ ìˆë‹¤. 2024ë…„ 2ì›” 1ì¼ë¶€í„° AWSì—ì„œëŠ” ëª¨ë“  ì„œë¹„ìŠ¤ ê´€ë¦¬í˜• í¼ë¸”ë¦­ IPv4 ì£¼ì†Œì— ëŒ€í•´ ìš”ê¸ˆì„ ë¶€ê³¼í•˜ê³  ìˆë‹¤. ê·¸ëŸ¬ë‚˜ BYOIP ì£¼ì†ŒëŠ” ì´ëŸ¬í•œ ìš”ê¸ˆì´ ë¶€ê³¼ë˜ì§€ ì•ŠëŠ”ë‹¤. ê°„í¸í•œ í—ˆìš© ëª©ë¡ ê´€ë¦¬: Amazonì´ ì œê³µí•˜ëŠ” ì—°ì† IPv4 ë¸”ë¡ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ë‚´ í—ˆìš© ëª©ë¡ ì‘ì„± ë° ìš´ì˜ ì‘ì—…ì„ ê°„ì†Œí™”í•  ìˆ˜ ìˆë‹¤. ìë™ ì „í™˜ ë©”ì»¤ë‹ˆì¦˜: IPAM í’€ì—ì„œ ê³µê¸‰ë˜ëŠ” ALBì˜ IP ì£¼ì†ŒëŠ” í¼ë¸”ë¦­ IPAM í’€ì˜ ì£¼ì†Œê°€ ì†Œì§„ë˜ë©´ AWS ê´€ë¦¬í˜• IP ì£¼ì†Œë¡œ ìë™ ì „í™˜ëœë‹¤. ì´ë¥¼ í†µí•´ ê·œëª¨ ì¡°ì • ì´ë²¤íŠ¸ ì¤‘ì—ë„ ì„œë¹„ìŠ¤ ê°€ìš©ì„±ì„ ìµœëŒ€í™”í•  ìˆ˜ ìˆë‹¤.ALBì™€ IPAM í†µí•©í•˜ê¸°1. IPAM, í’€ ìƒì„±AWS ì½˜ì†”ì—ì„œ Amazon VPC IP Address Manager ë¥¼ ê²€ìƒ‰í•´ì„œ ì´ë™í•œ ë’¤, IPAM ê³¼ í’€ì„ ìƒì„±í•œë‹¤.CIDR ë„·ë§ˆìŠ¤í¬ ê¸¸ì´ëŠ” ALBì˜ ê°€ìš© ì˜ì—­ ê°¯ìˆ˜ì— ë”°ë¼ ì„ íƒí•˜ë©´ ë  ê²ƒ ê°™ë‹¤.2. ALB IP í’€ í¸ì§‘ì‚¬ìš©ì¤‘ì¸ ALB -&gt; ë„¤íŠ¸ì›Œí¬ ë§¤í•‘ -&gt; IP í’€ í¸ì§‘ì„ í´ë¦­í•˜ì—¬ IP í’€ í¸ì§‘ í™”ë©´ìœ¼ë¡œ ì´ë™í•œë‹¤.ìƒì„±í•œ IPv4 IPAM í’€ì„ ì„ íƒí•˜ê³  ì €ì¥í•˜ë©´ í†µí•©ì´ ì™„ë£Œëœë‹¤.3. í™•ì¸ë‹¤ì‹œ IPAM ì½˜ì†”ë¡œ ëŒì•„ì™€ ê°€ìš© ì˜ì—­ì˜ ê°¯ìˆ˜ì— ë§ì¶° IPê°€ ë¦¬ì†ŒìŠ¤ì— ë°°ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ ë³´ì.ì •í™•í•œ í™•ì¸ì„ ìœ„í•´ nslookup ëª…ë ¹ì–´ë¡œ í• ë‹¹ëœ IPê°€ ë¦¬í„´ë˜ëŠ”ì§€ í™•ì¸í•´ ë³´ì.ê²°ë¡ ALBì™€ IPAMì˜ í†µí•©ì„ í†µí•´ ALBì— ê³ ì • IPë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤. ë‹¹ì—°í•œ ì´ì•¼ê¸°ê² ì§€ë§Œ ì´ëŸ° ì•„í‚¤í…ì²˜ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ CloudFrontì— ê³ ì • IPë¥¼ ì‚¬ìš©í•œê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ë¬´ìš©ì§€ë¬¼ì´ë‹¤. (ë¬¼ë¡  ì´ ê²½ìš° Anycast ê³ ì • IP ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.)API ì„œë¹„ìŠ¤ ì œê³µìë¼ë©´ ê³ ê°ì˜ ë°©í™”ë²½ ì„¤ì •ì„ ìœ„í•´ IPv4 ì£¼ì†Œë¥¼ ìš”êµ¬í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤. ì €í¬ê°€ APIë¥¼ ì‚¬ìš©í•˜ë ¤ëŠ”ë°, ë°©í™”ë²½ ì‹œìŠ¤í…œ ë•Œë¬¸ì— IP ë“±ë¡ì´ í•„ìš”í•©ë‹ˆë‹¤. DNSê°€ ì•„ë‹Œ IPv4 ì£¼ì†Œë¥¼ ì•Œë ¤ì£¼ì‹¤ ìˆ˜ ìˆì„ê¹Œìš”? ì™€ ê°™ì€ ìš”ì²­ì´ ë¹ˆë²ˆí•˜ê²Œ ë°œìƒí•˜ê¸° ë•Œë¬¸ì´ë‹¤. ì´ë•Œ ìœ„ ê¸°ëŠ¥ì´ ë„ì›€ì´ ë  ê²ƒì´ë‹¤." }, { "title": "ì•¼ê°„ ë° ì£¼ë§ì— AWS Fargate ë™ì ìœ¼ë¡œ ìš´ì˜í•˜ê¸°", "url": "/posts/aws-fargate-dynamic-operation/", "categories": "AWS", "tags": "AWS, DevOps", "date": "2024-12-14 08:12:00 +0900", "snippet": "ì•¼ê°„ ë° ì£¼ë§ì— AWS Fargate ë™ì ìœ¼ë¡œ ìš´ì˜í•˜ê¸°ì‚¬ë‚´ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” ê´€ë¦¬ì(ê´€ì œ) ì„œë¹„ìŠ¤ê°€ ìˆë‹¤. ì•„ì£¼ ê°€ë” ì—…ë¬´ ì‹œê°„ì™¸ì— ì“¸ì¼ì´ ìˆê¸´ í•˜ì§€ë§Œ ëŒ€ë¶€ë¶„ì˜ ê²½ìš° í‰ì¼ 21ì‹œ ~ 08ì‹œ, ì£¼ë§ì—ëŠ” ì „í˜€ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.í´ë¼ìš°ë“œì˜ ì¥ì ì¤‘ í•„ìš”í•œ ë§Œí¼ë§Œ ì‚¬ìš©, í•„ìš”í•  ë•Œë§Œ ì‚¬ìš©ì„ ì¤‘ìš”í•œ ì¥ì ìœ¼ë¡œ ìƒê°í•œë‹¤. ê·¸ë˜ì„œ ì´ ê¸°íšŒì— AWS Fargate ë¥¼ ë™ì ìœ¼ë¡œ ìš´ì˜í•´ë³´ê¸°ë¡œ í–ˆë‹¤. :exclamation: ë³¸ í¬ìŠ¤íŒ…ì—ì„œ ì†Œê°œí•˜ëŠ” ë¡œì§ì€, ì œ ê°œì¸ì ì¸ ì ‘ê·¼ ë°©ì‹ì´ë¯€ë¡œ ì‹¤ì œ ìƒìš© ì‹œìŠ¤í…œì— ì ìš©í•˜ê¸° ì „ ì² ì €í•œ í…ŒìŠ¤íŠ¸ ê³¼ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.í˜„ì¬ ì•„í‚¤í…ì²˜í˜„ì¬ ì•„í‚¤í…ì²˜ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.CloudFrontì—ì„œ 1ì°¨ì ì¸ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ê²½ë¡œê°€ /api ë¡œ ì‹œì‘í•œë‹¤ë©´ api endpointsë¡œ ê°„ì£¼í•˜ì—¬ ë¡œë“œë°¸ëŸ°ì„œ - Fargateë¡œ ìš”ì²­ì„ ë³´ë‚´ê³  ê·¸ ì™¸ëŠ” frontend apië¡œ ê°„ì£¼í•˜ì—¬ s3ë¡œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤.í”„ë¡ íŠ¸ëŠ” React, ë°±ì—”ë“œëŠ” Spring Bootë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤.ì—…ë¬´ ì™¸ ì‹œê°„ ì•„í‚¤í…ì²˜ì—…ë¬´ ì™¸ ì‹œê°„ ì•„í‚¤í…ì²˜ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.í”„ë¡ íŠ¸ì—”ë“œë¡œ ê°€ëŠ” ìš”ì²­ì€ ê±´ë“¤ì§€ ì•Šì•˜ë‹¤. ì•„ì˜ˆ ì²˜ìŒë¶€í„° CloudFront ë„ ì—…ë¬´ ì™¸ ì‹œê°„ íŠ¸ë˜í”½ì„ í•¸ë“¤ë§í• ìˆ˜ ìˆê²Œ ë³„ë„ì˜ ë°°í¬ë¥¼ êµ¬ì„±í• ê¹Œë„ ê³ ë¯¼í•´ë´¤ì§€ë§Œ, CloudFront ë°°í¬ì—ì„œëŠ” ë™ì¼í•œ ëŒ€ì²´ ë„ë©”ì¸ ì´ë¦„ì„ ì—¬ëŸ¬ ë°°í¬ì— ì¤‘ë³µí•´ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— í¬ê¸°í–ˆë‹¤.ì˜ˆë¥¼ë“¤ì–´ ì—…ë¬´ì‹œê°„ì—ëŠ” a.b.c -&gt; a ë°°í¬, ê·¸ ì™¸ ì‹œê°„ì—ëŠ” a.b.c -&gt; b ë°°í¬ ì´ê²Œ ì•ˆëœë‹¤. ë¬¼ë¡  ì—…ë¬´ ì™¸ ì‹œê°„ì— a ë°°í¬ì˜ ëŒ€ì²´ ë„ë©”ì¸ì„ ë°”ê¿”ë²„ë¦¬ë©´ ë˜ì§€ë§Œ CloudFront ìˆ˜ì • í›„ ë°°í¬ ì‹œê°„ì´ ê½¤ ì†Œìš”ë˜ê¸° ë•Œë¬¸ì— í¬ê¸°í–ˆë‹¤.ë°±ì—”ë“œ ì•„í‚¤í…ì²˜ë¥¼ ë³€ê²½í–ˆë‹¤. ê¸°ì¡´ Fargateë¡œ ê°€ëŠ” ìš”ì²­ì„ Lambdaë¡œ ë³´ë‚¸ë‹¤. ê·¸ ì™¸ EventBridge ê°€ ìˆ˜í–‰í•˜ëŠ” ë™ì‘ì— ëŒ€í•´ì„œëŠ” ì•„ë˜ì—ì„œ ì„¤ëª…í•œë‹¤.Lambda í•¨ìˆ˜ ì‘ì„±í•˜ê¸°ëŒë‹¤ê°€ ì²˜ë¦¬í•˜ëŠ” ì¼ì´ ë§ë‹¤. ì²˜ë¦¬í•˜ëŠ”ì¼ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. EventBridge ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰ ìš”ì²­ ì²˜ë¦¬ EventBridge ì´ë²¤íŠ¸ ê·œì¹™ì„ í†µí•´ ì „ë‹¬ëœ ì´ë²¤íŠ¸ ì²˜ë¦¬ Application Load Balancer ë¡œë¶€í„° ì „ë‹¬ëœ ìš”ì²­ ì²˜ë¦¬ë‹¤ìŒì€ ëŒë‹¤ì˜ index ì½”ë“œì´ë‹¤. ì—¬ê¸°ì„œ ë¶„ê¸°ë¥¼ í†µí•´ ê° ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•œë‹¤.export const handler = async (event, context) =&gt; { if (event) { // ë¡œë“œë°¸ëŸ°ì„œ ìš”ì²­ if (event.requestContext &amp;&amp; event.requestContext.elb) { return handleAlb(event, context); } if (event.sourceLocation &amp;&amp; event.sourceLocation === 'EventBridge') { // ì„œë¹„ìŠ¤ê°€ SERVICE_STEADY_STATE ê°€ ë˜ì—ˆì„ë•Œ if (event.eventName === 'SERVICE_STEADY_STATE') { return handleService(event, context); } // EventBridge ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰ ìš”ì²­ ì²˜ë¦¬ if (event.eventName === 'FARGATE_SCALING_TRIGGER') { return handleScaling(event, context); } } } return null;};ë‹¤ìŒì€ ì‹œìŠ¤í…œì„ í•¸ë“¤ë§í• ë•Œ ì‚¬ìš©ë  ì„œë¹„ìŠ¤ ë°ì´í„°ì´ë‹¤. ì‚¬ì‹¤ í˜¸ìŠ¤íŠ¸ë‚˜ ê¸°íƒ€ ë°ì´í„°ë¡œ í•„ìš”í•œ arnë“¤ì„ ì—­ìœ¼ë¡œ ì°¾ì•„ê°ˆìˆ˜ë„ ìˆê² ìœ¼ë‚˜ ê·¸ë ‡ê²Œ ë˜ë©´ ë¶ˆí•„ìš”í•œ í˜¸ì¶œì´ë‚˜ ë¡œì§ì´ ë“¤ì–´ê°€ê¸° ë•Œë¬¸ì— í•„ìš”í•œ ì •ë³´ë“¤ì„ ë³€ìˆ˜ì— ë‹´ì•„ë‘ê¸°ë¡œ í–ˆë‹¤.const SERVICE_DATA = [ { key: 'admin', host: 'admin.keencho.com', cluster: 'keencho-cluster', service: 'admin', albArn: 'ë¡œë“œ ë°¸ëŸ°ì„œ arn', albRuleArns: ['ì‹¤ì œ admin.keencho.com ì„ HTTP í˜¸ìŠ¤íŠ¸ í—¤ë” ì¡°ê±´ìœ¼ë¡œ ê°€ì§€ê³  ìˆëŠ” ë¦¬ìŠ¤ë„ˆ ê·œì¹™ arn ë¦¬ìŠ¤íŠ¸'], lambdaTargetGroupArn: 'ëŒë‹¤ê°€ í¬í•¨ë˜ì–´ ìˆëŠ” ëŒ€ìƒê·¸ë£¹ arn', ecsFargateTargetGroupArn: ['ì‹¤ì œ fargate íƒœìŠ¤í¬ê°€ í¬í•¨ë˜ì–´ ìˆëŠ” ëŒ€ìƒê·¸ë£¹ arn ë¦¬ìŠ¤íŠ¸'] }]EventBridge ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰ ìš”ì²­ ì²˜ë¦¬ì²«ë²ˆì§¸ëŠ” EventBridge ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰ ìš”ì²­ ì²˜ë¦¬ì´ë‹¤. Amazon EventBridge -&gt; Scheduler -&gt; ì¼ì • ì—ì„œ ì„¤ì •í•˜ì˜€ìœ¼ë©° ì–´ë–»ê²Œ ì„¤ì •í•˜ëŠ”ì§€ê¹Œì§€ ì„¤ëª…í•˜ì§„ ì•ŠëŠ”ë‹¤. ë‚˜ì˜ ê²½ìš° 30ë¶„ë§ˆë‹¤ ì‘ë™í•˜ê²Œ ì„¤ì •í•˜ì˜€ìœ¼ë©°, ë‹¤ìŒê³¼ ê°™ì€ í˜ì´ë¡œë“œë¥¼ ì „ë‹¬í•˜ë„ë¡ í•˜ì˜€ë‹¤.{ \"sourceLocation\": \"EventBridge\", \"eventName\": \"FARGATE_SCALING_TRIGGER\" }ìœ„ í˜ì´ë¡œë“œë¥¼ ì „ë‹¬ë°›ì€ ëŒë‹¤ëŠ” handleScaling ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤. ì´ ë©”ì†Œë“œëŠ” 1ì°¨ë¡œ ì‹œê°„ì„ í™•ì¸í•œë‹¤. í˜„ì¬ ì‹œê°„ì´ ì£¼ë§ì´ê±°ë‚˜ í‰ì¼ 21ì‹œ ~ 08ì‹œ ì‚¬ì´ë©´ stop ë©”ì†Œë“œë¥¼, ê·¸ ì™¸ì—ëŠ” start ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤.const handleScaling = async(event, context) =&gt; { const now = new Date(); const utcHour = now.getUTCHours(); const kstHour = (utcHour + 9) % 24 const isNightTime = (kstHour &gt;= 21) || (kstHour &lt; 8); const kstTime = new Date(now.getTime() + (9 * 60 * 60 * 1000)); const kstDay = kstTime.getUTCDay(); const isWeekend = kstDay === 0 || kstDay === 6; for (const data of SERVICE_DATA) { if (isNightTime || isWeekend) { await stop(data) } else { await start(data, context) } }}1. stopë©ˆì¶°ì•¼ í•˜ëŠ” ì‹œê°„ëŒ€ì´ë©´ ë©ˆì¶˜ë‹¤. ë‹¤ìŒì€ ì‚¬ìš©ë˜ëŠ” ì „ì²´ ì½”ë“œì´ë‹¤.// ì„œë¹„ìŠ¤ ê°€ì ¸ì˜¤ê¸°const getService = async(ecsClient, clusterName, serviceName) =&gt; { const response = await ecsClient.send(new DescribeServicesCommand({ cluster: clusterName, services: [serviceName] })) if (!response || !response.services || response.services.length !== 1) { return undefined } return response.services[0];}// íŠ¸ë˜í”½ ê²€ì¦const checkTraffic = async(data) =&gt; { const now = new Date(); const end = new Date(Date.UTC( now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds() )); // 20ë¶„ const start = new Date(end.getTime() - 20 * 60 * 1000); // ê°„ê²©: 20ë¶„ const period = 1200; const loadBalancerArn = data.albArn const loadBalancerName = loadBalancerArn.split(':').pop().split('/').slice(1).join('/'); const sum = await data.ecsFargateTargetGroupArn.reduce(async (acc, arn) =&gt; { const accumulated = await acc; const tgName = arn.split(':').pop() const params = { StartTime: start, EndTime: end, MetricDataQueries: [ { Id: \"count\", MetricStat: { Metric: { Namespace: \"AWS/ApplicationELB\", MetricName: \"HTTPCode_Target_2XX_Count\", // 200ë²ˆëŒ€ ìƒíƒœ ì½”ë“œë§Œ í•„í„°ë§ Dimensions: [ { Name: \"LoadBalancer\", Value: loadBalancerName }, { Name: \"TargetGroup\", Value: tgName } ] }, Period: period, Stat: \"Sum\" // ìš”ì²­ ê°œìˆ˜ì˜ í•©ê³„ }, Label: \"200 Status Code Requests\" } ] }; const cloudwatch = new CloudWatchClient({ region: 'ap-northeast-2' }); const command = new GetMetricDataCommand(params); const response = await cloudwatch.send(command); const results = response.MetricDataResults[0] const trafficSum = (!results.Values || results.Values.length === 0) ? 0 : results.Values.reduce((sum, number) =&gt; sum + number, 0) return accumulated + trafficSum; }, Promise.resolve(0)) return sum === 0}const stop = async(data) =&gt; { ////////// 1. ë©ˆì¶°ì•¼ í•˜ëŠ” ì„œë¹„ìŠ¤ì¸ì§€ ê²€ì¦ const ecsClient = new ECSClient({region: 'ap-northeast-2'}); const service = await getService(ecsClient, data.cluster, data.service); if (service === undefined || service.desiredCount === 0) { return } // ìƒˆë²½ì— ë„ëŠ” ìŠ¤ì¼€ì¥´ì˜ ê²½ìš° í˜„ì¬ desiredCountê°€ 1 ì´ìƒì¸ ê²½ìš° ì§€ë‚œ 20ë¶„ê°„ 2xx ìƒíƒœì½”ë“œë¥¼ ê°€ì§„ íŠ¸ë˜í”½ì´ ìˆëŠ”ì§€ ê²€ì¦í•œë‹¤. // ì‚¬ìš©ì¤‘ì¸ë° êº¼ì§€ë©´ ì•ˆë˜ê¸° ë•Œë¬¸ì´ë‹¤. if (!await checkTraffic(data)) { return; } ////////// 2. ë©ˆì¶°ì•¼ í•˜ëŠ” ì„œë¹„ìŠ¤ë¼ë©´ í•´ë‹¹ ì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ…ì¤‘ì¸ ë¡œë“œë°¸ëŸ°ì„œ ë£° ë³€ê²½ const albClient = new ElasticLoadBalancingV2Client({region: 'ap-northeast-2'}) const describeResponse = await albClient.send( new DescribeRulesCommand({ RuleArns: data.albRuleArns }) ); for (const rule of (describeResponse.Rules || [])) { if (rule.Actions &amp;&amp; rule.Actions.length === 1 &amp;&amp; rule.Actions[0].Type === 'forward') { const action = rule.Actions[0] const updatedAction = { ...action, TargetGroupArn: data.lambdaTargetGroupArn, ForwardConfig: { ...action.ForwardConfig, TargetGroups: [ { TargetGroupArn: data.lambdaTargetGroupArn, Weight: 1 } ] } }; await albClient.send( new ModifyRuleCommand({ RuleArn: rule.RuleArn, Actions: [updatedAction] }) ) } } ////////// 3. ì„œë¹„ìŠ¤ desired count 0 ì²˜ë¦¬ const params = { cluster: data.cluster, service: data.service, desiredCount: 0 } await ecsClient.send(new UpdateServiceCommand(params));}ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. ë©ˆì¶°ì•¼ í•˜ëŠ” ì„œë¹„ìŠ¤ì¸ì§€ ê²€ì¦í•œë‹¤. ì´ë¯¸ ecs ì„œë¹„ìŠ¤ì˜ desired countê°€ 0 ì´ë©´ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. ì§€ë‚œ 20ë¶„ê°„ 2xx ìƒíƒœì½”ë“œë¥¼ ë¦¬í„´í•œ ìš”ì²­ì´ ìˆìœ¼ë©´ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. (ì´ ìŠ¤ì¼€ì¤„ëŸ¬ëŠ” 30ë¶„ ê°„ê²©ìœ¼ë¡œ ë„ëŠ”ë° ë„ëŠ” ì‹œì ì— ì‚¬ìš©í•˜ê³  ìˆì„ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì—) ì‹¤ì œ admin.keencho.com ì„ HTTP í˜¸ìŠ¤íŠ¸ í—¤ë” ì¡°ê±´ìœ¼ë¡œ ê°€ì§€ê³  ìˆëŠ” ë¦¬ìŠ¤ë„ˆ ê·œì¹™ arn ë¦¬ìŠ¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ê·œì¹™ì˜ ì‘ì—…ì„ ëŒë‹¤ ëŒ€ìƒê·¸ë£¹ìœ¼ë¡œ ì „ë‹¬ ë¡œ ë³€ê²½í•œë‹¤. ecs ì„œë¹„ìŠ¤ì˜ desired countë¥¼ 0ìœ¼ë¡œ ë³€ê²½í•œë‹¤.ì´ë ‡ê²Œ í•˜ë©´ api íŠ¸ë˜í”½ì€ ëŒë‹¤ë¡œ ê°€ê³  ì„œë¹„ìŠ¤ì˜ íƒœìŠ¤í¬ ìˆ˜ëŠ” 0ì´ ëœë‹¤. íƒœìŠ¤í¬ê°€ ë™ì‘í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë‹¹ì—°íˆ ìš”ê¸ˆì´ ë¶€ê³¼ë˜ì§€ ì•ŠëŠ”ë‹¤.2. startì—…ë¬´ì‹œê°„ì´ ë‹¤ê°€ì˜¤ë©´ ì‹œì‘í•œë‹¤. ë‹¤ìŒì€ ì‚¬ìš©ë˜ëŠ” ì „ì²´ ì½”ë“œì´ë‹¤.const start = async(data, context) =&gt; { ////////// 1. ì‹œì‘í•´ì•¼ í•˜ëŠ” ì„œë¹„ìŠ¤ì¸ì§€ ê²€ì¦ const ecsClient = new ECSClient({ region: 'ap-northeast-2' }); const service = await getService(ecsClient, data.cluster, data.service); if (service === undefined || service.desiredCount !== 0) { return } ////////// 2. desired count 1 ì²˜ë¦¬ const params = { cluster: data.cluster, service: data.service, desiredCount: 1 }; await ecsClient.send(new UpdateServiceCommand(params)); ////////// 3. EventBridgeì— ê·œì¹™ ë“±ë¡ (ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆëŠ” ê²½ìš° ì—…ë°ì´íŠ¸ë¨) const ruleName = `ecs-monitor-${data.cluster}_${data.service}` const ruleParams = { Name: ruleName, EventPattern: JSON.stringify({ source: [\"aws.ecs\"], \"detail-type\": ['ECS Service Action'], resources: [service.serviceArn], detail: { eventName: ['SERVICE_STEADY_STATE'] } }), }; const eventBridgeClient = new EventBridgeClient({ region: \"ap-northeast-2\" }); const result = await eventBridgeClient.send(new PutRuleCommand(ruleParams)); ////////// 4. ê·œì¹™ì— ëŒ€í•œ íƒ€ê²Ÿ ì„¤ì • const targetParams = { Rule: ruleName, Targets: [ { Id: `${ruleName}-target`, Arn: context.invokedFunctionArn, Input: JSON.stringify({ sourceLocation: 'EventBridge', eventName: 'SERVICE_STEADY_STATE', clusterArn: service.clusterArn, serviceArn: service.serviceArn, albArn: data.albArn, key: data.key }) } ] } await eventBridgeClient.send(new PutTargetsCommand(targetParams)); ////////// 5. lambdaì— ë¦¬ì†ŒìŠ¤ ì•¡ì„¸ìŠ¤ ê¶Œí•œ ë¶€ì—¬ try { const lambdaClient = new LambdaClient({ region: \"ap-northeast-2\" }); const addPermissionParams = { Action: \"lambda:InvokeFunction\", FunctionName: context.functionName, Principal: \"events.amazonaws.com\", SourceArn: result.RuleArn, StatementId: `${ruleName}-permission` }; await lambdaClient.send(new AddPermissionCommand(addPermissionParams)); } catch (error) { // ê¶Œí•œì´ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²½ìš° ì—ëŸ¬ ë°œìƒ (StatementId ì¤‘ë³µ) if (error.name === 'ResourceConflictException') { // ... } }}ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. ë©ˆì¶°ì•¼ í•˜ëŠ” ì„œë¹„ìŠ¤ì¸ì§€ ê²€ì¦í•œë‹¤. ì´ë¯¸ ecs ì„œë¹„ìŠ¤ì˜ desired countê°€ 1 ì´ë©´ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. ecs ì„œë¹„ìŠ¤ì˜ desired countë¥¼ 1ìœ¼ë¡œ ë³€ê²½í•œë‹¤. EventBridgeì— ê·œì¹™ì„ ë“±ë¡í•œë‹¤. detail type: ECS Service Action event type: SERVICE_STEADY_STATE ì°¸ì¡° ë“±ë¡í•œ ê·œì¹™ì— ëŒ€í•œ íƒ€ê²Ÿì„ ì„¤ì •í•œë‹¤. ëŒë‹¤ì™€ Input ë°ì´í„°ë¥¼ ì§€ì •í•œë‹¤. EventBridge ê·œì¹™ì´ ëŒë‹¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬í•œë‹¤. ì´ ì‘ì—…ì€ ìµœì´ˆ 1íšŒë§Œ í•˜ë©´ ë˜ë©° ê·¸ ì´í›„ ë™ì¼í•œ ì‘ì—… ìˆ˜í–‰ì‹œ ResourceConflictException ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ecs ì„œë¹„ìŠ¤ íƒœìŠ¤í¬ ìˆ˜ê°€ 1ì´ ëœë‹¤. ê·¸ëŸ¬ë‚˜ ì‹¤ì œ ë¡œë“œë°¸ëŸ°ì„œ ë¦¬ìŠ¤ë„ˆ ê·œì¹™ì„ ë³€ê²½í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. ë¬¼ë¡  ì´ ì‹œì ì—ì„œ í´ë§ì„ í†µí•´ íƒœìŠ¤í¬ ìƒíƒœë¥¼ ê²€ì¦í•˜ëŠ” ë°©ë²•ë„ ìˆì§€ë§Œ ëŒë‹¤ëŠ” ì‹¤í–‰ì‹œê°„ ë§Œí¼ ìš”ê¸ˆì´ ë¶€ê³¼ë˜ê¸° ë•Œë¬¸ì— ecs ì„œë¹„ìŠ¤ê°€ ì•ˆì •ì ì¸ ìƒíƒœì— ë„ë‹¬í•˜ë©´ ëŒë‹¤ë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•˜ëŠ” ì´ë²¤íŠ¸ë¥¼ EventBridgeì— ë“±ë¡í•˜ëŠ” ë°©ì‹ì„ ì„ íƒí–ˆë‹¤.EventBridge ì´ë²¤íŠ¸ ê·œì¹™ì„ í†µí•´ ì „ë‹¬ëœ ì´ë²¤íŠ¸ ì²˜ë¦¬ecs ì„œë¹„ìŠ¤ì˜ íƒœìŠ¤í¬ ìˆ˜ë¥¼ 1ë¡œ ë³€ê²½í•˜ê³  ì„œë¹„ìŠ¤ê°€ ì•ˆì •ì ì¸ ìƒíƒœì— ë„ë‹¬í•œë‹¤ë©´, EventBridgeì— ë“±ë¡í•´ë‘” SERVICE_STEADY_STATE ì´ë²¤íŠ¸ê°€ íŠ¸ë¦¬ê±°ë˜ì–´ ëŒë‹¤ë¥¼ í˜¸ì¶œí•œë‹¤. ë‹¤ìŒì€ ì´ë¥¼ í•¸ë“¤ë§í•˜ëŠ” ì½”ë“œì´ë‹¤.const handleService = async(event) =&gt; { const data = SERVICE_DATA.find(item =&gt; item.key === event.key) if (!data) { return; } const input = { services: [event.serviceArn], cluster: event.clusterArn } const ecsClient = new ECSClient({ region: 'ap-northeast-2' }); const command = new DescribeServicesCommand(input); const response = await ecsClient.send(command); if (!response.services || response.services.length === 0) { return; } const service = response.services[0]; if (service.desiredCount === 0) { return; } if (!service.loadBalancers || service.loadBalancers.length === 0) { return; } const targetChangeArns = data.albRuleArns const targetGroupArn = service.loadBalancers[0].targetGroupArn; const albClient = new ElasticLoadBalancingV2Client({ region: 'ap-northeast-2' }) const describeResponse = await albClient.send( new DescribeRulesCommand({ RuleArns: targetChangeArns }) ); if (!describeResponse.Rules || describeResponse.Rules.length === 0) { return; } const rule = describeResponse.Rules[0]; // ì´ë¯¸ ë¼ìš°íŒ…ì´ ì •ìƒì¸ ê²½ìš° -&gt; ë°°í¬ì˜ ê²½ìš° if (rule.Actions.some(item =&gt; item.TargetGroupArn === targetGroupArn)) { return; } const updatedActions = rule.Actions.map(action =&gt; { return { ...action, TargetGroupArn: targetGroupArn, ForwardConfig: { ...action.ForwardConfig, TargetGroups: [ { TargetGroupArn: targetGroupArn, Weight: 1 } ] } }; }); for (const ruleArn of targetChangeArns) { await albClient.send( new ModifyRuleCommand({ RuleArn: ruleArn, Actions: updatedActions }) ) }}ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. ë„˜ì–´ì˜¨ í˜ì´ë¡œë“œ ì˜ keyë¡œ SERVICE_DATA ì—ì„œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ì°¾ëŠ”ë‹¤. ecs ì„œë¹„ìŠ¤ì˜ desired countê°€ 0 ì´ë©´ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´ë¯¸ ë¦¬ìŠ¤ë„ˆ ê·œì¹™ì´ ì˜¬ë°”ë¥¸ ëŒ€ìƒ ê·¸ë£¹ìœ¼ë¡œ ì „ë‹¬ë˜ê³  ìˆì„ ê²½ìš° ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. ì„œë¹„ìŠ¤ê°€ ë°°í¬ë˜ëŠ” ê²½ìš°ë„ ì´ ëŒë‹¤ê°€ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— ì¶”ê°€ëœ ì¡°ê±´ì´ë‹¤. ëŒë‹¤ ëŒ€ìƒê·¸ë£¹ì„ ë°”ë¼ë³´ê³  ìˆëŠ” ë¦¬ìŠ¤ë„ˆ ê·œì¹™ì„ ecs ì„œë¹„ìŠ¤ íƒœìŠ¤í¬ê°€ í¬í•¨ëœ ëŒ€ìƒê·¸ë£¹ìœ¼ë¡œ ë³€ê²½í•œë‹¤ ë‚˜ì˜ ê²½ìš° CodeDeploy ê¸°ë°˜ ë°°í¬ë¥¼ ì§„í–‰í•˜ê³  ìˆê³ , ì´ëŠ” 2ê°œì˜ ëŒ€ìƒê·¸ë£¹ì„ í•„ìš”ë¡œ í•œë‹¤. ë”°ë¼ì„œ ë³€ê²½í•  íƒœìŠ¤í¬ ëŒ€ìƒê·¸ë£¹ì€ í•˜ë“œì½”ë”©ëœ ëŒ€ìƒê·¸ë£¹ì´ ì•„ë‹Œ ecs ì„œë¹„ìŠ¤ì™€ ì—®ì—¬ìˆëŠ” ëŒ€ìƒê·¸ë£¹ìœ¼ë¡œ í•´ì•¼ í•œë‹¤. Rolling Update ê¸°ë°˜ ë°°í¬ì˜ ê²½ìš° ëŒ€ìƒê·¸ë£¹ì´ 1ê°œì¼ ê²ƒì´ê¸° ë•Œë¬¸ì— í•˜ë“œì½”ë”©ëœ ëŒ€ìƒê·¸ë£¹ì„ ì‚¬ìš©í•´ë„ ë¬´ë°©í•˜ë‹¤. Application Load Balancer ë¡œë¶€í„° ì „ë‹¬ëœ ìš”ì²­ ì²˜ë¦¬ì§€ê¸ˆê¹Œì§€ì˜ ì‘ì—…ë§Œ ì§„í–‰í•˜ë©´ ì—…ë¬´ ì™¸ ì‹œê°„ì—ëŠ” ì„œë¹„ìŠ¤ì˜ í•„ìš” íƒœìŠ¤í¬ê°€ 0ì´ ë˜ê³  ì—…ë¬´ ì‹œê°„ì´ ë‹¤ê°€ì˜¤ë©´ ì„œë¹„ìŠ¤ì˜ í•„ìš” íƒœìŠ¤í¬ê°€ 1ì´ ëœë‹¤. í•˜ì§€ë§Œ ë§Œì•½ì— ê¸´ê¸‰í•˜ê²Œ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•´ì•¼í•  ê²½ìš°ëŠ” ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ? ì´ì— ëŒ€í•´ ë‚´ê°€ ìƒê°í•œ ë°©ë²•ì„ ì‘ì„±í•´ë³´ë„ë¡ í•œë‹¤.1. ìš”ì²­ ê²€ì¦í•˜ê¸°ì•ì„œ ì„œë¹„ìŠ¤ë¥¼ stop í• ë•Œ, ë¦¬ìŠ¤ë„ˆ ê·œì¹™ì´ ë°”ë¼ë³¼ ëŒ€ìƒì„ ëŒë‹¤ë¡œ ë³€ê²½í–ˆë‹¤. ì—…ë¬´ ì™¸ ì‹œê°„ ê¸´ê¸‰í•˜ê²Œ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•´ì•¼í•  ê²½ìš° ì´ ëŒë‹¤ë¡œ ìš”ì²­ì´ ì „ë‹¬ë  ê²ƒì´ë‹¤. ì´ ê²½ìš° ì„œë¹„ìŠ¤ë¥¼ ë‹¤ì‹œ ì‹œì‘í•´ì•¼ í•œë‹¤. ë‹¤ë§Œ 2ê°€ì§€ ê³ ë ¤ì‚¬í•­ì´ ìˆë‹¤. í”„ë¡œê·¸ë¨(ë´‡) ì— ì˜í•´ ì°”ëŸ¬ë³¸ ìš”ì²­ì¸ê°€? ì‹¤ì œ ì„œë¹„ìŠ¤ (Spring Boot) ì— ì¡´ì¬í•˜ëŠ” ê²½ë¡œì¸ê°€?1ë²ˆì˜ ê²½ìš° CloudFront ì•ë‹¨ì— WAF ë¥¼ ë°°ì¹˜í•˜ì—¬ ë´‡ì„ ì»¨íŠ¸ë¡¤ í•  ìˆ˜ ìˆë‹¤. ëŒë‹¤ì—ì„œ ì§ì ‘ ì»¨íŠ¸ë¡¤ í•  ìˆ˜ë„ ìˆê² ì§€ë§Œ ë‚´ ê²½ìš° ê·¸ëƒ¥ WAF ë¡œ ì»¨íŠ¸ë¡¤í•˜ëŠ” ìª½ì„ ì„ íƒí–ˆë‹¤.2ë²ˆì˜ ê²½ìš° ìƒê°ì„ ì¢€ í•´ë´¤ëŠ”ë° ë‚´ê°€ ìƒê°í•œ ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. @PostConstructë¥¼ ì´ìš©í•˜ì—¬ diê°€ ëë‚œ í›„ ì•± ë‚´ì— ìˆëŠ” ëª¨ë“  ê²½ë¡œë¥¼ ê²€ìƒ‰í•´ì„œ s3ì— ë°°ì—´ë¡œ ì €ì¥í•œë‹¤. ì‹¤ì œ ëŒë‹¤ê°€ í˜¸ì¶œë˜ì—ˆì„ë•Œ ë°°ì—´ì— pathì™€ ì¼ì¹˜í•˜ëŠ” ìš”ì†Œê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°ë§Œ ì„œë¹„ìŠ¤ë¥¼ ì‹œì‘í•œë‹¤.ë‹¤ìŒì€ ëª¨ë“  ê²½ë¡œë¥¼ ê²€ìƒ‰í•´ì„œ s3ì— ì—…ë¡œë“œí•˜ëŠ” ì½”ë“œì´ë‹¤. s3util ë¶€ë¶„ë§Œ ì‹¤ì œ ì˜¬ë¦¬ëŠ” ë¡œì§ìœ¼ë¡œ ë³€ê²½í•˜ë©´ ë  ê²ƒì´ë‹¤.@Profile(\"prod\")@Componentpublic class EndpointGenerator { @Autowired RequestMappingHandlerMapping requestMappingHandlerMapping; @Autowired S3Util s3Util; @Autowired ObjectMapper objectMapper; @Autowired WebApplicationContext webApplicationContext; @PostConstruct public void init() throws JsonProcessingException { var patterns = new ArrayList&lt;String&gt;(); var contextPath = webApplicationContext.getServletContext().getContextPath(); for (var info : requestMappingHandlerMapping.getHandlerMethods().keySet()) { var patternWithContext = info.getPatternValues().stream() .map(pattern -&gt; contextPath + pattern) .collect(Collectors.toList()); patterns.addAll(patternWithContext); } s3Util.upload( \"keencho-bucket\", \"admin.json\", objectMapper.writeValueAsString(patterns) ); }}2. ì‹œì‘í•˜ê¸°ì´ì œ ì‹¤ì œ ì‹œì‘ì— í•„ìš”í•œ ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ì. ë¡œë“œë°¸ëŸ°ì„œì˜ ìš”ì²­ì„ ì²˜ë¦¬í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ê·¸ì— ë§ëŠ” í˜•ì‹ì„ ë¦¬í„´í•  í•„ìš”ê°€ ìˆë‹¤.const buildResponse = (success, data) =&gt; { return { headers: { \"Content-Type\": \"application/json\", }, statusCode: success ? 200 : 500, body: JSON.stringify(data) }}const errorResponse = () =&gt; buildResponse(false, { success: false, message: 'Invalid access' })const successResponse = () =&gt; buildResponse(true, { success: true })const handleAlb = async(event, context) =&gt; { /////////////////////////////////////// í—¬ìŠ¤ ì²´í¬ if (event.path === '/health-check') { return { statusCode: 200, statusDescription: \"OK\", isBase64Encoded: false, headers: { \"Content-Type\": \"application/json\" } }; } try { return handle(event, context) } catch (error) { return errorResponse() }}const isValidRoute = async(type, url) =&gt; { const patternToRegex = (pattern) =&gt; { const regexPattern = pattern .replace(/\\//g, '\\\\/') // ìŠ¬ë˜ì‹œ ì´ìŠ¤ì¼€ì´í”„ .replace(/\\*\\*/g, '.*') // ** íŒ¨í„´ì„ .* (ëª¨ë“  ë¬¸ì, ì—¬ëŸ¬ ê°œ)ë¡œ ë³€í™˜ .replace(/{([^}]+)}/g, '([^/]+)'); // {ë³€ìˆ˜} íŒ¨í„´ì„ ìº¡ì²˜ ê·¸ë£¹ìœ¼ë¡œ ë³€í™˜ return new RegExp(`^${regexPattern}$`); } const client = new S3Client({}); const command = new GetObjectCommand({ Bucket: 'keencho-bucket', Key: type + '.json' }) const responseData = await client.send(command); const str = await responseData.Body.transformToString(); const routes = JSON.parse(str); for (const route of routes) { const regex = patternToRegex(route); if (regex.test(url)) { return true; } } return false;}const handle = async(event, context) =&gt; { const path = event.path; const host = event.headers.host; const data = SERVICE_DATA.find(item =&gt; item.host === host); if (!data) { return errorResponse() } const type = data.key ////////// 1. ê²€ì¦ if (!type || !await isValidRoute(type, path) || !event?.headers?.referer?.includes(host)) { return errorResponse() } ////////// 2. desired count ì´ë¯¸ 1 ì´ìƒì¸ì§€ í™•ì¸ const ecsClient = new ECSClient({region: 'ap-northeast-2'}); const service = await getService(ecsClient, data.cluster, data.service); if (service === undefined) { return errorResponse() } // ì´ë¯¸ ì‹œì‘ëœ ê²½ìš°ë¼ê³  ê°„ì£¼í•¨. if (service.desiredCount &gt; 0) { return successResponse(type) } ////////// 3. desire task 1 ì²˜ë¦¬ await start(data, context) return successResponse(type)}ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. ë°ì´í„°ë¥¼ ê²€ì¦í•œë‹¤. isValidRoute() ë©”ì†Œë“œë¥¼ í†µí•´ ìœ íš¨í•œ ê²½ë¡œì¸ì§€ ê²€ì¦í•œë‹¤. @PathVariableë¥¼ ì‚¬ìš©í•œ ê²½ë¡œì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê·¸ì—ëŒ€í•œ ì •ê·œì‹ì´ í•„ìš”í•˜ë‹¤. ë™ì¼ ì¶œì²˜ì¸ì§€ ê²€ì¦í•œë‹¤. ì–´ì§œí”¼ ë”°ë¡œ í—ˆìš©í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ì—ëŸ¬ê°€ ë°œìƒí•  í…Œì§€ë§Œ ëª…ì‹œì ìœ¼ë¡œ ê²€ì¦í•œë‹¤. ecs ì„œë¹„ìŠ¤ì˜ desired countê°€ 0ë³´ë‹¤ í¬ë©´ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. ì•ì„œ ì‘ì„±í•œ start() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤. ì„±ê³µ ì‘ë‹µì„ ë¦¬í„´í•œë‹¤.ì´ë¯¸ ê²€ì¦ì„ í–ˆìœ¼ë¯€ë¡œ start() ë©”ì†Œë“œì—ì„œ ë˜ ê²€ì¦í•  í•„ìš”ëŠ” ì—†ë‹¤. ë¶ˆí•„ìš”í•œ í˜¸ì¶œì„ ë§‰ëŠ” ë¡œì§ì„ ì¶”ê°€í•˜ë©´ ì¢‹ì„ê²ƒ ê°™ë‹¤. (ì—¬ê¸°ì„  í•˜ì§€ ì•ŠëŠ”ë‹¤.)ì´í›„ íƒœìŠ¤í¬ê°€ ì‹œì‘ë˜ë©´ EventBridgeì— ë“±ë¡í•´ë‘” SERVICE_STEADY_STATEê°€ íŠ¸ë¦¬ê±°ë˜ê³  ì•ì„œ ì‚´í´ë³¸ ì´ë²¤íŠ¸ ì²˜ë¦¬ ë¡œì§ ì— ì˜í•´ ì²˜ë¦¬ëœë‹¤.ê²°ë¡ í˜„ì¬ ì‚¬ë‚´ ì‹œìŠ¤í…œ(ê´€ë¦¬ì)ê³¼ í…ŒìŠ¤íŠ¸ì„œë²„ ì—ë§Œ ìœ„ ì•„í‚¤í…ì²˜ë¥¼ ì ìš©í•˜ê³  ìˆë‹¤. í…ŒìŠ¤íŠ¸ì„œë²„ì˜ ê²½ìš° ìƒˆë²½ì‹œê°„ëŒ€ì— ì‹œì‘í•˜ëŠ” ë¡œì§ì´ ë¹ ì ¸ìˆë‹¤. ê·¸ëƒ¥ ë¬´ì¡°ê±´ ì—…ë¬´ì‹œê°„ì—ë§Œ ì“°ë„ë¡ í•œ ê²ƒì´ë‹¤.ì½”ë“œë‚˜ ë¡œì§ì€ ì¡°ê¸ˆ ë³´ì™„í•´ì•¼ ê² ì§€ë§Œ ì˜ˆìƒëŒ€ë¡œ ëŒì•„ê°ì— ë§Œì¡±í•œë‹¤. ì¶”ê°€ë¡œ ì´ í¬ìŠ¤íŒ…ì— ì‘ì„±í•˜ì§„ ì•Šì•˜ì§€ë§Œ ì¤‘ì§€ ì‹œê°„ëŒ€ì— ë‹¤ìŒê³¼ ê°™ì´ UIê°€ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©´ ì¢‹ì„ê²ƒì´ë‹¤.ë‚´ ê²½ìš° ì„œë¹„ìŠ¤ ìœ ì§€ê¸°ê°„ì¸ ê²½ìš° ì•„ì˜ˆ ë³„ë„ì˜ í˜ì´ì§€ë¡œ redirect ì‹œí‚¤ê³  ì‹œì‘í•´ì•¼í•  ì„œë¹„ìŠ¤ë©´ ì„œë¹„ìŠ¤ë¥¼ ì‹œì‘ì‹œí‚¤ê³  ìƒíƒœë¥¼ START, PROCESSING, COMPLETED 3ë‹¨ê³„ë¡œ ê°„ë‹¨í•˜ê²Œ ë‚˜ëˆ„ì–´ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ í•˜ê³  ì‹œì‘í•˜ì§€ ì•Šì•„ì•¼ í•  ì„œë¹„ìŠ¤ë©´ ìœ„ì™€ ê°™ì€ í™”ë©´ì´ ë³´ì´ë„ë¡ UIë¥¼ êµ¬ì„±í–ˆë‹¤.Instance Scheduler ì´ë¼ëŠ” ì†”ë£¨ì…˜ì´ ì¡´ì¬í•˜ê¸´ í•˜ëŠ”ë° ì´ëŠ” ECS Fargate ëŒ€ìƒìœ¼ë¡œëŠ” ìë™í™” ëª»í•˜ëŠ”ê±° ê°™ì•„ EventBridge + Lambda ì¡°í•©ìœ¼ë¡œ ì§ì ‘ êµ¬í˜„í•´ ë´¤ë‹¤. ë•ë¶„ì— ë¦¬ì†ŒìŠ¤ ë¹„ìš©ì´ ì¡°ê¸ˆì´ë‚˜ë§ˆ ì ˆê°ë˜ì–´ ì¢‹ì€ë“¯ í•˜ë‹¤." }, { "title": "Arm ì•„í‚¤í…ì²˜ì—ì„œ AAPT2 ë¹Œë“œ ë„êµ¬ ì‚¬ìš©í•˜ê¸°", "url": "/posts/aapt2-arm/", "categories": "Android", "tags": "Android, Arm", "date": "2024-09-22 08:12:00 +0900", "snippet": "Arm ì•„í‚¤í…ì²˜ì—ì„œ AAPT2 ë¹Œë“œ ë„êµ¬ ì‚¬ìš©í•˜ê¸°ìµœê·¼ ê°œë°œì„œë²„ì˜ ì•„í‚¤í…ì²˜ë¥¼ x86 ì—ì„œ Arm ìœ¼ë¡œ ë³€ê²½í–ˆë‹¤. (ë” ì‹¸ì„œ)í•´ë‹¹ ì„œë²„ì—ëŠ” gitea, Jenkins, Nexus Repository ê°€ êµ´ëŸ¬ê°€ê³  ìˆì—ˆë‹¤. ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ê·¸ëŸ­ì €ëŸ­ ìˆœì¡°ë¡­ê²Œ ì§„í–‰í–ˆëŠ”ë° ë¬¸ì œëŠ” Jenkins jobì„ ë§ˆì´ê·¸ë ˆì´ì…˜ í•˜ë˜ì¤‘, íŠ¹ì • jobì—ì„œ ì•ˆë“œë¡œì´ë“œë¥¼ ë¹Œë“œí•˜ëŠ” ê³¼ì •ì—ì„œ ë‚˜íƒ€ë‚¬ë‹¤.stage('android build') { steps { script { dir('android') { sh 'chmod +x gradlew' sh './gradlew assembleRelease' } } }}ê·¸ëƒ¥ ê°„ë‹¨í•œ apk ë¹Œë“œ ëª…ë ¹ì–´ë‹¤. ê·¼ë° ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ ë©”ì‹œì§€ê°€ ë°œê²¬ëë‹¤.AAPT2 aapt2-3.6.1-6040484-linux Daemon #0: Unexpected error output: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: cannot execute binary fileAAPT2 aapt2-3.6.1-6040484-linux Daemon #26: Unexpected error output: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: cannot execute binary fileAAPT2 aapt2-3.6.1-6040484-linux Daemon #23: Unexpected error output: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: cannot execute binary fileAAPT2 aapt2-3.6.1-6040484-linux Daemon #36: Unexpected error output: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: cannot execute binary fileAAPT2 aapt2-3.6.1-6040484-linux Daemon #40: Unexpected error output: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: cannot execute binary fileAAPT2 aapt2-3.6.1-6040484-linux Daemon #38: Unexpected error output: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: cannot execute binary fileAAPT2 aapt2-3.6.1-6040484-linux Daemon #47: Unexpected error output: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: cannot execute binary fileAAPT2 aapt2-3.6.1-6040484-linux Daemon #55: Unexpected error output: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: cannot execute binary fileAAPT2 aapt2-3.6.1-6040484-linux Daemon #85: Unexpected error output: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: cannot execute binary fileAAPT2 aapt2-3.6.1-6040484-linux Daemon #84: Unexpected error output: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: /var/lib/jenkins/.gradle/caches/transforms-2/files-2.1/52f8b6df1762ac7006c8d9f8d6d1e0ad/aapt2-3.6.1-6040484-linux/aapt2: cannot execute binary fileì„œë²„ ì•„í‚¤í…ì²˜ëŠ” x86ì¸ë° ë°”ì´ë„ˆë¦¬ íŒŒì¼ì˜ ì•„í‚¤í…ì²˜ëŠ” arm ì´ë¼ì„œ ë°œìƒí•œ ë¬¸ì œì˜€ë‹¤.ê·¸ë˜ì„œ ë‹¹ì—°íˆ êµ¬ê¸€ì—ì„œ armìš© aapt2 íŒŒì¼ì„ ì œê³µí• ì¤„ ì•Œê³  ë¬¸ì„œë¥¼ ë’¤ì ¸ë³´ì•˜ëŠ”ë°â€¦ ì•„ë‹ˆ ê¸€ì„ ì•„ë¬´ë¦¬ ì°¾ì•„ë´ë„ ì—†ëŠ”ê±° ì•„ë‹Œê°€?ì‹¬ì§€ì–´ ì´ëŸ° ì´ìŠˆ íŠ¸ë˜ì»¤ë„ ì°¾ì•„ë³¼ ìˆ˜ ìˆì—ˆë‹¤.ê¶ì‹œë ëŒ€ë©´ì„œ ì°¾ì•„ë³´ë‹ˆ build-tool ì„ armìš©ìœ¼ë¡œ ì»´íŒŒì¼í•  ìˆ˜ ìˆëŠ” ì €ì¥ì†Œ ë¥¼ ì°¾ì„ ìˆ˜ ìˆì—ˆë‹¤. ë¬¸ì„œì—ëŠ” ì§ì ‘ ë¹Œë“œí•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í•˜ê³  ìˆì§€ë§Œ ë‚œ ê·¸ëƒ¥ ë¦´ë¦¬ì¦ˆ ë˜ì–´ìˆëŠ” ê²°ê³¼ë¬¼ì„ ë‹¤ìš´ë°›ì•„ ì‚¬ìš©í–ˆë‹¤.ë‹¤ìŒê³¼ ê°™ì€ ìˆœì„œë¡œ ì ìš©í–ˆë‹¤ build-tool ë‹¤ìš´ë°›ì•„ aapt2 íŒŒì¼ì„ ì›í•˜ëŠ” ê³³ì— ë³µì‚¬ Jenkins í™˜ê²½ë³€ìˆ˜ì— ANDROID_AAPT2_ROOT:/a/b/c/aapt2 ë“±ë¡ gradle.propertiesì— aapt2FromMavenOverride ì†ì„± ì ìš©íŒŒì¼ ìì²´ì— í”„ë¡œí¼í‹°ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆì§€ë§Œ ì–´ì§œí”¼ ë¹Œë“œì‹œì—ë§Œ ì‚¬ìš©ë  ê²ƒì´ë¯€ë¡œ ë‹¤ìŒê³¼ ê°™ì€ stageë¥¼ ì¶”ê°€í–ˆë‹¤.stage ('replace aapt2') { steps { script { dir('android') { def gradlePropsPath = \"${WORKSPACE}/gradle.properties\" sh \"\"\" # ê¸°ì¡´ AAPT2 ì„¤ì •ì´ ìˆìœ¼ë©´ ì œê±° sed -i '/android.aapt2FromMavenOverride/d' ${gradlePropsPath} # ìƒˆë¡œìš´ AAPT2 ì„¤ì •ì„ ê°œí–‰ê³¼ í•¨ê»˜ ì¶”ê°€ echo -e \"\\\\n# Custom AAPT2 configuration for ARM\\\\nandroid.aapt2FromMavenOverride=${env.ANDROID_AAPT2_ROOT}\" &gt;&gt; ${gradlePropsPath} \"\"\" } } }}êµ¬ê¸€ì´ ê³µì‹ì ìœ¼ë¡œ armìš© aapt2ë¥¼ ì¶œì‹œí–ˆìœ¼ë©´ ì¢‹ê² ë‹¤." }, { "title": "Terraformìœ¼ë¡œ AWS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° - 7. ë§ˆë¬´ë¦¬", "url": "/posts/terraform-aws-infra-7/", "categories": "AWS, Terraform", "tags": "AWS, ECS", "date": "2024-06-22 08:12:00 +0900", "snippet": "Terraformìœ¼ë¡œ AWS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° ê°œìš” ê¸°ì´ˆ ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸ í™˜ê²½ ìš´ì˜í™˜ê²½ (í”„ë¡ íŠ¸) ìš´ì˜í™˜ê²½ (ë°±ì—”ë“œ) ë§ˆë¬´ë¦¬Terraformìœ¼ë¡œ AWS ECS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° - 7. ë§ˆë¬´ë¦¬ì´ ì‹œë¦¬ì¦ˆë¥¼ ì‘ì„±í•˜ë©´ì„œ ì‘ì„±í•œ ìŠ¤í¬ë¦½íŠ¸ë“¤ì´ ì™„ë²½í•˜ë‹¤ê³  ìƒê°í•˜ì§„ ì•ŠëŠ”ë‹¤. ëª¨ë“ˆí™”ë¥¼ ë” í•˜ê±°ë‚˜ ì¡°ê¸ˆë” ì•„ë¦„ë‹µê²Œ ìŠ¤í¬ë¦½íŠ¸ë“¤ì„ ì‘ì„±í•  ìˆ˜ ìˆì—ˆë‹¤ê³  ìƒê°í•œë‹¤.ë˜í•œ êµ¬ì„±ì ìœ¼ë¡œë„ ë¯¸í¡í•œ ë¶€ë¶„ë“¤ì´ ì¡´ì¬í•œë‹¤. ì—„ê²©í•œ ë¦¬ì†ŒìŠ¤ ë„¤ì´ë° ê·œì¹™ Bastion Host ë¶„ë¦¬ RDS í”„ë¼ì´ë¹— ì„œë¸Œë„·ìœ¼ë¡œ ì´ì „ ECR ìˆ˜ëª… ì£¼ê¸° ì •ì±… ê·œì¹™ ì„¤ì • ìƒì„¸í•œ Autoscaling ê·œì¹™ ì •ì˜ ë°°í¬, Scaling ì´ë²¤íŠ¸ ë°œìƒì‹œ AWS SNS íŠ¸ë¦¬ê±° ì»¨í…Œì´ë„ˆ í™˜ê²½ë³€ìˆ˜ ì•ˆì „í•˜ê²Œ ê´€ë¦¬ Github Actions í™˜ê²½ë³€ìˆ˜ ì•ˆì „í•˜ê²Œ ê´€ë¦¬ ê·¸ ì™¸â€¦Terraform ì‚¬ìš© ì¸¡ë©´ì—ì„œëŠ” ì§ì ‘ ì½˜ì†”ë¡œ í•˜ë‚˜í•˜ë‚˜ ìƒì„±í–ˆì„ë•Œë‚˜ AWS CLI, SDK ë“±ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í• ë•Œë³´ë‹¤ ì˜¤ë¥˜ê°€ ëœ ë°œìƒí•˜ê³  ìƒì‚°ì„± ì¸¡ë©´ì—ì„œ ë§ì´ ë°œì „í–ˆë‹¤ê³  ìƒê°í•œë‹¤. ë˜í•œ ë¹„êµì  ì½ê¸° ì‰½ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ì‚¬ëŒê³¼ë„ ì‰½ê²Œ ê³µìœ í•  ìˆ˜ ìˆì„ê²ƒ ê°™ë‹¤.ë¬´ì—‡ë³´ë‹¤ Terraformì˜ ê°€ì´ë“œê°€ ë§¤ìš° ì˜ë˜ì–´ ìˆëŠ”ê²ƒ ê°™ë‹¤. ë¬¸ì œê°€ ë°œìƒí•´ë„ ê°€ì´ë“œ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì—¬ ë¬¸ì œë¥¼ ì‰½ê²Œ í•´ê²°í•  ìˆ˜ ìˆì—ˆë‹¤.ì‹¤ì œ ì„œë¹„ìŠ¤ì— ì‚¬ìš©í•˜ë ¤ë©´ ì„¸ì„¸í•˜ê²Œ ì˜µì…˜ì„ ì„¤ì •í•´ì•¼ í•˜ê² ì§€ë§Œ ì´ ê¸€ì„ ì½ìœ¼ì‹  ë¶„ë“¤ì€ ëª¨ë‘ ì˜ ì ìš©í•  ìˆ˜ ìˆì„ê²ƒì´ë¼ ìƒê°í•œë‹¤. ëª¨ë“  ì½”ë“œëŠ” ì´ê³³ ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤." }, { "title": "Terraformìœ¼ë¡œ AWS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° - 6. ìš´ì˜í™˜ê²½ (ë°±ì—”ë“œ)", "url": "/posts/terraform-aws-infra-6/", "categories": "AWS, Terraform", "tags": "AWS, ECS", "date": "2024-05-18 08:12:00 +0900", "snippet": "Terraformìœ¼ë¡œ AWS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° ê°œìš” ê¸°ì´ˆ ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸ í™˜ê²½ ìš´ì˜í™˜ê²½ (í”„ë¡ íŠ¸) ìš´ì˜í™˜ê²½ (ë°±ì—”ë“œ) ë§ˆë¬´ë¦¬Terraformìœ¼ë¡œ AWS ECS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° - 6. ìš´ì˜í™˜ê²½ (ë°±ì—”ë“œ)ë°±ì—”ë“œ ìš´ì˜í™˜ê²½ì„ êµ¬ì¶•í•œë‹¤.ë¦¬ì†ŒìŠ¤1. RDSRDSë¥¼ ìƒì„±í•œë‹¤.resource \"aws_security_group\" \"app-rds-sg\" { name = \"app-rds-sg\" description = \"security group for rds\" vpc_id = aws_vpc.vpc.id ingress { description = \"postgresSQL\" from_port = 5432 to_port = 5432 protocol = \"tcp\" cidr_blocks = [\"0.0.0.0/0\"] } egress { from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [\"0.0.0.0/0\"] } tags = { Name = \"app-rds-sg\" }}resource \"aws_db_subnet_group\" \"app-rds-subnet-group\" { name = \"app-rds-subnet-group\" subnet_ids = aws_subnet.public[*].id tags = { name = \"app-rds-subnet-group\" }}resource \"aws_db_instance\" \"app-rds\" { db_name = \"app\" identifier = \"app-rds\" engine = \"postgres\" engine_version = \"15.8\" storage_type = \"gp2\" allocated_storage = 20 instance_class = \"db.t3.micro\" username = var.db-username # secret password = var.db-password # secret parameter_group_name = \"default.postgres15\" skip_final_snapshot = true publicly_accessible = true vpc_security_group_ids = [aws_security_group.app-rds-sg.id] db_subnet_group_name = aws_db_subnet_group.app-rds-subnet-group.name}rdsê°€ ìƒì„±ë˜ì—ˆë‹¤ë©´ db ì ‘ì†í•˜ì—¬ ìœ ì €, database ë“± ì•±ì— í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë“¤ì„ ì„¤ì •í•œë‹¤. :warning: í¸ì˜ìƒ publicly_accessible, subnet group, security groupì„ í¼ë¸”ë¦­ìœ¼ë¡œ ì„¤ì •í–ˆë‹¤. ë‹¹ì—°íˆ íŠ¹ì • bastion ì–´í”Œë¦¬ì¼€ì´ì…˜í™˜ê²½ í˜¹ì€ bastion host ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ í•´ì•¼í•œë‹¤.2. EFSë¡œê·¸ë¥¼ ì €ì¥í•  EFS ì €ì¥ì†Œë¥¼ ìƒì„±í•œë‹¤. 2049 í¬íŠ¸ë¥¼ ì—´ì–´ì•¼ í•˜ë©° ë„¤íŠ¸ì›Œí¬ìƒ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ìœ„ì¹˜í•˜ë„ë¡ í•˜ì˜€ë‹¤.resource \"aws_security_group\" \"app-efs-sg\" { name = \"app-efs-sg\" description = \"security group for ecs service\" vpc_id = aws_vpc.vpc.id ingress { description = \"allow 2049\" from_port = 2049 to_port = 2049 protocol = \"tcp\" cidr_blocks = [\"0.0.0.0/0\"] } egress { from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [\"0.0.0.0/0\"] } tags = { Name = \"app-efs-sg\" }}resource \"aws_efs_file_system\" \"app-efs\" { encrypted = true performance_mode = \"generalPurpose\" throughput_mode = \"bursting\" lifecycle_policy { transition_to_ia = \"AFTER_90_DAYS\" }}resource \"aws_efs_mount_target\" \"app-efs-target\" { count = \"${length(aws_subnet.private.*.id)}\" file_system_id = \"${aws_efs_file_system.app-efs.id}\" subnet_id = \"${element(aws_subnet.private.*.id, count.index)}\" security_groups = [\"${aws_security_group.app-efs-sg.id}\"]}3. ECSECSì™€ ê´€ë ¨ëœ ë¦¬ì†ŒìŠ¤ë“¤ì„ ì„¤ì •í•œë‹¤.1. ECRECRì„ ìƒì„±í•œë‹¤.resource \"aws_ecr_repository\" \"app-ecr\" { name = \"app-ecr\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = false }}ì›í• í•œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì´ ë‹¨ê³„ì—ì„œ ECR ë¦¬í¬ì§€í† ë¦¬ì— ì´ë¯¸ì§€ë¥¼ í‘¸ì‰¬í•´ë‘ì. ë‚˜ì˜ ê²½ìš° nginx-latet, admin-latest, user-latest 3ê°œì˜ ì´ë¯¸ì§€ë¥¼ í‘¸ì‰¬í•´ ë‘ì—ˆë‹¤.2. Task Definitionresource \"aws_iam_role\" \"app-ecs-task-execution-role\" { name = \"ecsTaskExecutionRole\" assume_role_policy = jsonencode({ Version = \"2012-10-17\", Statement = [ { Action = \"sts:AssumeRole\", Effect = \"Allow\", Principal = { Service = \"ecs-tasks.amazonaws.com\" } } ] })}resource \"aws_iam_role_policy_attachment\" \"app-ecs-task-execution-role-policy-attachment\" { role = aws_iam_role.app-ecs-task-execution-role.name policy_arn = \"arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy\"}íƒœìŠ¤í¬ë¥¼ ì •ì˜í•˜ê¸°ì „ í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë“¤ì´ë‹¤. AmazonECSTaskExecutionRolePolicy ì •ì±…ì´ í•„ìš”í•˜ê¸° ë–„ë¬¸ì— app-ecs-task-execution-roleë¥¼ ì •ì˜í•˜ì—¬ ë¶™ì—¬ ë‘ì—ˆë‹¤.íƒœìŠ¤í¬ ì •ì˜ ì„¤ëª…ì „ ì ì‹œ ì„œë²„ êµ¬ì„±ì— ëŒ€í•´ ì´ì•¼ê¸° í•˜ìë©´, ë‚´ê°€ êµ¬ìƒí•œ êµ¬ì„±ì€ ê° SpringBoot ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë…ë¦½ì ì¸ ì»¨í…Œì´ë„ˆ í˜•íƒœë¡œ ì¡´ì¬í•˜ëŠ”ê²ƒì´ ì•„ë‹Œ í•œ íƒœìŠ¤í¬ ì•ˆì— nginx, admin, user ì»¨í…Œì´ë„ˆê°€ ì¡´ì¬í•˜ëŠ” í˜•íƒœì´ë‹¤.íŠ¸ë˜í”½ íë¦„ìœ¼ë¡œ ì„¤ëª…í•˜ìë©´ ì‚¬ìš©ì -&gt; CloudFront -&gt; ALB -&gt; (íƒœìŠ¤í¬) -&gt; Admin or User (Nê°œì˜ ì•±, Nê°œì˜ ECS ì„œë¹„ìŠ¤) ê°€ ì•„ë‹Œ ì‚¬ìš©ì -&gt; CloudFront -&gt; ALB -&gt; (íƒœìŠ¤í¬) -&gt; Nginx -&gt; Admin or User (Nê°œì˜ ì•±, 1ê°œì˜ ECS ì„œë¹„ìŠ¤) í˜•íƒœê°€ ë˜ëŠ” ê²ƒì´ë‹¤. ë‹¤ë¥¸ ì‹œìŠ¤í…œì—ëŠ” (ì˜ˆë¥¼ë“¤ì–´ íšŒì‚¬ì—ì„œ ìš´ì˜ì¤‘ì¸ ì„œë¹„ìŠ¤ ë“±.) ë…ë¦½ì ì¸ ì»¨í…Œì´ë„ˆ í˜•íƒœë¡œ ì¡´ì¬í•˜ëŠ”ê²ƒì´ ë”ìš± ì•ˆì „í•˜ë‹¤ê³  ìƒê°í•œë‹¤.ë¬¼ë¡  ê·¸ì—ë”°ë¥¸ ë¦¬ì†ŒìŠ¤ ë¹„ìš© ì¦ê°€ë‚˜ ê´€ë¦¬ì˜ ë³µì¡ì„±ì´ ë”°ë¼ì˜¬ ìˆ˜ ìˆìœ¼ë‹ˆ ê° ì„œë¹„ìŠ¤ë³„ë¡œ ì ë‹¹í•˜ê²Œ ì„œë²„ êµ¬ì„±ì„ í•˜ë©´ ë  ê²ƒ ê°™ë‹¤. ì¼ë‹¨ ì´ í¬ìŠ¤íŒ…ì—ì„  ì‚¬ìš©ì -&gt; CloudFront -&gt; ALB -&gt; (íƒœìŠ¤í¬) -&gt; Nginx -&gt; Admin or User í˜•íƒœë¡œ íƒœìŠ¤í¬ë¥¼ ì •ì˜í•œë‹¤.user nginx;worker_processes auto;events { worker_connections 1024;}http { sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 4096; include /etc/nginx/mime.types; default_type application/octet-stream; server { listen 80; server_name app-admin.keencho.com client_max_body_size 1G; access_log off; location /health-check { return 200; } location /api/ { proxy_redirect off; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header Host $http_host; proxy_connect_timeout 600; proxy_send_timeout 600; proxy_read_timeout 600; send_timeout 600; proxy_headers_hash_max_size 512; proxy_headers_hash_bucket_size 128; proxy_pass http://127.0.0.1:10000/api/; } } server { listen 80; server_name app-user.keencho.com client_max_body_size 1G; access_log off; location /api/ { proxy_redirect off; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header Host $http_host; proxy_connect_timeout 600; proxy_send_timeout 600; proxy_read_timeout 600; send_timeout 600; proxy_headers_hash_max_size 512; proxy_headers_hash_bucket_size 128; proxy_pass http://127.0.0.1:10010/api/; } }}ìœ„ì™€ê°™ì€ nginx ì„¤ì •íŒŒì¼ì„ ì‚¬ìš©í•œë‹¤.variable \"nginx-container-name\" { default = \"nginx\"}resource \"aws_ecs_task_definition\" \"app-definition\" { family = \"app-definition\" requires_compatibilities = [\"FARGATE\"] cpu = 1024 memory = \"2048\" network_mode = \"awsvpc\" task_role_arn = aws_iam_role.app-ecs-task-execution-role.arn execution_role_arn = aws_iam_role.app-ecs-task-execution-role.arn runtime_platform { operating_system_family = \"LINUX\" cpu_architecture = \"ARM64\" } container_definitions = jsonencode([ { name = var.nginx-container-name image = \"${aws_ecr_repository.app-ecr.repository_url}:nginx-latest\" essential = true portMappings = [ { containerPort = 80 hostPort = 80 } ], healthCheck = { command = [\"CMD-SHELL\", \"curl -f http://localhost:80/health-check || exit 1\"] } }, { name = \"admin\" image = \"${aws_ecr_repository.app-ecr.repository_url}:admin-latest\" essential = true portMappings = [ { containerPort = 10000 hostPort = 10000 } ], environment = [ { name = \"spring.profiles.active\", value = \"prod\" }, { \"name\": \"logging.file.name\", \"value\": \"/app-efs/logs/prod/admin/$(curl -s $ECS_CONTAINER_METADATA_URI_V4/task | jq -r .TaskARN | cut -d '/' -f 3).log\" }, { \"name\": \"server.port\", \"value\": \"10000\" }, { \"name\": \"db_url\", \"value\": \"jdbc:postgresql://${aws_db_instance.app-rds.endpoint}/${aws_db_instance.app-rds.db_name}\" }, { \"name\": \"db_username\", \"value\": var.db-username }, { \"name\": \"db_password\", \"value\": var.db-password }, ], mountPoints: [ { sourceVolume: \"app-efs\", containerPath: \"/app-efs\", readOnly: false } ], healthCheck = { command = [\"CMD-SHELL\", \"curl -f http://localhost:10000/api/health-check || exit 1\"] } }, { name = \"user\" image = \"${aws_ecr_repository.app-ecr.repository_url}:user-latest\" essential = true portMappings = [ { containerPort = 10010 hostPort = 10010 } ], environment = [ { name = \"spring.profiles.active\", value = \"prod\" }, { \"name\": \"logging.file.name\", \"value\": \"/app-efs/logs/prod/user/$(curl -s $ECS_CONTAINER_METADATA_URI_V4/task | jq -r .TaskARN | cut -d '/' -f 3).log\" }, { \"name\": \"server.port\", \"value\": \"10010\" }, { \"name\": \"db_url\", \"value\": \"jdbc:postgresql://${aws_db_instance.app-rds.endpoint}/${aws_db_instance.app-rds.db_name}\" }, { \"name\": \"db_username\", \"value\": var.db-username }, { \"name\": \"db_password\", \"value\": var.db-password }, ], mountPoints: [ { sourceVolume: \"app-efs\", containerPath: \"/app-efs\", readOnly: false } ], healthCheck = { command = [\"CMD-SHELL\", \"curl -f http://localhost:10010/api/health-check || exit 1\"] } } ]) volume { name = \"app-efs\" efs_volume_configuration { file_system_id = aws_efs_file_system.app-efs.id root_directory = \"/\" } } lifecycle { ignore_changes = [container_definitions] }} ì‹œì‘ìœ í˜•: Fargate OS, ì•„í‚¤í…ì²˜: Linux/ARM64 CPU: 2vCPU ë©”ëª¨ë¦¬: 2 GB ë³¼ë¥¨: ì•ì—ì„œ ìƒì„±í•œ EFS ìœ í˜•ì˜ ìŠ¤í† ë¦¬ì§€ë¥¼ ë§ˆìš´íŠ¸, ë£¨íŠ¸ ë””ë ‰í† ë¦¬ëŠ” / ì»¨í…Œì´ë„ˆ ì •ì˜ nginx í¬íŠ¸: 80 ìƒíƒœí™•ì¸: /health-check admin / user í¬íŠ¸: 10000 / 10010 ìƒíƒœí™•ì¸: /api/health-check EFS ë³¼ë¥¨ ë§ˆìš´íŠ¸ í™˜ê²½ë³€ìˆ˜ SpringBoot í”„ë¡œí•„ ë¡œê¹…íŒŒì¼ ê²½ë¡œ ì§€ì •: EFS ê²½ë¡œ + â€¦ + í˜„ì¬ ì»¨í…Œì´ë„ˆê°€ ì†í•œ íƒœìŠ¤í¬ì˜ ì „ì²´ Amazon ë¦¬ì†ŒìŠ¤ ì´ë¦„ (ARN) db ì„¤ì •ê°’ë“¤ (ì—¬ê¸°ì„œëŠ” ê·¸ëƒ¥ rdsì˜ endpointì™€ db_nameì„ ëŒì–´ë‹¤ ì¼ë‹¤. ì‹¤ì œ ìš´ì˜í™˜ê²½ ì´ë¼ë©´ S3ì— í™˜ê²½ íŒŒì¼ì„ ì €ì¥í•´ë‘ê³  ì‚¬ìš©í•˜ëŠ”ê²Œ ì•ˆì „í• ê²ƒ ê°™ë‹¤.) :warning: ignore_changes ì— container_definitions ë¥¼ ì¶”ê°€í•œë‹¤. ì•„ë¬´ ìˆ˜ì • ì—†ì–´ë„ í•­ìƒ terraformì´ â€˜force replacementâ€™ ë¥¼ ì‹œë„í•˜ê¸° ë•Œë¬¸ì´ë‹¤. ì•„ë§ˆ â€˜container_definitionsâ€™ê°€ JSON í˜•ì‹ìœ¼ë¡œ ì •ì˜ë˜ê¸° ë•Œë¬¸ì— í•„ë“œ ìˆœì„œë‚˜ ë¯¸ì„¸í•œ ì°¨ì´ë¡œ ì¸í•´ ë³€ê²½ì´ ê°ì§€ë  ìˆ˜ ìˆì–´ì„œ ê·¸ëŸ°ê²ƒ ê°™ë‹¤.2. Cluster &amp; Serviceí´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í•œë‹¤.resource \"aws_ecs_cluster\" \"app-cluster\" { name = \"app-cluster\"}ì„œë¹„ìŠ¤ ìƒì„±ì „ ë¡œë“œë°¸ëŸ°ì„œì™€ ì—°ê²°í•  íƒ€ê²Ÿ ê·¸ë£¹ì„ ì •ì˜í•œë‹¤. ì¶”í›„ CodeDeployë¡œ Blue / Green ë°°í¬ë¥¼ ì§„í–‰í•  ê²ƒì´ë¯€ë¡œ íƒ€ê²Ÿ ê·¸ë£¹ì„ 2ê°œ ì •ì˜í•œë‹¤. ë¡œë“œ ë°¸ëŸ°ì„œì—ëŠ” 1ë²ˆ ëŒ€ìƒê·¸ë£¹ë§Œ ì—°ê²°í•œë‹¤.resource \"aws_lb_target_group\" \"app-ecs-service-tg1\" { name = \"app-ecs-service-tg1\" port = 80 protocol = \"HTTP\" target_type = \"ip\" vpc_id = aws_vpc.vpc.id health_check { path = var.alb-health-check-path port = \"traffic-port\" }}resource \"aws_lb_target_group\" \"app-ecs-service-tg2\" { name = \"app-ecs-service-tg2\" port = 80 protocol = \"HTTP\" target_type = \"ip\" vpc_id = aws_vpc.vpc.id health_check { path = var.alb-health-check-path port = \"traffic-port\" }}resource \"aws_lb_listener_rule\" \"app-alb-ecs-service-rule\" { listener_arn = aws_lb_listener.app-alb-listener-https.arn priority = 2 action { type = \"forward\" target_group_arn = aws_lb_target_group.app-ecs-service-tg1.arn } condition { host_header { values = [\"app-admin.keencho.com\", \"app-user.keencho.com\"] } }}ë‹¤ìŒìœ¼ë¡œëŠ” ì„œë¹„ìŠ¤ë¥¼ ì •ì˜í•œë‹¤.resource \"aws_security_group\" \"app-ecs-service-sg\" { name = \"app-ecs-service-sg\" description = \"security group for ecs service\" vpc_id = aws_vpc.vpc.id ingress { description = \"alb traffic\" from_port = 0 to_port = 65535 protocol = \"tcp\" security_groups = [aws_security_group.app-alb-sg.id] } egress { from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [\"0.0.0.0/0\"] } tags = { Name = \"app-ecs-service-sg\" }}resource \"aws_ecs_service\" \"app-ecs-service\" { name = \"app-ecs-service\" cluster = aws_ecs_cluster.app-cluster.id task_definition = aws_ecs_task_definition.app-definition.arn desired_count = 1 launch_type = \"FARGATE\" propagate_tags = \"SERVICE\" health_check_grace_period_seconds = 60 network_configuration { subnets = aws_subnet.private[*].id security_groups = [aws_security_group.app-ecs-service-sg.id] assign_public_ip = false } deployment_controller { type = \"CODE_DEPLOY\" } load_balancer { target_group_arn = aws_lb_target_group.app-ecs-service-tg1.arn container_name = var.nginx-container-name container_port = 80 } lifecycle { ignore_changes = [desired_count] }} ì‹œì‘ìœ í˜•: Fargate íƒœê·¸ì „íŒŒ: ì„œë¹„ìŠ¤ ê¸°ì¤€ ìƒíƒœí™•ì¸ ìœ íœ´ê¸°ê°„: 60ì´ˆ ë°°í¬ ì˜µì…˜: CodeDeploy ë¡œë“œë°¸ëŸ°ì„œ: íƒ€ê²Ÿê·¸ë£¹1ì— ë“±ë¡, 80í¬íŠ¸ë¡œ íŠ¸ë˜í”½ ë¼ìš°íŒ… ë„¤íŠ¸ì›Œí¬ êµ¬ì„±: í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ì¡´ì¬, ë¡œë“œë°¸ëŸ°ì„œ ë¡œë¶€í„° ì˜¤ëŠ” íŠ¸ë˜í”½ë§Œ í—ˆìš©, ë‚˜ë¨¸ì§€ ê¸ˆì§€ì—¬ê¸°ê¹Œì§€ ì˜¤ë©´ ì„œë¹„ìŠ¤ì™€ íƒœìŠ¤í¬ê°€ ìƒì„±ëœë‹¤. ì½˜ì†”ì—ì„œ ìƒíƒœë¥¼ í™•ì¸í•´ë³´ì. :warning: ë°°í¬ ì˜µì…˜ì„ CodeDeployë¡œ ì§€ì •í–ˆê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ë°œìƒí•´ë„ ì„œë¹„ìŠ¤ ì—…ë°ì´íŠ¸ë¥¼ í•  ìˆ˜ ì—†ë‹¤. (í˜„ ì‹œì ì—ëŠ” CodeDeployì™€ ì—°ê²°ë˜ì–´ ìˆì§€ ì•Šê¸° ë•Œë¬¸) ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´ ì„œë¹„ìŠ¤ë¥¼ ì§€ìš°ê³  ë‹¤ì‹œ ìƒì„±í•˜ëŠ” ìˆ˜ ë°–ì— ì—†ë‹¤.3. AutoScalingresource \"aws_iam_role\" \"app-ecs-autoscale\" { name = \"app-ecs-autoscale-iam-role\" assume_role_policy = jsonencode({ Version = \"2012-10-17\", Statement = [ { Sid = \"Autoscaling\" Action = \"sts:AssumeRole\", Effect = \"Allow\", Principal = { Service = \"application-autoscaling.amazonaws.com\" } } ] })}resource \"aws_iam_role_policy_attachment\" \"app-ecs-autoscale\" { role = aws_iam_role.app-ecs-autoscale.name policy_arn = \"arn:aws:iam::aws:policy/service-role/AmazonEC2ContainerServiceAutoscaleRole\"}resource \"aws_appautoscaling_target\" \"app-ecs-target\" { min_capacity = 1 max_capacity = 4 resource_id = \"service/${aws_ecs_cluster.app-cluster.name}/${aws_ecs_service.app-ecs-service.name}\" role_arn = aws_iam_role.app-ecs-task-execution-role.arn scalable_dimension = \"ecs:service:DesiredCount\" service_namespace = \"ecs\" depends_on = [ aws_ecs_service.app-ecs-service ]}resource \"aws_appautoscaling_policy\" \"app-ecs-policy-scale-out\" { name = \"scale-out\" policy_type = \"StepScaling\" resource_id = aws_appautoscaling_target.app-ecs-target.resource_id scalable_dimension = aws_appautoscaling_target.app-ecs-target.scalable_dimension service_namespace = aws_appautoscaling_target.app-ecs-target.service_namespace step_scaling_policy_configuration { adjustment_type = \"PercentChangeInCapacity\" cooldown = 1 metric_aggregation_type = \"Average\" step_adjustment { metric_interval_lower_bound = 0 scaling_adjustment = 100 } }}resource \"aws_cloudwatch_metric_alarm\" \"app-ecs-cpu-high\" { alarm_name = \"app-ecs-cpu-high\" comparison_operator = \"GreaterThanOrEqualToThreshold\" evaluation_periods = \"3\" metric_name = \"CPUUtilization\" namespace = \"AWS/ECS\" period = \"60\" statistic = \"Average\" threshold = \"70\" dimensions = { ClusterName = aws_ecs_cluster.app-cluster.name ServiceName = aws_ecs_service.app-ecs-service.name } alarm_actions = [aws_appautoscaling_policy.app-ecs-policy-scale-out.arn]}ìµœì†Œìš©ëŸ‰ì„ 1, ìµœëŒ€ìš©ëŸ‰ì„ 4 ë¡œ ì§€ì •í•˜ê³  CPUì— ë”°ë¼ íƒœìŠ¤í¬ë¥¼ scale out í•˜ë„ë¡ êµ¬ì„±í•˜ì˜€ë‹¤. ì½˜ì†”ì—ì„œ í™•ì¸í•´ë³´ì.4. CloudFront ìˆ˜ì •ì•ì„œ ìš´ì˜í™˜ê²½ - í”„ë¡ íŠ¸ë¥¼ êµ¬ì„±í• ë•Œ CloudFrontë¡œ ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  íŠ¸ë˜í”½ì€ S3ë¡œ ì „ë‹¬ë˜ê²Œ êµ¬ì„±í•˜ì˜€ë‹¤. ë§¨ ì²˜ìŒ ê°œìš”ì—ì„œ ì„¤ëª…í–ˆë“¯ /api/** ê²½ë¡œë¡œ ì‹œì‘í•˜ëŠ” ìš”ì²­ì€ Application Load Balancerë¡œ ì „ë‹¬ë˜ë„ë¡ ìˆ˜ì •í•´ì•¼ í•œë‹¤.resource \"aws_cloudfront_distribution\" \"admin-distribution\" { origin { domain_name = aws_s3_bucket.app-prod-react.bucket_regional_domain_name origin_id = aws_s3_bucket.app-prod-react.id origin_access_control_id = aws_cloudfront_origin_access_control.admin-front.id origin_path = \"/admin\" } # ì¶”ê°€ origin { domain_name = aws_lb.app-alb.dns_name origin_id = aws_lb.app-alb.id custom_origin_config { http_port = 80 https_port = 443 origin_protocol_policy = \"https-only\" origin_ssl_protocols = [\"TLSv1.2\"] origin_keepalive_timeout = 5 origin_read_timeout = 30 } } enabled = true default_root_object = \"index.html\" comment = \"admin distribution\" aliases = [\"app-admin.keencho.com\"] default_cache_behavior { allowed_methods = [\"GET\", \"HEAD\"] cached_methods = [\"GET\", \"HEAD\"] target_origin_id = aws_s3_bucket.app-prod-react.id viewer_protocol_policy = \"redirect-to-https\" min_ttl = 0 default_ttl = 3600 max_ttl = 86400 forwarded_values { query_string = false cookies { forward = \"none\" } } } # ì¶”ê°€ ordered_cache_behavior { path_pattern = \"/api/*\" allowed_methods = [\"GET\", \"HEAD\", \"OPTIONS\", \"PUT\", \"POST\", \"PATCH\", \"DELETE\"] cached_methods = [\"GET\", \"HEAD\"] target_origin_id = aws_lb.app-alb.id viewer_protocol_policy = \"redirect-to-https\" default_ttl = 0 max_ttl = 0 min_ttl = 0 forwarded_values { query_string = true headers = [\"*\"] cookies { forward = \"all\" } } } price_class = \"PriceClass_100\" restrictions { geo_restriction { restriction_type = \"whitelist\" locations = [\"KR\"] } } viewer_certificate { acm_certificate_arn = aws_acm_certificate.ssl-certificate-virginia.arn ssl_support_method = \"sni-only\" minimum_protocol_version = \"TLSv1.2_2021\" } custom_error_response { error_code = 403 error_caching_min_ttl = 10 response_page_path = \"/index.html\" response_code = 200 }}ê¸€ì—ëŠ” ê´€ë¦¬ì ìˆ˜ì •ë³¸ë§Œ ì‘ì„±í•œë‹¤. Application Load Balancer ì›ë³¸ì„ ì¶”ê°€í•˜ì˜€ê³  /api/* ê²½ë¡œ íŒ¨í„´ì€ ë¡œë“œë°¸ëŸ°ì„œë¡œ ë¼ìš°íŒ… ë  ìˆ˜ ìˆë„ë¡ ë™ì‘ì„ ìˆ˜ì •í•˜ì˜€ë‹¤.5. CodeDeployBlue / Green ë°°í¬ë¥¼ ìœ„í•œ CodeDeploy ê´€ë ¨ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•œë‹¤.resource \"aws_codedeploy_app\" \"app-deploy-app\" { compute_platform = \"ECS\" name = \"app-deploy\"}data \"aws_iam_policy_document\" \"app-deploy-assume-role\" { statement { effect = \"Allow\" principals { type = \"Service\" identifiers = [\"codedeploy.amazonaws.com\"] } actions = [\"sts:AssumeRole\"] }}resource \"aws_iam_role\" \"app-deploy-role\" { name = \"app-deploy-role\" assume_role_policy = data.aws_iam_policy_document.app-deploy-assume-role.json}resource \"aws_iam_role_policy_attachment\" \"app-AWSCodeDeployRole\" { policy_arn = \"arn:aws:iam::aws:policy/service-role/AWSCodeDeployRole\" role = aws_iam_role.app-deploy-role.name}resource \"aws_iam_role_policy_attachment\" \"app-AWSCodeDeployRoleForECS\" { policy_arn = \"arn:aws:iam::aws:policy/AWSCodeDeployRoleForECS\" role = aws_iam_role.app-deploy-role.name}resource \"aws_codedeploy_deployment_group\" \"app-deploy-group\" { app_name = aws_codedeploy_app.app-deploy-app.name deployment_config_name = \"CodeDeployDefault.ECSAllAtOnce\" deployment_group_name = \"app-deploy-group\" service_role_arn = aws_iam_role.app-deploy-role.arn auto_rollback_configuration { enabled = false } blue_green_deployment_config { deployment_ready_option { action_on_timeout = \"CONTINUE_DEPLOYMENT\" } terminate_blue_instances_on_deployment_success { action = \"TERMINATE\" termination_wait_time_in_minutes = 1 } } deployment_style { deployment_option = \"WITH_TRAFFIC_CONTROL\" deployment_type = \"BLUE_GREEN\" } ecs_service { cluster_name = aws_ecs_cluster.app-cluster.name service_name = aws_ecs_service.app-ecs-service.name } load_balancer_info { target_group_pair_info { prod_traffic_route { listener_arns = [aws_lb_listener.app-alb-listener-https.arn] } target_group { name = aws_lb_target_group.app-ecs-service-tg1.name } target_group { name = aws_lb_target_group.app-ecs-service-tg2.name } } }} ì–´í”Œë¦¬ì¼€ì´ì…˜ ìƒì„± CodeDeploy ê´€ë ¨ IAM Role ìƒì„± ë°°í¬ê·¸ë£¹ ìƒì„± ë¡œë“œë°¸ëŸ°ì„œ ì§€ì • (Blue / Green ë°°í¬ë¥¼ ìœ„í•´ ì•ì—ì„œ ìƒì„±í•œ íƒ€ê²Ÿê·¸ë£¹ 1, 2 ì§€ì •)6. Github Actions ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±ë‚´ê°€ ì‚¬ìš©í•œ Dockerfileì´ë‹¤.FROM amazoncorretto:21# íƒ€ì„ì¡´ ì„¸íŒ…ENV TZ=\"Asia/Seoul\"ARG JAR_PATH# ì›Œí¬ ë””ë ‰í† ë¦¬ ì„¸íŒ…WORKDIR /app-admin/# ë¹Œë“œëœ jar íŒŒì¼ ë³µì‚¬COPY $JAR_PATH /app-admin/app.jarENTRYPOINT [\"java\",\"-jar\",\"app.jar\"]FROM nginx:latestCOPY nginx.conf /etc/nginx/nginx.confEXPOSE 80ë‹¤ìŒì€ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ë‹¤.name: Deploy Spring Boot Application to ECS using CodeDeploy Blue / Green Deploymenton: workflow_dispatch:jobs: deploy: name: Deploy runs-on: ubuntu-latest steps: - name: Check out the repository uses: actions/checkout@v4 - name: Setup JDK 21 uses: actions/setup-java@v4 with: java-version: '21' distribution: 'corretto' - name: Setup Gradle uses: gradle/actions/setup-gradle@v3 - name: Build Gradle working-directory: spring-boot run: | chmod +x ./gradlew ./gradlew bootjar --project-dir ./app-admin ./gradlew bootjar --project-dir ./app-user - name: Configure AWS credentials uses: aws-actions/configure-aws-credentials@v2 with: aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }} aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }} aws-region: ${{ secrets.AWS_REGION }} - name: Login to Amazon ECR id: login-ecr uses: aws-actions/amazon-ecr-login@v2 - name: Build, tag and push image to Amazon ECR working-directory: spring-boot env: ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }} run: | docker build --build-arg JAR_PATH=app-admin/build/libs/*.jar --platform=linux/arm64 -t $ECR_REGISTRY/app-ecr:admin-latest -f app-admin/Dockerfile . docker build --build-arg JAR_PATH=app-user/build/libs/*.jar --platform=linux/arm64 -t $ECR_REGISTRY/app-ecr:user-latest -f app-user/Dockerfile . docker build --platform=linux/arm64 -t $ECR_REGISTRY/app-ecr:nginx-latest -f nginx.Dockerfile . docker push $ECR_REGISTRY/app-ecr:admin-latest docker push $ECR_REGISTRY/app-ecr:user-latest docker push $ECR_REGISTRY/app-ecr:nginx-latest - name: CodeDeploy Blue / Green Deployment working-directory: spring-boot run: | APPLICATION_NAME=\"${{ secrets.AWS_CODEDEPLOY_APPLICATION_NAME }}\" DEPLOYMENT_GROUP=\"${{ secrets.AWS_CODEDEPLOY_DEPLOYMENT_GROUP_NAME }}\" REGION=\"${{ secrets.AWS_REGION }}\" REVISION_JSON='{ \"version\": 1, \"Resources\": [ { \"TargetService\": { \"Type\": \"AWS::ECS::Service\", \"Properties\": { \"TaskDefinition\": \"${{ secrets.AWS_CODEDEPLOY_TASK_DEFINITION }}\", \"LoadBalancerInfo\": { \"ContainerName\": \"nginx\", \"ContainerPort\": 80 }, \"PlatformVersion\": \"LATEST\" } } } ] }' # Create a new deployment aws deploy create-deployment \\ --cli-input-json \"{\\\"applicationName\\\":\\\"$APPLICATION_NAME\\\",\\\"deploymentGroupName\\\":\\\"$DEPLOYMENT_GROUP\\\",\\\"revision\\\":{\\\"revisionType\\\":\\\"AppSpecContent\\\",\\\"appSpecContent\\\":{\\\"content\\\":\\\"$(echo $REVISION_JSON | sed 's/\"/\\\\\"/g')\\\"}}}\" \\ --region $REGION repository checkout setup jdk21 setup gradle build gradle (bootjar) configure aws credentials login ecr build, tag and push image to ecr OS, ì•„í‚¤í…ì²˜ë¥¼ linux/arm64ë¡œ ì§€ì • CodeDeploy ë°°í¬ ìƒì„± ì–´í”Œë¦¬ì¼€ì´ì…˜ ì§€ì • ë°°í¬ ê·¸ë£¹ ì§€ì • ë¦¬ì „ ì§€ì • íƒœìŠ¤í¬ ì •ì˜ ì§€ì • ë¡œë“œë°¸ëŸ°ì„œê°€ íŠ¸ë˜í”½ì„ nginx(80 í¬íŠ¸) ë¡œ ë¼ìš°íŒ…í•˜ë„ë¡ ì§€ì • ìœ„ì™€ê°™ì€ ìˆœì„œë¡œ ì§„í–‰ëœë‹¤. ë‘ê·¼ê±°ë¦¬ëŠ” ë§ˆìŒìœ¼ë¡œ Run workflow ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì." }, { "title": "Terraformìœ¼ë¡œ AWS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° - 5. ìš´ì˜í™˜ê²½ (í”„ë¡ íŠ¸)", "url": "/posts/terraform-aws-infra-5/", "categories": "AWS, Terraform", "tags": "AWS, ECS", "date": "2024-04-13 08:12:00 +0900", "snippet": "Terraformìœ¼ë¡œ AWS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° ê°œìš” ê¸°ì´ˆ ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸ í™˜ê²½ ìš´ì˜í™˜ê²½ (í”„ë¡ íŠ¸) ìš´ì˜í™˜ê²½ (ë°±ì—”ë“œ) ë§ˆë¬´ë¦¬Terraformìœ¼ë¡œ AWS ECS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° - 5. ìš´ì˜í™˜ê²½ (í”„ë¡ íŠ¸)í”„ë¡ íŠ¸ ìš´ì˜í™˜ê²½ì„ êµ¬ì¶•í•œë‹¤.ë¦¬ì†ŒìŠ¤1. S3 ë²„í‚·ë¨¼ì € S3 ë²„í‚·ì„ ìƒì„±í•œë‹¤.resource \"aws_s3_bucket\" \"app-prod-react\" { bucket = \"app-prod-react\" tags = { Name = \"app-prod-react\" }}resource \"aws_s3_bucket_ownership_controls\" \"app-prod-react-ownership\" { bucket = aws_s3_bucket.app-prod-react.id rule { object_ownership = \"BucketOwnerPreferred\" }}resource \"aws_s3_bucket_acl\" \"app-prod-react-acl\" { depends_on = [aws_s3_bucket_ownership_controls.app-prod-react-ownership] bucket = aws_s3_bucket.app-prod-react.id acl = \"private\"}resource \"aws_s3_object\" \"app-prod-react-admin\" { bucket = aws_s3_bucket.app-prod-react.id content_type = \"application/x-directory\" key = \"admin/\"}resource \"aws_s3_object\" \"app-prod-react-user\" { bucket = aws_s3_bucket.app-prod-react.id content_type = \"application/x-directory\" key = \"user/\"}ë²„í‚·ê³¼ ì—‘ì„¸ìŠ¤ ì œì–´ ëª©ë¡, ê´€ë¦¬ìì™€ ìœ ì € ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë  í´ë”ë¥¼ ì •ì˜í–ˆë‹¤.ê´€ë¦¬ìì™€ ìœ ì € ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì—…ë¡œë“œí•´ ë‘˜ ê²ƒì´ë‹¤. ì´ ë˜í•œ terraformìœ¼ë¡œ ì§„í–‰ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, ì–´ì§œí”¼ ì•± ë°°í¬ëŠ” ì¶”í›„ github actionì„ í†µí•´ ë¹Œë“œí•˜ê³  s3ì— ì—…ë¡œë“œí•  ê²ƒì´ë¯€ë¡œ ì§€ê¸ˆì€ ì½˜ì†” í™˜ê²½ì—ì„œ ì§ì ‘ ì—…ë¡œë“œ í•œë‹¤.ì´ ìƒíƒœì—ì„œ ë²„í‚·ì„ í¼ë¸”ë¦­ ì•¡ì„¸ìŠ¤ë¡œ ì—´ì–´ë²„ë¦¬ê³  ì£¼ì†Œë¡œ ì ‘ê·¼í•˜ë©´ ì›¹ í˜ì´ì§€ê°€ ëœ¬ë‹¤. ê·¸ëŸ¬ë‚˜ ì•ë‹¨ì— CloudFrontë¥¼ ë‘ì–´ ê·¸ê³³ì—ì„œ s3ë¡œ ë¼ìš°íŒ…í•  ê²ƒì´ê¸° ë•Œë¬¸ì— ë„˜ì–´ê°„ë‹¤.2. CloudFrontresource \"aws_cloudfront_origin_access_control\" \"admin-front\" { name = \"admin-front\" description = \"admin front\" origin_access_control_origin_type = \"s3\" signing_behavior = \"always\" signing_protocol = \"sigv4\"}resource \"aws_cloudfront_distribution\" \"admin-distribution\" { origin { domain_name = aws_s3_bucket.app-prod-react.bucket_regional_domain_name origin_id = aws_s3_bucket.app-prod-react.id origin_access_control_id = aws_cloudfront_origin_access_control.admin-front.id origin_path = \"/admin\" } enabled = true default_root_object = \"index.html\" comment = \"admin distribution\" aliases = [\"app-admin.keencho.com\"] default_cache_behavior { allowed_methods = [\"GET\", \"POST\", \"PUT\", \"OPTIONS\", \"DELETE\", \"PATCH\", \"HEAD\"] cached_methods = [\"GET\", \"HEAD\"] target_origin_id = aws_s3_bucket.app-prod-react.id forwarded_values { query_string = false cookies { forward = \"none\" } } viewer_protocol_policy = \"redirect-to-https\" min_ttl = 0 default_ttl = 3600 max_ttl = 86400 } price_class = \"PriceClass_100\" restrictions { geo_restriction { restriction_type = \"whitelist\" locations = [\"KR\"] } } viewer_certificate { acm_certificate_arn = aws_acm_certificate.ssl-certificate-virginia.arn ssl_support_method = \"sni-only\" minimum_protocol_version = \"TLSv1.2_2021\" } custom_error_response { error_code = 403 error_caching_min_ttl = 10 response_page_path = \"/index.html\" response_code = 200 }}ê´€ë¦¬ì ë°°í¬ë¥¼ ìƒì„±í–ˆë‹¤. ëŒ€ì²´ ë„ë©”ì¸ì„ ì§€ì •í•  ê²½ìš° SSL ì¸ì¦ì„œëŠ” í•„ìˆ˜ì¸ë°, ì•ì„œ ë§í–ˆë˜ ê²ƒì²˜ëŸ¼ ì—¬ê¸°ì—” us-east-1 ë¦¬ì „ì— ì¡´ì¬í•˜ëŠ” ì¸ì¦ì„œë§Œ ì§€ì •í•  ìˆ˜ ìˆë‹¤.í˜„ ì‹œì ì—” ë¼ìš°íŒ…ë˜ëŠ” ëª¨ë“  íŠ¸ë˜í”½ì´ s3 ë²„í‚·ì˜ /admin í´ë”ë¡œ ì „ì†¡ëœë‹¤.resource \"aws_route53_record\" \"app-admin\" { zone_id = aws_route53_zone.keencho.id name = \"app-admin.keencho.com\" type = \"A\" alias { name = aws_cloudfront_distribution.admin-distribution.domain_name zone_id = aws_cloudfront_distribution.admin-distribution.hosted_zone_id evaluate_target_health = true }}Route 53 ë ˆì½”ë“œë¥¼ ìƒì„±í•˜ì—¬ app-admin.keencho.com ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì´ CloudFrontë¡œ ë¼ìš°íŒ… ë˜ë„ë¡ í•˜ì˜€ë‹¤. ì‚¬ìš©ì(user) ë°°í¬ë„ ì´ë¦„ë§Œ ë°”ê¾¸ì–´ ìƒì„±í•œë‹¤.S3 ë²„í‚· ì •ì±… ë³€ê²½í˜„ì¬ S3 ë²„í‚· ì •ì±…ì€ ì•„ë˜ ì´ë¯¸ì§€ì™€ ê°™ì´ ëª¨ë“  í¼ë¸”ë¦­ ì—‘ì„¸ìŠ¤ê°€ ì°¨ë‹¨ë˜ì–´ ìˆì„ ê²ƒì´ë‹¤.CloudFront ì—ì„œ ì˜¨ ìš”ì²­ì€ í—ˆìš©í•˜ëŠ” ì •ì±…ì„ ì ìš©í•œë‹¤.resource \"aws_s3_bucket_policy\" \"allow-from-cloudfront-policy\" { bucket = aws_s3_bucket.app-prod-react.id policy = jsonencode({ Version = \"2012-10-17\", Statement = [ { Sid = \"AllowCloudFrontServicePrincipal\", Action = \"s3:GetObject\", Effect = \"Allow\", Resource = \"${aws_s3_bucket.app-prod-react.arn}/*\", Principal = { \"Service\": \"cloudfront.amazonaws.com\" }, Condition = { StringEquals = { \"AWS:SourceArn\": [ aws_cloudfront_distribution.admin-distribution.arn, aws_cloudfront_distribution.user-distribution.arn, ] } } } ] })}ë„ë©”ì¸ìœ¼ë¡œ ì ‘ì†í–ˆì„ ë•Œ ì˜ë„í•œëŒ€ë¡œ í˜ì´ì§€ê°€ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ì.3. Github Actions ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±react í”„ë¡œì íŠ¸ êµ¬ì¡°ì´ë‹¤. root í´ë”ì—ì„œ npm install ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•œ í›„ ê° admin, user í´ë”ì—ì„œ ë¹Œë“œë¥¼ ìˆ˜í–‰í•´ì•¼ í•œë‹¤.ë‹¤ìŒì€ Github Actions ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ì´ë‹¤. ì•ì„œ ì„¤ëª…í•œëŒ€ë¡œ install ê³¼ buildë¥¼ ìˆ˜í–‰í•œ í›„ S3ì— ì—…ë¡œë“œí•œë‹¤. ì´ë•Œ ê¸°ì¡´ íŒŒì¼ì€ ëª¨ë‘ ì‚­ì œí•œë‹¤. ë¬¼ë¡  ì‹¤ì œ ìš´ì˜í™˜ê²½ì—ì„  ë”°ë¡œ ë°±ì—…í•´ë‘ëŠ”ê²Œ ì•ˆì „í•˜ë‹¤.ê·¸ í›„ CloudFront Invalidate ë¥¼ í†µí•´ ìºì‹±ëœ íŒŒì¼ì„ ë¬´íš¨í™” í•˜ì—¬ ì‚¬ìš©ìê°€ ë°°í¬ëœ íŒŒì¼ì„ í™•ì¸í•  ìˆ˜ ìˆê²Œ í•œë‹¤.name: Deploy Admin and User to S3on: workflow_dispatch:jobs: deploy: name: Deploy runs-on: ubuntu-latest steps: - name: Check out the repository uses: actions/checkout@v4 - name: Set up Node.js uses: actions/setup-node@v3 with: node-version: '20' - name: Install dependencies for Root Project working-directory: react run: npm install - name: Build Admin working-directory: react/app/admin run: npm run build:production - name: Build User working-directory: react/app/user run: npm run build:production - name: Configure AWS credentials uses: aws-actions/configure-aws-credentials@v2 with: aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }} aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }} aws-region: ${{ secrets.AWS_REGION }} - name: Remove Exist &amp; Upload New to S3 working-directory: react run: | aws s3 rm s3://${{ secrets.S3_BUCKET_NAME }}/admin --recursive aws s3 rm s3://${{ secrets.S3_BUCKET_NAME }}/user --recursive aws s3 cp app/admin/dist s3://${{ secrets.S3_BUCKET_NAME }}/admin --recursive aws s3 cp app/user/dist s3://${{ secrets.S3_BUCKET_NAME }}/user --recursive - name: Invalidate CloudFront run: | aws cloudfront create-invalidation --distribution-id ${{ secrets.AWS_CLOUDFRONT_DISTRIBUTION_ID_ADMIN }} --paths \"/*\" aws cloudfront create-invalidation --distribution-id ${{ secrets.AWS_CLOUDFRONT_DISTRIBUTION_ID_USER }} --paths \"/*\"" }, { "title": "Athenaë¡œ ALB Access Log ë¶„ì„í•˜ê¸°", "url": "/posts/aws-alb-log-athena/", "categories": "AWS", "tags": "AWS", "date": "2024-03-23 08:12:00 +0900", "snippet": "Athenaë¡œ ALB Access Log ë¶„ì„í•˜ê¸°Appliation Load Balancerì—ëŠ” ì•¡ì„¸ìŠ¤ ë¡œê·¸ë¥¼ ì €ì¥í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ ìˆë‹¤. ì´ë¥¼ í™œì„±í™” í•˜ë©´ S3ì— ëª¨ë“  ìš”ì²­ ë¡œê·¸ë¥¼ ì €ì¥í•˜ê²Œ ë˜ëŠ”ë°, ë™ì¼í•œ ë‚ ì§œì˜ ìš”ì²­ì´ë¼ë„ í•œ íŒŒì¼ì— ì €ì¥ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ êµ‰ì¥íˆ ë§ì€ .gz í˜•ì‹ì˜ ì••ì¶•íŒŒì¼ë¡œ ìª¼ê°œì ¸ ì €ì¥ëœë‹¤.ì•„ë¦„ë‹µë‹¤/order ë¼ëŠ” ê²½ë¡œë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ê²€ìƒ‰í•´ ë³¸ë‹¤ê³  ê°€ì •í•´ë³´ì. ì¼ë‹¨ íŒŒì¼ì„ ì°¾ê¸° ìœ„í•´ ë§ˆì§€ë§‰ ìˆ˜ì • í•„ë“œë¥¼ í™•ì¸í•´ì•¼ í•œë‹¤. ì–´ì°Œì €ì°Œ íŒŒì¼ì„ ì°¾ì•˜ë‹¤ë©´ íŒŒì¼ì„ ë‹¤ìš´ë°›ê³  ì••ì¶•í’€ê³  ì˜ ì½ì–´ì§€ì§€ë„ ì•ŠëŠ” íŒŒì¼ì„ ì°¾ì•„ì•¼ í•œë‹¤. ì‹œê°„ëŒ€ê°€ ì¢€ ì°¨ì´ë‚˜ëŠ” ìš”ì²­ì„ ë¹„êµí•´ì•¼ í•œë‹¤ë©´ ìˆ˜ë§ì€ íŒŒì¼ì„ ë„ì›Œë†“ê³  í•˜ë‚˜í•˜ë‚˜ ë¹„êµí•´ì•¼ í•œë‹¤.AWS ì—ì„œ ì œê³µí•˜ëŠ” Amazone Athena ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ SQLë¬¸ìœ¼ë¡œ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ì‰½ê²Œ ì¶”ì¶œí•  ìˆ˜ ìˆë‹¤.AthenaëŠ” í‘œì¤€ SQLì„ ì‚¬ìš©í•´ S3ì— ìˆëŠ” ë°ì´í„°ë¥¼ ì§ì ‘ ê°„í¸í•˜ê²Œ ë¶„ì„í•  ìˆ˜ ìˆëŠ” ëŒ€í™”í˜• ì¿¼ë¦¬ ì„œë¹„ìŠ¤ì´ë‹¤. AthenaëŠ” ì„œë²„ë¦¬ìŠ¤ì´ë¯€ë¡œ ì¸í”„ë¼ ì„¤ì •ì´ë‚˜ ê´€ë¦¬ê°€ ë¶ˆí•„ìš”í•˜ë©°, ì‹¤í–‰í•˜ëŠ” ì¿¼ë¦¬ ë˜ëŠ” ì¿¼ë¦¬ì— í•„ìš”í•œ ì»´í“¨íŒ…ì„ ê¸°ì¤€ìœ¼ë¡œ ìš”ê¸ˆì„ ì§€ë¶ˆí•  ìˆ˜ ìˆë‹¤. ìŠ¤ìº”í•œ ë°ì´í„° 1TB ë‹¹ $5ì˜ ìš”ê¸ˆì´ ë¶€ê³¼ëœë‹¤. ì˜ˆë¥¼ë“¤ì–´ Athenaë¥¼ ì‚¬ìš©í•´ 100MB ì˜ ë°ì´í„°ë¥¼ ìŠ¤ìº”í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ë§¤ì¼ 100ê°œì”© ì‹¤í–‰í•œë‹¤ë©´ ì›”ë³„ $1.45ì˜ ìš”ê¸ˆì´ ë¶€ê³¼ëœë‹¤.ì—„ì²­ë‚œ í¬ê¸°ì˜ ë°ì´í„°ë¥¼ ë‹¤ë£¬ë‹¤ë©´ ë¹„ìš©ì´ ë¶€ë‹´ë˜ê² ì§€ë§Œ, ì ë‹¹í•œ íŠ¸ë˜í”½ì´ ë°œìƒí•˜ëŠ” ì„œë¹„ìŠ¤ì˜ ALB ë¡œê·¸ ë¶„ì„ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©í•œë‹¤ë©´ ë¹„ìš© ì••ë°•ì€ ê±°ì˜ ì—†ë‹¤ê³  ìƒê°ëœë‹¤. (ì´ëŸ°ê±° ì•„ë¼ëŠ” íšŒì‚¬ëŠ”â€¦ã…) íŒŒí‹°ì…”ë‹ ê´€ë¦¬ë¥¼ ìœ„í•œ CREATE, ALTER í˜¹ì€ DROP TABLE ë¬¸ê³¼ ê°™ì€ DDLë¬¸ ë˜ëŠ” ì‹¤íŒ¨í•œ ì¿¼ë¦¬ì—ëŠ” ìš”ê¸ˆì´ ë¶€ê³¼ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì·¨ì†Œí•œ ì¿¼ë¦¬ëŠ” ì¿¼ë¦¬ë¥¼ ì·¨ì†Œí•  ì‹œì ì— ìŠ¤ìº”ëœ ì´ ë°ì´í„° ì–‘ì— ë”°ë¼ ìš”ê¸ˆì´ ì²­êµ¬ë©ë‹ˆë‹¤.Athena ì„¤ì •ì¿¼ë¦¬ë¥¼ ë‚ ë¦¬ê¸° ì•ì„œ í•„ìš”í•œ ì„¤ì •ë“¤ì„ ì§„í–‰í•´ ë³´ì.ì¼ë‹¨ ì¿¼ë¦¬ ê²°ê³¼ê°€ ì €ì¥ë  ë³„ë„ì˜ S3 ë²„í‚·ì´ í•„ìš”í•˜ë‹¤. ë²„í‚·ì„ ìƒì„±í•˜ê³  Amazon Athena &gt; ì¿¼ë¦¬ í¸ì§‘ê¸° &gt; ì„¤ì • &gt; ê´€ë¦¬ë¡œ ì´ë™í•œë‹¤.Location of query result í•­ëª©ì— ë°©ê¸ˆ ìƒì„±í•œ ë²„í‚·ì„ ì§€ì •í•œë‹¤.ë°ì´í„°ë² ì´ìŠ¤ &amp; í…Œì´ë¸” ìƒì„±ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆë‹¤ë©´ í¸ì§‘ê¸°ë¡œ ëŒì•„ì™€ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.CREATE DATABASE alb_log_db;ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•˜ì˜€ë‹¤ë©´ ì¢Œì¸¡ ë°ì´í„° - ë°ì´í„°ë² ì´ìŠ¤ í•­ëª©ì—ì„œ ë°©ê¸ˆ ìƒì„±í•œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì„ íƒí•œë‹¤.ì˜µì…˜1. ì¼ë°˜ í…Œì´ë¸” ìƒì„±CREATE EXTERNAL TABLE IF NOT EXISTS alb_access_logs ( type string, time string, elb string, client_ip string, client_port int, target_ip string, target_port int, request_processing_time double, target_processing_time double, response_processing_time double, elb_status_code int, target_status_code string, received_bytes bigint, sent_bytes bigint, request_verb string, request_url string, request_proto string, user_agent string, ssl_cipher string, ssl_protocol string, target_group_arn string, trace_id string, domain_name string, chosen_cert_arn string, matched_rule_priority string, request_creation_time string, actions_executed string, redirect_url string, lambda_error_reason string, target_port_list string, target_status_code_list string, classification string, classification_reason string, conn_trace_id string ) ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.RegexSerDe' WITH SERDEPROPERTIES ( 'serialization.format' = '1', 'input.regex' = '([^ ]*) ([^ ]*) ([^ ]*) ([^ ]*):([0-9]*) ([^ ]*)[:-]([0-9]*) ([-.0-9]*) ([-.0-9]*) ([-.0-9]*) (|[-0-9]*) (-|[-0-9]*) ([-0-9]*) ([-0-9]*) \\\"([^ ]*) (.*) (- |[^ ]*)\\\" \\\"([^\\\"]*)\\\" ([A-Z0-9-_]+) ([A-Za-z0-9.-]*) ([^ ]*) \\\"([^\\\"]*)\\\" \\\"([^\\\"]*)\\\" \\\"([^\\\"]*)\\\" ([-.0-9]*) ([^ ]*) \\\"([^\\\"]*)\\\" \\\"([^\\\"]*)\\\" \\\"([^ ]*)\\\" \\\"([^\\s]+?)\\\" \\\"([^\\s]+)\\\" \\\"([^ ]*)\\\" \\\"([^ ]*)\\\" ?([^ ]*)?( .*)?') LOCATION 's3://DOC-EXAMPLE-BUCKET/access-log-folder-path/'ìœ„ SQL ë¬¸ì„ ì‚¬ìš©í•´ í…Œì´ë¸”ì„ ìƒì„±í•œë‹¤. LOCATION í•­ëª©ì˜ ê²½ë¡œë¥¼ ALB ë¡œê·¸ê°€ ì €ì¥ë˜ì–´ ìˆëŠ” ê²½ë¡œë¡œ ë³€ê²½í•˜ë©´ ëœë‹¤.ì˜µì…˜2. partition projection ê¸°ëŠ¥ì„ í™œìš©í•´ í…Œì´ë¸” ìƒì„± (ì¶”ì²œ)ALB ë¡œê·¸ëŠ” ì •í•´ì§„ ì²´ê³„ë¡œ ìƒì„±ì´ ë˜ê¸° ë•Œë¬¸ì— Athena partition projection ê¸°ëŠ¥ì„ í™œìš©í•´ ì¿¼ë¦¬ ëŸ°íƒ€ì„ì„ ì¤„ì´ê³  íŒŒí‹°ì…˜ ê´€ë¦¬ë¥¼ ìë™í™” í• ìˆ˜ ìˆë‹¤. íŒŒí‹°ì…˜ í”„ë¡œì ì…˜ì€ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì¶”ê°€í•  ë•Œ ìë™ìœ¼ë¡œ ìƒˆë¡œìš´ íŒŒí‹°ì…˜ì„ ì¶”ê°€í•˜ê¸° ë•Œë¬¸ì— ë³„ë„ì˜ ALTER TABLE ADD PARTITIONë¬¸ì„ ì‚¬ìš©í•˜ì—¬ íŒŒí‹°ì…˜ì„ ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€í•  í•„ìš”ê°€ ì—†ë‹¤. ì´ë¥¼ í†µí•´ Athenaë¥¼ ìµœì í™” (ì¿¼ë¦¬ ì‹¤í–‰ì‹œê°„ ë‹¨ì¶•, íŒŒí‹°ì…˜ ê´€ë¦¬ ìë™í™”, ìŠ¤ìº” ë°ì´í„° ì ˆì•½, ë¹„ìš© ì ˆê°) í•  ìˆ˜ ìˆë‹¤.partition projection ì— ëŒ€í•´ì„œëŠ” ê³µì‹ë¬¸ì„œ ë¥¼ í™•ì¸í•˜ë©´ ìƒì„¸í•˜ê²Œ ì•Œ ìˆ˜ ìˆë‹¤.ALB ë¡œê·¸ íŒŒì¼ì€ ì„¤ëª… ì— ë”°ë¥´ë©´ ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ìƒì„±ëœë‹¤.bucket[/prefix]/AWSLogs/aws-account-id/elasticloadbalancing/region/yyyy/mm/dd/aws-account-id_elasticloadbalancing_region_app.load-balancer-id_end-time_ip-address_random-string.log.gzyyyy/mm/dd í˜•ì‹ìœ¼ë¡œ í´ë”ê°€ ìƒì„±ë¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ year, month, dayë¥¼ íŒŒí‹°ì…˜ ì»¬ëŸ¼ìœ¼ë¡œ ì§€ì •í•˜ë„ë¡ í•˜ê² ë‹¤.CREATE EXTERNAL TABLE IF NOT EXISTS sys_log ( type string, time string, elb string, client_ip string, client_port int, target_ip string, target_port int, request_processing_time double, target_processing_time double, response_processing_time double, elb_status_code int, target_status_code string, received_bytes bigint, sent_bytes bigint, request_verb string, request_url string, request_proto string, user_agent string, ssl_cipher string, ssl_protocol string, target_group_arn string, trace_id string, domain_name string, chosen_cert_arn string, matched_rule_priority string, request_creation_time string, actions_executed string, redirect_url string, lambda_error_reason string, target_port_list string, target_status_code_list string, classification string, classification_reason string, conn_trace_id string ) PARTITIONED BY ( year integer, month integer, day integer ) ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.RegexSerDe' WITH SERDEPROPERTIES ( 'serialization.format' = '1', 'input.regex' = '([^ ]*) ([^ ]*) ([^ ]*) ([^ ]*):([0-9]*) ([^ ]*)[:-]([0-9]*) ([-.0-9]*) ([-.0-9]*) ([-.0-9]*) (|[-0-9]*) (-|[-0-9]*) ([-0-9]*) ([-0-9]*) \\\"([^ ]*) (.*) (- |[^ ]*)\\\" \\\"([^\\\"]*)\\\" ([A-Z0-9-_]+) ([A-Za-z0-9.-]*) ([^ ]*) \\\"([^\\\"]*)\\\" \\\"([^\\\"]*)\\\" \\\"([^\\\"]*)\\\" ([-.0-9]*) ([^ ]*) \\\"([^\\\"]*)\\\" \\\"([^\\\"]*)\\\" \\\"([^ ]*)\\\" \\\"([^\\s]+?)\\\" \\\"([^\\s]+)\\\" \\\"([^ ]*)\\\" \\\"([^ ]*)\\\" ?([^ ]*)?( .*)?') LOCATION 's3://DOC-EXAMPLE-BUCKET/AWSLogs/&lt;ACCOUNT-NUMBER&gt;/elasticloadbalancing/&lt;REGION&gt;/' TBLPROPERTIES ( \"projection.enabled\" = \"true\", \"projection.year.type\" = \"integer\", \"projection.year.range\" = \"2024,2024\", \"projection.year.digits\" = \"4\", \"projection.month.type\" = \"integer\", \"projection.month.range\" = \"01,12\", \"projection.month.digits\" = \"2\", \"projection.day.type\" = \"integer\", \"projection.day.range\" = \"01,31\", \"projection.day.digits\" = \"2\", \"storage.location.template\" = \"s3://DOC-EXAMPLE-BUCKET/AWSLogs/&lt;ACCOUNT-NUMBER&gt;/elasticloadbalancing/&lt;REGION&gt;/${year}/${month}/${day}\" )LOCATION í•­ëª©ê³¼ storage.locationon.template í•­ëª©ì˜ ê²½ë¡œë¥¼ ALB ë¡œê·¸ ë²„í‚· ê²½ë¡œë¡œ ë³€ê²½í•˜ë©´ ëœë‹¤. í…Œì´ë¸”ì„ ìƒì„±í•˜ì˜€ë‹¤ë©´ ìš°ì¸¡ í…Œì´ë¸” ì„¹ì…˜ì—ì„œ year, month, day ì»¬ëŸ¼ì„ ì°¾ì•„ë³´ì. ì•„ë˜ ìº¡ì³ëœ ì´ë¯¸ì§€ì™€ ê°™ì´ íŒŒí‹°ì…˜ëœ ì»¬ëŸ¼ì´ë¼ê³  í‘œê¸°ë˜ì–´ ìˆì„ ê²ƒì´ë‹¤. í…Œì´ë¸”ì€ ìƒì„±ë˜ì—ˆëŠ”ë° ë°ì´í„°ê°€ ì¡°íšŒë˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì´ ë¬¸ì„œì˜ Syntax ë¬¸ë‹¨ì„ í™•ì¸í•´ì„œ ëˆ„ë½ëœ í•„ë“œê°€ ìˆëŠ”ì§€ í™•ì¸í•´ ë³´ì„¸ìš”. ì˜ˆì œì˜ ê²½ìš° ì´ í¬ìŠ¤íŒ…ì„ ì‘ì„±í•˜ëŠ” ì‹œì ì˜ í•„ë“œë“¤ë§Œì„ í¬í•¨í•˜ê³  ìˆìœ¼ë¯€ë¡œ ì¶”í›„ í•„ë“œê°€ ì¶”ê°€ëœë‹¤ë©´ ì •ìƒë™ì‘í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì¿¼ë¦¬ ì‹¤í–‰í…Œì´ë¸”ì´ ì˜¤ë¥˜ì—†ì´ ìƒì„±ë˜ì—ˆë‹¤ë©´ í•„ìš”í•œ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ëŠ” ì¼ë§Œ ë‚¨ì•˜ë‹¤. ì¿¼ë¦¬ ì‘ì„±í›„ ctrl + enter ë¡œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìœ¼ë©° í•˜ë‹¨ ì¿¼ë¦¬ ê²°ê³¼ ì—ì„œ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.ì˜ˆì œë‚ ì§œë³„ ì „ì²´ ìš”ì²­ ê°¯ìˆ˜ countSELECT cast(year as VARCHAR) || cast(month as VARCHAR) || cast(day as VARCHAR) as date, count(*) as countFROM sys_logGROUP BY cast(year as VARCHAR) || cast(month as VARCHAR) || cast(day as VARCHAR)2024ë…„ 3ì›” 23ì¼ 11ì‹œ ~ 18ì‹œ 30ë¶„ ì‚¬ì´ ìš”ì²­ì¤‘ ì²˜ë¦¬ ì‹œê°„ì´ 10ì´ˆë¥¼ ì´ˆê³¼í•˜ëŠ” ìš”ì²­ì„ ì²˜ë¦¬ì‹œê°„ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬SELECT *FROM sys_logWHERE ( parse_datetime(time, 'yyyy-MM-dd''T''HH:mm:ss.SSSSSS''Z') BETWEEN parse_datetime('2024-03-23 02:00:00', 'yyyy-MM-dd HH:mm:ss') AND parse_datetime('2024-03-23 09:30:00', 'yyyy-MM-dd HH:mm:ss') )AND target_processing_time &gt; 10ORDER BY target_processing_time DESC3ì›” 10ì¼ ìš”ì²­ì¤‘ ë„¤ì´ë²„ ì›¨ì¼ ë¸Œë¼ìš°ì €ì—ì„œ ìš”ì²­í•œ ìš”ì²­ ê°¯ìˆ˜ countSELECT count(*)FROM sys_logWHERE month = 03 AND day = 10 AND user_agent like '%Whale%'" }, { "title": "Terraformìœ¼ë¡œ AWS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° - 4. í…ŒìŠ¤íŠ¸ í™˜ê²½", "url": "/posts/terraform-aws-infra-4/", "categories": "AWS, Terraform", "tags": "AWS, ECS", "date": "2024-02-24 08:12:00 +0900", "snippet": "Terraformìœ¼ë¡œ AWS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° ê°œìš” ê¸°ì´ˆ ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸ í™˜ê²½ ìš´ì˜í™˜ê²½ (í”„ë¡ íŠ¸) ìš´ì˜í™˜ê²½ (ë°±ì—”ë“œ) ë§ˆë¬´ë¦¬Terraformìœ¼ë¡œ AWS ECS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° - 4. í…ŒìŠ¤íŠ¸ í™˜ê²½ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ êµ¬ì„±í•œë‹¤. í…ŒìŠ¤íŠ¸ í™˜ê²½ì€ ìš´ì˜í™˜ê²½ê³¼ëŠ” ë‹¤ë¥´ê²Œ ë°±ì—”ë“œ, í”„ë¡ íŠ¸ì—”ë“œ, dbê°€ ëª¨ë‘ 1ê°œì˜ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ëŒì•„ê°€ê²Œ êµ¬ì„±í•œë‹¤.ë‹¹ì—°íˆ ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ì„œë¹„ìŠ¤ì˜ ê²½ìš° ì‹¤ì œ ìš´ì˜í™˜ê²½ê³¼ ë™ì¼í•˜ê²Œ í™˜ê²½ì„ êµ¬ì„±í•´ì•¼ ê² ì§€ë§Œ ì´ ì‹œë¦¬ì¦ˆì—ì„œëŠ” ê·¸ë ‡ê²Œê¹Œì§€ í•˜ì§„ ì•ŠëŠ”ë‹¤. ec2, key-pairë“±ê³¼ ê°™ì€ ë¦¬ì†ŒìŠ¤ë„ Terraformìœ¼ë¡œ ìƒì„±í•´ë³´ê¸° ìœ„í•¨ì´ë‹¤.í…ŒìŠ¤íŠ¸ í™˜ê²½ì˜ íŠ¸ë˜í”½ì€ Route53 -&gt; Application Load Balancer -&gt; EC2 ë¡œ ì „ì†¡ëœë‹¤.í…ŒìŠ¤íŠ¸ í™˜ê²½ì€ ë¬´ì¤‘ë‹¨ ë°°í¬ë¥¼ ê³ ë ¤í•˜ì§€ ì•ŠëŠ”ë‹¤.ë¦¬ì†ŒìŠ¤1. Application Load Balancerë¨¼ì € ë¡œë“œë°¸ëŸ°ì„œë¥¼ ìƒì„±í•œë‹¤. ë¡œë“œë°¸ëŸ°ì„œëŠ” í¼ë¸”ë¦­ ì„œë¸Œë„·ì„ ê°€ìš©ì˜ì—­ìœ¼ë¡œ ë‘ì–´ì•¼ í•œë‹¤. ë˜í•œ 80 í¬íŠ¸ì™€ 443 í¬íŠ¸ë¥¼ ê°œë°©í•˜ë„ë¡ í•˜ê² ë‹¤.resource \"aws_lb\" \"app-alb\" { name = \"app-alb\" internal = false load_balancer_type = \"application\" security_groups = [aws_security_group.app-alb-sg.id] subnets = [for subnet in aws_subnet.public : subnet.id] enable_deletion_protection = true}resource \"aws_security_group\" \"app-alb-sg\" { name = \"app-alb-sg\" description = \"security group for application load balancer\" vpc_id = \"${aws_vpc.vpc.id}\" ingress { description = \"http\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [\"0.0.0.0/0\"] ipv6_cidr_blocks = [\"::/0\"] } ingress { description = \"https\" from_port = 443 to_port = 443 protocol = \"tcp\" cidr_blocks = [\"0.0.0.0/0\"] ipv6_cidr_blocks = [\"::/0\"] } egress { from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [\"0.0.0.0/0\"] } tags = { Name = \"app-alb-sg\" }}2. EC2ë‹¤ìŒìœ¼ë¡œ EC2ë¥¼ ìƒì„±í•œë‹¤. ë‚˜ëŠ” ê°€ë‚œí•œ ê°œë°œì ì´ë¯€ë¡œ í”„ë¦¬í‹°ì–´ë¥¼ ì‚¬ìš©í•  ê²ƒì´ë‹¤.2.1 Key Pairí‚¤í˜ì–´ë¥¼ ìƒì„±í•œë‹¤. ì´ ê¸€ ì„ ì°¸ê³ í•´ ìƒì„±í•˜ì˜€ë‹¤. ë‹¤ ë§Œë“¤ì—ˆë‹¤ë©´ outputì„ í™•ì¸í•˜ì—¬ íŒŒì¼ì„ ìƒì„±í•´ ì¶”í›„ ssh ì ‘ì†ì‹œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.resource \"tls_private_key\" \"pk\" { algorithm = \"RSA\" rsa_bits = 4096}resource \"aws_key_pair\" \"app-test-key-pair\" { key_name = \"app-test-key-pair\" public_key = tls_private_key.pk.public_key_openssh}output \"private_key\" { value = tls_private_key.pk.private_key_pem sensitive = true}2.2 Security Group &amp; Elastic IPë‹¤ìŒìœ¼ë¡  ë³´ì•ˆê·¸ë£¹ê³¼ ê³ ì • IPë¥¼ ìƒì„±í•œë‹¤. ì›ë˜ëŒ€ë¡œë¼ë©´ ê°œë°œì pcì˜ ipë§Œ ssh ì ‘ì† í—ˆìš©í•´ì•¼ê² ìœ¼ë‚˜ í¸ì˜ìƒ ëª¨ë“  íŠ¸ë˜í”½ì„ í—ˆìš©í•˜ë„ë¡ í•˜ê² ë‹¤. ì´ ì¸ìŠ¤í„´ìŠ¤ë¡œ ë“¤ì–´ì˜¤ëŠ” http í¬íŠ¸ëŠ” 80 í¬íŠ¸ë¥¼ ì‚¬ìš©í•  ê²ƒì´ë©° ë¡œë“œë°¸ëŸ°ì„œ ì—ì„œ ë¼ìš°íŒ…ë˜ëŠ” ìš”ì²­ë§Œ í—ˆìš©í•  ê²ƒì´ë‹¤. ë”°ë¼ì„œ ingress ë¶€ë¶„ì˜ security groups ê°’ì„ ë¡œë“œë°¸ëŸ°ì„œì˜ ë³´ì•ˆê·¸ë£¹ idë¡œ ì§€ì •í•œë‹¤.resource \"aws_security_group\" \"app-test-sg\" { name = \"app-test-sg\" description = \"security group for app test instance\" vpc_id = \"${aws_vpc.vpc.id}\" ingress { description = \"ssh\" from_port = 22 to_port = 22 protocol = \"tcp\" cidr_blocks = [\"0.0.0.0/0\"] } ingress { description = \"http\" from_port = 80 to_port = 80 protocol = \"tcp\" security_groups = [aws_security_group.app-alb-sg.id] } egress { from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [\"0.0.0.0/0\"] } tags = { Name = \"app-test-sg\" }}resource \"aws_eip\" \"app-test-ec2-eip\" { vpc = true tags = { Name = \"app-test-eip\" }}2.3 EC2ì¤€ë¹„ê°€ ë˜ì—ˆìœ¼ë‹ˆ EC2ë¥¼ ìƒì„±í•œë‹¤. a ì¡´ì— ìˆëŠ” í¼ë¸”ë¦­ ì„œë¸Œë„·ì— ìƒì„±ë  ê²ƒì´ë©° í”„ë¦¬í‹°ì–´ë¡œ ì‚¬ìš©ì´ ê°€ëŠ¥í•œ t2.micro íƒ€ì…ì„ ì„ íƒí–ˆë‹¤. ê¸°íƒ€ ìœ„ ìƒì„±í•œ ë¦¬ì†ŒìŠ¤ë“¤ê³¼ ì—°ê²°í•´ì¤€ë‹¤.resource \"aws_instance\" \"app-test-ec2\" { ami = \"ami-0b8414ae0d8d8b4cc\" instance_type = \"t2.micro\" availability_zone = \"${var.aws_region}${element(var.availability_zones, 0)}\" subnet_id = aws_subnet.public[0].id key_name = aws_key_pair.app-test-key-pair.key_name vpc_security_group_ids = [aws_security_group.app-test-sg.id] tags = { Name = \"app-test-ec2\" }}ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì˜€ìœ¼ë‹ˆ ìœ„ì—ì„œ ìƒì„±í•œ eipì™€ ì—°ê²°í•´ì¤€ë‹¤.resource \"aws_eip\" \"app-test-ec2-eip\" { vpc = true instance = \"${aws_instance.app-test-ec2.id}\" tags = { Name = \"app-test-eip\" }}3. Application Load Balancer - Target Group &amp; Routingí…ŒìŠ¤íŠ¸ EC2ê°€ ì¡´ì¬í•˜ëŠ” ëŒ€ìƒ ê·¸ë£¹ì„ ìƒì„±í•˜ê³  í…ŒìŠ¤íŠ¸ ë„ë©”ì¸ì„ í•´ë‹¹ ëŒ€ìƒê·¸ë£¹ìœ¼ë¡œ ë¼ìš°íŒ…í•œë‹¤.3.1 Target Groupíƒ€ê²Ÿ ê·¸ë£¹ì„ ìƒì„±í•œë‹¤. 80í¬íŠ¸ë¡œ íŠ¸ë˜í”½ì„ ì „ì†¡ë°›ì„ ê²ƒì´ë©° /alb/health-check ê²½ë¡œë¡œ ìƒíƒœê²€ì‚¬ë¥¼ ì§„í–‰í•  ê²ƒì´ë‹¤.resource \"aws_lb_target_group\" \"app-test\" { name = \"app-test\" port = 80 protocol = \"HTTP\" target_type = \"instance\" vpc_id = aws_vpc.vpc.id health_check { path = var.alb-health-check-path port = \"traffic-port\" }}3.2 Listenerë¡œë“œë°¸ëŸ°ì„œ ë¦¬ìŠ¤ë„ˆë¥¼ ìƒì„±í•œë‹¤. 80í¬íŠ¸ì˜ ê²½ìš° 443 í¬íŠ¸ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œí‚¨ë‹¤. 443 í¬íŠ¸ì˜ ê²½ìš° ì•ì„œ AWS Certificate Manager ì—ì„œ ìƒì„±í•œ ssl ì¸ì¦ì„œë¥¼ ì ìš©í•˜ê³  ëŒ€ìƒê·¸ë£¹ìœ¼ë¡œ íŠ¸ë˜í”½ì„ í¬ì›Œë”©í•œë‹¤.resource \"aws_lb_listener\" \"app-alb-listener-http\" { load_balancer_arn = aws_lb.app-alb.arn port = \"80\" protocol = \"HTTP\" default_action { type = \"redirect\" redirect { port = \"443\" protocol = \"HTTPS\" status_code = \"HTTP_301\" } }}resource \"aws_lb_listener\" \"app-alb-listener-https\" { load_balancer_arn = aws_lb.app-alb.arn port = \"443\" protocol = \"HTTPS\" certificate_arn = aws_acm_certificate.ssl-certificate.arn default_action { type = \"forward\" target_group_arn = aws_lb_target_group.app-test.arn }}3.3 Target Registerí…ŒìŠ¤íŠ¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ëŒ€ìƒ ì¸ìŠ¤í„´ìŠ¤ë¡œ ë“±ë¡í•œë‹¤.resource \"aws_lb_target_group_attachment\" \"app-test-attachment\" { target_group_arn = aws_lb_target_group.app-test.id target_id = aws_instance.app-test-ec2.id port = 80}3.4 Listener Ruleë¡œë“œë°¸ëŸ°ì„œ ë¦¬ìŠ¤ë„ˆ ë£°ì„ ì§€ì •í•œë‹¤. ë„ë©”ì¸ì´ app-admin-test.keencho.com, app-user-test.keencho.com ì¸ ê²½ìš° í…ŒìŠ¤íŠ¸ ì¸ìŠ¤í„´ìŠ¤ë¡œ ë¼ìš°íŒ…í•  ê²ƒì´ë‹¤.resource \"aws_lb_listener_rule\" \"app-alb-test-rule\" { listener_arn = aws_lb_listener.app-alb-listener-https.arn priority = 1 action { type = \"forward\" target_group_arn = aws_lb_target_group.app-test.arn } condition { host_header { values = [\"app-admin-test.keencho.com\", \"app-user-test.keencho.com\"] } }} :warning: ì´ ë‹¨ê³„ì—ì„œëŠ” ëŒ€ìƒ ê·¸ë£¹ì— ë“±ë¡ëœ ëŒ€ìƒì˜ ìƒíƒœê°€ Unhealthyë¡œ í‘œì‹œë  ê²ƒì…ë‹ˆë‹¤. ì´ëŠ” ì¸ìŠ¤í„´ìŠ¤ ë‚´ë¶€ì—ì„œ ì„¸íŒ…í•´ì£¼ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ë©° ë‹¤ìŒì— ë°”ë¡œ ì„¤ì •í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.4. Route 53 RecordRoute 53 ì— ë ˆì½”ë“œë¥¼ ì¶”ê°€í•œë‹¤. ê° í…ŒìŠ¤íŠ¸ ë„ë©”ì¸ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” íŠ¸ë˜í”½ì´ albë¡œ í–¥í• ìˆ˜ ìˆë„ë¡ ì„¤ì •í•  ê²ƒì´ë‹¤.resource \"aws_route53_record\" \"app-admin-test\" { zone_id = aws_route53_zone.keencho.id name = \"app-admin-test.keencho.com\" type = \"A\" alias { name = aws_lb.app-alb.dns_name zone_id = aws_lb.app-alb.zone_id evaluate_target_health = true }}resource \"aws_route53_record\" \"app-user-test\" { zone_id = aws_route53_zone.keencho.id name = \"app-user-test.keencho.com\" type = \"A\" alias { name = aws_lb.app-alb.dns_name zone_id = aws_lb.app-alb.zone_id evaluate_target_health = true }}í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ìœ„í•´ AWSì—ì„œ ì„¤ì •í•´ ì¤˜ì•¼í•  ê²ƒì€ ëë‚¬ë‹¤. ë‚˜ë¨¸ì§€ëŠ” í…ŒìŠ¤íŠ¸ ì¸ìŠ¤í„´ìŠ¤ì— ì§ì ‘ ì ‘ì†í•´ì„œ ì§„í–‰í•´ì•¼ í•œë‹¤.5. EC2 ì„¤ì •ì´ì œ ì¸ìŠ¤í„´ìŠ¤ì— ì§ì ‘ ë“¤ì–´ì™€ ì—¬ëŸ¬ê°€ì§€ ì„¤ì •ì„ í•´ì¤˜ì•¼ í•œë‹¤. nginx ì„¤ì¹˜ java ì„¤ì¹˜ PostgreSQL ì„¤ì¹˜ ë°±ì—”ë“œ ì•± ë°°í¬ í”„ë¡ íŠ¸ ì•± ë°°í¬í•„ìëŠ” ì´ëŸ¬í•œ ìˆœì„œë¡œ ì§„í–‰í•˜ì˜€ìœ¼ë©° ì´ í¬ìŠ¤íŒ…ì€ ì¸í”„ë¼ êµ¬ì„±ì— ëŒ€í•œ ë‚´ìš©ë§Œ ë‹´ì„ê²ƒì´ê¸° ë•Œë¬¸ì— í•˜ë‚˜í•˜ë‚˜ ì–´ë–»ê²Œ ì„¤ì¹˜í•˜ê³  ë°°í¬í•˜ëŠ”ì§€ê¹Œì§€ ì‘ì„±í•˜ì§„ ì•ŠëŠ”ë‹¤.ì‚¬ìš©í•œ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì´ê³³ ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©° ê¼­ í•„ìˆ˜ë¡œ í•´ì•¼í•  ì‘ì—… ëª‡ê°€ì§€ë§Œ ì†Œê°œí•˜ë„ë¡ í•˜ê² ë‹¤. target group ìƒíƒœê²€ì‚¬ ê²½ë¡œ ì§€ì • - nginx ì„¤ì • íŒŒì¼ì„ í†µí•´ /alb/health-check ê²½ë¡œë¡œ ì ‘ê·¼í•œ ê²½ìš° 200 ìƒíƒœê°’ì„ ë¦¬í„´í•  ìˆ˜ ìˆë„ë¡ ì²«ë²ˆì§¸ ì„œë²„ ë¸”ë¡ì— ì •ì˜í•˜ì˜€ë‹¤. /api ê²½ë¡œê°€ ì¡´ì¬í•˜ëŠ” ìš”ì²­ê³¼ ì•„ë‹Œ ê²½ìš° êµ¬ë¶„ - /api ê²½ë¡œê°€ ì—†ëŠ” ê²½ìš° í”„ë¡ íŠ¸ ë¦¬ì•¡íŠ¸ ì•±ìœ¼ë¡œ, /api ê²½ë¡œê°€ ìˆëŠ” ê²½ìš° ë°±ì—”ë“œ ì„œë²„ë¡œ ë¼ìš°íŒ… ë ìˆ˜ ìˆë„ë¡ í•˜ì˜€ë‹¤.ì´ ë‹¨ê³„ê¹Œì§€ ì§„í–‰í•˜ì˜€ë‹¤ë©´ ëŒ€ìƒê·¸ë£¹ì´ Healthy ìƒíƒœë¡œ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë³´ì. ë³€ê²½ë˜ì—ˆë‹¤ë©´ ì‹¤ì œ ë„ë©”ì¸ìœ¼ë¡œ ì ‘ì†í•´ ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ë©´ ëœë‹¤." }, { "title": "Terraformìœ¼ë¡œ AWS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° - 3. ë„¤íŠ¸ì›Œí¬", "url": "/posts/terraform-aws-infra-3/", "categories": "AWS, Terraform", "tags": "AWS, ECS", "date": "2024-02-03 08:12:00 +0900", "snippet": "Terraformìœ¼ë¡œ AWS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° ê°œìš” ê¸°ì´ˆ ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸ í™˜ê²½ ìš´ì˜í™˜ê²½ (í”„ë¡ íŠ¸) ìš´ì˜í™˜ê²½ (ë°±ì—”ë“œ) ë§ˆë¬´ë¦¬Terraformìœ¼ë¡œ AWS ECS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° - 3. ë„¤íŠ¸ì›Œí¬ì´ë²ˆ í¬ìŠ¤íŒ…ë¶€í„° ë³¸ê²©ì ìœ¼ë¡œ AWS ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•œë‹¤. ê·¸ ì²«ë²ˆì§¸ë¡œ ì¸í”„ë¼ êµ¬ì„±ì— ê°€ì¥ ê¸°ë³¸ì´ ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ê´€ë ¨ ë¦¬ì†ŒìŠ¤(vpc, subnet ë“±â€¦)ë¶€í„° ìƒì„±í•œë‹¤.ì´ ê¸€ì—ì„  vpc, subnetë“±ì´ ë¬´ì—‡ì¸ì§€ ì„¤ëª…í•˜ì§„ ì•ŠëŠ”ë‹¤. ì´ ì‹œë¦¬ì¦ˆ ë¥¼ ë”°ë¼ê°€ë‹¤ ë³´ë©´ ê°œë…ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë‹ˆ ëª¨ë¥´ì‹œëŠ” ë¶„ë“¤ì€ ì½ì–´ë³´ì‹œê¸° ë°”ë€ë‹¤.ì‹œì‘í•˜ê¸°ì „ ê¸°ì´ˆ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.# main.tfterraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~&gt; 4.16\" } } required_version = \"&gt;= 1.2.0\"}provider \"aws\" { region = var.aws_region default_tags { tags = { Project = var.app_project_name } }}variable \"app_name\" { description = \"The name of application\" type = string default = \"app\"}variable \"app_project_name\" { description = \"The name of Project\" type = string default = \"appProject\"}ì „ì—­ì ìœ¼ë¡œ Project íƒœê·¸ë¥¼ ì„¸íŒ…í•˜ì˜€ë‹¤. í•œ ê³„ì •ì— í”„ë¡œì íŠ¸ê°€ 1ê°œì´ë©´ ìƒê´€ì—†ì§€ë§Œ, í”„ë¡œì íŠ¸ê°€ Nê°œë¼ë©´ í”„ë¡œì íŠ¸ë¥¼ ë¶„ë¦¬í•˜ì—¬ ì§€ì •í–ˆì„ ì‹œ í”„ë¡œì íŠ¸ ë³„ë¡œ ë¹„ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í¸ë¦¬í•˜ë‹¤.ë³€ìˆ˜ë³€ìˆ˜ë¥¼ í™œìš©í•œë‹¤.variable \"aws_region\" { description = \"The AWS region to deploy the VPC in\" type = string default = \"ap-northeast-2\"}variable \"availability_zones\" { description = \"List of availability zones to use\" type = list(string) default = [\"a\", \"b\"]}variable \"vpc_cidr\" { description = \"The CIDR block for the VPC\" type = string default = \"10.0.0.0/16\"}variable \"public_subnet_cidrs\" { description = \"The CIDR blocks for the public subnets\" type = list(string) default = [\"10.0.1.0/24\", \"10.0.2.0/24\"]}variable \"private_subnet_cidrs\" { description = \"The CIDR blocks for the private subnets\" type = list(string) default = [\"10.0.3.0/24\", \"10.0.4.0/24\"]}variable \"db_subnet_cidrs\" { description = \"The CIDR blocks for the DB subnets\" type = list(string) default = [\"10.0.5.0/24\", \"10.0.6.0/24\"]}ìœ„ ë³€ìˆ˜ë“¤ì€ ë„¤íŠ¸ì›Œí¬ ë¦¬ì†ŒìŠ¤ ìƒì„±ì— í•„ìš”í•œ ë³€ìˆ˜ë“¤ì´ë‹¤. ì´ ì˜ˆì œì—ì„œëŠ” a, b 2ê°œì˜ ê°€ìš©ì¡´ì„ ì‚¬ìš©í•œë‹¤. ë§Œì•½ a, b, c, d ëª¨ë‘ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´variable \"availability_zones\" { description = \"List of availability zones to use\" type = list(string) default = [\"a\", \"b\", \"c\", \"d\"]}ìœ„ì™€ ê¹‰ì´ ê¸°ë³¸ ê°’ë§Œ ìˆ˜ì •í•´ì£¼ë©´ ì‰½ê²Œ ê°€ìš©ì¡´ì„ í™•ì¥í•  ìˆ˜ ìˆë‹¤. (ë¬¼ë¡  ì„œë¸Œë„· cidr ë„ ìˆ˜ì •í•´ ì¤˜ì•¼ í•œë‹¤.) ì›¹ ì½˜ì†” í™˜ê²½ì—ì„œ í•˜ë‚˜í•˜ë‚˜ í´ë¦­í•˜ë©´ì„œ ìƒì„±í• ë•Œì™€ ë¹„êµí•´ ë´¤ì„ë•Œ ìƒì‚°ì„±ì´ ëˆˆì— ë„ê²Œ ëŠ˜ì–´ë‚¨ì„ í™•ì¸í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.ë¦¬ì†ŒìŠ¤1. VPCresource \"aws_vpc\" \"vpc\" { cidr_block = var.vpc_cidr enable_dns_support = true enable_dns_hostnames = true tags = { Name = \"${var.app_name}-vpc\" }}ì²«ë²ˆì§¸ë¡œ VPCë¥¼ ìƒì„±í•œë‹¤.2. Internet Gatewayresource \"aws_internet_gateway\" \"igw\" { vpc_id = aws_vpc.vpc.id tags = { Name = \"${var.app_name}-igw\" }}ë‹¤ìŒìœ¼ë¡œ í¼ë¸”ë¦­ ì„œë¸Œë„·ì— ë¶™ì¼ ìš©ë„ë¡œ Internet Gatewayë¥¼ ìƒì„±í•œë‹¤.3. NAT Gatewayresource \"aws_eip\" \"nat\" { count = length(var.public_subnet_cidrs) vpc = true tags = { Name = \"${var.app_name}-nat-eip-${element(var.availability_zones, count.index)}\" }}resource \"aws_nat_gateway\" \"nat\" { count = length(var.public_subnet_cidrs) allocation_id = aws_eip.nat[count.index].id subnet_id = element(aws_subnet.public[*].id, count.index) tags = { Name = \"${var.app_name}-nat-${element(var.availability_zones, count.index)}\" } depends_on = [aws_internet_gateway.igw]}ë‹¤ìŒìœ¼ë¡œ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ë¶™ì¼ ìš©ë„ë¡œ NAT Gatewayë¥¼ ìƒì„±í•œë‹¤. NAT GatewayëŠ” íƒ„ë ¥ì  ipë¥¼ í•„ìš”ë¡œ í•˜ê¸° ë•Œë¬¸ì— ì´ ë˜í•œ ìƒì„±í•œë‹¤.4. Routing Tableresource \"aws_route_table\" \"rt-public\" { vpc_id = aws_vpc.vpc.id tags = { Name = \"${var.app_name}-rt-public\" }}resource \"aws_main_route_table_association\" \"main\" { vpc_id = aws_vpc.vpc.id route_table_id = aws_route_table.rt-public.id}resource \"aws_route\" \"route-public\" { route_table_id = aws_route_table.rt-public.id destination_cidr_block = \"0.0.0.0/0\" gateway_id = aws_internet_gateway.igw.id}resource \"aws_route_table\" \"rt-private\" { count = length(var.private_subnet_cidrs) vpc_id = aws_vpc.vpc.id tags = { Name = \"${var.app_name}-rt-private-${element(var.availability_zones, count.index)}\" }}resource \"aws_route\" \"route-private\" { count = length(var.private_subnet_cidrs) route_table_id = element(aws_route_table.rt-private[*].id, count.index) destination_cidr_block = \"0.0.0.0/0\" nat_gateway_id = element(aws_nat_gateway.nat[*].id, count.index)}ë‹¤ìŒìœ¼ë¡œ ë¼ìš°íŒ… í…Œì´ë¸”ì„ ìƒì„±í•œë‹¤. 1ê°œì˜ í¼ë¸”ë¦­ ë¼ìš°íŒ… í…Œì´ë¸”ê³¼ ê°ê°ì˜ ì¡´ì— ì¡´ì¬í•˜ëŠ” 2ê°œì˜ í”„ë¼ì´ë¹— ë¼ìš°íŒ… í…Œì´ë¸”ì„ ìƒì„±í•˜ì˜€ìœ¼ë©° í¼ë¸”ë¦­ ë¼ìš°íŒ… í…Œì´ë¸”ì„ ê¸°ë³¸ ë¼ìš°íŒ… í…Œì´ë¸”ë¡œ ì§€ì •í•œë‹¤.í¼ë¸”ë¦­ ì„œë¸Œë„·ì˜ ì•„ì›ƒë°”ìš´ë“œ íŠ¸ë˜í”½ì€ Internet Gatewayë¡œ, í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ ì•„ì›ƒë°”ìš´ë“œ íŠ¸ë˜í”½ì€ NAT Gatewayë¡œ ì „ì†¡í•œë‹¤. :warning: VPC ìƒì„±ì‹œ AWSëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë¼ìš°íŒ… í…Œì´ë¸”ì„ í•˜ë‚˜ ìƒì„±í•œë‹¤. ìœ„ êµ¬ì„±ì—ì„œ ìƒì„±í•œ ë¼ìš°íŒ… í…Œì´ë¸”ê³¼ëŠ” ì „í˜€ ê´€ë ¨ì—†ëŠ” ë¼ìš°íŒ… í…Œì´ë¸”ì´ë‹¤. ë­”ê°€ ê¹”ë”(?) í•˜ê²Œ êµ¬ì„±í•˜ë ¤ë©´ ì½˜ì†”ì—ì„œ í˜¹ì€ CLIë¡œ ì§ì ‘ í•´ë‹¹ ë¼ìš°íŒ… í…Œì´ë¸”ì„ ì‚­ì œí•˜ë©´ ëœë‹¤. (Terraform ì°¨ì›ì—ì„œëŠ” ì‚´ì§ ì–´ë ¤ìš´ë“¯ í•˜ë‹¤.) ì—¬ê¸°ì„œëŠ” ì§„í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.5. Subnetresource \"aws_subnet\" \"public\" { count = length(var.public_subnet_cidrs) vpc_id = aws_vpc.vpc.id cidr_block = element(var.public_subnet_cidrs, count.index) map_public_ip_on_launch = true availability_zone = \"${var.aws_region}${element(var.availability_zones, count.index)}\" tags = { Name = \"${var.app_name}-subnet-public-${element(var.availability_zones, count.index)}\" }}resource \"aws_subnet\" \"private\" { count = length(var.private_subnet_cidrs) vpc_id = aws_vpc.vpc.id cidr_block = element(var.private_subnet_cidrs, count.index) availability_zone = \"${var.aws_region}${element(var.availability_zones, count.index)}\" tags = { Name = \"${var.app_name}-subnet-private-${element(var.availability_zones, count.index)}\" }}resource \"aws_subnet\" \"private-db\" { count = length(var.db_subnet_cidrs) vpc_id = aws_vpc.vpc.id cidr_block = element(var.db_subnet_cidrs, count.index) availability_zone = \"${var.aws_region}${element(var.availability_zones, count.index)}\" tags = { Name = \"${var.app_name}-subnet-db-private-${element(var.availability_zones, count.index)}\" }}í•œê°œì˜ í¼ë¸”ë¦­ ì„œë¸Œë„·ê³¼ 4ê°œì˜ í”„ë¼ì´ë¹— ì„œë¸Œë„· (2 for app, 2 for db)ì„ ìƒì„±í•œë‹¤.6. Subnet Associationresource \"aws_route_table_association\" \"rt-public-association\" { count = length(var.public_subnet_cidrs) subnet_id = element(aws_subnet.public[*].id, count.index) route_table_id = aws_route_table.rt-public.id}resource \"aws_route_table_association\" \"rt-private-association\" { count = length(var.private_subnet_cidrs) subnet_id = element(aws_subnet.private[*].id, count.index) route_table_id = element(aws_route_table.rt-private[*].id, count.index)}resource \"aws_route_table_association\" \"rt-private-db-association\" { count = length(var.db_subnet_cidrs) subnet_id = element(aws_subnet.private-db[*].id, count.index) route_table_id = element(aws_route_table.rt-private[*].id, count.index)}ë§ˆì§€ë§‰ìœ¼ë¡œ ì„œë¸Œë„·ê³¼ ë¼ìš°íŒ… í…Œì´ë¸”ë“¤ì„ ëª…ì‹œì ìœ¼ë¡œ ì—°ê²°í•œë‹¤.ë¦¬ì†ŒìŠ¤ ë§µVPC ì½˜ì†”ë¡œ ë“¤ì–´ê°€ ë¦¬ì†ŒìŠ¤ ë§µì„ í™•ì¸í•´ ë³´ì. ìœ„ì™€ê°™ì´ ë¦¬ì†ŒìŠ¤ê°€ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©´ ëœë‹¤. ë”ìš±ë” í™•ì‹¤í•˜ê²Œ í™•ì¸í•˜ë ¤ë©´ ê°ê°ì˜ ë¦¬ì†ŒìŠ¤ ì½˜ì†”ë¡œ ì´ë™í•˜ì—¬ í™•ì¸í•´ë³´ì.Route 53 &amp; SSL ì¸ì¦ì„œì›í• í•œ ì§„í–‰ì„ ìœ„í•´ Route 53 í˜¸ìŠ¤íŒ… ì˜ì–µì„ ìƒì„±í•˜ê³  AWS Certificate Managerë¥¼ í†µí•´ SSL ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ì•„ ë‘ë„ë¡ í•˜ê² ë‹¤. (ì¶”í›„ CloudFront êµ¬ì„±ì‹œ ëŒ€ì²´ ë„ë©”ì¸ì„ ì—°ê²°í•´ì•¼ í•˜ëŠ”ë°, ì´ë•Œ SSL ì¸ì¦ì„œê°€ í•„ìˆ˜ì´ë‹¤.)ê°ê°ì˜ recordëŠ” ê·¸ë•Œê·¸ë•Œ ì¶”ê°€í•˜ë„ë¡ í•œë‹¤.resource \"aws_route53_zone\" \"keencho\" { name = \"keencho.com\" lifecycle { prevent_destroy = true } tags = { Name = \"app-keencho-route53\" }}resource \"aws_route53_record\" \"app-certificate-validation\" { for_each = { for dvo in aws_acm_certificate.ssl-certificate.domain_validation_options : dvo.domain_name =&gt; { name = dvo.resource_record_name record = dvo.resource_record_value type = dvo.resource_record_type } } allow_overwrite = true name = each.value.name records = [each.value.record] ttl = 60 type = each.value.type zone_id = aws_route53_zone.keencho.id}resource \"aws_acm_certificate\" \"ssl-certificate\" { domain_name = \"*.keencho.com\" validation_method = \"DNS\" lifecycle { create_before_destroy = true }}resource \"aws_acm_certificate_validation\" \"ssl-certificate-validation\" { certificate_arn = aws_acm_certificate.ssl-certificate.arn validation_record_fqdns = [for record in aws_route53_record.app-certificate-validation : record.fqdn]}AWS Certificate Managerì— SSL ì¸ì¦ì„œë¥¼ ì¶”ê°€í•˜ê³  Route 53 CNAME ë ˆì½”ë“œë¥¼ í†µí•´ ì†ì‰½ê²Œ ê²€ì¦í•  ìˆ˜ ìˆë‹¤.ì£¼ì˜í•  ì ì´ ìˆë‹¤. í˜„ ì‹œì  ìƒì„±ëœ SSL ì¸ì¦ì„œëŠ” ì„œìš¸ ë¦¬ì „ (ap-northeast-2)ì— ì¡´ì¬í•œë‹¤. ì¶”í›„ CloudFront ìƒì„±ì‹œì—ëŠ” ë²„ì§€ë‹ˆì•„ ë¶ë¶€ (us-east-1) ì— ì¡´ì¬í•˜ëŠ” SSL ì¸ì¦ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ us-ease-1 ë¦¬ì „ì—ë„ ì¸ì¦ì„œë¥¼ ì¶”ê°€í•´ ì£¼ë„ë¡ í•˜ê² ë‹¤.provider \"aws\" { alias = \"us-east-1\" region = \"us-east-1\"}resource \"aws_acm_certificate\" \"ssl-certificate-virginia\" { domain_name = \"*.keencho.com\" validation_method = \"DNS\" provider = aws.us-east-1 lifecycle { create_before_destroy = true }}ì–´ë–¤ ë¡œì§ì´ ìˆ¨ê²¨ì ¸ ìˆëŠ”ì§€ ëª¨ë¥´ê² ì§€ë§Œ ìœ„ ì¸ì¦ì„œë„ ì•ì„œ ì§„í–‰í•œ ssl-certificate-validation ê²€ì¦ì„ í†µí•´ ê²€ì¦ë°›ì„ ìˆ˜ ìˆë‹¤. (ë³„ë„ì˜ ê²€ì¦ ë¦¬ì†ŒìŠ¤ ë¸”ë½ì´ í•„ìš”í•˜ì§€ ì•ŠìŒ.) ë”°ë¼ì„œ ìƒì„±í›„ ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë¦¬ë©´ ìƒíƒœê°€ ë³€ê²½ë¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.ë§Œì•½ ë„ë©”ì¸ì„ ì™¸ë¶€ ë„ë©”ì¸ ì—…ì²´ (ê°€ë¹„ì•„, í›„ì´ì¦ˆ ë“±) ì—ì„œ êµ¬ë§¤í•˜ì˜€ë‹¤ë©´ í•´ë‹¹ ì—…ì²´ ê´€ë¦¬í™”ë©´ìœ¼ë¡œ ì´ë™í•´ ë„¤ì„ì„œë²„ë¥¼ AWSê°€ ìƒì„±í•œ ë„¤ì„ì„œë²„ë¡œ ë³€ê²½í•˜ë„ë¡ í•˜ì. ë³€ê²½í•˜ì§€ ì•Šìœ¼ë©´ ë¬´ìš©ì§€ë¬¼ì´ë‹¤." }, { "title": "Terraformìœ¼ë¡œ AWS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° - 2. ê¸°ì´ˆ", "url": "/posts/terraform-aws-infra-2/", "categories": "AWS, Terraform", "tags": "AWS, ECS", "date": "2024-01-13 08:12:00 +0900", "snippet": "Terraformìœ¼ë¡œ AWS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° ê°œìš” ê¸°ì´ˆ ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸ í™˜ê²½ ìš´ì˜í™˜ê²½ (í”„ë¡ íŠ¸) ìš´ì˜í™˜ê²½ (ë°±ì—”ë“œ) ë§ˆë¬´ë¦¬Terraformìœ¼ë¡œ AWS ECS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° - 2. ê¸°ì´ˆì•ì„œ ì„¤ëª…í–ˆë“  í”„ë¡ íŠ¸ë‹¨ì€ React, ë°±ë‹¨ì€ Spring-Bootë¥¼ ì‚¬ìš©í•œë‹¤.ì•±ì´ í¬ìŠ¤íŒ…ì—ì„œ ì•±ì„ êµ¬ì„±í•˜ëŠ” ë°©ë²•ê¹Œì§€ í¬í•¨í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. ì´ ë¦¬í¬ì§€í† ë¦¬ ì— í•„ìš”í•œ ì½”ë“œëŠ” ëª¨ë‘ ì¡´ì¬í•˜ë‹ˆ í•„ìš”í•œ ë¶„ë“¤ì€ ì°¸ê³ í•˜ì‹œê¸° ë°”ë€ë‹¤.ì „ì²´ì ì¸ êµ¬ì„± ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. í”„ë¡ íŠ¸ (React) ëª¨ë…¸ë ˆí¬ í”„ë¡œì íŠ¸ êµ¬ì„± ë°± (SpringBoot) ë©€í‹°ëª¨ë“ˆ í”„ë¡œì íŠ¸ êµ¬ì„± í”„ë¡ íŠ¸ ê²½ë¡œì™€ ê²¹ì¹˜ì§€ ì•ŠëŠ” contextPath í•„ìˆ˜ (ì´ ì˜ˆì œì—ì„  /api ì‚¬ìš©) í”„ë¡ íŠ¸ ê²½ë¡œì™€ ê²¹ì¹˜ì§€ ì•ŠëŠ” contextPathê°€ í•„ìˆ˜ì¸ ì´ìœ ëŠ” CloudFrontì—ì„œ ê²½ë¡œì— ë”°ë¼ ë¼ìš°íŒ… ì •ì±…ì„ ë‹¤ë¥´ê²Œ ê°€ì ¸ê°€ì•¼ ë•Œë¬¸ì´ë‹¤. (ë˜í•œ CORS ë¬¸ì œ í”¼í•˜ê¸°) CloudFrontëŠ” ìš´ì˜ íŠ¸ë˜í”½ì„ ê°ê° s3ì™€ Application Load Balancer ë¡œ ì „ì†¡í•´ì•¼ í•˜ëŠ”ë°, ë§Œì•½ contextPathê°€ /app ìœ¼ë¡œ ëª¨ë‘ ë™ì¼í•˜ë‹¤ë©´ CloudFrontê°€ ê²½ë¡œì— ë”°ë¼ ìš”ì²­ ë¶„ê¸°ë¥¼ í•˜ì§€ ëª»í•˜ê¸° ë•Œë¬¸ì— ë‘˜ì¤‘ í•œê³³ì— ìœ ë‹ˆí¬í•œ contextPathëŠ” í•„ìˆ˜ì´ë‹¤.ë”°ë¼ì„œ ë°±ë‹¨ì— /api contextPathë¥¼ ì ìš©í•œë‹¤. (/api ê²½ë¡œê°€ ì¡´ì¬í•˜ëŠ” ìš”ì²­ -&gt; ALBë¡œ ì „ì†¡, ê·¸ì™¸ -&gt; S3ë¡œ ì „ì†¡)ë§Œì•½ í”„ë¡ íŠ¸ ê²½ë¡œì— /api/account/listì™€ ê°™ì€ ê²½ë¡œê°€ ì¡´ì¬í•˜ë©´ CloudFrontëŠ” ìš”ì²­ì„ ALBë¡œ ì „ì†¡í•  ê²ƒì´ë¯€ë¡œ ì˜ë„í•˜ì§€ ì•Šì€ ë™ì‘ì´ ë  ê²ƒì´ë‹¤. ì´ë¥¼ ì—¼ë‘í•˜ê³  ì½”ë“œë¥¼ ì‘ì„±í–ˆë‹¤.Terraform &amp; AWS CLI ì´ê³³ ì„ ì°¸ê³ í•˜ì—¬ terraformì„ ì„¤ì¹˜í•œë‹¤. ì´ê³³ ì„ ì°¸ê³ í•˜ì—¬ AWS CLIë¥¼ ì„¤ì¹˜í•œë‹¤. ì´ê³³ ì„ ì°¸ê³ í•˜ì—¬ AWS CLIë¥¼ ì„¤ì •í•œë‹¤.ëª¨ë“  ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆë‹¤ë©´ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ terraform ê³¼ aws cliê°€ ì˜ êµ¬ì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.terraformaws sts get-caller-identityë³¸ê²©ì ì¸ AWS ë¦¬ì†ŒìŠ¤ êµ¬ì„±ì€ ë‹¤ìŒ í¬ìŠ¤íŒ…ë¶€í„° ì§„í–‰í•œë‹¤." }, { "title": "Terraformìœ¼ë¡œ AWS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° - 1. ê°œìš”", "url": "/posts/terraform-aws-infra-1/", "categories": "AWS, Terraform", "tags": "AWS, ECS", "date": "2023-12-09 08:12:00 +0900", "snippet": "Terraformìœ¼ë¡œ AWS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° ê°œìš” ê¸°ì´ˆ ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸ í™˜ê²½ ìš´ì˜í™˜ê²½ (í”„ë¡ íŠ¸) ìš´ì˜í™˜ê²½ (ë°±ì—”ë“œ) ë§ˆë¬´ë¦¬Terraformìœ¼ë¡œ AWS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° - 1. ê°œìš”ìµœê·¼ ì˜¤í”ˆí•˜ëŠ” ì‹œìŠ¤í…œì„ ECS ê¸°ë°˜ ì¸í”„ë¼ë¡œ ë³€ê²½í•˜ì˜€ë‹¤. ë„ì…ì‹œ ê²ªì—ˆë˜ ì‹œí–‰ì°©ì˜¤ë‚˜ ê¸°íƒ€ ë¬¸ì œë¥¼ ë‹¤ì‹œí•œë²ˆ ì •ë¦¬í•˜ë©° ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ë¥¼ êµ¬ì„±í•´ë³¸ë‹¤.AWS Web Consoleë¡œë„ ì¸í”„ë¼ êµ¬ì„±ì´ ê°€ëŠ¥íˆì§€ë§Œ ì½”ë“œë¥¼ ì‚¬ìš©í•´ ì¸í”„ë¼ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ IaCì¤‘ í•˜ë‚˜ì¸ Terraform ì„ ì‚¬ìš©í•œë‹¤. Terraformì´ ë¬´ì—‡ì¸ì§€ëŠ” ìì„¸í•˜ê²Œ ì„¤ëª…í•˜ì§„ ì•Šê² ìœ¼ë‚˜ í•„ìš”ì‹œ ê°„ë‹¨í•˜ê²Œ ì§šê³  ë„˜ì–´ê°€ë„ë¡ í•œë‹¤.ì´ ì‹œë¦¬ì¦ˆ ì™€ëŠ” ë‹¤ë¥´ê²Œ í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì¶•, ìš´ì˜ í™˜ê²½ì˜ ê²½ìš° ECS Fargate ì‚¬ìš©, Terraform ì‚¬ìš©, CloudFront ì‚¬ìš© ë“± ì‹¤ì œ ì„œë¹„ìŠ¤ì— ì ìš©í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í•´ë³¼ ê²ƒì´ë‹¤.ì¸í”„ë¼ êµ¬ì„±êµ¬ì„±í•  ì¸í”„ë¼ë¥¼ ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤. ë„ë©”ì¸ì€ ë‚´ê°€ ë³´ìœ ì¤‘ì¸ keencho.com ë„ë©”ì¸ì„ ì‚¬ìš©í•œë‹¤. Route 53ì€ ë‹¤ìŒ ë„ë©”ì¸ì˜ íŠ¸ë˜í”½ì„ ê°ê° ë¼ìš°íŒ…í•œë‹¤. app-admin.keencho.com (ê´€ë¦¬ì - CloudFront) app-user.keencho.com (ì‚¬ìš©ì - CloudFront) app-admin-test.keencho.com (ê´€ë¦¬ì í…ŒìŠ¤íŠ¸ - Application Load Balancer) app-user-test.keencho.com (ì‚¬ìš©ì í…ŒìŠ¤íŠ¸ - Application Load Balancer) app-resources.keencho.com (ë¦¬ì†ŒìŠ¤ - CloudFront) CloudFront ìš´ì˜ íŠ¸ë˜í”½, ë¦¬ìŠ¤ì†Œ íŠ¸ë˜í”½ì„ ë‹´ë‹¹ ìš´ì˜ íŠ¸ë˜í”½ì˜ /api/** ê²½ë¡œë¡œ ì‹œì‘í•˜ëŠ” ìš”ì²­ì˜ ê²½ìš° Application Load Balancerë¡œ ì „ë‹¬í•œë‹¤. /api/** ê²½ë¡œë¡œ ì‹œì‘í•˜ì§€ ì•ŠëŠ” ìš´ì˜ ìš”ì²­ì€ react ì•±ì´ ë°°í¬ë˜ì–´ ìˆëŠ” s3 ë²„í‚·ìœ¼ë¡œ ì „ì†¡í•œë‹¤. ë¦¬ì†ŒìŠ¤ íŠ¸ë˜í”½ì€ ë¦¬ì†ŒìŠ¤ s3 ë²„í‚·ìœ¼ë¡œ ì „ì†¡í•œë‹¤. Application Load Balancer í…ŒìŠ¤íŠ¸ íŠ¸ë˜í”½, ìš´ì˜ api íŠ¸ë˜í”½ ë‹´ë‹¹ (ë„ë©”ì¸ì— ë”°ë¼ ë¶„ê¸°) í…ŒìŠ¤íŠ¸ íŠ¸ë˜í”½ì€ 2a í¼ë¸”ë¦­ ì„œë¸Œë„·ì— ìœ„ì¹˜í•˜ëŠ” test + bastion ì¸ìŠ¤í„´ìŠ¤ë¡œ ì „ë‹¬ ìš´ì˜ api íŠ¸ë˜í”½ì€ ECS Fargate ë¡œ ì „ì†¡í•œë‹¤. RDS - ìš´ì˜ dbëŠ” RDSë¥¼ ì‚¬ìš©í•œë‹¤. EFS - ì–´í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ë¥¼ ìŒ“ê¸°ìœ„í•œ ìš©ë„ë¡œ EFS ë¥¼ ì‚¬ìš©í•œë‹¤. ECR - ë¹Œë“œí•œ ë„ì»¤ ìœ„ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ê¸°í•´ ECRì„ ì‚¬ìš©í•œë‹¤. CodeDeploy - ìš´ì˜ ì•± ë°°í¬ë¥¼ ìœ„í•´ CodeDeployë¥¼ ì‚¬ìš©í•œë‹¤.í”„ë¡ íŠ¸ë‹¨ì€ React, ë°±ë‹¨ì€ SpringBootë¥¼ ì‚¬ìš©í•˜ë©° DBëŠ” PostgreSQLì„ ì‚¬ìš©í•œë‹¤.ì¸í”„ë¼ ë‹¤ì´ì–´ê·¸ë¨ìœ„ êµ¬ì„±ì„ ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ í‘œí˜„í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.ê¸°íƒ€ì´ ì‹œë¦¬ì¦ˆì—ì„œëŠ” Terraform, AWS CLI ê°€ ë¬´ì—‡ì¸ì§€ ë“±ì€ ì„¤ëª…í•˜ì§€ ì•ŠëŠ”ë‹¤.terraform applyterraform planterraform destroyìœ„ì™€ ê°™ì€ ëª…ë ¹ì–´ë“¤ë„ ë§ˆì°¬ê°€ì§€ë¡œ ë¬´ì—‡ì¸ì§€ëŠ” ì„¤ëª…í•˜ì§€ ì•Šìœ¼ë©° IaC, CLI ë“±ì— ê¸°ì´ˆ ì§€ì‹ì´ ìˆë‹¤ëŠ” ê°€ì • í•˜ì— ì§„í–‰í•œë‹¤. :warning: Application Load Balancerì—ì„œ S3ë¡œ íŠ¸ë˜í”½ì„ ë¼ìš°íŒ…í• ìˆ˜ ìˆëŠ” ë°©ë²•ì€ ì—†ë‹¤. ë”°ë¼ì„œ CloudFrontì—ì„œ ìš”ì²­ì„ ë¶„ê¸°í•´ì•¼ í•˜ëŠ”ë° ì´ë ‡ê²Œ ì¸í”„ë¼ë¥¼ êµ¬ì„±í•˜ë ¤ë©´ Route 53 ì€ í•„ìˆ˜ë‹¤. ì•„ì˜ˆ ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ awsì—ì„œ êµ¬ë§¤í•˜ê±°ë‚˜ ë³¸ì¸ì´ ì†Œìœ í•œ ë„ë©”ì¸ì˜ ë„¤ì„ì„œë²„ë¥¼ awsì˜ ê²ƒìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. (í˜¹ì€ ë„ë©”ì¸ì„ êµ¬ë§¤í•œ ê³³ì—ì„œ CNAME ë ˆì½”ë“œë¥¼ ì„¤ì •í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.)" }, { "title": "AWS Abuse malware website report", "url": "/posts/aws-abuse-malware-website-report/", "categories": "AWS", "tags": "AWS", "date": "2023-10-31 08:12:00 +0900", "snippet": "AWS Abuse malware website reportí‰í™”ë¡œìš´ ëª©ìš”ì¼ AWSì—ì„œ ë©”ì¼ í•œí†µì´ ë‚ ë¼ì™”ë‹¤. ë‹¤ìŒë‚  ì—°ì°¨ê³  ì—¬í–‰ ê³„íšì´ ì¡í˜€ìˆê¸° ë•Œë¬¸ì— ëŒ€ìˆ˜ë¡­ì§€ ì•Šê²Œ ë„˜ê²¼ë‹¤. ê·¸ëŸ°ë° ë‹¤ìŒë‚  ê¸ˆìš”ì¼ ë°¤ 11ì‹œì— ë‘ë²ˆì§¸ ë©”ì¼ì´ ë‚ ë¼ì™”ë‹¤.êµ¬ê¸€ë§ í•´ë³´ë‹ˆ ë©”ì¼ ëë¶€ë¶„ì— ìì„¸í•œ ë‚´ìš©ì´ ì í˜€ ìˆë‹¤ê³  í•˜ì—¬ ë§ˆì§€ë§‰ ë¶€ë¶„ê¹Œì§€ ì­‰ ì½ì–´ë³´ë‹ˆ ë©€ì›¨ì–´ ê³µê²©ê³¼ ê´€ë ¨ëœ ì‚¬ì´íŠ¸ë¥¼ í˜¸ìŠ¤íŒ…í•˜ê³  ìˆë‹¤ëŠ” ë‚´ìš©ì„ì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.í•´ë‹¹ ë§í¬ëŠ” apkíŒŒì¼ì„ ë‹¤ìš´ë°›ì„ ìˆ˜ ìˆëŠ” ë§í¬ë¡œì„œ, íšŒì‚¬ ë‚´ë¶€ ì§ì›ë“¤ì´ ì‰½ê²Œ ì•±ì„ ë‹¤ìš´ë°›ì„ ìˆ˜ ìˆë„ë¡ í•´ë‘” ë§í¬ì˜€ë‹¤.ë©”ì¼ì„ ë’¤ì ¸ë³´ë‹ˆ Netcraftë¼ëŠ” ê³³ì—ì„œ ë§í¬ë¥¼ í”¼ì‹± ë§í¬ë¡œ ì§€ì •í•˜ê³  í•´ë‹¹ ì„œë²„ì™€ ê´€ë ¨ëœ ê³³ì— ì•Œë¦¼ì„ ë³´ë‚¸ê²ƒìœ¼ë¡œ í™•ì¸ëë‹¤.ë§í¬ ë¹„í™œì„±í™”ë¬¸ì œëŠ” AWSê°€ ë§ˆì§€ë§‰ ë©”ì¼ì„ ë³´ë‚¸ ì´í›„ 24ì‹œê°„ ì•ˆì— ì¡°ì¹˜ë¥¼ ì·¨í•˜ê³  í•´ë‹¹ ë©”ì¼ì— ë‹µì‹ í•˜ì§€ ì•Šìœ¼ë©´ ê´€ë ¨ ë¦¬ì†ŒìŠ¤ë“¤ì„ ì„ì˜ë¡œ ì¢…ë£Œì‹œì¼œë²„ë¦´ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ì—ˆë‹¤.ì„œë²„ë¥¼ ìì„¸íˆ ë’¤ì ¸ë³¼ìˆ˜ ì—†ëŠ” ìƒí™©(ì—¬í–‰ì¤‘) ì´ì—ˆì§€ë§Œ ì‹œë§ì„œë¥¼ ì“°ê¸° ì‹«ì—ˆë˜ ë‚˜ëŠ” ë¶€ë´ë¶€ë´ ì„œë²„ë¡œ ì ‘ì†í•˜ì—¬ nginxë¡œ í•´ë‹¹ ë§í¬ë¡œ ì ‘ì†ì‹œ 404 ìƒíƒœê°’ì„ ë¦¬í„´í•˜ë„ë¡ ì„ì‹œë¡œ ì¡°ì¹˜í•˜ê³  AWSì— ì¡°ì¹˜ë¥¼ ì·¨í–ˆë‹¤ê³  ë‹µì‹ í•˜ì˜€ë‹¤.ì´ë²¤íŠ¸ ì¢…ë£Œë‹¤í–‰íˆ AWS ì—ì„œ ìš°ë¦¬ê°€ í•„ìš”í•œ ëª¨ë“  ì¡°ì¹˜ë¥¼ í–ˆë‹¤ê³  íŒë‹¨í•˜ê³  ì´ë²¤íŠ¸ë¥¼ ì¢…ë£Œì‹œì¼°ë‹¤.ì›ì¸ íŒŒì•…ì–¸ì œê¹Œì§€ê³  ë§í¬ë¥¼ ë¹„í™œì„±í™”í•œ ìƒíƒœë¡œ ë‘˜ìˆœ ì—†ì–´ì„œ ì¶œê·¼ í•˜ìë§ˆì ì›ì¸ íŒŒì•…ì— ë“¤ì–´ê°”ë‹¤. ë‚´ê°€ í™•ì¸í•´ ë´¤ë˜ê±´ ë‹¤ìŒê³¼ ê°™ë‹¤. ì„œë²„ ë¡œê·¸ì¸ ê¸°ë¡ íƒìƒ‰ ë¹„ì •ìƒ í”„ë¡œì„¸ìŠ¤ í™•ì¸ JADXë¡œ apkíŒŒì¼ ë””ì»´íŒŒì¼ clamavë¡œ ë©€ì›¨ì–´ íƒìƒ‰ AWS GuardDutyë¡œ ì¸ìŠ¤í„´ìŠ¤ ë³¼ë¥¨(EBS) ë©€ì›¨ì–´ íƒìƒ‰ì´ì¤‘ ë¬¸ì œê°€ ë°œê²¬ëœê³³ì€ ì•„ë¬´ê³³ë„ ì—†ì—ˆë‹¤.ê·¸ë˜ì„œ ë‹¤ì‹œ êµ¬ê¸€ë§ì„ í•´ë³´ë‹ˆ Netcraftê°€ ì˜ëª» íƒì§€í•˜ì—¬ ë§í¬ë¥¼ í”¼ì‹± ë§í¬ë¡œ ë“±ë¡í•œ ì‚¬ë¡€ë¥¼ ì–´ë µì§€ ì•Šê²Œ ì°¾ì•„ë³¼ ìˆ˜ ìˆì—ˆë‹¤.ê·¸ë˜ì„œ Netcraftì— ë”ë¸” ì²´í¬ë¥¼ ìš”ì²­í•˜ëŠ” ë©”ì¼ì„ ì „ì†¡í•˜ì˜€ê³  ê·¸ìª½ì—ì„œ ì˜ëª»ëœ ì¸ì‹ ì´ì—ˆìŒì„ ë™ì˜í•˜ê³  í›„ì²˜ë¦¬í–ˆë‹¤ëŠ” ë©”ì¼ì„ ë°›ì•„ë³¼ìˆ˜ ìˆì—ˆë‹¤.ì˜ë¬¸ì ë³´ì•„í•˜ë‹ˆ AWSê°€ Netcraft ì—ì„œ ë³´ë‚¸ ì•Œë¦¼ì„ ë°›ê³  ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•˜ì—¬ ìš°ë¦¬ì—ê²Œ ì•Œë¦¼ì„ ë³´ë‚¸ê²ƒ ê°™ë‹¤. ê·¸ëŸ°ë° ë¬¸ì œë¥¼ í•´ê²°í•œ ì‹œì ì— ë‹¤ì‹œ ë³´ë‹ˆ AWSëŠ” ë”°ë¡œ ë”ë¸”ì²´í¬í•˜ì§€ ì•Šì€ë“¯ í•˜ë‹¤.ì›ë˜ ì´ëŸ°ê°€ í•˜ì—¬ ì¢€ ì°¾ì•„ë³´ë‹ˆ GCP, OCI ë“±ì—ì„œë„ ì´ëŸ° ì‚¬ë¡€ê°€ ìˆëŠ”ê²ƒ ê°™ì•˜ë‹¤. ê·¸ë ‡ë‹¤ë©´ ì›¹ í˜¸ìŠ¤íŒ… ì—…ì²´ì—ì„œ ì§€ì •í•œ ë³´ì•ˆì—…ì²´(Netcraft ê°™ì€) ì—ì„œ ì•Œë¦¼ì„ ë°›ìœ¼ë©´ ì§„ìœ„ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì§€ ì•Šê³  ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•œë‹¤ëŠ” ë§ì´ ë˜ëŠ”ë° ë­”ê°€ ì¢€ ì´ìƒí–ˆë‹¤.ë³´ì•ˆì—…ì²´ì—ì„œ ì˜ëª»í•œ ê²½ìš° ì˜ëª»ëœ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë™ì•ˆ ì‹¤ìƒí™œì—ì„œ ë°œìƒí•œ ë˜ë‹¤ë¥¸ ë¬¸ì œëŠ” ëˆ„êµ¬ì—ê²Œ ì±…ì„ì„ ëŒë ¤ì•¼ í•˜ëŠ”ê°€?ê²°ë¡ ì´ ì¼€ì´ìŠ¤ì˜ ê²½ìš° í•´ë‹¹ ë§í¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ì‚¬ëŒì´ ë§ì§€ ì•Šê³  ì‚¬ëŒì´ ì§ì ‘ íŒŒì¼ì„ ì „ë‹¬í•˜ë©´ ë˜ê¸° ë•Œë¬¸ì— í° ë¬¸ì œì—†ì´ ë„˜ì–´ê°”ì§€ë§Œ ë§Œì•½ ì‚¬ìš©ìê°€ ë§ì•„ ë§í¬ë¥¼ ë¹„í™œì„±í™” í•  ìˆ˜ ì—†ëŠ” ìƒí™©ì´ë¼ë©´ ë”ì°í–ˆì„ê±° ê°™ì€ ìƒê°ì´ ë“ ë‹¤." }, { "title": "React custom hook return array vs object", "url": "/posts/react-hook-return-array-object/", "categories": "React", "tags": "React", "date": "2023-08-29 08:12:00 +0900", "snippet": "React custom hook return array vs object1. ê°œìš”ë¦¬ì•¡íŠ¸ ìì²´ì˜ í›…, ë˜ëŠ” ë¦¬ì•¡íŠ¸ ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì˜ í›…ì„ ì‚¬ìš©í•˜ë‹¤ ë³´ë©´ ë“œëŠ” ì˜ë¬¸ì ì´ í•˜ë‚˜ ìˆë‹¤.const [state, setState] = useState&lt;string&gt;('');const { table, selection } = useTable();ì–´ë–¤ í›…ì€ ë¦¬í„´íƒ€ì…ì´ ë°°ì—´ì´ê³ , ì–´ë–¤ í›…ì€ ë¦¬í„´íƒ€ì…ì´ ê°ì²´ì´ë‹¤. (ì—„ë°€íˆ ë”°ì§€ë©´ ë°°ì—´ë„ ê°ì²´ì´ê¸´ í•˜ì§€ë§Œ í¸ì˜ìƒ ê°ì²´ë¼ê³  í•˜ê² ë‹¤.)ì´ ë‘˜ì˜ ì°¨ì´ì ì„ ì‚´í´ë³´ì.2. ì°¨ì´ì ?ì–´ë–¤ê²ƒì„ ì„ íƒí•˜ë˜ í›…ì´ ìˆ˜í–‰í•˜ëŠ” í–‰ìœ„ì˜ ì°¨ì´ì ì€ ì—†ë‹¤.ë¦¬í„´íƒ€ì…ìœ¼ë¡œ ë°°ì—´ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ë™ì¼ í›…ì„ ê°™ì€ ì»´í¬ë„ŒíŠ¸ í•¨ìˆ˜ ë‚´ì—ì„œ Në²ˆ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ë°°ì—´ì€ ìˆœì„œì— ê¸°ë°˜í•˜ê¸° ë•Œë¬¸ì— ê°ì²´ í˜•íƒœì— ë¹„í•´ ì½”ë“œëŸ‰ì´ ì¤„ì–´ë“œëŠ” ì¥ì (?) ì´ ìˆë‹¤.ë§Œì•½ useState() í›…ì˜ ë¦¬í„´íƒ€ì…ì´ ê°ì²´ì˜€ë‹¤ë©´ ì–´ë• ì„ê¹Œ? ì•„ë˜ ì˜ˆì‹œë¥¼ ë³´ìconst { state: state1, setState: setState1 } = useState&lt;string&gt;('');const { state: state2, setState: setState2 } = useState&lt;string&gt;('');ë°°ì—´ ë°©ì‹ì— ë¹„í•´ ëœ ê¹”ë”í•˜ì§€ ì•Šì€ê°€? í›…ì´ Në²ˆ ì‚¬ìš©ë  ê²½ìš° ê°ì²´ ë¹„êµ¬ì¡°í™” í• ë‹¹ì‹œ ìœ„ì™€ê°™ì´ ë³„ì¹­ì„ ì‚¬ìš©í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì´ë‹¤. ì´ê²ƒì´ ë¦¬ì•¡íŠ¸ ì €ìë“¤ì´ useState() í›…ì˜ ë¦¬í„´ íƒ€ì…ì„ ë°°ì—´ë¡œ ì§€ì •í•œ ì´ìœ ì´ë‹¤.ë¬¼ë¡  ì´ê²ƒì´ í•­ìƒ í›…ì´ ë¦¬í„´íƒ€ì…ìœ¼ë¡œ ë°°ì—´ì„ ì‚¬ìš©í•´ì•¼ í•¨ì„ ì˜ë¯¸í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. í›…ì´ ë¦¬í„´í•˜ëŠ” ê°’ì˜ ê°¯ìˆ˜ê°€ ë§ì„ìˆ˜ë¡ ë°°ì—´ì€ ì í•©í•˜ì§€ ì•Šë‹¤.ì–´ë–¤ í›…ì˜ ë¦¬í„´íƒ€ì…ì´ ë°°ì—´ì´ê³  ê·¸ ë°°ì—´ì´ í¬í•¨í•˜ê³  ìˆëŠ” ê°’ì´ 5ê°œë¼ê³  ê°€ì •í•˜ê³  ê°œë°œìëŠ” ë°°ì—´ì˜ ì²«ë²ˆì§¸ ì†ì„±ê³¼ ë§ˆì§€ë§‰ ì†ì„±ë§Œ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •í•˜ì. ìš°ë¦¬ëŠ” í›…ì˜ ëª¨ë“  ì†ì„±ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹˜ì—ë„ ë°°ì—´ì˜ êµ¬ì¡°ì  íŠ¹ì„±ìƒ ë³€ìˆ˜ë¥¼ í• ë‹¹í•´ì•¼ í•œë‹¤.const [v1, _1, _2, _3, v2] = useCustomHook();ìœ„ì™€ê°™ì´ ì‹¤ì œ ì‚¬ìš©í•˜ëŠ” ì†ì„±ì€ v1, v2 ì„ì—ë„ ìˆœì„œë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ ë¶ˆí•„ìš”í•œ ë³€ìˆ˜ë¥¼ í• ë‹¹í•´ì•¼ í•˜ëŠ” ê²ƒì´ë‹¤.3. ê·¸ë˜ì„œ?ê³µì‹ ë¬¸ì„œ ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„¤ëª…í•˜ê³  ìˆë‹¤. Unlike a React component, a custom Hook doesnâ€™t need to have a specific signature. We can decide what it takes as arguments, and what, if anything, it should return. In other words, itâ€™s just like a normal function. Its name should always start with use so that you can tell at a glance that the rules of Hooks apply to it.ê·¸ëƒ¥ ì‚¬ìš©í•˜ëŠ” ìš©ë„ì— ë”°ë¼ ì„ íƒí•˜ë¼ê³  ì„¤ëª…ë˜ì–´ ìˆë‹¤.ë”°ë¼ì„œ ë³¸ì¸ì€ ë‹¤ìŒê³¼ ê°™ì€ ë£°ì„ ì •í•˜ì—¬ ê°œë°œí•˜ê³  ìˆë‹¤. ê°™ì€ í›…ì´ ë™ì¼í•œ ì»´í¬ë„ŒíŠ¸ ë‚´ì—ì„œ Në²ˆ ì‚¬ìš©ëœë‹¤ë©´ ë¦¬í„´íƒ€ì…ìœ¼ë¡œ ë°°ì—´ì„ ì‚¬ìš©í•œë‹¤. í›…ì´ ë¦¬í„´í•˜ëŠ” ê°’ì˜ ê°¯ìˆ˜ê°€ 3ê°œë¥¼ ë„˜ì–´ê°€ë©´ ë¦¬í„´íƒ€ì…ìœ¼ë¡œ ê°ì²´ë¥¼ ì‚¬ìš©í•œë‹¤.ì–´ë–¤ ê¸€ì„ ë´ë„ ìœ„ ì£¼ì œì—ëŠ” ë”±íˆ ì •ë‹µì´ë„ê²Œ ì—†ì–´ ë³´ì¸ë‹¤. ê°œë°œìê°€ í™•ì‹¤í•œ ê·œì¹™ì„ ê°–ê³  í›…ì„ ê°œë°œí•œë‹¤ë©´, ê³§ ê·¸ê²ƒì´ ì •ë‹µì´ ì•„ë‹ê¹Œ?" }, { "title": "Sticky Session - AWS ì—ì„œ ì„¤ì •í•˜ê¸°", "url": "/posts/aws-application-load-balancer-sticky-session/", "categories": "AWS", "tags": "AWS, Application Load Balancer, SAML", "date": "2023-07-03 08:12:00 +0900", "snippet": "Sticky Session1. ê°œìš”ìµœê·¼ ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ ë¡œê·¸ì¸ ì²˜ë¦¬ë¥¼ ì—°ë™í•´ì•¼í•  ì¼ì´ ìˆì—ˆëŠ”ë°, í•´ë‹¹ ì‹œìŠ¤í…œì€ SAMLê¸°ë°˜ ì¸ì¦ ë°©ì‹ ì„ ì‚¬ìš©í•˜ê³  ìˆì—ˆë‹¤.ì¹´ì¹´ì˜¤, ë„¤ì´ë²„, êµ¬ê¸€ë“±ì€ ë¡œê·¸ì¸ì„ Oauth 2.0 ê¸°ë°˜ì˜ ì‚¬ìš©ì ì¸ì¦ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ”ë°, ê°œì¸ì ìœ¼ë¡œëŠ” SAML ì¸ì¦ ë°©ì‹ì€ ì²˜ìŒ ì ‘í•´ë´¤ë‹¤.ê°€ì´ë“œ ë¬¸ì„œê°€ ì˜ ë˜ì–´ ìˆì–´ì„œ ê°œë°œí™˜ê²½ / í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œëŠ” ë¬¸ì œì—†ì´ ê°œë°œ ë° í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í–ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë¼ì´ë¸Œ ì„œë²„ì— ë°°í¬í–ˆì„ë•Œ ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.ì§§ì§€ ì•Šì€ ì‹œê°„ë™ì•ˆ ë™ë™ ì•“ë‹¤ê°€ ì–´ëŠìˆœê°„ ë¨¸ë¦¬ë¥¼ ìŠ¤ì¹˜ë“¯ í•œ ìƒê°ì´ ì§€ë‚˜ê°”ë‹¤.ì„¸ì…˜ ì¸ì¦ ë°©ì‹ì„ ì‚¬ìš©í•˜ê³  ìˆì–´ ìš”ì²­ / ì‘ë‹µí•˜ëŠ” ì„œë²„ê°€ ë‹¤ë¥´ë©´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤? ë¼ëŠ” ìƒê°ì´ë‹¤. ì‹¤ì œë¡œ í™•ì¸í•´ë³´ë‹ˆ, A ì¸ìŠ¤í„´ìŠ¤ê°€ ìš”ì²­í•œ ì¸ì¦ì„ B ì¸ìŠ¤í„´ìŠ¤ê°€ ë°›ì•„ì„œ ì²˜ë¦¬í•˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.ê·¸ë ‡ë‹¤ë©´ ë§Œì•½ ìµœì´ˆ ì ‘ì†ì„ A ì¸ìŠ¤í„´ìŠ¤ë¡œ í•˜ì˜€ë‹¤ë©´ ê·¸ ì´í›„ì˜ ëª¨ë“  ìš”ì²­ì€ A ì¸ìŠ¤í„´ìŠ¤ë¡œ ë¼ìš°íŒ… ë  ìˆ˜ ìˆë„ë¡ ì¡°ì¹˜ê°€ í•„ìš”í•˜ë‹¤. ì´ë•Œ í•„ìš”í•œ ê²ƒì´ Sticky Session ê¸°ëŠ¥ì´ë‹¤. nginxë¡œ ì¹˜ë©´ ip_hashì™€ ë¹„ìŠ·í•˜ë‹¤ê³  ë³¼ ìˆ˜ ìˆê² ë‹¤.ë¼ì´ë¸Œ ì„œë²„ëŠ” Application Load Balancerë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ”ë° ë‹¤í–‰íˆ ì„¤ì • í•˜ë‚˜ë¡œ Sticky Session ì„¤ì •ì´ ê°€ëŠ¥í•˜ë‹¤.2. ì™œ ë°œìƒí•˜ì§€? :exclamation: ê°œì¸ì ìœ¼ë¡œ ê¸°ì–µì„ ì •ë¦¬í•˜ê¸° ìœ„í•œ ë¬¸ë‹¨ì…ë‹ˆë‹¤. ê¶ê¸ˆí•˜ì§€ ì•Šìœ¼ì‹  ë¶„ë“¤ì€ ë‹¤ìŒ ë¬¸ë‹¨ìœ¼ë¡œ ë„˜ì–´ê°€ ì£¼ì„¸ìš”.ê·¼ë° ë­”ê°€ ì´ìƒí•˜ë‹¤. SAML í† í°ì—ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì„œëª…(signature)ì´ í¬í•¨ë˜ì–´ ìˆì–´ í† í°ì˜ ë¬´ê²°ì„±ì„ ë³´ì¥í•œë‹¤. ë”°ë¼ì„œ ìš”ì²­ ì„œë²„ì™€ ì‘ë‹µ ì„œë²„ê°€ ë‹¤ë¥´ë”ë¼ë„ ì„œëª… ê²€ì¦ì„ í†µí•´ SAML í† í°ì˜ ìœ íš¨ì„±ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. (í™•ì‹¤í•˜ì§€ ì•ŠìŒâ€¦)ë¬¼ë¡  ì´ë¥¼ ìœ„í•´ì„  ìš”ì²­ ì„œë²„ì™€ ì¸ì¦ ì„œë²„ê°„ ì ì ˆí•œ í‚¤ or ì¸ì¦ì„œ ê³µìœ ê°€ ì´ë£¨ì–´ì ¸ì•¼ í•œë‹¤. ë‚˜ì˜ ê²½ìš° ì´ëŸ¬í•œ í‚¤ë¥¼ ì „ë‹¬ë°›ì•„ ì ìš©í•œ ìƒíƒœì˜€ë‹¤.ê·¸ëŸ°ë°ë„ ì—ëŸ¬ê°€ ë°œìƒí•´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½”ë“œë¥¼ ê¹Œë´¤ë‹¤. ê¹Œë³´ë‹ˆ ì´ìœ ë¥¼ ì°¾ì„ìˆ˜ ìˆì—ˆë‹¤. ì¸ì¦ ìš”ì²­ì‹œ message ìƒì„±í›„ Map í˜•íƒœì˜ LocalStorage classì— ë°ì´í„° ì €ì¥í›„ ì¸ì¦ ìš”ì²­ ì¸ì¦ ì„±ê³µí›„ ì¸ì¦ ì •ë³´ íŒŒì‹±ì‹œ LocalStorage classì—ì„œ ë°ì´í„° ê²€ìƒ‰ ì¸ìŠ¤í„´ìŠ¤ê°€ ë‹¤ë¥´ë‹ˆ ë‹¹ì—°íˆ ê°ê°ì˜ ì¸ìŠ¤í„´ìŠ¤ì— LocalStorageê°€ ì¡´ì¬í•¨ A ì¸ìŠ¤í„´ìŠ¤ì— ì €ì¥ëœ ì •ë³´ë¥¼ B ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì°¾ê³ ì í•˜ë‹ˆ ì—ëŸ¬ ë°œìƒì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” 2010ë…„ëŒ€ ì´ˆë°˜ì— ë§Œë“¤ì–´ì§„ë“¯ í•œë°, ê·¸ë•ŒëŠ” ì„œë²„ë¥¼ ì´ì¤‘í™”ë¡œ êµ¬ì„±í•˜ì§€ ì•Šì•˜ë‚˜? ì˜ ëª¨ë¥´ê² ë‹¤â€¦ ì–´ì¨Œê±°ë‚˜ ëª…í™•í•œ ë¬¸ì œë¥¼ ì°¾ì•„ì„œ ì†ì´ ì‹œì›í–ˆë‹¤.3. AWS ì—ì„œ Sticky Session ì„¤ì •í•˜ê¸°ìœ„ì—ì„œ ë§í–ˆë‹¤ì‹œí”¼ í˜„ì¬ ì„œë¹„ìŠ¤ëŠ” Application Load Balancerì„ ì‚¬ìš©í•˜ê³  ìˆì—ˆê³ , ë‹¤í–‰íˆ ê°„ë‹¨í•œ ì„¤ì •ìœ¼ë¡œ Sticky Sessionì„ ì„¤ì •í•  ìˆ˜ ìˆì—ˆë‹¤.Sticky Sessionì€ ë¡œë¸Œë°¸ëŸ°ì„œê°€ ì•„ë‹Œ ëŒ€ìƒ ê·¸ë£¹ ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.ëŒ€ìƒ ê·¸ë£¹ -&gt; íƒ€ê²Ÿ -&gt; ì†ì„± -&gt; í¸ì§‘ ìˆœìœ¼ë¡œ ì´ë™í•˜ì.í¸ì§‘ í˜ì´ì§€ì— ë“¤ì–´ì™”ìœ¼ë©´ ëŒ€ìƒ ì„ íƒ êµ¬ì„± í•­ëª©ì„ ì°¾ì„ ìˆ˜ ìˆë‹¤.ì˜µì…˜ì„ í™œì„±í™” í•˜ê³  ê³ ì • ìœ í˜•ì„ ë¡œë“œ ë°¸ëŸ°ì„œ ìƒì„± ì¿ í‚¤ë¡œ ì„ íƒí•œë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ë°˜ ì¿ í‚¤ë¥¼ ì„ íƒí•œë‹¤ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì—ì„œ ì²˜ë¦¬ë¥¼ í•´ì¤˜ì•¼ í•˜ê¸° ë•Œë¬¸ì— ê·€ì°®ë‹¤.ì ë‹¹í•œ ê³ ì • ì§€ì† ì‹œê°„ì„ ì„ íƒí•œë‹¤. ì˜ˆë¥¼ë“¤ì–´ 1ì¼ë¡œ ì§€ì •í–ˆë‹¤ë©´ ì˜¤ëŠ˜ 10ì‹œì— ì‚¬ìš©ìì˜ ìš”ì²­ì´ ë¡œë“œë°¸ëŸ°ì„œë¥¼ í†µí•´ A ì¸ìŠ¤í„´ìŠ¤ë¡œ í˜ëŸ¬ ë“¤ì–´ê°”ë‹¤ë©´ ë‚´ì¼ 10ì‹œê¹Œì§€ëŠ” í•´ë‹¹ ì‚¬ìš©ìì˜ ëª¨ë“  ìš”ì²­ì€ A ì¸ìŠ¤í„´ìŠ¤ë¡œ í˜ëŸ¬ ë“¤ì–´ê°€ê²Œ ëœë‹¤.ì €ì¥í•˜ë©´ ì™„ë£Œë‹¤. ì •ë§ ê°„ë‹¨í•˜ê²Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.ìœ„ì™€ê°™ì´ ìš”ì²­ì— AWSALB, AWSALBCORS ë¼ëŠ” ì´ë¦„ì˜ ì¿ í‚¤ê°€ ìˆë‹¤ë©´ ì„±ê³µì´ë‹¤. ê°€ì¥ í™•ì‹¤í•œ ë°©ë²•ì€ ì–´ë–¤ ì¸ìŠ¤í„´ìŠ¤ì¸ì§€ í™•ì¸í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ë§Œë“¤ê³  ë°°í¬í•˜ì—¬ í™•ì¸í•´ë³´ëŠ” ê²ƒì´ë‹¤.4. ê²°ë¡ Sticky Sessionì€ íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ í•­ìƒ ë™ì¼í•œ ì„œë²„ë¡œ ë³´ë‚´ê¸° ë•Œë¬¸ì— ì¼ë¶€ ì„œë²„ì— ë¶€í•˜ê°€ ì§‘ì¤‘ë  ìˆ˜ ë°–ì— ì—†ë‹¤.ì´ë¥¼ ì‚¬ìš©í•˜ëŠ” ë„ì¤‘ ì„œë²„ì— ì¥ì• ê°€ ë°œìƒí•˜ê±°ë‚˜ ë‹¤ìš´ë˜ë©´ í•´ë‹¹ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì€ ë‹¤ë¥¸ ì„œë²„ë¡œ ì „ë‹¬ë˜ì§€ ëª»í•˜ê³  ì„œë¹„ìŠ¤ ì¤‘ë‹¨ í˜„ìƒì´ ë°œìƒí•  ìˆ˜ ìˆì–´ ì „ì²´ ì‹œìŠ¤í…œì˜ ì„±ëŠ¥ ì €í•˜ë¥¼ ì•¼ê¸°í•  ìˆ˜ ìˆë‹¤.ê·¸ëŸ¬ë‚˜ ë‚˜ë¡œì„œëŠ” ê¸‰í•œ ìƒí™©ì´ë¼ ì„ íƒì§€ê°€ ì—†ì—ˆê³ , ì–´ì©”ìˆ˜ ì—†ì´ ì ìš©í•˜ê²Œ ë˜ì—ˆë‹¤.ì•„ì˜ˆ ë³„ë„ì˜ ë„ë©”ì¸ê³¼ ë³„ë„ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë„ì›Œ ì¥ì• ê°€ ë°œìƒí•˜ë”ë¼ë„ ê¸°ì¡´ ì‹œìŠ¤í…œì— ì˜í–¥ì„ ì£¼ì§€ ì•Šë„ë¡ í•˜ê³  ì‹¶ì—ˆì§€ë§Œ ë¬¸ì œëŠ” ëˆì´ì§€â€¦ì„œë²„ ë¹„ìš©ì„ ì•„ì˜ˆ ì‹ ê²½ ì•ˆì“¸ìˆœ ì—†ê² ì§€ë§Œ ì‹œìŠ¤í…œì˜ ì•ˆì •ì„±ì„ ìœ„í•´ì„œë¼ë„ ë¶„ë¦¬ í• ê»€ í•˜ê³  ëˆ ë‚¼ê»€ ë‚´ì£¼ë©´ ì¢‹ê² ë‹¤. (ì´ì§í•˜ì)" }, { "title": "FFI", "url": "/posts/ffi/", "categories": "FFI", "tags": "FFI, Java", "date": "2023-06-12 08:12:00 +0900", "snippet": "FFI1. ê°œìš”FFIëŠ” Foreign Function Interfaceì˜ ì•½ìì…ë‹ˆë‹¤. ì´ëŠ” ì–´ë–¤ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì„¸ì„œ ë‹¤ë¥¸ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.FFIëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì„œë¡œ ë‹¤ë¥¸ ì–¸ì–´ ê°„ì— ìƒí˜¸ ìš´ìš©ì„±(interoperability)ì„ ì œê³µí•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤. í”„ë¡œê·¸ë˜ë° ì–¸ì–´ ê°„ì—ëŠ” ë‹¤ì–‘í•œ ê·œì¹™ê³¼ ë°ì´í„° í˜•ì‹ì´ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì—, ë‹¤ë¥¸ ì–¸ì–´ë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ í•¨ìˆ˜ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ê²ƒì€ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ° ê²½ìš°ì— FFIë¥¼ ì‚¬ìš©í•˜ì—¬ í•¨ìˆ˜ í˜¸ì¶œ ë° ë°ì´í„° ì „ë‹¬ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.FFIëŠ” ì¼ë°˜ì ìœ¼ë¡œ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì˜ ì»´íŒŒì¼ëŸ¬ë‚˜ ì¸í„°í”„ë¦¬í„°ì—ì„œ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì´ë©°, ì–¸ì–´ì— ë”°ë¼ êµ¬í˜„ ë°©ì‹ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, C ì–¸ì–´ì—ì„œëŠ” FFIë¥¼ í†µí•´ ë‹¤ë¥¸ ì–¸ì–´ì˜ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê±°ë‚˜ C í•¨ìˆ˜ë¥¼ ë‹¤ë¥¸ ì–¸ì–´ì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Javaì—ì„œëŠ” JNI(Java Native Interface)ë¼ëŠ” FFIë¥¼ ì œê³µí•˜ì—¬ Cë‚˜ C++ë¡œ ì‘ì„±ëœ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.FFIëŠ” ë‹¤ë¥¸ ì–¸ì–´ë‚˜ í”Œë«í¼ì— êµ¬ì• ë°›ì§€ ì•Šê³  ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ì¤‘ìš”í•œ ë„êµ¬ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë‹¤ë¥¸ ì–¸ì–´ë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì¥ì ì„ í™œìš©í•˜ë©´ì„œë„ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì˜ ìƒì‚°ì„±ê³¼ íš¨ìœ¨ì„±ì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.2. ìë°”ì—ì„œì˜ FFIìë°”ì—ì„œ FFIë¥¼ êµ¬í˜„í•˜ë ¤ë©´ JNI(Java Native Interface)í˜¹ì€ JNA(Java Native Access) ë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤. ë‘ê°€ì§€ ë°©ë²•ì€ ê°ê° ì¥ë‹¨ì ì´ ìˆìœ¼ë©° ë‹¤ìŒê³¼ ê°™ì€ ì°¨ì´ì ì´ ìˆìŠµë‹ˆë‹¤.1. JNI (Java Native Interface)JNIëŠ” ë„¤ì´í‹°ë¸Œ ì½”ë“œì™€ ì§ì ‘ì ìœ¼ë¡œ ìƒí˜¸ ì‘ìš©í•˜ê¸° ë•Œë¬¸ì— ë§¤ìš° ë›°ì–´ë‚œ ì„±ëŠ¥ì„ ì œê³µ í•©ë‹ˆë‹¤. ë„¤ì´í‹°ë¸Œ ì½”ë“œì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ ìë°”ì™€ C/C++ ì‚¬ì´ì˜ ì§ì ‘ì ì¸ ë§¤í•‘ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.JNIë¥¼ ì‚¬ìš©í•˜ë©´ ìë°”ì—ì„œ ë„¤ì´í‹°ë¸Œ ì½”ë“œì— ì§ì ‘ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ê³  ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì„±ëŠ¥ì´ ì¤‘ìš”í•˜ê±°ë‚˜ ë³µì¡í•œ ë°ì´í„° êµ¬ì¡°ë¥¼ ë‹¤ë£° ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.JNIëŠ” ë³µì¡í•œ êµ¬í˜„ì´ í•„ìš”í•˜ë©°, ë„¤ì´í‹°ë¸Œ ì½”ë“œì™€ ìë°” ì‚¬ì´ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ê°œë°œ ê³¼ì •ì´ ë²ˆê±°ë¡œìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.JNIëŠ” í”Œë«í¼ì— ì¢…ì†ì ì…ë‹ˆë‹¤. ë„¤ì´í‹°ë¸Œ ì½”ë“œì˜ ì»´íŒŒì¼ì´ í•„ìš”í•˜ë©°, íŠ¹ì • í”Œë«í¼ì— ë§ì¶°ì•¼ í•©ë‹ˆë‹¤.JNIëŠ” ì§ì ‘ C ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë”°ë¡œ ì˜ˆì œì½”ë“œë¥¼ ì‘ì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.2. JNA (Java Native Access)JNAëŠ” ë„¤ì´í‹°ë¸Œ ì½”ë“œì™€ ìë°” ê°„ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. ë³„ë„ì˜ ë„¤ì´í‹°ë¸Œ í—¤ë” íŒŒì¼ì„ ì‘ì„±í•  í•„ìš” ì—†ì´, ìë°” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì„ ì–¸í•˜ê³  JNAê°€ ìë™ìœ¼ë¡œ ë§¤í•‘ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.JNAëŠ” í”Œë«í¼ì— ë…ë¦½ì ì…ë‹ˆë‹¤. ë„¤ì´í‹°ë¸Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë“œí•˜ê³  ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ë©°, í”Œë«í¼ì— ì¢…ì†ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.JNIì— ë¹„í•´ JNAëŠ” ì•½ê°„ì˜ ì„±ëŠ¥ ì†ì‹¤ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. JNAëŠ” ë™ì  ë¼ì´ë¸ŒëŸ¬ë¦¬ ë§¤í•‘ê³¼ ì¶”ê°€ì ì¸ ì˜¤ë²„í—¤ë“œë¥¼ í¬í•¨í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.public class HelloController { public interface User32 extends Library { User32 INSTANCE = (User32) Native.load(\"user32\", User32.class); int MessageBoxA(int hWnd, String lpText, String lpCaption, int uType); } @FXML protected void onHelloButtonClick() { User32.INSTANCE.MessageBoxA(0, \"Hello from Java!\", \"MessageBox Example\", 0); }}ê°„ë‹¨í•œ ì˜ˆì œì…ë‹ˆë‹¤. ëª‡ì¤„ë˜ì§€ ì•ŠëŠ” ì½”ë“œë¡œ ë²„íŠ¼ í´ë¦­ì‹œ Win32 API - MessageBoxA í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ê·¸ë˜ì„œ?JNIì™€ JNAëŠ” ê°ê°ì˜ ìƒí™©ê³¼ ìš©ë„ì— ë”°ë¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤. ì„±ëŠ¥ê³¼ ì§ì ‘ ë©”ëª¨ë¦¬ ì ‘ê·¼ì´ ì¤‘ìš”í•œ ê²½ìš°ì—ëŠ” JNIê°€ ì í•©í•˜ë©°, í”Œë«í¼ ë…ë¦½ì„±ê³¼ ê°œë°œ í¸ì˜ì„±ì´ ì¤‘ìš”í•œ ê²½ìš°ì—ëŠ” JNAë¥¼ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." }, { "title": "DB ë·°(View)", "url": "/posts/database-view/", "categories": "Database", "tags": "Database, PostgreSQL", "date": "2023-05-23 08:12:00 +0900", "snippet": "1. ê°œìš”ë°ì´í„°ë² ì´ìŠ¤ ë·°ëŠ” í˜„ëŒ€ì˜ ë°ì´í„° ì¤‘ì‹¬ ì‹œìŠ¤í…œì—ì„œ í•„ìˆ˜ì ì¸ ìš”ì†Œë¡œ ìë¦¬ì¡ì•˜ìŠµë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ ë·°ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©ìë“¤ì—ê²Œ í¸ë¦¬í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ê³ , ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì¡°ì‘í•˜ê³  ê²€ìƒ‰í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. íŠ¹íˆ, PostgreSQLê³¼ ê°™ì€ ê°•ë ¥í•œ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ë·°ëŠ” ë§¤ìš° ìœ ìš©í•œ ë„êµ¬ì…ë‹ˆë‹¤.ë°ì´í„°ë² ì´ìŠ¤ ë·°ë€ ë¬´ì—‡ì¼ê¹Œìš”? ê°„ë‹¨í•˜ê²Œ ë§í•˜ë©´, ë·°ëŠ” í•˜ë‚˜ ì´ìƒì˜ í…Œì´ë¸”ì—ì„œ íŒŒìƒëœ ê°€ìƒì˜ í…Œì´ë¸”ì…ë‹ˆë‹¤. ì¦‰, ì‹¤ì œë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ì§€ ì•Šê³ , ê¸°ì¡´ì˜ í…Œì´ë¸”ì—ì„œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê±°ë‚˜ ê°€ê³µí•˜ì—¬ ë³´ì—¬ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. ë·°ëŠ” ì¿¼ë¦¬ì˜ ê²°ê³¼ë¥¼ ë¯¸ë¦¬ ì •ì˜ëœ êµ¬ì¡°ë¡œ í‘œì‹œí•˜ê³  í•„ìš”í•œ ì¡°ê±´ì— ë”°ë¼ ë°ì´í„°ë¥¼ ì œí•œí•˜ëŠ” ë“±ì˜ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.2. ë·°ì˜ ì¥ì 1. ë³µì¡í•œ ì¿¼ë¦¬ ë‹¨ìˆœí™”ë³µì¡í•œ ì¡°ì¸ì´ë‚˜ ê³„ì‚°ì´ í•„ìš”í•œ ì¿¼ë¦¬ë¥¼ ë¯¸ë¦¬ ì •ì˜ëœ ë·°ë¡œ ëŒ€ì²´í•¨ìœ¼ë¡œì¨, ì‚¬ìš©ìëŠ” ê°„ë‹¨í•œ ì¿¼ë¦¬ë§Œ ì‘ì„±í•˜ì—¬ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ê³  ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ê°œë°œìì™€ ë°ì´í„° ë¶„ì„ê°€ê°€ ì‘ì—…ì„ ë”ìš± íš¨ìœ¨ì ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.2. ë°ì´í„°ì˜ ë³´ì•ˆê³¼ ì ‘ê·¼ ì œì–´ ê°•í™”ë·°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ í•„ìš”í•œ ë°ì´í„°ë§Œ ë…¸ì¶œí•˜ê³ , ë¯¼ê°í•œ ì •ë³´ë¥¼ ìˆ¨ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ì˜ ë³´ì•ˆ ì •ì±…ì„ ë”ìš± ê°•ë ¥í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìœ¼ë©°, ì ‘ê·¼ ê¶Œí•œì„ í†µí•´ íŠ¹ì • ì‚¬ìš©ì ë˜ëŠ” ì—­í• ì—ê²Œë§Œ ë·°ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.3. ë°ì´í„°ì˜ ì¼ê´€ì„±ê³¼ ì¤‘ë³µì„±ì„ ê´€ë¦¬í•˜ëŠ”ë° ë„ì›€ì´ ë¨ì—¬ëŸ¬ í…Œì´ë¸”ì—ì„œ ë™ì¼í•œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ì•¼ í•  ë•Œ, ë·°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¤‘ë³µ ë°ì´í„°ë¥¼ í”¼í•˜ê³  ì¼ê´€ëœ ë°ì´í„°ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ê³ , ë°ì´í„°ì˜ ë³€ê²½ì´ í•„ìš”í•œ ê²½ìš° ë·°ë§Œ ìˆ˜ì •í•˜ë©´ ë˜ë¯€ë¡œ ìœ ì§€ ë³´ìˆ˜ì™€ ê´€ë¦¬ì˜ í¸ì˜ì„±ì„ ë†’ì…ë‹ˆë‹¤.3. ë·°ì˜ ë‹¨ì 1. ì„±ëŠ¥ë·°ëŠ” ê°€ìƒì˜ í…Œì´ë¸”ë¡œì¨, ì‹¤ì œ ë°ì´í„°ë¥¼ í¬í•¨í•˜ê³  ìˆì§€ ì•Šìœ¼ë©° ì¿¼ë¦¬ ì‹¤í–‰ ì‹œ ì‹¤ì œ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ì—¬ ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ë³µì¡í•œ ë·°ì˜ ê²½ìš° ì„±ëŠ¥ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ, ë·°ì— ëŒ€í•œ ì¿¼ë¦¬ê°€ ë³µì¡í•˜ê±°ë‚˜ ë°ì´í„° ì–‘ì´ ë§ì€ ê²½ìš°ì—ëŠ” ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.2. ë³µì¡ì„±ë·°ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œì˜ êµ¬ì¡°ë¥¼ ë³µì¡í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ëŸ¬ í…Œì´ë¸”ì„ ì¡°í•©í•˜ê³  ì¡°ì¸í•˜ì—¬ ë·°ë¥¼ ìƒì„±í•˜ëŠ” ê²½ìš°, ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆê°€ ë³µì¡í•´ì§€ê³  ì´í•´í•˜ê¸° ì–´ë ¤ì›Œì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ë·° ìì²´ê°€ ë‹¤ë¥¸ ë·°ì— ì˜ì¡´í•˜ëŠ” ê²½ìš°, ë³€ê²½ ì‚¬í•­ì„ ì¶”ì í•˜ê³  ìœ ì§€ ê´€ë¦¬í•˜ê¸°ê°€ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.3. ì—…ë°ì´íŠ¸ ì œí•œì¼ë¶€ ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œì—ì„œëŠ” ë·°ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒì„ ì œí•œí•©ë‹ˆë‹¤. ë·°ê°€ ì—¬ëŸ¬ í…Œì´ë¸”ì˜ ì¡°í•©ì´ê±°ë‚˜ íŠ¹ì • ì¡°ê±´ì— ë”°ë¼ ë°ì´í„°ë¥¼ í•„í„°ë§í•˜ëŠ” ê²½ìš°, ë·°ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì§ì ‘ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš°ì—ëŠ” ëŒ€ì‹  ë·°ë¥¼ êµ¬ì„±í•˜ëŠ” ì›ë³¸ í…Œì´ë¸”ì„ ì§ì ‘ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤.4. PostgreSQLì—ì„œ ë·° ìƒì„±í•˜ê¸°PostgreSQLì—ì„œ ë·°ë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•ì€ ê°„ë‹¨í•©ë‹ˆë‹¤.1. CREATE VIEW ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ë·° ìƒì„±PostgreSQLì—ì„œëŠ” CREATE VIEW ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ë·°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì•„ë˜ì˜ í˜•ì‹ì„ ë”°ë¼ ë·°ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.CREATE VIEW view_name ASSELECT column1, column2, ...FROM table1WHERE condition; view_name: ìƒì„±í•  ë·°ì˜ ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤. column1, column2, ...: ë·°ì—ì„œ í‘œì‹œí•  ì—´ì˜ ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤. í•„ìš”ì— ë”°ë¼ í…Œì´ë¸”ì˜ ì—´ì´ë‚˜ ê³„ì‚°ëœ ì—´ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. table1: ë·°ë¥¼ ìƒì„±í•  ê¸°ë°˜ì´ ë˜ëŠ” í…Œì´ë¸”ì˜ ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤. WHERE condition: ë·°ì— ì ìš©í•  ì„ íƒì ì¸ ì¡°ê±´ì„ ì§€ì •í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ íŠ¹ì • ë°ì´í„°ë§Œ ë·°ì— í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì˜ˆë¥¼ ë“¤ì–´, employees í…Œì´ë¸”ë¡œë¶€í„° ì´ë¦„ê³¼ ì§ê¸‰ ì •ë³´ë§Œì„ í¬í•¨í•˜ëŠ” employee_viewë¼ëŠ” ë·°ë¥¼ ìƒì„±í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.CREATE VIEW employee_view ASSELECT name, titleFROM employees;2. ë·° ì‚¬ìš© ê¶Œí•œ ì„¤ì •ë·°ë¥¼ ìƒì„±í•œ í›„, í•´ë‹¹ ë·°ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ë·°ë¥¼ ìƒì„±í•œ ì‚¬ìš©ìê°€ í•´ë‹¹ ë·°ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ê°€ì§€ê²Œ ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë‹¤ë¥¸ ì‚¬ìš©ìë‚˜ ì—­í• ì—ê²Œë„ ë·°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ì£¼ê³  ì‹¶ë‹¤ë©´ GRANT ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ëª…ì‹œì ìœ¼ë¡œ í• ë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.employee_viewì— ëŒ€í•œ ì½ê¸° ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ user1 ì‚¬ìš©ìì—ê²Œ ì£¼ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•©ë‹ˆë‹¤.GRANT SELECT ON employee_view TO user1;3. ë·° ì‚¬ìš©ë·°ê°€ ìƒì„±ë˜ê³  ê¶Œí•œì´ ì„¤ì •ë˜ì—ˆë‹¤ë©´, í•´ë‹¹ ë·°ë¥¼ ì¿¼ë¦¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.SELECT * FROM employee_view;ë·°ë¥¼ ì‚¬ìš©í• ë•ŒëŠ” ëª‡ê°€ì§€ ì‚¬í•­ì„ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤. ë·°ëŠ” ê¸°ì¡´ì˜ í…Œì´ë¸”ì„ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ë˜ë¯€ë¡œ, ë·°ì— ëŒ€í•œ ë³€ê²½ì€ ì‹¤ì œ í…Œì´ë¸”ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤. ë·°ëŠ” ë°ì´í„°ë¥¼ ì €ì¥í•˜ì§€ ì•Šê³  ì‹¤ì‹œê°„ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ë¯€ë¡œ, ë·°ë¥¼ í†µí•´ ë³€ê²½ëœ ë°ì´í„°ëŠ” ì‹¤ì œ í…Œì´ë¸”ì— ë°˜ì˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë·°ëŠ” ë³µì¡í•œ ì¿¼ë¦¬ì˜ ë‹¨ìˆœí™”ë‚˜ ë°ì´í„°ì˜ ê°€ê³µì„ ìœ„í•´ ì‚¬ìš©ë˜ì§€ë§Œ, ì„±ëŠ¥ ì €í•˜ì˜ ê°€ëŠ¥ì„±ë„ ìˆìŠµë‹ˆë‹¤. í° ë°ì´í„°ì…‹ì´ë‚˜ ë³µì¡í•œ ì¡°ì¸ì´ ìˆëŠ” ê²½ìš° ì„±ëŠ¥ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.5. ë·°ì˜ ì‚¬ìš© ì‚¬ë¡€ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë·°ëŠ” ì‹¤ì œë¡œ ìœ ìš©í•˜ê²Œ í™œìš©ë©ë‹ˆë‹¤. ëª‡ê°€ì§€ ëŒ€í‘œì ì¸ ì‚¬ë¡€ë¥¼ ì†Œê°œí•˜ê³  ê°ê°ì— ëŒ€í•œ ì„¤ëª…ê³¼ ì‹¤ì œ ì¿¼ë¦¬ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.1. ë³µì¡í•œ ì¿¼ë¦¬ ë‹¨ìˆœí™”ë·°ë¥¼ ì‚¬ìš©í•˜ë©´ ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ë‹¨ìˆœí™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ëŸ¬ ê°œì˜ í…Œì´ë¸” ê°„ ì¡°ì¸ì´ í•„ìš”í•œ ì¿¼ë¦¬ë¥¼ ë¯¸ë¦¬ ì •ì˜ëœ ë·°ë¡œ ëŒ€ì²´í•˜ì—¬, ì‚¬ìš©ìëŠ” ê°„ë‹¨í•œ ì¿¼ë¦¬ë§Œ ì‘ì„±í•˜ì—¬ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì˜ˆë¥¼ ë“¤ì–´, ordersì™€ customers í…Œì´ë¸”ì´ ìˆì„ ë•Œ, ì£¼ë¬¸ ì •ë³´ì™€ ê³ ê° ì •ë³´ë¥¼ í•¨ê»˜ ì¡°íšŒí•˜ëŠ” ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ë·°ë¡œ ë‹¨ìˆœí™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.CREATE VIEW order_details ASSELECT o.order_id, o.order_date, c.customer_nameFROM orders oINNER JOIN customers c ON o.customer_id = c.customer_id;ì´ì œ order_details ë·°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°„ë‹¨í•˜ê²Œ ì£¼ë¬¸ ì •ë³´ì™€ ê³ ê° ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.SELECT * FROM order_details;2. ë°ì´í„° ë³´ì•ˆ ê°•í™”ë·°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ì˜ ë³´ì•ˆì„ ê°•í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¯¼ê°í•œ ì •ë³´ê°€ í¬í•¨ëœ í…Œì´ë¸”ì„ ì§ì ‘ ë…¸ì¶œí•˜ì§€ ì•Šê³ , í•„ìš”í•œ ì—´ë§Œ í¬í•¨í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì˜ˆë¥¼ ë“¤ì–´, employees í…Œì´ë¸”ì—ëŠ” ì—°ë´‰ ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì¼ë°˜ ì‚¬ìš©ìì—ê²ŒëŠ” ì—°ë´‰ ì •ë³´ë¥¼ ìˆ¨ê¸°ê³  ì´ë¦„ê³¼ ì§ê¸‰ ì •ë³´ë§Œì„ ì œê³µí•˜ê³  ì‹¶ë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë·°ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.CREATE VIEW employee_info ASSELECT name, titleFROM employees;ì´ì œ employee_info ë·°ë¥¼ í†µí•´ ì§ì›ì˜ ì´ë¦„ê³¼ ì§ê¸‰ ì •ë³´ë§Œì„ ì¡°íšŒí•  ìˆ˜ ìˆìœ¼ë©°, ì—°ë´‰ ì •ë³´ëŠ” ìˆ¨ê²¨ì ¸ ìˆìŠµë‹ˆë‹¤.3. ë°ì´í„° ê°€ê³µ ë° í˜•ì‹ ë³€í™˜ë·°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ê°€ê³µí•˜ê±°ë‚˜ í˜•ì‹ì„ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹ì • í˜•ì‹ìœ¼ë¡œ ë³€í™˜ëœ ë°ì´í„°ë¥¼ í•„ìš”ë¡œ í•˜ëŠ” ê²½ìš°, ë·°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›ë³¸ ë°ì´í„°ë¥¼ ë³€í™˜ëœ í˜•ì‹ìœ¼ë¡œ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì˜ˆë¥¼ ë“¤ì–´, sales í…Œì´ë¸”ì—ëŠ” ë‚ ì§œì™€ íŒë§¤ëŸ‰ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. íŠ¹ì • í˜•ì‹ìœ¼ë¡œ ë‚ ì§œë¥¼ í‘œì‹œí•˜ê³ ì í•  ë•Œ, ë·°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë³€í™˜ëœ ë‚ ì§œ í˜•ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.CREATE VIEW sales_summary ASSELECT TO_CHAR(sale_date, 'YYYY-MM-DD') AS formatted_date, quantityFROM sales;ì´ì œ sales_summary ë·°ë¥¼ í†µí•´ í˜•ì‹ì´ ë³€í™˜ëœ ë‚ ì§œì™€ íŒë§¤ëŸ‰ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.6. ì„±ëŠ¥ ê³ ë ¤ ì‚¬í•­ë°ì´í„°ë² ì´ìŠ¤ ë·°ëŠ” ìœ ìš©í•œ ë„êµ¬ì§€ë§Œ, ì˜ëª» ì‚¬ìš©í•˜ê±°ë‚˜ ì„¤ê³„í•˜ì§€ ì•Šìœ¼ë©´ ì„±ëŠ¥ ì €í•˜ì˜ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤. ì´ì œ ë°ì´í„°ë² ì´ìŠ¤ ë·°ë¥¼ ì‚¬ìš©í•  ë•Œ ê³ ë ¤í•´ì•¼ í•  ì„±ëŠ¥ ì¸¡ë©´ì— ëŒ€í•´ ë‹¤ë£¨ê³ , ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.1. ì¡°ì¸ê³¼ ì¿¼ë¦¬ ë³µì¡ì„±ë·°ë¥¼ ìƒì„±í•  ë•Œ ì¡°ì¸ ì—°ì‚°ì´ í¬í•¨ëœ ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¡°ì¸ì´ ë§ê±°ë‚˜ ë³µì¡í•œ ì¿¼ë¦¬ëŠ” ì²˜ë¦¬ ì‹œê°„ì„ ì¦ê°€ì‹œí‚¬ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, í•„ìš”í•œ ê²½ìš° ì¿¼ë¦¬ë¥¼ ìµœì í™”í•˜ê³  ì¸ë±ìŠ¤ë¥¼ í™œìš©í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì¸ë±ìŠ¤ í™œìš©: ë·°ì˜ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ ë·°ì— ì‚¬ìš©ëœ ì—´ì— ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì¡°ì¸ ì¡°ê±´ì´ë‚˜ í•„í„°ë§ ì¡°ê±´ì— ì‚¬ìš©ë˜ëŠ” ì—´ì— ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒê³¼ ë™ì¼í•œ ì›ë¦¬ì…ë‹ˆë‹¤. ë‹¹ì—°íˆ ë·° ìì²´ì— ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•  ìˆœ ì—†ìŠµë‹ˆë‹¤.2. ë·° ì¬ì‘ì„±ë°ì´í„°ë² ì´ìŠ¤ì˜ ê¸°ë³¸ í…Œì´ë¸”ì´ ë³€ê²½ë  ë•Œ, ë·°ì˜ ì •ì˜ë¥¼ ì¬ì‘ì„±í•˜ëŠ” ê²ƒì´ ì„±ëŠ¥ í–¥ìƒì— ë„ì›€ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³€ê²½ëœ ë°ì´í„°ì— ëŒ€í•œ ìµœì‹  ì •ë³´ë¥¼ ìœ ì§€í•˜ê³  ë·°ì˜ ì¿¼ë¦¬ ì‹¤í–‰ ê³„íšì„ ìµœì í™”í•˜ê¸° ìœ„í•´ ë·°ë¥¼ ì¬ì‘ì„±í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì¼ë¶€ ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œì€ ë·°ë¥¼ ìë™ìœ¼ë¡œ ì¬ì‘ì„±í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ë¥¼ í™œìš©í•˜ì—¬ ë°ì´í„° ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ ë·°ë¥¼ ê°±ì‹ í•˜ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.3. ì¿¼ë¦¬ ìµœì í™”ë·°ë¥¼ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ì˜ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ ì¿¼ë¦¬ ìµœì í™”ë¥¼ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤. ì¿¼ë¦¬ ì‹¤í–‰ ê³„íšì„ ë¶„ì„í•˜ê³  ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´ ì ì ˆí•œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ì¿¼ë¦¬ íŠœë‹ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œì€ ì¿¼ë¦¬ ì‹¤í–‰ ê³„íšì„ ì œê³µí•˜ì—¬ ì¿¼ë¦¬ì˜ ì‹¤í–‰ ê³„íšì„ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë¹„íš¨ìœ¨ì ì¸ ì—°ì‚°ì´ë‚˜ ì¡°ì¸ì„ í™•ì¸í•˜ê³  ìµœì í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.4. ì œì•½ ì‚¬í•­ ê³ ë ¤ë·°ë¥¼ ì‚¬ìš©í•  ë•Œ ì£¼ì˜í•´ì•¼ í•  ì œì•½ ì‚¬í•­ë„ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë·°ì˜ ì •ì˜ì— ì‚¬ìš©ëœ í…Œì´ë¸”ì´ë‚˜ ì—´ì´ ë³€ê²½ë˜ê±°ë‚˜ ì‚­ì œë˜ë©´ ë·°ê°€ ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì— ëŒ€ë¹„í•˜ì—¬ ë·°ë¥¼ ì‚¬ìš©í•˜ê¸° ì „ì— ì œì•½ ì‚¬í•­ì„ í™•ì¸í•˜ê³  ìœ ì§€ë³´ìˆ˜ì— ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.7. ë§ˆë¬´ë¦¬ë°ì´í„°ë² ì´ìŠ¤ ë·°ë¥¼ ì‚¬ìš©í•˜ë©´ ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ë‹¨ìˆœí™”í•˜ê³ , ë³´ì•ˆì„ ê°•í™”í•˜ë©°, ë°ì´í„°ë¥¼ ê°€ê³µí•˜ê±°ë‚˜ í˜•ì‹ì„ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë·°ëŠ” ì‚¬ìš©ìì—ê²Œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ê°„í¸í•˜ê²Œ ì œê³µí•˜ë©°, ì¤‘ë³µ ë°ì´í„°ë¥¼ ì œê±°í•˜ì—¬ ì¼ê´€ì„±ì„ ìœ ì§€í•©ë‹ˆë‹¤. ë˜í•œ, ë°ì´í„°ë² ì´ìŠ¤ì˜ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ ì¸ë±ìŠ¤ë¥¼ í™œìš©í•˜ê±°ë‚˜ ë·°ë¥¼ ì¬ì‘ì„±í•˜ëŠ” ë“±ì˜ ë°©ë²•ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë·°ë¥¼ ì ì ˆíˆ í™œìš©í•˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì„ íš¨ìœ¨ì ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ë‹¨ìˆœí™”í•˜ì—¬ ê°œë°œìì™€ ì‚¬ìš©ì ëª¨ë‘ì˜ ì‘ì—…ì„ ê°„í¸í•˜ê²Œ ë§Œë“¤ê³ , ë°ì´í„°ì˜ ë³´ì•ˆê³¼ ì¼ê´€ì„±ì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ ì¿¼ë¦¬ë¥¼ ìµœì í™”í•˜ê³  ì¸ë±ìŠ¤ë¥¼ í™œìš©í•˜ëŠ” ë“±ì˜ ë°©ë²•ì„ ì ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì˜ ì‘ë‹µ ì‹œê°„ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë°ì´í„°ë² ì´ìŠ¤ ë·°ëŠ” ë°ì´í„° ê´€ë¦¬ì™€ ë¶„ì„ ì‘ì—…ì— ìˆì–´ í•„ìˆ˜ì ì¸ ë„êµ¬ì…ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì´ì œ ë·°ì˜ ê°œë…, ìƒì„± ë°©ë²•, ì‚¬ìš© ì‚¬ë¡€, ì„±ëŠ¥ ê³ ë ¤ ì‚¬í•­ ë“±ì„ ë‹¤ë£¨ë©° ë°ì´í„°ë² ì´ìŠ¤ ë·°ì˜ í™œìš©ì— ëŒ€í•´ ë°°ì› ìŠµë‹ˆë‹¤. ì´ì œ ì—¬ëŸ¬ë¶„ì€ ë°ì´í„°ë² ì´ìŠ¤ ë·°ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ í™œìš©í•˜ì—¬ ë” ë‚˜ì€ ë°ì´í„° ê´€ë¦¬ì™€ ë¶„ì„ì„ ì‹¤í˜„í•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.ë°ì´í„°ë² ì´ìŠ¤ ë·°ì˜ ì¤‘ìš”ì„±ì„ ì¸ì§€í•˜ê³ , ì ì ˆí•œ ìƒí™©ì—ì„œ ë·°ë¥¼ ì ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì„ ë”ìš± íš¨ìœ¨ì ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ ë…¸ë ¥í•´ë³´ì„¸ìš”. ë°ì´í„°ë² ì´ìŠ¤ ë·°ëŠ” ë°ì´í„°ì˜ ê°€ì‹œì„±ê³¼ ì¼ê´€ì„±ì„ ì œê³µí•˜ë©°, ë°ì´í„° ê´€ë¦¬ì™€ ë¶„ì„ì˜ íš¨ìœ¨ì„±ì„ ë†’ì—¬ì¤„ ê²ƒì…ë‹ˆë‹¤.ë„ì ë„ì ..ì´ ê¸€ì€ Hibernate â€˜introduce @View annotationâ€™ PRì„ ë³´ê³  ì‚˜ë°›ì•„ì„œ ì •ë¦¬í•œ ê¸€ì…ë‹ˆë‹¤. 2023ë…„ì— ORMì—ì„œ ë·°ë¥¼ ì‚¬ìš©í• ìˆ˜ ìˆê²Œ ë ìˆ˜ë„ ìˆë‹¤ëŠ” ê²ƒì— ì¢‹ì•„í•˜ëŠ”ê²Œ ë§ë‚˜ ëª¨ë¥´ê² ì§€ë§Œâ€¦ ì¼ë‹¨ì€ ì¢‹ìŠµë‹ˆë‹¤. ë‚˜ì˜¤ë©´ ì–¼ë¥¸ ì‚¬ìš©í•´ë³´ê³  ì‹¶ë„¤ìš”." }, { "title": "ìë°” ë™ì‹œì„± í”„ë¡œê·¸ë˜ë° - ë©”ëª¨ë¦¬ ëª¨ë¸ê³¼ ë™ê¸°í™”ë¶€í„° ê³ ê¸‰ ê¸°ë²•ê¹Œì§€", "url": "/posts/java-concurrency-programming/", "categories": "Java", "tags": "Java", "date": "2023-05-15 08:12:00 +0900", "snippet": "1. ì„œë¡ 1.1 ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ì˜ ì¤‘ìš”ì„±ê³¼ ìë°” ë©”ëª¨ë¦¬ ëª¨ë¸ì˜ ì—­í• ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ì€ í˜„ëŒ€ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì—ì„œ ë§¤ìš° ì¤‘ìš”í•œ ê°œë…ì…ë‹ˆë‹¤. ë™ì‹œì„±ì€ ì—¬ëŸ¬ ê°œì˜ ì‘ì—…ì´ ë™ì‹œì— ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ë©°, ì´ëŠ” í”„ë¡œê·¸ë¨ì˜ ì„±ëŠ¥ê³¼ ë°˜ì‘ì„±ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë™ì‹œì— ì‹¤í–‰ë˜ëŠ” ì‘ì—…ë“¤ ê°„ì˜ ìƒí˜¸ì‘ìš©ì€ ì˜ëª»ëœ ê²°ê³¼ë‚˜ ì˜ˆìƒì¹˜ ëª»í•œ ë™ì‘ì„ ì´ˆë˜í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.ìë°” ë©”ëª¨ë¦¬ ëª¨ë¸ì€ ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ì—ì„œ ìŠ¤ë ˆë“œ ê°„ì˜ ìƒí˜¸ì‘ìš©ê³¼ ë©”ëª¨ë¦¬ì˜ ë™ê¸°í™”ë¥¼ ê´€ë¦¬í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. ë©”ëª¨ë¦¬ ëª¨ë¸ì€ ìŠ¤ë ˆë“œê°€ ê³µìœ  ë³€ìˆ˜ë¥¼ ì½ê³  ì“¸ ë•Œì˜ ë™ì‘ ë°©ì‹ê³¼ ê°€ì‹œì„± ë“±ì„ ê·œì •í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ìŠ¤ë ˆë“œ ê°„ì˜ ì•ˆì „í•œ ë°ì´í„° ê³µìœ ì™€ ì¼ê´€ëœ ì‹¤í–‰ ê²°ê³¼ë¥¼ ë³´ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.1.2 ë™ì‹œì„± ë¬¸ì œì™€ ê·¸ë¡œ ì¸í•´ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë²„ê·¸ì™€ ì„±ëŠ¥ ì´ìŠˆë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ì€ ì—¬ëŸ¬ ë™ì‹œ ì‹¤í–‰ë˜ëŠ” ìŠ¤ë ˆë“œë“¤ ì‚¬ì´ì—ì„œ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ ë‹¤ë£¨ëŠ”ë°, ì£¼ìš”í•œ ë¬¸ì œë“¤ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤: ê²½í•© ìƒíƒœ(Race Condition): ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ê³µìœ  ë³€ìˆ˜ì— ì ‘ê·¼í•˜ì—¬ ìˆ˜ì •í•˜ëŠ” ê²½ìš°, ì˜ë„ì¹˜ ì•Šì€ ê²°ê³¼ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìŠ¤ë ˆë“œ ê°„ì˜ ì‹¤í–‰ ìˆœì„œë‚˜ íƒ€ì´ë°ì— ë”°ë¼ ê²°ê³¼ê°€ ë‹¬ë¼ì§€ë©°, ì´ë¡œ ì¸í•´ ë²„ê·¸ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. êµì°©ìƒíƒœ(Deadlock): ë‘ ê°œ ì´ìƒì˜ ìŠ¤ë ˆë“œê°€ ì„œë¡œê°€ ê°€ì§„ ìì›ì„ ê¸°ë‹¤ë¦¬ë©° ë¬´í•œíˆ ëŒ€ê¸°í•˜ëŠ” ìƒíƒœì…ë‹ˆë‹¤. ì´ë¡œ ì¸í•´ í”„ë¡œê·¸ë¨ì´ ë©ˆì¶”ëŠ” í˜„ìƒì´ ë°œìƒí•˜ë©°, ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•ŠëŠ” ì›ì¸ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìŠ¤ë ˆë“œ ì•ˆì „ì„± ë¬¸ì œ: ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ê°™ì€ ìë£Œêµ¬ì¡°ë‚˜ ê°ì²´ë¥¼ ìˆ˜ì •í•˜ëŠ” ê²½ìš°, ì˜ˆê¸°ì¹˜ ì•Šì€ ê²°ê³¼ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ì˜ëª»ëœ ë°ì´í„° ì²˜ë¦¬, ì¼ê´€ì„± ì—†ëŠ” ìƒíƒœ ë“±ì˜ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë˜í•œ ë™ì‹œì„±ì€ ì„±ëŠ¥ì—ë„ ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìŠ¤ë ˆë“œ ê°„ì˜ ê²½ìŸì´ë‚˜ ë™ê¸°í™” ë©”ì†Œë“œì˜ ê³¼ë„í•œ í˜¸ì¶œì€ ì†Œìš”ëœ ì‹œê°„ ë° ìì›ì˜ ë¹„ìš©ì„ ì¦ê°€ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë™ì‹œì— ì‹¤í–‰ë˜ëŠ” ìŠ¤ë ˆë“œë“¤ì´ ì„œë¡œ ê²½ìŸí•˜ê±°ë‚˜ ë™ê¸°í™”ë¥¼ ìœ„í•´ ëŒ€ê¸°í•˜ëŠ” ê²½ìš°, ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ, ì˜ëª»ëœ ë™ê¸°í™” ê¸°ë²•ì´ ì‚¬ìš©ë  ê²½ìš° ìŠ¤ë ˆë“œ ê°„ì˜ ëŒ€ê¸° ì‹œê°„ì´ ëŠ˜ì–´ë‚˜ê±°ë‚˜ ë³‘ëª© í˜„ìƒì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë”°ë¼ì„œ ë™ì‹œì„± ë¬¸ì œë¥¼ ì˜¬ë°”ë¥´ê²Œ ë‹¤ë£¨ê³  í•´ê²°í•˜ëŠ” ê²ƒì€ ì¤‘ìš”í•©ë‹ˆë‹¤. ì˜¬ë°”ë¥¸ ë™ê¸°í™” ê¸°ë²•ê³¼ ìŠ¤ë ˆë“œ ê°„ì˜ í˜‘ë ¥ ë° í†µì‹  ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ë™ì‹œì„± ë¬¸ì œë¥¼ ì˜ˆë°©í•˜ê³ , ì„±ëŠ¥ ì´ìŠˆë¥¼ ìµœì†Œí™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.2. ìë°” ìŠ¤ë ˆë“œ ëª¨ë¸ê³¼ ìŠ¤ë ˆë“œ ì•ˆì •ì„±2.1 ìë°”ì—ì„œ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë°©ë²•ìë°”ì—ì„œëŠ” Thread í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ê±°ë‚˜ Runnable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ì—¬ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ê³  ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Thread í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì€ ê²½ìš° run() ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬ ìŠ¤ë ˆë“œê°€ ì‹¤í–‰í•  ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. Runnable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ê²½ìš° run() ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ê³ , í•´ë‹¹ ê°ì²´ë¥¼ Thread í´ë˜ìŠ¤ì˜ ìƒì„±ìì— ì „ë‹¬í•˜ì—¬ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.ìŠ¤ë ˆë“œëŠ” start() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ì‹¤í–‰ë©ë‹ˆë‹¤. JVMì€ ìŠ¤ë ˆë“œë¥¼ ìŠ¤ì¼€ì¤„ë§í•˜ì—¬ ì‹¤í–‰í•˜ë©°, ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.// Thread í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì•„ ìŠ¤ë ˆë“œ ìƒì„±í•˜ê¸°class MyThread extends Thread { @Override public void run() { // ìŠ¤ë ˆë“œê°€ ì‹¤í–‰í•  ì‘ì—…ì„ ì‘ì„± System.out.println(\"ìŠ¤ë ˆë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.\"); }}// Runnable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ì—¬ ìŠ¤ë ˆë“œ ìƒì„±í•˜ê¸°class MyRunnable implements Runnable { @Override public void run() { // ìŠ¤ë ˆë“œê°€ ì‹¤í–‰í•  ì‘ì—…ì„ ì‘ì„± System.out.println(\"ìŠ¤ë ˆë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.\"); }}public class Main { public static void main(String[] args) { // Thread í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì€ ìŠ¤ë ˆë“œ ìƒì„±í•˜ê¸° MyThread thread1 = new MyThread(); thread1.start(); // ìŠ¤ë ˆë“œ ì‹¤í–‰ // Runnable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ìŠ¤ë ˆë“œ ìƒì„±í•˜ê¸° MyRunnable runnable = new MyRunnable(); Thread thread2 = new Thread(runnable); thread2.start(); // ìŠ¤ë ˆë“œ ì‹¤í–‰ }}2.2 ìŠ¤ë ˆë“œ ì•ˆì „ì„± ê°œë…ê³¼ ìŠ¤ë ˆë“œ ì•ˆì „í•œ ì½”ë“œì˜ í•„ìš”ì„±ìŠ¤ë ˆë“œ ì•ˆì „ì„±ì€ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì ‘ê·¼í•´ë„ ì•ˆì „í•˜ê²Œ ë™ì‘í•˜ëŠ” ì½”ë“œë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ìŠ¤ë ˆë“œ ì•ˆì „í•œ ì½”ë“œëŠ” ê²½í•© ìƒíƒœ(Race Condition)ì™€ ê°™ì€ ë™ì‹œì„± ë¬¸ì œë¥¼ í”¼í•˜ê³ , ì •í™•í•˜ê³  ì¼ê´€ëœ ê²°ê³¼ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤.ìŠ¤ë ˆë“œ ì•ˆì „í•œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•´ì„œëŠ” ë™ê¸°í™”(Synchronization) ë©”ì»¤ë‹ˆì¦˜ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. ë™ê¸°í™”ë¥¼ í†µí•´ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì ‘ê·¼í•˜ë”ë¼ë„ ë°ì´í„°ì˜ ì¼ê´€ì„±ê³¼ ì•ˆì •ì„±ì„ ë³´ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìë°”ì—ì„œëŠ” synchronized í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì„œë“œ ë˜ëŠ” ë¸”ë¡ì„ ë™ê¸°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ìŠ¤ë ˆë“œ ì•ˆì „í•œ ì½”ë“œëŠ” ë‹¤ì¤‘ ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ì•ˆì „í•˜ê²Œ ë™ì‘í•˜ëŠ”ë°, ì´ëŠ” í”„ë¡œê·¸ë¨ì˜ ì •í™•ì„±ê³¼ ì‹ ë¢°ì„±ì„ë³´ì¥í•©ë‹ˆë‹¤. ìŠ¤ë ˆë“œ ì•ˆì „í•œ ì½”ë“œëŠ” ë™ì‹œì„± ë¬¸ì œë¡œë¶€í„° ììœ ë¡œì›Œì ¸ ì˜ˆê¸°ì¹˜ ì•Šì€ ë²„ê·¸ì™€ ì ì¬ì ì¸ ë¬¸ì œë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ê°œë°œìëŠ” ìŠ¤ë ˆë“œ ì•ˆì „ì„±ì„ ê³ ë ¤í•˜ì—¬ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³ , í•„ìš”í•œ ë™ê¸°í™” ë©”ì»¤ë‹ˆì¦˜ì„ ì ì ˆíˆ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ì˜ ì¼ê´€ì„±ê³¼ ì•ˆì •ì„±ì„ í™•ë³´í•´ì•¼ í•©ë‹ˆë‹¤.class Counter { private int count = 0; // synchronized í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ê¸°í™”ëœ ë©”ì„œë“œ public synchronized void increment() { count++; } public int getCount() { return count; }}public class Main { public static void main(String[] args) { Counter counter = new Counter(); // ì—¬ëŸ¬ ìŠ¤ë ˆë“œì—ì„œ ë™ì‹œì— increment() ë©”ì„œë“œ í˜¸ì¶œ Runnable runnable = () -&gt; { for (int i = 0; i &lt; 1000; i++) { counter.increment(); } }; // ì—¬ëŸ¬ ìŠ¤ë ˆë“œ ìƒì„± Thread thread1 = new Thread(runnable); Thread thread2 = new Thread(runnable); // ìŠ¤ë ˆë“œ ì‹¤í–‰ thread1.start(); thread2.start(); try { // ìŠ¤ë ˆë“œ ì‹¤í–‰ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸° thread1.join(); thread2.join(); } catch (InterruptedException e) { e.printStackTrace(); } // ìµœì¢… ê²°ê³¼ ì¶œë ¥ System.out.println(\"Count: \" + counter.getCount()); }}3. ìë°” ë©”ëª¨ë¦¬ ëª¨ë¸(Memory Model)3.1 ìë°” ë©”ëª¨ë¦¬ ëª¨ë¸ ê°œë…ê³¼ ëª©ì ìë°” ë©”ëª¨ë¦¬ ëª¨ë¸ì€ ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ìŠ¤ë ˆë“œë“¤ì´ ë©”ëª¨ë¦¬ë¥¼ ê³µìœ í•˜ëŠ” ë°©ì‹ê³¼ ë™ì‘ì„ ì •ì˜í•˜ëŠ” ê·œì¹™ì˜ ëª¨ìŒì…ë‹ˆë‹¤. ëª©ì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ìŠ¤ë ˆë“œ ê°„ì˜ ë™ì‘ê³¼ ìƒí˜¸ì‘ìš©ì„ ì •í™•í•˜ê²Œ ì œì–´í•˜ê¸° ìœ„í•´ ì¼ê´€ëœ ë™ì‘ì„ ë³´ì¥í•©ë‹ˆë‹¤. ë‹¤ì¤‘ ìŠ¤ë ˆë“œë¡œë¶€í„° ì•ˆì „í•˜ê²Œ ê³µìœ ëœ ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.ìë°” ë©”ëª¨ë¦¬ ëª¨ë¸ì€ ìŠ¤ë ˆë“œ ê°„ì˜ ìƒí˜¸ì‘ìš©ì„ í†µí•´ ê°€ì‹œì„±(Visibility)ì™€ ìˆœì„œ(Ordering)ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. ê°€ì‹œì„±ì€ í•œ ìŠ¤ë ˆë“œì—ì„œ ë³€ê²½í•œ ë°ì´í„°ê°€ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì— ì–¼ë§ˆë‚˜ ë¹ ë¥´ê²Œ ë³´ì´ëŠ”ì§€ë¥¼ ì˜ë¯¸í•˜ë©°, ìˆœì„œëŠ” ì—°ì†ëœ ì—°ì‚°ì˜ ì‹¤í–‰ ìˆœì„œë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.3.2 ë©”ì¸ ë©”ëª¨ë¦¬, ìºì‹œ, ë©”ëª¨ë¦¬ ê°€ì‹œì„±ìë°” ë©”ëª¨ë¦¬ ëª¨ë¸ì€ ë©”ì¸ ë©”ëª¨ë¦¬ì™€ ìºì‹œ(Cache) ë“±ì˜ ë‹¤ì–‘í•œ ë©”ëª¨ë¦¬ ì˜ì—­ì„ ë‹¤ë£¹ë‹ˆë‹¤. ë©”ì¸ ë©”ëª¨ë¦¬: ì‹œìŠ¤í…œ ì „ì²´ì˜ ì£¼ ë©”ëª¨ë¦¬ë¡œ ëª¨ë“  ìŠ¤ë ˆë“œê°€ ê³µìœ í•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤. ìºì‹œ: í”„ë¡œì„¸ì„œì˜ ìºì‹œ ë©”ëª¨ë¦¬ë¡œ ê° ì½”ì–´ë§ˆë‹¤ ë…ë¦½ì ìœ¼ë¡œ ì¡´ì¬í•˜ë©°, ë©”ì¸ ë©”ëª¨ë¦¬ë¡œë¶€í„° ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ìºì‹œì— ì €ì¥í•©ë‹ˆë‹¤.ë©”ëª¨ë¦¬ ê°€ì‹œì„±ì€ ë©”ì¸ ë©”ëª¨ë¦¬ì™€ ìºì‹œ ê°„ì˜ ë°ì´í„° ì¼ê´€ì„±ì„ ë‹¤ë£¨ëŠ” ê°œë…ì…ë‹ˆë‹¤. ë©”ì¸ ë©”ëª¨ë¦¬ì— ì €ì¥ëœ ë°ì´í„°ê°€ ìºì‹œì— ë³µì‚¬ë˜ê±°ë‚˜, ìºì‹œì— ìˆëŠ” ë°ì´í„°ê°€ ë©”ì¸ ë©”ëª¨ë¦¬ë¡œ ë°˜ì˜ë˜ëŠ” ì‹œì ì— ë”°ë¼ ìŠ¤ë ˆë“œ ê°„ì˜ ë°ì´í„° ê°€ì‹œì„±ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.3.3 ë©€í‹°ì½”ì–´ ì•„í‚¤í…ì²˜ì—ì„œì˜ ë™ì‘ë©€í‹°ì½”ì–´ ì•„í‚¤í…ì²˜ì—ì„œëŠ” ì—¬ëŸ¬ ê°œì˜ ì½”ì–´ê°€ ë³‘ë ¬ë¡œ ë™ì‘í•˜ë©°, ê° ì½”ì–´ë§ˆë‹¤ ë…ë¦½ì ì¸ ìºì‹œê°€ ìˆìŠµë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ê° ìŠ¤ë ˆë“œê°€ ì„œë¡œ ë‹¤ë¥¸ ìºì‹œë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ë©”ëª¨ë¦¬ ê°€ì‹œì„± ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìë°” ë©”ëª¨ë¦¬ ëª¨ë¸ì€ ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ volatile í‚¤ì›Œë“œì™€ ë™ê¸°í™” ê¸°ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.volatile í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë³€ìˆ˜ë¥¼ ì„ ì–¸í•˜ë©´ ë³€ìˆ˜ë¥¼ ë©”ì¸ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ê³  ìºì‹œë¥¼ ê±´ë„ˆë›°ê³  ë©”ì¸ ë©”ëª¨ë¦¬ì—ì„œ ê°’ì„ ì½ê³  ì“°ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. volatile ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ìŠ¤ë ˆë“œ ê°„ì˜ ê°€ì‹œì„±ì´ í™•ë³´ë˜ì–´ ë°ì´í„°ì˜ ì¼ê´€ì„±ì´ ìœ ì§€ë©ë‹ˆë‹¤.ë˜í•œ ë™ê¸°í™” ê¸°ë²•ì¸ synchronized í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì„ê³„ ì˜ì—­ì„ ì„¤ì •í•˜ê±°ë‚˜ Lockê³¼ Conditionì„ í™œìš©í•˜ì—¬ ìŠ¤ë ˆë“œ ê°„ì˜ ë™ê¸°í™”ë¥¼ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì ‘ê·¼í•˜ë”ë¼ë„ ë°ì´í„° ì¼ê´€ì„±ê³¼ ìŠ¤ë ˆë“œ ì•ˆì „ì„±ì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ìë°” ë©”ëª¨ë¦¬ ëª¨ë¸ì€ ë©€í‹°ì½”ì–´ ì•„í‚¤í…ì²˜ì—ì„œì˜ ë™ì‘ì„ ê³ ë ¤í•˜ì—¬ ìŠ¤ë ˆë“œ ê°„ì˜ ë©”ëª¨ë¦¬ ê°€ì‹œì„±ê³¼ ì¼ê´€ì„±ì„ ì œì–´í•¨ìœ¼ë¡œì¨ ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì•ˆì •ì ì´ê³  ì •í™•í•œ ë™ì‹œì„± í”„ë¡œê·¸ë¨ì„ ê°œë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.4. ë™ê¸°í™”(Synchronization)4.1 ê°œë…ë™ê¸°í™”ëŠ” ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ê³µìœ ëœ ìì›ì— ì ‘ê·¼í•  ë•Œ, ì´ë¥¼ ì¡°ì ˆí•˜ì—¬ ë°ì´í„°ì˜ ì¼ê´€ì„±ê³¼ ìŠ¤ë ˆë“œ ì•ˆì „ì„±ì„ ë³´ì¥í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. ë™ê¸°í™”ëŠ” ê²½ìŸ ìƒíƒœ(Race Condition)ì™€ ê°™ì€ ë™ì‹œì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ê³ , ìŠ¤ë ˆë“œ ê°„ì˜ ìƒí˜¸ì‘ìš©ì„ ì¡°ìœ¨í•˜ì—¬ ì˜ˆìƒì¹˜ ëª»í•œ ê²°ê³¼ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.4.2 ìë°”ì—ì„œì˜ ë™ê¸°í™” ë©”ì»¤ë‹ˆì¦˜ìë°”ì—ì„œëŠ” synchronized í‚¤ì›Œë“œì™€ volatile í‚¤ì›Œë“œë¥¼ ì œê³µí•˜ì—¬ ë™ê¸°í™”ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. synchronized í‚¤ì›Œë“œ: ë©”ì„œë“œë‚˜ ë¸”ë¡ì— synchronized í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì„ê³„ ì˜ì—­ì„ ì„¤ì •í•©ë‹ˆë‹¤. ì„ê³„ ì˜ì—­ì— ì§„ì…í•œ ìŠ¤ë ˆë“œëŠ” í•´ë‹¹ ê°ì²´ì˜ ëª¨ë‹ˆí„° ë½(Monitor Lock)ì„ íšë“í•˜ê³ , ë‹¤ë¥¸ ìŠ¤ë ˆë“œëŠ” í•´ë‹¹ ì˜ì—­ì— ì§„ì…í•˜ì§€ ëª»í•˜ê³  ëŒ€ê¸°í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ìŠ¤ë ˆë“œ ê°„ì˜ ë™ê¸°í™”ê°€ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.public synchronized void synchronizedMethod() { // ë™ê¸°í™”ê°€ í•„ìš”í•œ ì‘ì—… ìˆ˜í–‰} volatile í‚¤ì›Œë“œ: volatile í‚¤ì›Œë“œë¥¼ ë³€ìˆ˜ì— ì‚¬ìš©í•˜ë©´ í•´ë‹¹ ë³€ìˆ˜ì˜ ê°’ì„ ë©”ì¸ ë©”ëª¨ë¦¬ì— ì“°ê³  ì½ì„ ë•Œ ìºì‹œë¥¼ ê±´ë„ˆë›°ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ìŠ¤ë ˆë“œ ê°„ì˜ ê°€ì‹œì„±ì„ ì œê³µí•©ë‹ˆë‹¤. volatile ë³€ìˆ˜ëŠ” ë³€ìˆ˜ ì„ ì–¸ ì•ì— volatile í‚¤ì›Œë“œë¥¼ ë¶™ì—¬ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤.private volatile int sharedVariable;4.3 Atomic í´ë˜ìŠ¤ìë°”ëŠ” java.util.concurrent.atomic íŒ¨í‚¤ì§€ì—ì„œ Atomicì´ë¼ëŠ” ì ‘ë‘ì‚¬ë¥¼ ê°€ì§„ í´ë˜ìŠ¤ë“¤ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ë“¤ í´ë˜ìŠ¤ëŠ” ì›ìì (Atomic) ì—°ì‚°ì„ ìˆ˜í–‰í•˜ì—¬ ìŠ¤ë ˆë“œ ê°„ì˜ ë™ê¸°í™”ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤. AtomicInteger, AtomicLong, AtomicBoolean ë“±ì˜ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›ìì ì¸ ì—°ì‚°ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.private AtomicInteger atomicCounter = new AtomicInteger();public void increment() { atomicCounter.incrementAndGet();}ì–´í† ë¯¹ í´ë˜ìŠ¤ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ Compare-and-Swap(CAS) ì—°ì‚°ì„ ì‚¬ìš©í•˜ì—¬ ìŠ¤ë ˆë“œ ê°„ì˜ ê²½ìŸ ìƒíƒœë¥¼ í•´ê²°í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë™ê¸°í™” ì‘ì—…ì„ ë½ ì—†ì´ ì²˜ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, ì„±ëŠ¥ì ìœ¼ë¡œ ìš°ìˆ˜í•œ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.4.4 ë™ê¸°í™”ì˜ í•œê³„ë™ê¸°í™”ëŠ” ìŠ¤ë ˆë“œ ê°„ì˜ ìƒí˜¸ì‘ìš©ì„ ë³´ì¥í•˜ê³  ìŠ¤ë ˆë“œ ì•ˆì „ì„±ì„ ë³´ì¥í•˜ëŠ” ê°•ë ¥í•œ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ë™ê¸°í™”ëŠ” ì˜¤ë²„í—¤ë“œì™€ ì„±ëŠ¥ ì €í•˜ì˜ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤. ë½ì„ íšë“í•˜ê³  í•´ì œí•˜ëŠ” ê³¼ì •ì—ì„œ ì¶”ê°€ì ì¸ ì‘ì—…ì´ í•„ìš”í•˜ë©°, ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ê¸°í™”ëœ ì˜ì—­ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ ê²½ìŸí•˜ë©´ì„œ ëŒ€ê¸°í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ëŠ” í”„ë¡œê·¸ë¨ì˜ ì‹¤í–‰ ì†ë„ë¥¼ ëŠë¦¬ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë˜í•œ ë™ê¸°í™”ì˜ ê³¼ë„í•œ ì‚¬ìš©ì€ êµì°©ìƒíƒœ(Deadlock)ì™€ ê°™ì€ ë¬¸ì œë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. êµì°©ìƒíƒœëŠ” ë‘ ê°œ ì´ìƒì˜ ìŠ¤ë ˆë“œê°€ ì„œë¡œê°€ ì†Œìœ í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ê¸°ë‹¤ë¦¬ë©° ë¬´í•œíˆ ëŒ€ê¸°í•˜ëŠ” ìƒíƒœë¥¼ ë§í•©ë‹ˆë‹¤. ì´ëŠ” í”„ë¡œê·¸ë¨ì˜ ì •ìƒì ì¸ ì‹¤í–‰ì„ ë°©í•´í•˜ê³  ë°ë“œë½ì„ í•´ê²°í•˜ê¸° ìœ„í•œ ë³µì¡í•œ ì•Œê³ ë¦¬ì¦˜ì„ ìš”êµ¬í•©ë‹ˆë‹¤.ë”°ë¼ì„œ ë™ê¸°í™”ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ì‹ ì¤‘í•˜ê²Œ ì ‘ê·¼í•´ì•¼ í•©ë‹ˆë‹¤. í•„ìš”í•œ ë¶€ë¶„ì—ë§Œ ë™ê¸°í™”ë¥¼ ì ìš©í•˜ê³ , ë™ê¸°í™”ì˜ ë²”ìœ„ë¥¼ ìµœì†Œí™”í•˜ì—¬ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ êµì°©ìƒíƒœì™€ ê°™ì€ ë¬¸ì œë¥¼ í”¼í•˜ê¸° ìœ„í•´ ë™ê¸°í™” ì½”ë“œë¥¼ ì‹ ì¤‘í•˜ê²Œ ì„¤ê³„í•˜ê³  ë°ë“œë½ ìƒí™©ì„ ì˜ˆë°©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.ìë°”ì—ì„œëŠ” ë™ê¸°í™”ë¥¼ ìœ„í•´ synchronized í‚¤ì›Œë“œ ì™¸ì—ë„ Lock ì¸í„°í˜ì´ìŠ¤ì™€ ê·¸ êµ¬í˜„ì²´ì¸ ReentrantLockì„ ì œê³µí•©ë‹ˆë‹¤. Lockì„ ì‚¬ìš©í•˜ë©´ ë” ì„¸ë°€í•œ ì œì–´ì™€ ê³ ê¸‰ ë™ê¸°í™” ê¸°ëŠ¥ì„ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ Lockì€ synchronized í‚¤ì›Œë“œë³´ë‹¤ ì‚¬ìš©ì´ ë³µì¡í•˜ê³  ì‹¤ìˆ˜í•  ê°€ëŠ¥ì„±ì´ ë†’ê¸° ë•Œë¬¸ì— ì ì ˆí•œ ìƒí™©ì—ì„œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.ë™ê¸°í™”ëŠ” ìŠ¤ë ˆë“œ ê°„ì˜ ìƒí˜¸ì‘ìš©ì„ ì¡°ìœ¨í•˜ì—¬ ìŠ¤ë ˆë“œ ì•ˆì „ì„±ê³¼ ë°ì´í„° ì¼ê´€ì„±ì„ ë³´ì¥í•˜ëŠ” ì¤‘ìš”í•œ ê°œë…ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì˜¤ë²„í—¤ë“œì™€ ì„±ëŠ¥ ì €í•˜ì˜ ê°€ëŠ¥ì„±ì„ ê³ ë ¤í•˜ì—¬ ì ì ˆí•˜ê²Œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.5. ìŠ¤ë ˆë“œ ê°„ì˜ í˜‘ë ¥ê³¼ í†µì‹ ìŠ¤ë ˆë“œ ê°„ì˜ í˜‘ë ¥ê³¼ í†µì‹ ì€ ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ì—ì„œ ì¤‘ìš”í•œ ì¸¡ë©´ì…ë‹ˆë‹¤. ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì‹¤í–‰ë˜ëŠ” í™˜ê²½ì—ì„œëŠ” ìŠ¤ë ˆë“œë“¤ì´ ë°ì´í„°ë¥¼ ê³µìœ í•˜ê³  ìƒí˜¸ì‘ìš©í•´ì•¼ í•©ë‹ˆë‹¤. ìë°”ì—ì„œëŠ” ëª‡ ê°€ì§€ ë©”ì»¤ë‹ˆì¦˜ì„ ì œê³µí•˜ì—¬ ìŠ¤ë ˆë“œ ê°„ì˜ í˜‘ë ¥ê³¼ í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.5.1 wait(), notify(), notifyAll() ë©”ì„œë“œwait(), notify(), notifyAll()ì€ ìë°”ì˜ ëª¨ë“  ê°ì²´ê°€ ê°€ì§€ê³  ìˆëŠ” ë©”ì„œë“œë¡œ, ìŠ¤ë ˆë“œ ê°„ì˜ í˜‘ë ¥ê³¼ í†µì‹ ì„ ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ ë©”ì„œë“œë“¤ì€ ìŠ¤ë ˆë“œê°€ ê°ì²´ì˜ ëª¨ë‹ˆí„° ë½ì„ í™•ë³´í•˜ê³  ìˆì„ ë•Œ í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤. wait(): í˜„ì¬ ìŠ¤ë ˆë“œë¥¼ ì¼ì‹œì ìœ¼ë¡œ ëŒ€ê¸° ìƒíƒœë¡œ ì „í™˜ì‹œí‚¤ê³ , ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ê°ì²´ì˜ ëª¨ë‹ˆí„° ë½ì„ íšë“í•˜ê³  notify() ë˜ëŠ” notifyAll()ì„ í˜¸ì¶œí•˜ì—¬ ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œë¥¼ ê¹¨ìš¸ ë•Œê¹Œì§€ ëŒ€ê¸°í•©ë‹ˆë‹¤. notify(): ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì—¬ ê¹¨ì›ë‹ˆë‹¤. ì„ íƒëœ ìŠ¤ë ˆë“œëŠ” ëª¨ë‹ˆí„° ë½ì„ ì–»ì„ ìˆ˜ ìˆëŠ” ì‹œë„ë¥¼ í•©ë‹ˆë‹¤. notifyAll(): ëŒ€ê¸° ì¤‘ì¸ ëª¨ë“  ìŠ¤ë ˆë“œë¥¼ ê¹¨ì›ë‹ˆë‹¤. ê¹¨ì–´ë‚œ ìŠ¤ë ˆë“œë“¤ì€ ëª¨ë‹ˆí„° ë½ì„ ì–»ì„ ìˆ˜ ìˆëŠ” ì‹œë„ë¥¼ í•©ë‹ˆë‹¤.5.2 ìŠ¤ë ˆë“œ ê°„ì˜ ë°ì´í„° ê³µìœ ìŠ¤ë ˆë“œ ê°„ì˜ ë°ì´í„° ê³µìœ ëŠ” ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ì—ì„œ ì£¼ì˜í•´ì•¼ í•  ì¤‘ìš”í•œ ì¸¡ë©´ì…ë‹ˆë‹¤. ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì¼í•œ ë°ì´í„°ì— ì ‘ê·¼í•˜ë©´ì„œ ë°ì´í„° ì¼ê´€ì„± ë¬¸ì œë‚˜ ê²½í•© ìƒíƒœ(Race Condition)ì™€ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë™ê¸°í™” ë©”ì»¤ë‹ˆì¦˜ì„ ì‚¬ìš©í•˜ì—¬ ìŠ¤ë ˆë“œ ê°„ì˜ ë°ì´í„° ê³µìœ ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. synchronized í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì„œë“œë‚˜ ë¸”ë¡ì„ ë™ê¸°í™”í•  ìˆ˜ ìˆìœ¼ë©°, volatile í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë³€ìˆ˜ì˜ ê°€ì‹œì„±ê³¼ ìˆœì„œë¥¼ ë³´ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.public class DataSharingExample { private int sharedData = 0; public synchronized void increment() { sharedData++; } public synchronized void decrement() { sharedData--; } public int getSharedData() { return sharedData; }}5.3 ìŠ¤ë ˆë“œ ê°„ì˜ í˜‘ë ¥ìŠ¤ë ˆë“œ ê°„ì˜ í˜‘ë ¥ì€ ì‘ì—…ì„ ì¡°ìœ¨í•˜ê³  ìŠ¤ë ˆë“œì˜ ì‹¤í–‰ ìˆœì„œë¥¼ ì œì–´í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ìŠ¤ë ˆë“œ ê°„ì˜ í˜‘ë ¥ì„ ìœ„í•´ ë‹¤ì–‘í•œ ê¸°ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Lockê³¼ Condition: Lock ì¸í„°í˜ì´ìŠ¤ì™€ Condition ì¸í„°í˜ì´ìŠ¤ëŠ” ìŠ¤ë ˆë“œ ê°„ì˜ í˜‘ë ¥ì„ ìœ„í•œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. Lockì€ synchronized í‚¤ì›Œë“œë³´ë‹¤ ë” ì„¸ë°€í•œ ì œì–´ê°€ ê°€ëŠ¥í•˜ë©°, Conditionì€ ìŠ¤ë ˆë“œì˜ ëŒ€ê¸°ì™€ ì‹ í˜¸ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. wait()ê³¼ notify(): ì•ì„œ ì–¸ê¸‰í•œ wait()ê³¼ notify() ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤ë ˆë“œ ê°„ì˜ ëŒ€ê¸°ì™€ ì‹ í˜¸ë¥¼ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. wait()ì„ í˜¸ì¶œí•œ ìŠ¤ë ˆë“œëŠ” ëŒ€ê¸° ìƒíƒœë¡œ ì „í™˜ë˜ë©°, ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ notify()ì„ í˜¸ì¶œí•˜ì—¬ ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œë¥¼ ê¹¨ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. BlockingQueue: BlockingQueue ì¸í„°í˜ì´ìŠ¤ëŠ” ìŠ¤ë ˆë“œ ê°„ì˜ ì‘ì—…ì„ ì¡°ìœ¨í•˜ê¸° ìœ„í•œ ìë£Œêµ¬ì¡°ì…ë‹ˆë‹¤. íì— ìš”ì†Œë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì œê±°í•  ë•Œ ìŠ¤ë ˆë“œê°€ ì°¨ë‹¨ë˜ì–´ ëŒ€ê¸°í•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ìƒì‚°ì-ì†Œë¹„ì íŒ¨í„´ê³¼ ê°™ì€ í˜‘ë ¥ì ì¸ ì‘ì—…ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. CountDownLatch: CountDownLatch í´ë˜ìŠ¤ëŠ” íŠ¹ì • ìŠ¤ë ˆë“œê°€ ì—¬ëŸ¬ ê°œì˜ ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°í•˜ëŠ” ë™ì•ˆ ë‹¤ë¥¸ ìŠ¤ë ˆë“œë“¤ì´ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ì£¼ë¡œ ë©”ì¸ ìŠ¤ë ˆë“œê°€ ì—¬ëŸ¬ ê°œì˜ ì‘ì—… ìŠ¤ë ˆë“œê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” ìƒí™©ì—ì„œ í™œìš©ë©ë‹ˆë‹¤. CyclicBarrier: CyclicBarrier í´ë˜ìŠ¤ëŠ” ì§€ì •ëœ ìˆ˜ì˜ ìŠ¤ë ˆë“œê°€ íŠ¹ì • ì§€ì ì—ì„œ ë§Œë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦´ ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë™ê¸°í™” ê¸°ë²•ì…ë‹ˆë‹¤. ëª¨ë“  ìŠ¤ë ˆë“œê°€ ë„ì°©í•˜ë©´ ì§€ì •ëœ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê±°ë‚˜ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì´ëŸ¬í•œ ìŠ¤ë ˆë“œ ê°„ì˜ í˜‘ë ¥ê³¼ í†µì‹  ê¸°ë²•ì„ ì ì ˆí•˜ê²Œ í™œìš©í•˜ë©´ ìŠ¤ë ˆë“œ ê°„ì˜ ì‘ì—… ì¡°ìœ¨ê³¼ ë°ì´í„° ê³µìœ ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.public class ThreadCooperationExample { private Lock lock = new ReentrantLock(); private boolean isDataAvailable = false; public void produceData() { lock.lock(); try { // ë°ì´í„° ìƒì„± ë° ì €ì¥ isDataAvailable = true; } finally { lock.unlock(); } } public void consumeData() { lock.lock(); try { while (!isDataAvailable) { // ë°ì´í„°ê°€ ìƒì„±ë˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¼ } // ë°ì´í„° ì†Œë¹„ isDataAvailable = false; } finally { lock.unlock(); } }}6. ê³ ê¸‰ ë™ì‹œì„± ê¸°ë²•ê³¼ íŒ¨í„´ë™ì‹œì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ê³ ê¸‰ ë™ì‹œì„± ê¸°ë²•ê³¼ íŒ¨í„´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ê¸°ë²•ê³¼ íŒ¨í„´ì€ ìŠ¤ë ˆë“œ ê°„ì˜ ê²½í•© ìƒíƒœì™€ ì„±ëŠ¥ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³ , ì½”ë“œì˜ ê°€ë…ì„±ê³¼ í™•ì¥ì„±ì„ í–¥ìƒì‹œí‚¤ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤. ì´ ì„¹ì…˜ì—ì„œëŠ” ì¼ë¶€ ì¼ë°˜ì ì¸ ê³ ê¸‰ ë™ì‹œì„± ê¸°ë²•ê³¼ íŒ¨í„´ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.6.1 ìŠ¤ë ˆë“œí’€(Thread Pool)ìŠ¤ë ˆë“œí’€ì€ ì‘ì—…ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ë¯¸ë¦¬ ìƒì„±ëœ ìŠ¤ë ˆë“œì˜ í’€ì„ ìœ ì§€í•˜ê³  ê´€ë¦¬í•˜ëŠ” ê¸°ë²•ì…ë‹ˆë‹¤. ìŠ¤ë ˆë“œí’€ì„ ì‚¬ìš©í•˜ë©´ ì‘ì—…ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ë§¤ë²ˆ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ê³  ì œê±°í•˜ëŠ” ë¹„ìš©ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëŒ€ì‹ , ìŠ¤ë ˆë“œí’€ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ìŠ¤ë ˆë“œ ì¤‘ í•˜ë‚˜ë¥¼ í• ë‹¹í•˜ì—¬ ì‘ì—…ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.public class ThreadPoolExample { public static void main(String[] args) { // ìŠ¤ë ˆë“œí’€ ìƒì„± ExecutorService executor = Executors.newFixedThreadPool(5); // ì‘ì—… ì œì¶œ for (int i = 0; i &lt; 10; i++) { executor.execute(new WorkerThread(\"Task \" + i)); } // ì‘ì—… ì™„ë£Œ í›„ ìŠ¤ë ˆë“œí’€ ì¢…ë£Œ executor.shutdown(); }}class WorkerThread implements Runnable { private String task; public WorkerThread(String task) { this.task = task; } @Override public void run() { // ì‘ì—… ì‹¤í–‰ System.out.println(\"Executing: \" + task); }}ìœ„ì˜ ì˜ˆì œì—ì„œëŠ” Executors.newFixedThreadPool(5)ë¥¼ ì‚¬ìš©í•˜ì—¬ í¬ê¸°ê°€ 5ì¸ ìŠ¤ë ˆë“œí’€ì„ ìƒì„±í•©ë‹ˆë‹¤. 10ê°œì˜ ì‘ì—…ì„ ì œì¶œí•˜ê³  ê° ì‘ì—…ì€ ìŠ¤ë ˆë“œí’€ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ìŠ¤ë ˆë“œ ì¤‘ í•˜ë‚˜ì— í• ë‹¹ë˜ì–´ ì‹¤í–‰ë©ë‹ˆë‹¤.6.2 ë½ì˜ ì¢…ë¥˜ì™€ ì„±ëŠ¥ë½ì€ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ê³µìœ  ìì›ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ì œì–´í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤. ìë°”ì—ì„œëŠ” synchronized í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¨ì¼ ìŠ¤ë ˆë“œì— ì˜í•œ ì ê¸ˆì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ synchronizedëŠ” ë‹¨ì¼ ìŠ¤ë ˆë“œì— ì˜í•œ ì ê¸ˆë§Œ ì§€ì›í•˜ë©°, ì—¬ëŸ¬ ìŠ¤ë ˆë“œì— ì˜í•œ ë™ì‹œ ì ‘ê·¼ì„ í—ˆìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ì— ëŒ€ë¹„í•˜ì—¬ ë‹¤ì–‘í•œ ë½ì˜ ì¢…ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤. ReentrantLock: synchronizedì™€ ìœ ì‚¬í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ë½ìœ¼ë¡œ, ì¬ì§„ì… ê°€ëŠ¥ í•©ë‹ˆë‹¤. ì¬ì§„ì… ê°€ëŠ¥í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ë½ìœ¼ë¡œ, synchronizedì™€ ë‹¬ë¦¬ ë”ìš± ì„¸ë°€í•œ ì œì–´ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë‹¤ìŒì€ ReentrantLockì˜ ì˜ˆì œ ì½”ë“œì…ë‹ˆë‹¤.public class ReentrantLockExample { private static ReentrantLock lock = new ReentrantLock(); public static void main(String[] args) { Thread t1 = new Thread(new WorkerThread()); Thread t2 = new Thread(new WorkerThread()); t1.start(); t2.start(); } static class WorkerThread implements Runnable { @Override public void run() { lock.lock(); // ë½ íšë“ try { // ì„ê³„ ì˜ì—­ System.out.println(\"Critical section\"); } finally { lock.unlock(); // ë½ í•´ì œ } } }}ìœ„ì˜ ì˜ˆì œì—ì„œëŠ” ReentrantLockì„ ì‚¬ìš©í•˜ì—¬ ì„ê³„ ì˜ì—­ì„ ë³´í˜¸í•©ë‹ˆë‹¤. lock.lock()ì„ í˜¸ì¶œí•˜ì—¬ ë½ì„ íšë“í•˜ê³ , lock.unlock()ì„ í˜¸ì¶œí•˜ì—¬ ë½ì„ í•´ì œí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì—¬ëŸ¬ ìŠ¤ë ˆë“œ ê°„ì˜ ìƒí˜¸ ë°°ì œë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ReadWriteLock: ì½ê¸° ì‘ì—…ê³¼ ì“°ê¸° ì‘ì—…ì„ êµ¬ë¶„í•˜ì—¬ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì½ê¸° ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•©ë‹ˆë‹¤. ì“°ê¸° ì‘ì—…ì´ ì§„í–‰ ì¤‘ì¼ ë•ŒëŠ” ë‹¤ë¥¸ ìŠ¤ë ˆë“œì˜ ì“°ê¸° ì‘ì—…ê³¼ ì½ê¸° ì‘ì—…ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. StampedLock: ReadWriteLockê³¼ ìœ ì‚¬í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ì§€ë§Œ, ì½ê¸° ë½ê³¼ ì“°ê¸° ë½ì˜ ê°œë…ì„ í™•ì¥í•˜ì—¬ ì¡°ê¸ˆ ë” ì„¸ë°€í•œ ì œì–´ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì¶”ê°€ì ìœ¼ë¡œ optimistic readì™€ write lockì„ ì§€ì›í•˜ì—¬ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.6.3 Thread-Safe Collectionsìë°”ì—ì„œëŠ” ë‹¤ì–‘í•œ Thread-Safe Collectionì„ ì œê³µí•©ë‹ˆë‹¤. ConcurrentHashMap: ë™ì‹œì„± í™˜ê²½ì—ì„œ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í•´ì‹œ ë§µì…ë‹ˆë‹¤. ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ë§µì— ì ‘ê·¼í•˜ì—¬ ìš”ì†Œë¥¼ ì¶”ê°€, ì œê±°, ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. CopyOnWriteArrayList: ë™ì‹œì„± í™˜ê²½ì—ì„œ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤. ìš”ì†Œë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ìˆ˜ì •í•˜ëŠ” ì‘ì—…ì´ ì¼ì–´ë‚  ë•Œ, ìƒˆë¡œìš´ ë³µì‚¬ë³¸ì„ ë§Œë“¤ì–´ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì½ê¸° ì‘ì—…ì€ ë½ ì—†ì´ ë™ì‹œì— ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ConcurrentLinkedQueue: ë™ì‹œì„± í™˜ê²½ì—ì„œ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” íì…ë‹ˆë‹¤. ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— íì— ì ‘ê·¼í•˜ì—¬ ìš”ì†Œë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.public class ThreadSafeDataStructureExample { public static void main(String[] args) { // ConcurrentHashMap ì˜ˆì œ ConcurrentHashMap&lt;String, Integer&gt; concurrentMap = new ConcurrentHashMap&lt;&gt;(); concurrentMap.put(\"Key1\", 1); concurrentMap.put(\"Key2\", 2); int value1 = concurrentMap.get(\"Key1\"); System.out.println(value1); // CopyOnWriteArrayList ì˜ˆì œ CopyOnWriteArrayList&lt;String&gt; copyOnWriteList = new CopyOnWriteArrayList&lt;&gt;(); copyOnWriteList.add(\"Item1\"); copyOnWriteList.add(\"Item2\"); String item1 = copyOnWriteList.get(0); System.out.println(item1); // ConcurrentLinkedQueue ì˜ˆì œ ConcurrentLinkedQueue&lt;Integer&gt; concurrentQueue = new ConcurrentLinkedQueue&lt;&gt;(); concurrentQueue.offer(1); concurrentQueue.offer(2); int element = concurrentQueue.poll(); System.out.println(element); }}ìœ„ì˜ ì˜ˆì œì—ì„œëŠ” ê°ê° ConcurrentHashMap, CopyOnWriteArrayList, ConcurrentLinkedQueueë¥¼ ì‚¬ìš©í•˜ì—¬ Thread-Safeí•œ ìë£Œêµ¬ì¡°ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ì´ ìë£Œêµ¬ì¡°ë“¤ì€ ì—¬ëŸ¬ ìŠ¤ë ˆë“œì—ì„œ ì•ˆì „í•˜ê²Œ ë™ì‘í•˜ë©°, ë™ì‹œì— ìš”ì†Œë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.7. ë™ì‹œì„± ë¬¸ì œì™€ ë””ë²„ê¹…ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ì—ì„œëŠ” ë™ì‹œì— ì‹¤í–‰ë˜ëŠ” ì—¬ëŸ¬ ìŠ¤ë ˆë“œë¡œ ì¸í•´ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ë¬¸ì œë“¤ì´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë™ì‹œì„± ë¬¸ì œë“¤ì€ ë²„ê·¸ì˜ ì›ì¸ì´ ë  ë¿ë§Œ ì•„ë‹ˆë¼ ì„±ëŠ¥ ì €í•˜ì™€ ì˜ëª»ëœ ë™ì‘ì„ ì•¼ê¸°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë²ˆ ì„¹ì…˜ì—ì„œëŠ” ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ì—ì„œ ì£¼ë¡œ ë°œìƒí•˜ëŠ” ë™ì‹œì„± ë¬¸ì œì˜ ì¢…ë¥˜ì™€ ë””ë²„ê¹… ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.7.1 ê²½í•© ìƒíƒœ (Race Condition)ê²½í•© ìƒíƒœëŠ” ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ê³µìœ ëœ ìì›ì— ë™ì‹œì— ì ‘ê·¼í•˜ê³  ìˆ˜ì •í•  ë•Œ ë°œìƒí•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤. ê²½í•© ìƒíƒœëŠ” ì˜ˆì¸¡í•  ìˆ˜ ì—†ëŠ” ê²°ê³¼ë¥¼ ì´ˆë˜í•˜ë©°, ìŠ¤ë ˆë“œ ìŠ¤ì¼€ì¤„ë§ê³¼ ê°™ì€ í™˜ê²½ ë³€í™”ì— ë”°ë¼ ê²°ê³¼ê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²½í•© ìƒíƒœë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” ìƒí˜¸ ë°°ì œ(Mutual Exclusion)ì™€ ê°™ì€ ë™ê¸°í™” ê¸°ë²•ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.7.2 êµì°©ìƒíƒœ (Deadlock)êµì°©ìƒíƒœëŠ” ë‘ ê°œ ì´ìƒì˜ ìŠ¤ë ˆë“œê°€ ì„œë¡œ ìƒëŒ€ë°©ì´ ì ìœ í•œ ìì›ì„ ê¸°ë‹¤ë¦¬ë©° ë¬´í•œíˆ ëŒ€ê¸°í•˜ëŠ” ìƒíƒœë¥¼ ë§í•©ë‹ˆë‹¤. ì´ëŠ” ìƒí˜¸ ë°°ì œ, ì ìœ ì™€ ëŒ€ê¸°, ë¹„ì„ ì , ìˆœí™˜ ëŒ€ê¸°ë¼ëŠ” ë„¤ ê°€ì§€ ì¡°ê±´ì´ ë™ì‹œì— ì¶©ì¡±ë  ë•Œ ë°œìƒí•©ë‹ˆë‹¤. êµì°©ìƒíƒœë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” êµì°©ìƒíƒœì˜ ì¡°ê±´ ì¤‘ í•˜ë‚˜ë¥¼ ì œê±°í•˜ê±°ë‚˜, êµì°©ìƒíƒœë¥¼ íšŒí”¼í•˜ê¸° ìœ„í•œ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.7.3 ìŠ¤ë ˆë“œ ì•ˆì „ì„± ë¬¸ì œìŠ¤ë ˆë“œ ì•ˆì „ì„± ë¬¸ì œëŠ” ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì ‘ê·¼í•˜ëŠ” ê³µìœ ëœ ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤. ìŠ¤ë ˆë“œ ê°„ì˜ ë°ì´í„° ê²½ìŸì´ ë°œìƒí•˜ì—¬ ë°ì´í„° ì¼ê´€ì„±ì´ ê¹¨ì§€ê±°ë‚˜ ì˜ëª»ëœ ì—°ì‚°ì´ ìˆ˜í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìŠ¤ë ˆë“œ ì•ˆì „ì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” ë™ê¸°í™” ë©”ì»¤ë‹ˆì¦˜ì„ ì‚¬ìš©í•˜ê±°ë‚˜ ìŠ¤ë ˆë“œ ì•ˆì „í•œ ìë£Œêµ¬ì¡°ë¥¼ í™œìš©í•´ì•¼ í•©ë‹ˆë‹¤.7.4 ë™ì‹œì„± ë¬¸ì œ ë””ë²„ê¹… ë°©ë²•ë™ì‹œì„± ë¬¸ì œë¥¼ ë””ë²„ê¹…í•˜ëŠ” ê²ƒì€ ë‹¤ë¥¸ ì¢…ë¥˜ì˜ ë²„ê·¸ë¥¼ ë””ë²„ê¹…í•˜ëŠ” ê²ƒë³´ë‹¤ ì–´ë µìŠµë‹ˆë‹¤. ë™ì‹œì„± ë¬¸ì œëŠ” ì‹¤í–‰ ì‹œì ì— ë”°ë¼ ê²°ê³¼ê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë©°, ì¼ì‹œì ì´ê³  ì¬í˜„ì´ ì–´ë ¤ì›Œì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ëª‡ ê°€ì§€ ë””ë²„ê¹… ê¸°ë²•ì„ í™œìš©í•˜ì—¬ ë™ì‹œì„± ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒì€ ë™ì‹œì„± ë¬¸ì œ ë””ë²„ê¹…ì— ë„ì›€ì´ ë˜ëŠ” ë°©ë²•ë“¤ì…ë‹ˆë‹¤. ë¡œê·¸ ë° ì¶œë ¥ ë¬¸ì¥ ë¶„ì„: ë¡œê·¸ì™€ ì¶œë ¥ ë¬¸ì¥ì„ ë¶„ì„í•˜ì—¬ ë™ì‹œì„± ë¬¸ì œì˜ ì›ì¸ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìŠ¤ë ˆë“œ ê°„ì˜ ìˆœì„œ, ë°ì´í„°ì˜ ìƒíƒœ ë° ë³€ê²½ ì´ë ¥ ë“±ì„ í™•ì¸í•˜ì—¬ ë¬¸ì œë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë™ê¸°í™” ê¸°ë²• ê²€í† : ë™ê¸°í™” ê¸°ë²•ì˜ ì ìš© ì—¬ë¶€ë¥¼ ê²€í† í•©ë‹ˆë‹¤. ê²½í•© ìƒíƒœë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ì ì ˆí•œ ë™ê¸°í™” ë©”ì»¤ë‹ˆì¦˜ì„ ì‚¬ìš©í•˜ê³ , êµì°©ìƒíƒœë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ êµì°©ìƒíƒœì˜ ì¡°ê±´ì„ ì œê±°í•˜ê±°ë‚˜ íšŒí”¼ ì•Œê³ ë¦¬ì¦˜ì„ ì ìš©í•©ë‹ˆë‹¤. ìŠ¤ë ˆë“œ ë™ì‘ ë¶„ì„: ê° ìŠ¤ë ˆë“œì˜ ë™ì‘ì„ ë¶„ì„í•˜ì—¬ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” ì‹œì ê³¼ ì¡°ê±´ì„ í™•ì¸í•©ë‹ˆë‹¤. ìŠ¤ë ˆë“œì˜ ë™ê¸°í™” ì˜ì—­, ê³µìœ  ë°ì´í„° ì ‘ê·¼, ëŒ€ê¸° ìƒíƒœ ë“±ì„ ê²€í† í•˜ì—¬ ë¬¸ì œì˜ ì›ì¸ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë„êµ¬ í™œìš©: ë‹¤ì–‘í•œ ë””ë²„ê¹… ë„êµ¬ë¥¼ í™œìš©í•˜ì—¬ ë™ì‹œì„± ë¬¸ì œë¥¼ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìŠ¤ë ˆë“œ ë¤í”„ ë¶„ì„ ë„êµ¬, ë°ë“œë½ ê²€ì¶œ ë„êµ¬, ëª¨ë‹ˆí„°ë§ ë„êµ¬ ë“±ì„ ì‚¬ìš©í•˜ì—¬ ë¬¸ì œë¥¼ ì§„ë‹¨í•˜ê³  í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ì™€ ê²€ì¦: ë™ì‹œì„± ë¬¸ì œë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ì ì ˆí•œ í…ŒìŠ¤íŠ¸ì™€ ê²€ì¦ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ì–‘í•œ ìƒí™©ì—ì„œì˜ ë™ì‹œì„± ë™ì‘ì„ ì‹œë®¬ë ˆì´ì…˜í•˜ê³  í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‘ì„±í•˜ì—¬ ë¬¸ì œë¥¼ ë°œê²¬í•˜ê³  ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë™ì‹œì„± ë¬¸ì œëŠ” ë³µì¡í•˜ê³  ì˜ˆì¸¡í•˜ê¸° ì–´ë ¤ìš´ ë¬¸ì œì´ì§€ë§Œ, ìœ„ì˜ ë””ë²„ê¹… ë°©ë²•ë“¤ì„ ì ì ˆíˆ í™œìš©í•˜ë©´ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë™ì‹œì„± ë¬¸ì œë¥¼ ì´í•´í•˜ê³  ì ì ˆí•œ ë™ê¸°í™” ê¸°ë²•ê³¼ ë””ë²„ê¹… ê¸°ë²•ì„ ì‚¬ìš©í•˜ì—¬ ì•ˆì •ì ì´ê³  íš¨ìœ¨ì ì¸ ë™ì‹œì„± í”„ë¡œê·¸ë¨ì„ ê°œë°œí•  ìˆ˜ ìˆë„ë¡ ë…¸ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.8. ê²°ë¡ ì´ ê¸€ì—ì„œëŠ” ìë°” ë©”ëª¨ë¦¬ ëª¨ë¸ê³¼ ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ì˜ ì¤‘ìš”ì„±ì„ ê°•ì¡°í•˜ì˜€ìŠµë‹ˆë‹¤. ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ì€ íš¨ìœ¨ì ì´ê³  ì•ˆì •ì ì¸ ë‹¤ì¤‘ ìŠ¤ë ˆë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ í•„ìˆ˜ì ì…ë‹ˆë‹¤.ìë°” ë©”ëª¨ë¦¬ ëª¨ë¸ì„ ì´í•´í•˜ê³ , ì ì ˆí•œ ë™ê¸°í™” ê¸°ë²•ì„ ì‚¬ìš©í•˜ì—¬ ìŠ¤ë ˆë“œ ê°„ì˜ ë™ê¸°í™”ë¥¼ ë³´ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ë™ê¸°í™”ë¥¼ í†µí•´ ê²½í•© ìƒíƒœì™€ ê°™ì€ ë™ì‹œì„± ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ìŠ¤ë ˆë“œ ê°„ì˜ í˜‘ë ¥ê³¼ í†µì‹ ì„ ìœ„í•´ wait(), notify(), notifyAll() ë©”ì„œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ê³ ê¸‰ ë™ì‹œì„± ê¸°ë²•ê³¼ íŒ¨í„´ì„ í™œìš©í•˜ì—¬ ë™ì‹œì„±ì„ ê°œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë™ì‹œì„± ë¬¸ì œì™€ ë””ë²„ê¹…ì— ëŒ€í•´ì„œëŠ” ë¡œê·¸ ë¶„ì„, ë™ê¸°í™” ê¸°ë²• ê²€í† , ìŠ¤ë ˆë“œ ë™ì‘ ë¶„ì„, ë„êµ¬ í™œìš©, í…ŒìŠ¤íŠ¸ì™€ ê²€ì¦ ë“±ì„ í†µí•´ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ìë°” ë©”ëª¨ë¦¬ ëª¨ë¸ê³¼ ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ì— ëŒ€í•œ ì´í•´ëŠ” ì•ˆì •ì ì´ê³  íš¨ìœ¨ì ì¸ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì„ ìœ„í•´ ì¤‘ìš”í•©ë‹ˆë‹¤. ê°œë°œìë“¤ì€ ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ì— ëŒ€í•œ ì£¼ì˜ì‚¬í•­ì„ ìˆ™ì§€í•˜ê³ , ì ì ˆí•œ ê¸°ë²•ê³¼ íŒ¨í„´ì„ í™œìš©í•˜ì—¬ ì•ˆì „í•˜ê³  ì„±ëŠ¥ ìš°ìˆ˜í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤." }, { "title": "JOOQ ì•Œì•„ë³´ê¸°", "url": "/posts/jooq/", "categories": "JOOQ", "tags": "JOOQ, Spring Boot", "date": "2023-04-19 08:12:00 +0900", "snippet": "JOOQJOOQë€?JOOQ(Java Oriented Querying)ëŠ” Javaë¥¼ ì‚¬ìš©í•˜ì—¬ ì•ˆì „í•œ SQL ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ í”„ë ˆì„ì›Œí¬ ì…ë‹ˆë‹¤. ê°œë°œìê°€ SQL ì¿¼ë¦¬ë¥¼ ë³´ë‹¤ ì§ê´€ì ì´ê³  ìì—°ìŠ¤ëŸ½ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ í•˜ë©° type-safeí•œ APIë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì»´íŒŒì¼ì‹œ ì˜¤ë¥˜ë¥¼ ë°œê²¬ / ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.JOOQëŠ” PostgreSQL, Oracle, MySQLê³¼ ê°™ì€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë“¤ì„ ì§€ì›í•©ë‹ˆë‹¤. NoSQLì€ ê¸°ë³¸ì ìœ¼ë¡œ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¼ë¶€ ì œí•œì ì¸ ê¸°ëŠ¥ì„ ì œê³µí•˜ê¸´ í•˜ëŠ”ë° ê·¸ëŸ´ë¹ ì—ì•¼ Spring Data MongoDB ì™€ ê°™ì´ í•´ë‹¹ ì˜ì—­ì— íŠ¹í™”ëœ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ìŠµë‹ˆë‹¤.JOOQëŠ” ë‹¨ìˆœ ì¿¼ë¦¬ ì‘ì—… ì™¸ì—ë„ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìƒì„±, ì½”ë“œ ìƒì„± ë° ê¸°íƒ€ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ ì‘ì—…ì„ ì§€ì›í•˜ë¯€ë¡œ Javaì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•í•˜ëŠ”ë° ìœ ìš©í•œ ë„êµ¬ì…ë‹ˆë‹¤.JOOQ vs QuerydslJOOQê³¼ Querydslì€ ê°œë°œìê°€ type-safeí•œ SQL ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤ëŠ” ê³µí†µì ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë‘ í”„ë ˆì„ì›Œí¬ ì‚¬ì´ì—ëŠ” ëª‡ê°€ì§€ ì°¨ì´ì ì´ ìˆìŠµë‹ˆë‹¤. DSL êµ¬ë¬¸ JOOQëŠ” SQL êµ¬ë¬¸ì„ ê¸°ë°˜ìœ¼ë¡œ DSLì„ ì‚¬ìš©í•©ë‹ˆë‹¤. Querydslì€ Java êµ¬ë¬¸ì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ëŠ” DSLì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì§€ì› ë²”ìœ„ JOOQëŠ” ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë“¤ì„ ì¤‘ì ìœ¼ë¡œ ì§€ì›í•©ë‹ˆë‹¤. Querydslì€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì™€ ë¹„ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤(NoSQL)ì„ ëª¨ë‘ ì§€ì›í•©ë‹ˆë‹¤. ì½”ë“œ ìƒì„± JOOQëŠ” ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ ê¸°ë°˜ìœ¼ë¡œ Java í´ë˜ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. QueryDSLì€ ìë°” ì½”ë“œë¥¼ ë°”íƒ•ìœ¼ë¡œ Java í´ë˜ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ ë‘˜ì¤‘ ë¬´ì—‡ì„ ì„ íƒí•´ì•¼ í•˜ëŠ”ê°€?ì‚¬ì‹¤ ê°œì¸ì ì¸ ìƒê°ìœ¼ë¡  JOOQì™€ Querydslë¥¼ ë¹„êµí•˜ëŠ”ê±´ ì˜ëª»ëë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. ì–´ë–¤ Persistence Frameworkë¥¼ ì„ íƒí–ˆëŠëƒ(ORMì´ëƒ SQLì´ëƒ) ì— ë”°ë¼ ë‹¬ë¼ì§€ê¸° ë•Œë¬¸ì´ì£ .ìŠ¤í”„ë§ ê¸°ë°˜ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí• ë•Œ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ Persistence Frameworkë¡œ ORM í˜¹ì€ SQL Mapperë¥¼ ì„ íƒí•©ë‹ˆë‹¤. ORMì˜ ê²½ìš° Hibernate - Spring Data JPA - Querydslì¡°í•©ì„ ì‚¬ìš©í•˜ê³  SQL Mapperì˜ ê²½ìš° MyBatisë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.SQL Mapper ë¥¼ ì„ íƒí–ˆë‹¤ë©´ JOOQëŠ” MyBatis ëŒ€ì‹  ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í”„ë ˆì„ì›Œí¬ë¼ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. XML ê¸°ë°˜ì¸ MyBatisì™€ ë‹¤ë¥´ê²Œ Javaë¡œ type-safeí•˜ê²Œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ì£ .ë”°ë¼ì„œ ë§Œì•½ ê°œë°œì¤‘ì¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ MyBatisë¥¼ ì‚¬ìš©í•˜ê³  type-safeí•˜ê²Œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆëŠ” í”„ë ˆì„ì›Œí¬ë¥¼ ì°¾ê³ ìˆë‹¤ë©´ JOOQëŠ” ì™„ë²½í•œ í”„ë ˆì„ì›Œí¬ë¼ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ORMì„ ì‚¬ìš©í•œë‹¤ë©´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ëŠ” Hibernate - Spring Data JPA - Querydslì¡°í•©ì„ ì‚¬ìš©í•˜ê³  í†µê³„ì„± ë°ì´í„°ë‚˜ ëŒ€ìš©ëŸ‰ ë°°ì¹˜ ì‘ì—…ì„ í• ë•Œ, í˜¹ì€ native queryê°€ í•„ìš”í•  ë•Œ JOOQë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.Spring Bootì—ì„œ JOOQ ì‚¬ìš©í•˜ê¸°Spring Boot ì—ì„œ JOOQë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.1.í™˜ê²½ì„¤ì •ë¹Œë“œ ë„êµ¬ëŠ” mavenì„ ì‚¬ìš©í•˜ë©° dbëŠ” PostgreSQLì„ ì‚¬ìš©í•©ë‹ˆë‹¤.&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jooq&lt;/artifactId&gt; &lt;version&gt;3.0.5&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.postgresql&lt;/groupId&gt; &lt;artifactId&gt;postgresql&lt;/artifactId&gt; &lt;version&gt;42.6.0&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;version&gt;3.0.5&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt;&lt;/dependencies&gt;ë‹¤ìŒìœ¼ë¡œ í…Œì´ë¸”ì„ ìƒì„±í•©ë‹ˆë‹¤.CREATE TABLE author ( id SERIAL NOT NULL PRIMARY KEY, first_name VARCHAR(50), last_name VARCHAR(50) NOT NULL);CREATE TABLE book ( id SERIAL NOT NULL PRIMARY KEY, title VARCHAR(100) NOT NULL);CREATE TABLE author_book( author_id INT NOT NULL, book_id INT NOT NULL, PRIMARY KEY (author_id, book_id), CONSTRAINT fk_ab_author FOREIGN KEY (author_id) REFERENCES author (id) ON UPDATE CASCADE ON DELETE CASCADE, CONSTRAINT fk_ab_book FOREIGN KEY (book_id) REFERENCES book (id));í…Œì´ë¸”ì„ ìƒì„±í–ˆë‹¤ë©´ spring datasourceë¥¼ ì •ì˜í•©ë‹ˆë‹¤. ë§Œì•½ ë°©ì–¸ì„ ì§€ì •í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ DEFAULT ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.spring.datasource.url=jdbc:postgresql://localhost:5432/jooqspring.datasource.username=usernamespring.datasource.password=passwordspring.datasource.driver-class-name=org.postgresql.Driverspring.jooq.sql-dialect= postgreslogging.level.org.jooq.tools.LoggerListener=DEBUGì´ì œ maven í”ŒëŸ¬ê·¸ì¸ì„ í†µí•´ ìƒì„±í•œ í…Œì´ë¸”ì„ ê¸°ë°˜ìœ¼ë¡œ ìë°” í´ë˜ìŠ¤ë¥¼ ìƒì„±í•  ê²ƒì…ë‹ˆë‹¤.&lt;plugin&gt; &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt; &lt;artifactId&gt;properties-maven-plugin&lt;/artifactId&gt; &lt;version&gt;1.1.0&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;phase&gt;initialize&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;read-project-properties&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;files&gt; &lt;file&gt;src/main/resources/application.properties&lt;/file&gt; &lt;/files&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt;&lt;/plugin&gt;&lt;plugin&gt; &lt;groupId&gt;org.jooq&lt;/groupId&gt; &lt;artifactId&gt;jooq-codegen-maven&lt;/artifactId&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;generate-postgres&lt;/id&gt; &lt;phase&gt;generate-sources&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;generate&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;!-- JDBC connection parameters --&gt; &lt;jdbc&gt; &lt;url&gt;${spring.datasource.url}&lt;/url&gt; &lt;user&gt;${spring.datasource.username}&lt;/user&gt; &lt;password&gt;${spring.datasource.password}&lt;/password&gt; &lt;driver&gt;${spring.datasource.driver-class-name}&lt;/driver&gt; &lt;/jdbc&gt; &lt;!-- Generator parameters --&gt; &lt;generator&gt; &lt;database&gt; &lt;name&gt; org.jooq.meta.postgres.PostgresDatabase &lt;/name&gt; &lt;includes&gt;.*&lt;/includes&gt; &lt;excludes/&gt; &lt;inputSchema&gt;public&lt;/inputSchema&gt; &lt;includeSystemSequences&gt;true&lt;/includeSystemSequences&gt; &lt;/database&gt; &lt;generate&gt; &lt;pojos&gt;true&lt;/pojos&gt; &lt;pojosEqualsAndHashCode&gt;true&lt;/pojosEqualsAndHashCode&gt; &lt;javaTimeTypes&gt;true&lt;/javaTimeTypes&gt; &lt;fluentSetters&gt;true&lt;/fluentSetters&gt; &lt;sequences&gt;true&lt;/sequences&gt; &lt;/generate&gt; &lt;target&gt; &lt;packageName&gt;com.keencho.jooq.model&lt;/packageName&gt; &lt;directory&gt;target/generated-sources/jooq&lt;/directory&gt; &lt;/target&gt; &lt;/generator&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt;&lt;/plugin&gt;í”„ë¡œí¼í‹° íŒŒì¼ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ properties-maven-pluginì„ ì‚¬ìš©í•©ë‹ˆë‹¤. jooq-codegen-maven í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ë©° ì„¤ì •ì— jdbc ì •ë³´, dbëª…, ì˜µì…˜, íƒ€ê²Ÿ íŒ¨í‚¤ì§€, íƒ€ê²Ÿ ë””ë ‰í† ë¦¬ ë“± í•„ìš”í•œ ì •ë³´ë“¤ì„ ì…ë ¥í•©ë‹ˆë‹¤.í•„ìš”í•œ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥ í–ˆë‹¤ë©´ mvn clean generate-sources ëª…ë ¹ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì•„ë˜ì²˜ëŸ¼ í´ë˜ìŠ¤ê°€ ìƒì„±ë˜ì—ˆë‹¤ë©´ ì„±ê³µì…ë‹ˆë‹¤.2. ì½”ë“œì‘ì„±1. ì „ì²˜ë¦¬í…ŒìŠ¤íŠ¸ ìˆ˜í–‰ ì „ì— í…Œì´ë¸”ì„ ì´ˆê¸°í™”í•˜ê³  ìƒˆë¡œìš´ ê°’ì„ ë„£ëŠ” ì „ì²˜ë¦¬ ì½”ë“œì…ë‹ˆë‹¤.@AutowiredDSLContext dslContext;@BeforeAllpublic void setUp() { // author dslContext.delete(AUTHOR).execute(); dslContext.alterSequence(AUTHOR_ID_SEQ).restart().execute(); dslContext .insertInto( AUTHOR, AUTHOR.FIRST_NAME, AUTHOR.LAST_NAME ) .valuesOfRows( Stream.of(\"í™ê¸¸ë™\", \"ê¹€ì² ìˆ˜\", \"ë°•ì˜í¬\").map(name -&gt; DSL.row( name.substring(0, 1), name.substring(1, 3) )).collect(Collectors.toList()) ) .execute(); // book dslContext.delete(BOOK).execute(); dslContext.alterSequence(BOOK_ID_SEQ).restart().execute(); dslContext .insertInto( BOOK, BOOK.TITLE ) .valuesOfRows( Stream.of( \"ì´í™í‹°ë¸Œ ìë°”\", \"ë¦¬íŒ©í† ë§\", \"DDD START!\", \"í† ë¹„ì˜ ìŠ¤í”„ë§3\", \"Do it! ì í”„ íˆ¬ íŒŒì´ì¬\", \"í˜¼ì ê³µë¶€í•˜ëŠ” ë¨¸ì‹ ëŸ¬ë‹+ë”¥ëŸ¬ë‹\", \"ê°œë°œìë¥¼ ìœ„í•œ ì±—GPT í™œìš©ë²•\", \"Cì–¸ì–´ë¡œ ì‰½ê²Œ í’€ì–´ì“´ ìë£Œêµ¬ì¡°\", \"ë¹„ì „ê³µìë„ ì´í•´í•  ìˆ˜ ìˆëŠ” AI ì§€ì‹\", \"ëª¨ë˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ Deep Dive\" ) .map(DSL::row) .collect(Collectors.toList()) ) .execute(); var rand = new Random(); var authorList = dslContext.selectFrom(AUTHOR).fetch(); var bookList = dslContext.selectFrom(BOOK).fetch(); bookList.forEach(book -&gt; dslContext .insertInto( AUTHOR_BOOK, AUTHOR_BOOK.AUTHOR_ID, AUTHOR_BOOK.BOOK_ID ) .valuesOfRows( DSL.row( authorList.get(rand.nextInt(authorList.size())).get(AUTHOR.ID), book.get(BOOK.ID) ) ) .execute() );} author, book, author_book í…Œì´ë¸”ì˜ ëª¨ë“  rowë¥¼ dslContext.delete(TABLE).excute() ë©”ì†Œë“œë¡œ ì‚­ì œí•©ë‹ˆë‹¤. ì‹œí€€ìŠ¤ê°€ ì¡´ì¬í•˜ëŠ” author, book í…Œì´ë¸”ì˜ ê²½ìš° dslContext.alterSequence(SEQUENCE).restart().execute() ë©”ì†Œë“œë¥¼ í†µí•´ ì‹œí€€ìŠ¤ë¥¼ ì´ˆê¸°í™” í•©ë‹ˆë‹¤. ê° í…Œì´ë¸”ì— ë°ì´í„°ë¥¼ ì‚½ì…í•©ë‹ˆë‹¤.ì°¸ê³ ë¡œ dslContextì˜ ê²½ìš° spring.datasourceë¥¼ ì˜¬ë°”ë¥´ê²Œ ì •ì˜í•˜ì˜€ë‹¤ë©´ JooqAutoConfiguration í´ë˜ìŠ¤ì— ì˜í•´ ìë™ìœ¼ë¡œ beanìœ¼ë¡œ ë“±ë¡ë˜ì–´ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.2. ì¡°íšŒí›„ custom classë¡œ ê²°ê³¼ ë°˜í™˜SELECT b.title, concat(a.first_name, a.last_name)FROM author_book ab LEFT JOIN author a ON ab.author_id = a.id LEFT JOIN book b ON ab.book_id = b.idWHERE a.first_name = 'í™';static class Projection { String author; String title;}@Testvoid fetchIntoCustomClass() { var list = dslContext .select( BOOK.TITLE, AUTHOR.FIRST_NAME.concat(AUTHOR.LAST_NAME).as(\"author\") ) .from(AUTHOR_BOOK) .leftJoin(AUTHOR).on(AUTHOR.ID.eq(AUTHOR_BOOK.AUTHOR_ID)) .leftJoin(BOOK).on(BOOK.ID.eq(AUTHOR_BOOK.BOOK_ID)) .where(AUTHOR.FIRST_NAME.eq(\"í™\")) .fetchInto(Projection.class); Assertions.assertTrue(list.stream().allMatch(item -&gt; StringUtils.hasText(item.title) &amp;&amp; item.author.charAt(0) == 'í™'));}select \"public\".\"book\".\"title\", (\"public\".\"author\".\"first_name\" || \"public\".\"author\".\"last_name\") as \"author\"from \"public\".\"author_book\" left outer join \"public\".\"author\" on \"public\".\"author\".\"id\" = \"public\".\"author_book\".\"author_id\" left outer join \"public\".\"book\" on \"public\".\"book\".\"id\" = \"public\".\"author_book\".\"book_id\"where \"public\".\"author\".\"first_name\" = 'í™'org.jooq.tools.LoggerListener - Fetched result : +-------------------+------+org.jooq.tools.LoggerListener - : |title |author|org.jooq.tools.LoggerListener - : +-------------------+------+org.jooq.tools.LoggerListener - : |í† ë¹„ì˜ ìŠ¤í”„ë§3 |í™ê¸¸ë™ |org.jooq.tools.LoggerListener - : |Do it! ì í”„ íˆ¬ íŒŒì´ì¬ |í™ê¸¸ë™ |org.jooq.tools.LoggerListener - : |Cì–¸ì–´ë¡œ ì‰½ê²Œ í’€ì–´ì“´ ìë£Œêµ¬ì¡° |í™ê¸¸ë™ |org.jooq.tools.LoggerListener - : |ëª¨ë˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ Deep Dive|í™ê¸¸ë™ |org.jooq.tools.LoggerListener - : +-------------------+------+org.jooq.tools.LoggerListener - Fetched row(s) : 4ê²°ê³¼ê°€ ì˜ ë°˜í™˜ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. aliasë¡œ í•„ë“œëª…ì„ ì§€ì •í•˜ë©´ í•´ë‹¹ í•„ë“œì— ê°’ì´ í• ë‹¹ë˜ëŠ” ê²ƒê¹Œì§€ ë§ˆìŒì— ë“œë„¤ìš”.3. updateUPDATE authorSET first_name = 'ì„±'WHERE id = 1 or id = 2;@Testvoid update() { var condition = AUTHOR.ID.eq(1).or(AUTHOR.ID.eq(2)); dslContext .update(AUTHOR) .set(AUTHOR.FIRST_NAME, \"ì„±\") .where(condition) .execute(); var list = dslContext.selectFrom(AUTHOR).where(condition).fetchInto(Author.class); Assertions.assertTrue(list.stream().allMatch(item -&gt; item.getFirstName().equals(\"ì„±\")));}update \"public\".\"author\"set \"first_name\" = 'ì„±'where ( \"public\".\"author\".\"id\" = 1 or \"public\".\"author\".\"id\" = 2)org.jooq.tools.LoggerListener - Affected row(s) : 2select \"public\".\"author\".\"id\", \"public\".\"author\".\"first_name\", \"public\".\"author\".\"last_name\"from \"public\".\"author\"where ( \"public\".\"author\".\"id\" = 1 or \"public\".\"author\".\"id\" = 2)org.jooq.tools.LoggerListener - Fetched result : +----+----------+---------+org.jooq.tools.LoggerListener - : | id|first_name|last_name|org.jooq.tools.LoggerListener - : +----+----------+---------+org.jooq.tools.LoggerListener - : | 1|ì„± |ê¸¸ë™ |org.jooq.tools.LoggerListener - : | 2|ì„± |ì² ìˆ˜ |org.jooq.tools.LoggerListener - : +----+----------+---------+org.jooq.tools.LoggerListener - Fetched row(s) : 2author í…Œì´ë¸”ì˜ idê°€ 1 í˜¹ì€ 2ì¸ rowì˜ first_nameì„ â€˜ì„±â€™ ìœ¼ë¡œ ë³€ê²½í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•˜ì˜€ê³  ì‘ì—…ì´ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.4. deleteDELETEFROM authorWHERE id = 1;@Testvoid delete() { dslContext.delete(AUTHOR).where(AUTHOR.ID.eq(1)).execute(); var authorList = dslContext.selectFrom(AUTHOR).fetchInto(Author.class); var authorBookList = dslContext.selectFrom(AUTHOR_BOOK).fetchInto(AuthorBook.class); Assertions.assertTrue(authorList.stream().noneMatch(item -&gt; item.getId() == 1)); Assertions.assertTrue(authorBookList.stream().noneMatch(item -&gt; item.getAuthorId() == 1));}delete from \"public\".\"author\"where \"public\".\"author\".\"id\" = 1org.jooq.tools.LoggerListener - Affected row(s) : 1select \"public\".\"author\".\"id\", \"public\".\"author\".\"first_name\", \"public\".\"author\".\"last_name\"from \"public\".\"author\"org.jooq.tools.LoggerListener - Fetched result : +----+----------+---------+org.jooq.tools.LoggerListener - : | id|first_name|last_name|org.jooq.tools.LoggerListener - : +----+----------+---------+org.jooq.tools.LoggerListener - : | 2|ê¹€ |ì² ìˆ˜ |org.jooq.tools.LoggerListener - : | 3|ë°• |ì˜í¬ |org.jooq.tools.LoggerListener - : +----+----------+---------+org.jooq.tools.LoggerListener - Fetched row(s) : 2select \"public\".\"author_book\".\"author_id\", \"public\".\"author_book\".\"book_id\"from \"public\".\"author_book\"org.jooq.tools.LoggerListener - Fetched result : +---------+-------+org.jooq.tools.LoggerListener - : |author_id|book_id|org.jooq.tools.LoggerListener - : +---------+-------+org.jooq.tools.LoggerListener - : | 3| 1|org.jooq.tools.LoggerListener - : | 3| 2|org.jooq.tools.LoggerListener - : | 2| 4|org.jooq.tools.LoggerListener - : | 2| 5|org.jooq.tools.LoggerListener - : | 3| 7|org.jooq.tools.LoggerListener - : +---------+-------+org.jooq.tools.LoggerListener - Fetched row(s) : 5 (or more)author í…Œì´ë¸”ì˜ idê°€ 1ì¸ rowë¥¼ ì‚­ì œí•˜ì˜€ê³  author, author_book í…Œì´ë¸”ì˜ rowê°€ ì‚­ì œëœê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë²ˆì™¸(DAOImpl)JOOQëŠ” ì¤‘ë³µë˜ëŠ” ë¶ˆí•„ìš”í•œ ì½”ë“œë¥¼ ì¤„ì´ê¸° ìœ„í•´ ìƒì„±ëœ DAOì— ëŒ€í•œ ê¸°ë³¸ êµ¬í˜„ì²´ë“¤ì„ ì œê³µí•©ë‹ˆë‹¤. ìŠ¤í”„ë§ í™˜ê²½ì—ì„œëŠ” AbstractSpringDAOImpl í´ë˜ìŠ¤ë¥¼ ìƒì†í•œ DAOë¥¼ ì£¼ì…ë°›ì•„ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©° ì´ DAO í´ë˜ìŠ¤ëŠ” jooq-codegen-maven í”ŒëŸ¬ê·¸ì¸ì— ì„¤ì •ê°’ì„ ì¶”ê°€í•˜ëŠ”ê²ƒìœ¼ë¡œ ì‰½ê²Œ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;generate&gt; &lt;pojos&gt;true&lt;/pojos&gt; &lt;pojosEqualsAndHashCode&gt;true&lt;/pojosEqualsAndHashCode&gt; &lt;javaTimeTypes&gt;true&lt;/javaTimeTypes&gt; &lt;fluentSetters&gt;true&lt;/fluentSetters&gt; &lt;sequences&gt;true&lt;/sequences&gt; &lt;!-- for spring--&gt; &lt;daos&gt;true&lt;/daos&gt; &lt;springDao&gt;true&lt;/springDao&gt; &lt;springAnnotations&gt;true&lt;/springAnnotations&gt;&lt;/generate&gt;doas, spirngDao, springAnnotations ì„¸ê°œì˜ ì„¤ì •ê°’ì„ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤. ì„¤ì •ê°’ì„ ì¶”ê°€í–ˆë‹¤ë©´ ì½”ë“œë¥¼ ìƒì„±í•˜ê³  ê´€ë ¨ í´ë˜ìŠ¤ë“¤ì´ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.ê·¸ëŸ¼ ì´ì œ ìƒì„±ëœ DAOë“¤ì„ ì£¼ì…ë°›ê³  ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.@AutowiredAuthorDao authorDao;@AutowiredAuthorBookDao authorBookDao;@Testvoid select() { var list = authorDao.fetch(Tables.AUTHOR.FIRST_NAME, \"í™\"); Assertions.assertTrue(list.stream().allMatch(item -&gt; item.getFirstName().equals(\"í™\")));}@Testvoid update() { authorDao.update( authorDao .fetchRangeOfId(1, 2) .stream() .peek(item -&gt; item.setFirstName(\"ì„±\")) .collect(Collectors.toList()) ); Assertions.assertTrue(authorDao.fetchRangeOfId(1, 2).stream().allMatch(item -&gt; item.getFirstName().equals(\"ì„±\")));}@Testvoid delete() { authorDao.deleteById(1); Assertions.assertFalse(authorDao.existsById(1)); Assertions.assertTrue(authorBookDao.fetchByAuthorId(1).isEmpty());}í™•ì‹¤íˆ ì½”ë“œê°€ ì¤„ê¸´ í–ˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ ê·¸ëƒ¥ dslContextë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì— ë¹„í•´ ë§ì€ ê¸°ëŠ¥(ë©”ì†Œë“œ)ë“¤ì´ ì œê±°ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ê°„ë‹¨í•œ ì¿¼ë¦¬ì •ë„ì—ë§Œ ì‚¬ìš©í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” dslContextë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ì•„ ë³´ì…ë‹ˆë‹¤.ê²°ë¡ JOOQì— ëŒ€í•´ ì‚´í´ ë³´ì•˜ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ì‚´í´ë³¸ ì˜ˆì œëŠ” ì •ë§ ê°„ë‹¨í•œ CRUDë§Œ í…ŒìŠ¤íŠ¸ í•´ë³¸ ê²ƒìœ¼ë¡œ ì‹¤ì œ JOOQëŠ” ë³´ë‹¤ ë§ì€ DBì˜ ê¸°ëŠ¥ì„ ì§€ì›í•©ë‹ˆë‹¤.ë˜í•œ ë¬¸ì„œê°€ ë§¤ìš° ì˜ë˜ì–´ ìˆì–´ì„œ ì²˜ìŒ ì‹œì‘í•˜ì‹œëŠ” ë¶„ë“¤ë„ ìµœì†Œí•œì˜ ì‚½ì§ˆë¡œ ì‚¬ìš©í•´ ë³´ì‹¤ ìˆ˜ ìˆì„ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë§Œì•½ ORMì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  SQL Mapper ê¸°ë°˜ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œì¤‘ì´ì‹œê±°ë‚˜ ê¸°ì¡´ì˜ Querydslì— ìµìˆ™í•˜ì‹  ë¶„ë“¤ì´ë¼ë©´ JOOQë¥¼ ì‚¬ìš©í•´ ë³´ì‹œëŠ”ê²Œ ì–´ë–¨ê¹Œìš”? ìœ ì € ë§¤ë‰´ì–¼: https://www.jooq.org/doc/latest/manual í¬ìŠ¤íŒ…ì— ì‚¬ìš©ëœ ì½”ë“œ: https://github.com/keencho/java-sandbox/tree/master/blog-example-code/use-jooq-in-spring-boot" }, { "title": "Web Worker", "url": "/posts/web-workers/", "categories": "Javascript", "tags": "Javascript", "date": "2023-04-13 12:12:00 +0900", "snippet": "Web Workerê°œìš”JavascriptëŠ” ì‹±ê¸€ ìŠ¤ë ˆë“œë¡œ ë™ì‘í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ìì²´ëŠ” ì‹±ê¸€ ìŠ¤ë ˆë“œë¡œ ë™ì‘í•˜ì§€ ì•Šìœ¼ë©° ë¸Œë¼ìš°ì €ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìŠ¤ë ˆë“œë“¤ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë©”ì¸ ìŠ¤ë ˆë“œ(Main Thread): ë¸Œë¼ìš°ì €ì˜ ì£¼ìš” ìŠ¤ë ˆë“œë¡œ, HTML, CSS, JavaScriptì˜ ì²˜ë¦¬, ë Œë”ë§, ì´ë²¤íŠ¸ ì²˜ë¦¬, ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì²˜ë¦¬ ë“±ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤. ë Œë”ë§ ìŠ¤ë ˆë“œ(Rendering Thread): ë¸Œë¼ìš°ì € ì°½ì— ë‚´ìš©ì„ ê·¸ë¦¬ëŠ” ë° í•„ìš”í•œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ìŠ¤ë ˆë“œì…ë‹ˆë‹¤. ë ˆì´ì•„ì›ƒ ê³„ì‚°, í˜ì¸íŒ… ì‘ì—… ë“±ì´ ì—¬ê¸°ì— í¬í•¨ë©ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ìŠ¤ë ˆë“œ(Network Thread): ë„¤íŠ¸ì›Œí¬ ìš”ì²­ê³¼ ì‘ë‹µ ì²˜ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” ìŠ¤ë ˆë“œì…ë‹ˆë‹¤. JavaScript ì—”ì§„ ìŠ¤ë ˆë“œ(JavaScript Engine Thread): JavaScript ì½”ë“œë¥¼ ì²˜ë¦¬í•˜ëŠ” ìŠ¤ë ˆë“œë¡œ, V8 ì—”ì§„ ë“±ì˜ JavaScript ì—”ì§„ì´ ì—¬ê¸°ì— ì†í•©ë‹ˆë‹¤. ì´ë²¤íŠ¸ ë£¨í”„ ìŠ¤ë ˆë“œ(Event Loop Thread): ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•œ ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ì‹¤í–‰í•˜ëŠ” ìŠ¤ë ˆë“œì…ë‹ˆë‹¤. Web Worker ìŠ¤ë ˆë“œ: ì›¹ ì›Œì»¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë³‘ë ¬ ì²˜ë¦¬ë¥¼ ì§€ì›í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ìŠ¤ë ˆë“œì…ë‹ˆë‹¤. Web WorkerëŠ” ë©”ì¸ ìŠ¤ë ˆë“œì™€ ë³„ê°œë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.ë‹¤ìŒê³¼ ê°™ì´ íŒ©í† ë¦¬ì–¼ì„ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ê°€ ìˆë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤.&lt;body&gt; &lt;button id=\"btn\"&gt;Button&lt;/button&gt;&lt;/body&gt;&lt;script&gt; document .getElementById('btn') .addEventListener('click', function() { alert('You clicked the button.') }); function doFactorial(number) { let result = BigInt(1); for (let i = 1; i &lt;= number; i ++) { result *= BigInt(i); } return result; } doFactorial(100000)&lt;/script&gt;ë²„íŠ¼ì— ì´ë²¤íŠ¸ë¥¼ ë°”ì¸ë”©í•˜ê³  doFactorial() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ íŒ©í† ë¦¬ì–¼ì„ ê³„ì‚°í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì‹¤í–‰ì‹œì¼œë³´ë©´ ë¸Œë¼ìš°ì €ëŠ” ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.ì„¤ë ¹ ë²„íŠ¼ UIê°€ ë Œë”ë§ ë˜ì—ˆë‹¤ê³  í•´ë„ ë²„íŠ¼ì„ í´ë¦­í•  ìˆ˜ ì—†ì„ ê²ƒì…ë‹ˆë‹¤. ë²„íŠ¼ì„ í´ë¦­í•  ìˆ˜ ì—†ëŠ” ì‹œê°„ì€ doFactorial() í•¨ìˆ˜ì˜ ì¸ìê°’ì´ ì»¤ì§€ë©´ ì»¤ì§ˆìˆ˜ë¡ ëŠ˜ì–´ë‚©ë‹ˆë‹¤.ì›ì¸ì€ ê°„ë‹¨í•©ë‹ˆë‹¤. ë Œë”ë§, í•¨ìˆ˜ ì²˜ë¦¬ê°€ ëª¨ë‘ ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. doFactorial() í•¨ìˆ˜ê°€ ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ë™ì‘í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ê·¸ ê¸°ê°„ë™ì•ˆì€ UIì™€ ê´€ë ¨ëœ ì´ë²¤íŠ¸ë“¤ì€ ì²˜ë¦¬í•  ìˆ˜ ì—†ê²Œ ë˜ëŠ” ê²ƒì´ì£ .async function doFactorial(number) { let result = BigInt(1); for (let i = 1; i &lt;= number; i ++) { result *= BigInt(i); } return result;}doFactorial(1000000)ì´ë²ˆì—ëŠ” doFactorial() í•¨ìˆ˜ë¥¼ ë¹„ë™ê¸° í•¨ìˆ˜ë¡œ ë°”ê¾¸ê³  ì‹¤í–‰í•´ ë´…ì‹œë‹¤. ì´ë²ˆì—ëŠ” ë²„íŠ¼ì„ í´ë¦­í•  ìˆ˜ ìˆì„ê¹Œìš”?ì•ˆíƒ€ê¹ìë§Œ ê²°ê³¼ëŠ” ë™ì¼í•©ë‹ˆë‹¤. ì½”ë“œ ë¸”ë¡œí‚¹ì´ ë°œìƒí•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë¹„ë™ê¸° ì‘ì—…ë„ ì¼ë°˜ì ìœ¼ë¡œ ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ë§¤ìš° í° ê³„ì‚°ì´ë‚˜ ë¬´í•œ ë°˜ë³µ ë£¨í”„ë¥¼ ì‹¤í–‰í•˜ì—¬ ì½”ë“œ ë¸”ë¡œí‚¹ì´ ë°œìƒí•˜ëŠ” ê²½ìš° ë©”ì¸ ìŠ¤ë ˆë“œê°€ ì°¨ë‹¨ë˜ì–´ë‹¤ë¥¸ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤.Web workerì´ëŸ´ë•Œ Web workerë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤. Web workerëŠ” ë…ë¦½ì ì¸ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë©”ì¸ ìŠ¤ë ˆë“œì™€ ê´€ê³„ ì—†ì´ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.Web worker ScopeWeb workerëŠ” ë³„ë„ì˜ ìŠ¤ì½”í”„ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤. Web worker ìŠ¤ì½”í”„ëŠ” ì „ì—­ê°ì²´ window ë¥¼ ê°–ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ Web worker ì—ì„œ DOM APIì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë§Œì•½ UI ì—…ë°ì´íŠ¸ë¥¼ ìˆ˜í–‰í•˜ê³ ì í•œë‹¤ë©´ ë©”ì¸ ìŠ¤ë ˆë“œì™€ì˜ í†µì‹ ì´ í•„ìš”í•©ë‹ˆë‹¤.ëŒ€ì‹  self ë¥¼ ì‚¬ìš©í•˜ì—¬ Web workerë§Œì˜ ìŠ¤ì½”í”„ì¸ WorkerGlobalScope ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ importScriopts() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¡œë“œí•˜ê³  í•´ë‹¹ ìŠ¤í¬ë¦½íŠ¸ì˜ ì „ì—­ ë³€ìˆ˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ErrorWeb worker ë‚´ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš° ë©”ì¸ ìŠ¤ë ˆë“œì— ì „íŒŒë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë§Œ ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ì—ëŸ¬ë¥¼ í™•ì¸í•´ì•¼ í•˜ëŠ” ê²½ìš° .onerror() ë©”ì†Œë“œë¥¼ í†µí•´ ì—ëŸ¬ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.// Web Worker ë‚´ì—ì„œ onerror ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡worker.onerror = function(event) { console.error(event.message);};ì‘ì—… ì†ë„ &amp; ìì› ì ìœ Web workerì˜ ì‘ì—… ì†ë„ì— ì˜í–¥ì„ ì£¼ëŠ” ìš”ì†ŒëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. CPU ì„±ëŠ¥: Web WorkerëŠ” JavaScript ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ë°ì— CPUë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë”°ë¼ì„œ CPU ì„±ëŠ¥ì´ ë†’ì„ìˆ˜ë¡ Web Workerì˜ ì‘ì—… ì†ë„ê°€ ë¹¨ë¼ì§‘ë‹ˆë‹¤. ë©”ëª¨ë¦¬ ìš©ëŸ‰: Web Workerê°€ ì‚¬ìš©í•˜ëŠ” ë©”ëª¨ë¦¬ ìš©ëŸ‰ì´ ë§ì„ìˆ˜ë¡ ë¸Œë¼ìš°ì €ì˜ ì„±ëŠ¥ì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•œ ìƒí™©ì—ì„œëŠ” ë¸Œë¼ìš°ì €ê°€ Web Workerë¥¼ ì¤‘ì§€í•˜ê±°ë‚˜ ì‘ì—… ì†ë„ê°€ ëŠë ¤ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­: Web Workerê°€ ë„¤íŠ¸ì›Œí¬ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê²½ìš°, ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ì´ ì‘ì„ìˆ˜ë¡ Web Workerì˜ ì‘ì—… ì†ë„ê°€ ëŠë ¤ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ ëŒ€ìš©ëŸ‰ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ê±°ë‚˜ ì—…ë¡œë“œí•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê²½ìš°ì—ëŠ” ì´ëŸ¬í•œ ì˜í–¥ì´ í½ë‹ˆë‹¤. ì‘ì—…ì˜ ë³µì¡ë„: Web Workerê°€ ìˆ˜í–‰í•˜ëŠ” ì‘ì—…ì˜ ë³µì¡ë„ê°€ ë†’ì„ìˆ˜ë¡ ì‘ì—… ì†ë„ê°€ ëŠë ¤ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í° ë°°ì—´ì„ ì •ë ¬í•˜ëŠ” ì‘ì—…ì€ ë” ë§ì€ ì‹œê°„ì´ ì†Œìš”ë©ë‹ˆë‹¤. ì›¹ ë¸Œë¼ìš°ì €ì˜ ì¢…ë¥˜: Web Workerì˜ ì‘ì—… ì†ë„ëŠ” ì›¹ ë¸Œë¼ìš°ì €ì˜ ì¢…ë¥˜ì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ì‘ì—… ì†ë„ê°€ ë‹¤ë¥´ê²Œ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë§Œì•½ ë¸Œë¼ìš°ì €ì—ì„œ ì‚¬ìš©í• ìˆ˜ ìˆëŠ” CPUì˜ ìµœëŒ€ì¹˜ê°€ 100ì´ë¼ê³  ê°€ì •í•´ ë´…ì‹œë‹¤. ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ 30ì˜ CPUë¥¼ ì‚¬ìš©í•œë‹¤ê³  í•˜ë©´, Web workerì˜ ìŠ¤ë ˆë“œëŠ” ì–¼ë§ˆë§Œí¼ì˜ CPU ìì›ì„ ì‚¬ìš©í• ìˆ˜ ìˆì„ê¹Œìš”?Web workerëŠ” ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì—, ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œì˜ CPU ì ìœ ìœ¨ê³¼ëŠ” ë…ë¦½ì ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ 30ì˜ CPUë¥¼ ì ìœ í•˜ê³  ìˆë”ë¼ë„, Web worker ìŠ¤ë ˆë“œëŠ” ì—¬ì „íˆ ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ìì›ì˜ ìµœëŒ€ì¹˜ì¸ 100ê¹Œì§€ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.í•˜ì§€ë§Œ, ì‹¤ì œë¡œ Web workerì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ CPU ìì›ì˜ ì–‘ì€ ì‹œìŠ¤í…œ ìƒí™©ì— ë”°ë¼ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ìš´ì˜ì²´ì œë‚˜ ë¸Œë¼ìš°ì € ìì²´ì ìœ¼ë¡œ ìŠ¤ë ˆë“œë³„ CPU ìì›ì˜ í• ë‹¹ëŸ‰ì„ ì¡°ì •í•˜ê±°ë‚˜, ì‹œìŠ¤í…œì˜ ì „ì²´ ìì›ì´ ë¶€ì¡±í•  ê²½ìš° Web workerë„ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ Web workerë¥¼ ì‚¬ìš©í•  ë•Œì—ëŠ”, íŠ¹ì • ì‘ì—…ì´ ì–¼ë§ˆë‚˜ ë§ì€ CPU ìì›ì„ ì‚¬ìš©í•˜ëŠ”ì§€ ê³ ë ¤í•˜ê³ , ê°€ëŠ¥í•˜ë©´ ì—¬ëŸ¬ ê°œì˜ Web workerë¥¼ ì‚¬ìš©í•˜ì—¬ ì‘ì—…ì„ ë¶„ì‚°ì‹œí‚¤ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.ì¥ë‹¨ì ì¥ì  ë©€í‹° ìŠ¤ë ˆë“œ ì²˜ë¦¬: Web WorkerëŠ” ë©”ì¸ ìŠ¤ë ˆë“œì™€ ë³„ê°œì˜ ìŠ¤ë ˆë“œì—ì„œ ë™ì‘í•˜ë¯€ë¡œ, ë©”ì¸ ìŠ¤ë ˆë“œì™€ ë³„ê°œë¡œ ë³‘ë ¬ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ë³µì¡í•œ ê³„ì‚°ì´ë‚˜ ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ë“±ì„ ë¹ ë¥´ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•ˆì •ì„±: Web WorkerëŠ” ë©”ì¸ ìŠ¤ë ˆë“œì™€ ë…ë¦½ì ìœ¼ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì—, Web Workerì—ì„œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ê°€ ë©”ì¸ ìŠ¤ë ˆë“œì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤. ë˜í•œ Web WorkerëŠ” í¬ë˜ì‹œë‚˜ ë²„ê·¸ë¡œ ì¸í•´ ì „ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë©ˆì¶”ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ì„±: Web WorkerëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” JavaScriptì™€ ë™ì¼í•œ ë¬¸ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ê°œë°œìê°€ ì¶”ê°€ì ì¸ í•™ìŠµ ì—†ì´ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë‹¨ì  UI ì¡°ì‘ ì œí•œ: Web WorkerëŠ” ë©”ì¸ ìŠ¤ë ˆë“œì™€ ë…ë¦½ì ìœ¼ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì—, UI ì¡°ì‘ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ë”°ë¼ì„œ Web Worker ë‚´ì—ì„œ UI ì¡°ì‘ì„ í•´ì•¼í•˜ëŠ” ê²½ìš°, ë©”ì¸ ìŠ¤ë ˆë“œì™€ ë©”ì‹œì§€ë¥¼ ì£¼ê³ ë°›ì•„ì•¼ í•©ë‹ˆë‹¤. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: Web WorkerëŠ” ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì—, ì¶”ê°€ì ì¸ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë”°ë¼ì„œ Web Workerë¥¼ ì§€ì†ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŒŒì¼ ë¡œë”© ì œì•½: Web WorkerëŠ” ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì—, ë©”ì¸ ìŠ¤ë ˆë“œì™€ ë³„ê°œì˜ íŒŒì¼ ë¡œë”©ì„ í•´ì•¼í•©ë‹ˆë‹¤. ë”°ë¼ì„œ Web Workerì—ì„œ ë¡œë”©í•  ìˆ˜ ìˆëŠ” íŒŒì¼ì˜ ì¢…ë¥˜ê°€ ì œí•œì ì…ë‹ˆë‹¤.ì˜ˆì œê°„ë‹¨í•œ ì˜ˆì œë¥¼ í†µí•´ Web workerì˜ ì‚¬ìš©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤. Web workerê°€ ì‹¤í–‰ë  ìˆ˜ ìˆëŠ” ë³„ë„ì˜ íŒŒì¼ì´ í•„ìš”í•©ë‹ˆë‹¤.// worker.jsself.onmessage = function(event) { console.log('message received'); const number = event.data; let result = BigInt(1); for (let i = 1; i &lt;= number; i ++) { result *= BigInt(i); } self.postMessage(result);}worker íŒŒì¼ì—ì„œ selfë¥¼ ì´ìš©í•˜ì—¬ WorkerGlobalScope ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. í•´ë‹¹ ìŠ¤ì½”í”„ì— ì ‘ê·¼í•˜ì—¬ ë©”ì„¸ì§€ë¥¼ ìˆ˜ì‹ í–ˆì„ë•Œ íŒ©í† ë¦¬ì–¼ì„ ê³„ì‚°í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ë„˜ê²¨ì§„ íŒŒë¼ë¯¸í„°ëŠ” event.dataë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ê³„ì‚°ì´ ëë‚œ ê²½ìš° self.postMessage() ë©”ì†Œë“œë¥¼ í†µí•´ ê²°ê³¼ê°’ì„ ì „ë‹¬í•©ë‹ˆë‹¤.// main.jsif (window.Worker) { const worker = new Worker('worker.js'); worker.postMessage(1000000); worker.onmessage = function(event) { console.log('result: ', event.data); worker.terminate(); }} new Worker() ìƒì„±ìë¥¼ í†µí•´ Web worker ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. worker.postMessage() ë©”ì†Œë“œë¥¼ í†µí•´ íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤. worker.onmessage() ë©”ì†Œë“œë¥¼ í†µí•´ ê²°ê³¼ë¥¼ ì „ë‹¬ë°›ê³  consoleì— ê²°ê³¼ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤. ì´ë•Œ wokerì—ì„œ íŒŒë¼ë¯¸í„°ì— ì ‘ê·¼í•˜ëŠ” ë°©ì‹ê³¼ ë™ì¼í•˜ê²Œ event.dataë¡œ ê²°ê³¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë” ì´ìƒ ìˆ˜í–‰í•  ì‘ì—…ì´ ì—†ì„ë• worker.terminate() ë©”ì†Œë“œë¡œ workerë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤." }, { "title": "JPA ì—ì„œ Java Record ì‚¬ìš©í•˜ê¸°", "url": "/posts/use-java-record-in-jpa-hibernate/", "categories": "JPA", "tags": "JPA, Hibernate", "date": "2023-03-09 20:12:00 +0900", "snippet": "JPA ì—ì„œ Java Record ì‚¬ìš©í•˜ê¸°Java Recordìë°” ë ˆì½”ë“œëŠ” JDK14ì—ì„œ previewë¡œì¨ ì²˜ìŒ ë“±ì¥í–ˆìœ¼ë©° JDK16ì—ì„œ ì •ì‹ ìŠ¤í™ìœ¼ë¡œ í¬í•¨ëœ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ì´ëŠ” í´ë˜ìŠ¤ì˜ ê¸°ëŠ¥ê³¼ ë°ì´í„° êµ¬ì¡°ë¥¼ ê²°í•©í•œ ìƒˆë¡œìš´ í´ë˜ìŠ¤ ìœ í˜•ì…ë‹ˆë‹¤.ë ˆì½”ë“œëŠ” record ì˜ˆì•½ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë ˆì½”ë“œì˜ êµ¬ì„±ìš”ì†Œë“¤ì€ ë©”ì„œë“œì˜ ë§¤ê°œë³€ìˆ˜ ì •ì˜ì™€ ë™ì¼í•œ í˜•íƒœì˜ êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ì •ì˜ë˜ë©° íƒ€ì…ê³¼ ì´ë¦„ì„ í¬í•©í•©ë‹ˆë‹¤.ì˜ˆë¥¼ë“¤ì–´ ì¢Œí‘œë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë ˆì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.public record Coordinates(double x, double y) { ...}ë‘ ì¢Œí‘œ (x, y)ë¥¼ ë³´ìœ í•˜ëŠ” ë¶ˆë³€ ê°ì²´ë¥¼ ìƒì„±í•˜ë©° ê¸°ì¡´ í´ë˜ìŠ¤ í˜•íƒœì˜ ê°ì²´ì—ì„œ ì¼ë°˜ì ìœ¼ë¡œ ì •ì˜í•œ ìƒìš©ì–´êµ¬ ì½”ë“œ (constructor, getter, toString, hashCode, equals)ë¥¼ ì •ì˜í•˜ì§€ ì•Šì•„ë„ ê¸°ë³¸ êµ¬í˜„ì„ ì œê³µí•˜ë¯€ë¡œ í´ë˜ìŠ¤ë³´ë‹¤ ê°„ê²°í•œ ë°©ë²•ìœ¼ë¡œ ê°ì²´ë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.Entityë¡œ ì‚¬ìš©í•˜ê¸°ì•„ì‰½ê²Œë„ JPAì—ì„œëŠ” Recordë¥¼ Entityë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. JPA ì‚¬ì–‘ì„ ë§Œì¡±í•˜ëŠ” ì—”í‹°í‹° ê°ì²´ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. @Entity ì–´ë…¸í…Œì´ì…˜ì´ ì„ ì–¸ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ë§¤ê°œë³€ìˆ˜ê°€ ì—†ëŠ” ìƒì„±ìê°€ public í˜¹ì€ protectedìœ¼ë¡œ ì„ ì–¸ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. JPA êµ¬í˜„ì²´ë“¤ì´ ì¿¼ë¦¬ ê²°ê³¼ë¥¼ ë§¤í•‘í• ë•Œ ê°ì²´ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™” í• ìˆ˜ ìˆì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. JPA êµ¬í˜„ì²´ê°€ í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— finalë¡œ ì„ ì–¸ë˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤. ì—”í‹°í‹° ê°ì²´ì„ì„ í™•ì¸í•˜ê¸° ìœ„í•´ í•˜ë‚˜ í˜¹ì€ ê·¸ ì´ìƒì˜ í•„ë“œë¥¼ ì„ ì–¸í•´ì•¼ í•©ë‹ˆë‹¤. í•„ë“œë¥¼ db ì»¬ëŸ¼ìœ¼ë¡œ ë§¤í•‘í•˜ê¸° ìœ„í•´ì„œ í•„ë“œëŠ” finalì´ ì•„ë‹ˆì–´ì•¼ í•©ë‹ˆë‹¤. í•„ë“œì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ getterì™€ setterë¥¼ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.ë ˆì½”ë“œëŠ” ë§¤ê°œ ë³€ìˆ˜ê°€ ì—†ëŠ” ìƒì„±ìë¥¼ ì§€ì›í•˜ì§€ ì•Šìœ¼ë©° í´ë˜ìŠ¤ ìì²´ê°€ final í´ë˜ìŠ¤ì…ë‹ˆë‹¤. ë ˆì½”ë“œì˜ í•„ë“œë“¤ ë˜í•œ finalì´ë©°, ì ‘ê·¼ ë©”ì†Œë“œë“¤ ë˜í•œ ìš”êµ¬ì‚¬í•­ì— ì í•©í•œ ë„¤ì´ë° ì „ëµì„ ë”°ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì´ìœ ë“¤ ë•Œë¬¸ì— ì•„ì§ê¹Œì§€ JPA ì—ì„œëŠ” Recordë¥¼ Entityë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.DTOë¡œ ì‚¬ìš©í•˜ê¸°ì¡°íšŒí•œ ì •ë³´ë¥¼ ë³€ê²½í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ DTOëŠ” ìµœê³ ì˜ ì„ íƒì…ë‹ˆë‹¤. ì´ëŠ” ì—”í‹°í‹°ë¥¼ ì§ì ‘ ì¡°íšŒí•˜ëŠ” ê²ƒë³´ë‹¤ ì„±ëŠ¥ì´ ë›°ì–´ë‚˜ë©° ë„ë©”ì¸ ëª¨ë¸ê³¼ APIë¥¼ ë¶„ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.JPAì˜ Criteriabuilder.construct ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ CriteriaQueryì—ì„œ ìƒì„±ì í˜¸ì¶œì„ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.public record OrderRecord( String id, OrderStatus status, String fromAddress, String fromName, String fromPhoneNumber, String toAddress, String toName, String toPhoneNumber, String itemName, int itemPrice, LocalDateTime createdDateTime) { }@Testpublic void recordDTO() { var cb = entityManager.getCriteriaBuilder(); var cq = cb.createQuery(OrderRecord.class); var root = cq.from(Order.class); cq.select( cb.construct( OrderRecord.class, root.get(Order_.id), root.get(Order_.status), root.get(Order_.fromAddress), root.get(Order_.fromName), root.get(Order_.fromPhoneNumber), root.get(Order_.toAddress), root.get(Order_.toName), root.get(Order_.toPhoneNumber), root.get(Order_.itemName), root.get(Order_.itemPrice), root.get(Order_.createdDateTime) ) ); cq.where(cb.notEqual(root.get(Order_.status), OrderStatus.FAILED)); var q = entityManager.createQuery(cq); var list = q.getResultList();}ì„ë² ë””ë“œ ê°ì²´ë¡œ ì‚¬ìš©í•˜ê¸°Hibernate &lt; 6.0Hiberante 6.0 ì´ì „ ë²„ì „ì—ì„œëŠ” record ê°ì²´ë¥¼ ì„ë² ë””ë“œ ê°ì²´ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ìœ ëŠ” ìœ„ì˜ record ê°ì²´ë¥¼ entityë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ì´ìœ ì™€ ê°™ìŠµë‹ˆë‹¤.Hibernate &gt;= 6.0HibernateëŠ” 6 ë²„ì „ì—ì„œ EmbeddableInstantiator ê¸°ëŠ¥ì„ ì†Œê°œí•˜ì˜€ìŠµë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì„ í†µí•´ enbeddable ê°ì²´ë¥¼ ë³´ë‹¤ ìœ ì—°í•˜ê²Œ ì¸ìŠ¤í„´ìŠ¤í™” í• ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì—ëŒ€í•œ ì‚¬ì´ë“œ ì´í™íŠ¸ë¡œ record ê°ì²´ë¥¼ ì…ë°ë””ë“œ ê°ì²´ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.@Entity@Table(name = \"order_new\")public class Order { ... @Embedded ShippingInfo fromInfo; @Embedded ShippingInfo toInfo; ...}@Embeddablepublic record ShippingInfo( String name, String address, String number) { }Order ì—”í‹°í‹°ì— fromInfoì™€ toInfo ë¼ëŠ” ë°°ì†¡ì§€ ì •ë³´ë¥¼ ì„ë² ë””ë“œ ê°ì²´ë¡œì¨ ì„ ì–¸í•˜ì˜€ìŠµë‹ˆë‹¤. :warning: ìœ„ ì˜ˆì œê°€ ë™ì‘í•˜ë ¤ë©´ ë„¤ì´ë° ì „ëµì´ ImplicitNamingStrategyComponentPathImpl ì´ì–´ì•¼ í•©ë‹ˆë‹¤. (&lt;property name=â€hibernate.implicit_naming_strategyâ€ value=â€org.hibernate.boot.model.naming.ImplicitNamingStrategyComponentPathImplâ€ /&gt;)ShippingInfo ê°ì²´ë¥¼ ì„ë² ë””ë“œ ê°ì²´ë¡œì¨ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì´ë¥¼ í•˜ì´ë²„ë„¤ì´íŠ¸ì— ì•Œë ¤ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ EmbeddableInstatiatorì„ ì»¤ìŠ¤í…€ í•˜ê² ìŠµë‹ˆë‹¤.public class ShippingInfoInstantiator implements EmbeddableInstantiator { @Override public Object instantiate(ValueAccess valueAccess, SessionFactoryImplementor sessionFactory) { var name = valueAccess.getValue(0, String.class); var address = valueAccess.getValue(1, String.class); var street = valueAccess.getValue(2, String.class); return new ShippingInfo(name, address, street); } @Override public boolean isInstance(Object object, SessionFactoryImplementor sessionFactory) { return object instanceof ShippingInfo; } @Override public boolean isSameClass(Object object, SessionFactoryImplementor sessionFactory) { return object.getClass().equals(ShippingInfo.class); }}ìœ„ ê°„ë‹¨í•œ í´ë˜ìŠ¤ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ê²ƒì€ instantiate ë©”ì†Œë“œ ì…ë‹ˆë‹¤. í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” ê°ì²´ì˜ ëª¨ë“  í•„ë“œ ì •ë³´ë¥¼ ì•ŒíŒŒë²³ ìˆœì„œë¡œ ë‹´ê³  ìˆëŠ” ValueAccess ê°ì²´ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ValudeAccessê°ì²´ì— ì¸ë±ìŠ¤ë¡œ ì ‘ê·¼í•˜ì—¬ ê°’ì„ ì›í•˜ëŠ” ìœ í˜•ìœ¼ë¡œ ìºìŠ¤íŒ… í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°ì²´ ì¸ìŠ¤í„´ìŠ¤í™”ì— í•„ìš”í•œ ëª¨ë“  ë§¤ê°œ ë³€ìˆ˜ë¥¼ ì¶”ì¶œí•œ í›„ ë§ˆì§€ë§‰ì— ëª¨ë“  ë§¤ê°œ ë³€ìˆ˜ë¥¼ ë‹´ê³  ìˆëŠ” ìƒì„±ìë¥¼ ìƒì„±í•˜ê¸° ë•Œë¬¸ì— recordë¥¼ ì„ë² ë””ë“œ ê°ì²´ë¡œì¨ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.@Embeddable@EmbeddableInstantiator(ShippingInfoInstantiator.class)public record ShippingInfo( String name, String address, String number) { }ìœ„ ì½”ë“œì²˜ëŸ¼ @EmbeddableInstantiator ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ì»¤ìŠ¤í…€í•œ EmbeddableInstatiator í´ë˜ìŠ¤ë¥¼ ì§€ì •í•˜ê¸°ë§Œ í•˜ë©´ ëì…ë‹ˆë‹¤.ì´ì œ ì´ record ì„ë² ë””ë“œ ê°ì²´ê°€ ì˜ ë™ì‘í•˜ëŠ”ì§€ ì¡°íšŒí•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.public record OrderRecord( String id, OrderStatus status, ShippingInfo fromShippingInfo, ShippingInfo toShippingInfo, String itemName, int itemPrice, LocalDateTime createdDateTime) { }ê²°ê³¼ë¥¼ ë°˜í™˜ë°›ê¸° ìœ„í•œ dto ê°ì²´ì…ë‹ˆë‹¤.@Testpublic void recordDTO() { var cb = entityManager.getCriteriaBuilder(); var cq = cb.createQuery(OrderRecord.class); var root = cq.from(Order.class); cq.select( cb.construct( OrderRecord.class, root.get(Order_.id), root.get(Order_.status), root.get(\"fromInfo\"), root.get(\"toInfo\"), root.get(Order_.itemName), root.get(Order_.itemPrice), root.get(Order_.createdDateTime) ) ); cq.where(cb.like(root.get(\"fromInfo\").get(\"name\"), \"%ê¹€%\")); var q = entityManager.createQuery(cq); var list = q.getResultList();}í…ŒìŠ¤íŠ¸ ì½”ë“œì…ë‹ˆë‹¤. record ê°ì²´ì—ëŠ” setter ë©”ì†Œë“œë¥¼ ì‘ì„±í•  ìˆ˜ ì—†ì–´ jpamodelgen í”„ë¡œì„¸ì„œê°€ ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë¶€ë“ì´í•˜ê²Œ string í˜•íƒœë¡œ ì„ë² ë””ë“œ ê°ì²´ì— ì ‘ê·¼í•˜ì˜€ìŠµë‹ˆë‹¤.select o1_0.id, o1_0.status, o1_0.fromInfo_address, o1_0.fromInfo_name, o1_0.fromInfo_number, o1_0.toInfo_address, o1_0.toInfo_name, o1_0.toInfo_number, o1_0.itemName, o1_0.itemPrice, o1_0.createdDateTime from order_new o1_0 where o1_0.fromInfo_name like ? escape ''ì •ìƒì ìœ¼ë¡œ sqlë¬¸ì´ ìƒì„±ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.Hibernate &gt;= 6.2Hibernate 6.2 ë²„ì „ë¶€í„°ëŠ” ì»¤ìŠ¤í…€ EmbeddableInstatiator í´ë˜ìŠ¤ì¡°ì°¨ í•„ìš” ì—†ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. record ê°ì²´ì— @Embeddable ê°ì²´ë¥¼ ë¶™ì´ëŠ” ê²ƒë§Œìœ¼ë¡œë„ record ê°ì²´ë¥¼ ì„ë² ë””ë“œ ê°ì²´ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.@Embeddablepublic record ShippingInfo( String name, String address, String number) { }ë¬¼ë¡  ê¸°ì¡´ê³¼ ê°™ì´ ì»¤ìŠ¤í…€ EmbeddableInstatiator ë¥¼ ë§Œë“¤ì–´ ì§€ì •í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤." }, { "title": "Hibernate ì—ì„œ PostgreSQL JSONB ë‹¤ë£¨ê¸°", "url": "/posts/hibernate-postgresql-jsonb/", "categories": "Hibernate", "tags": "Hibernate, PostgreSQL", "date": "2023-02-26 20:12:00 +0900", "snippet": "Hibernate ì—ì„œ PostgreSQL JSONB ë‹¤ë£¨ê¸°Hibnerate6 ì´ì „ ë²„ì „ì—ì„œ PostgreSQLì˜ JSONB íƒ€ì…ì„ ë‹¤ë£¨ê¸° ìœ„í•´ì„  ì§ì ‘ UserType ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê±°ë‚˜ ì´ëŸ° ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¥¼ ì‚¬ìš©í•˜ì—¬ JSONB íƒ€ì…ì„ ë‹¤ë¤˜ì—ˆìŠµë‹ˆë‹¤.Hibernate6 ë¶€í„°ëŠ” ì´ëŸ¬í•œ ê¸°ëŠ¥ì„ í‘œì¤€ìœ¼ë¡œ ì œê³µí•˜ê¸° ì‹œì‘í•˜ì—¬ JSON ì»¬ëŸ¼ì„ entityì˜ ì†ì„±ìœ¼ë¡œì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. :warning: ì•„ë˜ ë‚´ìš©ì€ Hibernate6 ì´ìƒì˜ ë²„ì „ì„ í•„ìš”ë¡œ í•©ë‹ˆë‹¤. Hibernate6 ì´ì „ ë²„ì „ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° (Hibernate 5.x, Spring Boot 2.x, Spring Data JPA 2.xâ€¦) ê·¸ëƒ¥ hypersistence-utilsë¥¼ ì‚¬ìš©í•˜ì‹œê¸¸ ê¶Œì¥ë“œë¦½ë‹ˆë‹¤.@JdbcTypeCode@JdbcTypeCode ì–´ë…¸í…Œì´ì…˜ì„ í•„ë“œì— ë¶™ì—¬ì£¼ê¸°ë§Œ í•˜ë©´ HibernateëŠ” RDBì˜ ì¢…ë¥˜ì— ë”°ë¼ ìë™ìœ¼ë¡œ JSON ì»¬ëŸ¼ì„ ì •ì˜í•©ë‹ˆë‹¤. PostgreSQL ê²½ìš°ì—” JSONB íƒ€ì…ì´ ë˜ê² ì£ . ëŸ°íƒ€ì„ì—ëŠ” ì§ë ¬í™” / ì—­ì§ë ¬í™” í•  ìˆ˜ ìˆëŠ” JSON ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°’ì„ ì»¨íŠ¸ë¡¤ í•©ë‹ˆë‹¤.@Datapublic class ShippingInfo implements Serializable { private String name; private String number; private String address;}@Entity@Data@Table(name = \"order_new\")public class Order { @Id @GeneratedValue(strategy = GenerationType.AUTO) Long id; @JdbcTypeCode(SqlTypes.JSON) ShippingInfo fromInfo; @JdbcTypeCode(SqlTypes.JSON) ShippingInfo toInfo;}[DEBUG] [main] SQL - create table order_new ( id bigint not null, fromInfo jsonb, toInfo jsonb, primary key (id) )UserType ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„UserType ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì§ì ‘ íƒ€ì…ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ë„ ìˆìŠµë‹ˆë‹¤. UserType ì¸í„°í˜ì´ìŠ¤ëŠ” Hibernate6 ë²„ì „ ì´ì „ì—ë„ ì¡´ì¬í–ˆì—ˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ Hibernate6 ë²„ì „ìœ¼ë¡œ ì˜¬ë¼ì˜¤ë©´ì„œ ì´ ì¸í„°í˜ì´ìŠ¤ëŠ” ì œë„¤ë¦­ì„ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.Hibernate5 - UserTypeHibernate6 - UserTypeë¿ë§Œ ì•„ë‹ˆë¼ ê¸°ì¡´ì—ëŠ” @TypeDef ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì‚¬ìš©í•  JSON íƒ€ì… í´ë˜ìŠ¤ë¥¼ ë¨¼ì € ë“±ë¡í•˜ê³  @Type ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í–ˆì—ˆì–´ì•¼ í–ˆë‹¤ë©´, ì´ì œ @Type ì–´ë…¸í…Œì´ì…˜ë§Œ ì‚¬ìš©í•˜ë©´ ë˜ë„ë¡ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. (@TypeDef ì–´ë…¸í…Œì´ì…˜ì€ ì‚­ì œ ë˜ì—ˆìŠµë‹ˆë‹¤.)@Entity@Data@Table(name = \"order_new\")@TypeDef(name = \"ShippingInfoJsonType\", typeClass = ShippingInfoJsonType.class)public class Order { @Id @GeneratedValue(strategy = GenerationType.AUTO) Long id; @Column @Type(type = \"ShippingInfoJsonType\") ShippingInfo fromInfo; @Column @Type(type = \"ShippingInfoJsonType\") ShippingInfo toInfo;}@Entity@Data@Table(name = \"order_new\")public class Order { @Id @GeneratedValue(strategy = GenerationType.AUTO) Long id; @Column @Type(ShippingInfoJsonType.class) ShippingInfo fromInfo; @Column @Type(ShippingInfoJsonType.class) ShippingInfo toInfo;}ì¡°ê¸ˆì´ë‚˜ë§ˆ ì½”ë“œê°€ ê°„ê²°í•´ì§€ê³  type-safe í•˜ê²Œ ë³€ê²½ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì‚¬ìš©ë²•ì€ ìœ„ì™€ê°™ê³  UserType ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ ë°©ë²•ì€ ê¸°ì¡´ê³¼ ë™ì¼í•©ë‹ˆë‹¤. í•„ìš”í•œ ë©”ì†Œë“œë“¤ì„ ì œë„¤ë¦­ íƒ€ì…ì— ë§ê²Œ ì¬ì •ì˜ í•˜ë©´ ë©ë‹ˆë‹¤.public class ShippingInfoJsonType implements UserType&lt;ShippingInfo&gt; { @Override public int getSqlType() { return SqlTypes.JSON; } @Override public Class&lt;ShippingInfo&gt; returnedClass() { return ShippingInfo.class; } ...}JSONB ì»¬ëŸ¼ì˜ í•„ë“œ ì—…ë°ì´íŠ¸setter ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´ JSONB ì»¬ëŸ¼ì˜ í•„ë“œê°’ì„ ë³€ê²½í•˜ë©´ íŠ¸ëœì­ì…˜ ì¢…ë£Œ ì´í›„ Hibernateì— ì˜í•´ ê°’ì´ ì—…ë°ì´íŠ¸ ë©ë‹ˆë‹¤.private static void doInTransaction(Runnable task) { entityManager.getTransaction().begin(); task.run(); entityManager.getTransaction().commit();}...doInTransaction(() -&gt; { var order = entityManager.find(Order.class, 1L); order.getFromInfo().setNumber(\"01000001111\");});sql ë¡œê·¸ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.[DEBUG] [main] SQL - update order_new set fromInfo=?, toInfo=? where id=?[TRACE] [main] bind - binding parameter [1] as [JSON] - [ShippingInfo(name=ì„ì„¤ìˆ˜, number=01000001111, address=ì„œìš¸íŠ¹ë³„ì‹œ êµ¬ë¡œêµ¬ ê°œí¬ë¡œ109ê¸¸)][TRACE] [main] bind - binding parameter [2] as [JSON] - [ShippingInfo(name=ì„±ì¸ê±´, number=01018657836, address=ì„œìš¸íŠ¹ë³„ì‹œ ê¸ˆì²œêµ¬ ê°œí¬ë¡œ34ê¸¸)][TRACE] [main] bind - binding parameter [3] as [BIGINT] - [1]idê°€ 1ì¸ ì—”í‹°í‹°ë¥¼ ì°¾ê³  ë°›ëŠ”ìª½ ë°°ì†¡ì •ë³´ JSONB ì»¬ëŸ¼ì˜ ë²ˆí˜¸ë¥¼ 01000001111 ë¡œ ë³€ê²½í•˜ì˜€ìŠµë‹ˆë‹¤. ì •ìƒì ìœ¼ë¡œ ì˜ ì—…ë°ì´íŠ¸ ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.JSONB ì¡°ê±´ê²€ìƒ‰ê·¸ë ‡ë‹¤ë©´ ë°›ëŠ”ìª½ ë°°ì†¡ì •ë³´ JSONB ì»¬ëŸ¼ì˜ ì„±ì´ ê¹€ ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” rowë¥¼ ê²€ìƒ‰í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”? sqlë¡œ í‘œí˜„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.select *from order_new owhere o.frominfo -&gt;&gt; 'name' like 'ê¹€%';Hibernate &lt; 6.2Hibernate 6.2 ì´ì „ ë²„ì „ì—ì„œëŠ” ì•„ì‰½ê²Œë„ JPQLë¡œ ìœ„ sqlì„ í‘œí˜„í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì–´ì©”ìˆ˜ ì—†ì´ createNativeQuery(query) ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ë°–ì— ì—†ìŠµë‹ˆë‹¤.entityManager.createNativeQuery(\"SELECT * FROM order_new o WHERE o.frominfo -&gt;&gt; 'name' LIKE :name \") .setParameter(\"name\", \"ê¹€%\") .getResultList()[DEBUG] [main] SQL - SELECT * FROM order_new o WHERE o.frominfo -&gt;&gt; 'name' LIKE ?[TRACE] [main] bind - binding parameter [1] as [VARCHAR] - [ê¹€%]Hibernate &gt;= 6.2Hibernate 6.2 ë²„ì „ì—ì„œ ë“œë””ì–´ JPQLë¡œ JSONB ì»¬ëŸ¼ì„ íƒìƒ‰í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì •í™•íˆëŠ” Embeddable ê°ì²´(í´ë˜ìŠ¤)ë¥¼ JSON ì»¬ëŸ¼ìœ¼ë¡œì¨ ë§¤í•‘ í• ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.@Data@Embeddablepublic class ShippingInfo implements Serializable { private String name; private String number; private String address;}ì¼ë‹¨ ShippingInfo í´ë˜ìŠ¤ì— @Embeddable ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ JPAê°€ ì´ í´ë˜ìŠ¤ë¥¼ ì¸ì‹í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.@Test@DisplayName(\"JPQL JSONB ì¡°ê±´ í…ŒìŠ¤íŠ¸ (version &gt;= 6.2\")public void jsonbJPQLCondition() { var orderList = entityManager .createQuery(\"SELECT o FROM Order o WHERE o.fromInfo.name LIKE :name\", Order.class) .setParameter(\"name\", \"ê¹€%\") .getResultList(); Assertions.assertTrue(orderList.stream().allMatch(o -&gt; o.getFromInfo().getName().startsWith(\"ê¹€\")));}[DEBUG] [main] SQL - select o1_0.id, o1_0.fromInfo, o1_0.toInfo from order_new o1_0 where cast(o1_0.fromInfo-&gt;&gt;'name' as varchar(255)) like ? escape ''[TRACE] [main] bind - binding parameter [1] as [VARCHAR] - [ê¹€%]í…ŒìŠ¤íŠ¸ ì½”ë“œì™€ sql ë¡œê·¸ì…ë‹ˆë‹¤. Hibernateê°€ JPQLì„ ì˜¬ë°”ë¥¸ sqlë¡œ ë³€í™˜í–ˆë„¤ìš”.QueryDSLJPQLë¡œ JSON ì»¬ëŸ¼ì„ íƒìƒ‰í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì€ QueryDSLì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.ì´ë²ˆì—ëŠ” QueryDSLë¡œ ì¡°ê¸ˆ ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ êµ¬í˜„í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ì¡°ê±´ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ë³´ë‚´ëŠ” ë¶„ì˜ ì„±ì€ ê¹€ì´ ì•„ë‹ˆì–´ì•¼ í•¨ ë³´ë‚´ëŠ” ë¶„ì˜ ì„±ìœ¼ë¡œ ê²°ê³¼ë¥¼ ê·¸ë£¨í•‘í•¨ ê²°ê³¼ë¥¼ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ì–´ë–¤ ì„±ì´ ê°€ì¥ ë§ì€ì§€ í™•ì¸ ìœ„ ì¡°ê±´ì„ sqlë¡œ í‘œí˜„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.select substr(o.frominfo -&gt;&gt; 'name', 1, 1), count(*)from order_new owhere o.frominfo -&gt;&gt; 'name' not like 'ê¹€%'group by substr(o.frominfo -&gt;&gt; 'name', 1, 1)order by count(*) desc;ì‹¤ë¬´ì—ì„œ ì´ëŸ° ìš”êµ¬ì‚¬í•­ì´ ë˜ì ¸ì§„ë‹¤ë©´ â€˜ê·¸ëƒ¥ ë‚ ì¿¼ë¦¬ ì“¸ê¹Œ?â€™ ë¼ëŠ” ìƒê°ì´ ë“¤ê³¤ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ì œëŠ” QueryDSLë¡œ ì´ëŸ° ì¿¼ë¦¬ë„ í‘œí˜„í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.ì¼ë‹¨ ì¡°íšŒê²°ê³¼ë¡œ ë°˜í™˜ë  dtoë¥¼ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.@Datapublic class OrderAggregationDTO { private String lastName; private int count; @QueryProjection public OrderAggregationDTO(String lastName, int count) { this.lastName = lastName; this.count = count; }}ë‹¤ìŒìœ¼ë¡œ QueryDSL ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.public void jsonbQueryDSLCondition() { var q = QOrder.order; var lastName = q.fromInfo.name.substring(0, 1); var count = q.count(); var list = jpaQueryFactory() .select(new QOrderAggregationDTO(lastName, count)) .from(q) .where(q.fromInfo.name.startsWith(\"ê¹€\").not()) .groupBy(lastName) .orderBy(count.desc()) .fetch(); list.forEach(item -&gt; System.out.printf(\"ì„±: %s / ê°¯ìˆ˜: %dê°œ%n\", item.getLastName(), item.getCount()));}[DEBUG] [main] SQL - select substr(cast(o1_0.fromInfo-&gt;&gt;'name' as varchar(255)),1,1), count(o1_0.id) from order_new o1_0 where cast(o1_0.fromInfo-&gt;&gt;'name' as varchar(255)) not like ? escape '!' group by substr(cast(o1_0.fromInfo-&gt;&gt;'name' as varchar(255)),1,1) order by count(o1_0.id) desc[TRACE] [main] bind - binding parameter [1] as [VARCHAR] - [ê¹€%]ì„±: ì£¼ / ê°¯ìˆ˜: 6ê°œì„±: ë³€ / ê°¯ìˆ˜: 4ê°œì„±: ì‹  / ê°¯ìˆ˜: 4ê°œì„±: ì§„ / ê°¯ìˆ˜: 4ê°œì„±: íƒ / ê°¯ìˆ˜: 4ê°œì„±: ë°• / ê°¯ìˆ˜: 3ê°œì„±: ì¡° / ê°¯ìˆ˜: 3ê°œì„±: ì—„ / ê°¯ìˆ˜: 3ê°œì„±: ë…¸ / ê°¯ìˆ˜: 3ê°œì„±: ì˜¤ / ê°¯ìˆ˜: 3ê°œì„±: ì„ / ê°¯ìˆ˜: 2ê°œì„±: í™ / ê°¯ìˆ˜: 2ê°œì„±: ì°¨ / ê°¯ìˆ˜: 2ê°œì„±: ì„  / ê°¯ìˆ˜: 2ê°œì„±: ì‹¬ / ê°¯ìˆ˜: 2ê°œì„±: í‘œ / ê°¯ìˆ˜: 2ê°œì„±: ìš° / ê°¯ìˆ˜: 2ê°œì„±: ì† / ê°¯ìˆ˜: 2ê°œì„±: ë‚¨ / ê°¯ìˆ˜: 2ê°œì„±: ë„ / ê°¯ìˆ˜: 2ê°œì„±: ì†Œ / ê°¯ìˆ˜: 2ê°œì„±: ì€ / ê°¯ìˆ˜: 2ê°œì„±: í—ˆ / ê°¯ìˆ˜: 2ê°œì„±: ì•ˆ / ê°¯ìˆ˜: 2ê°œì„±: ì „ / ê°¯ìˆ˜: 2ê°œì„±: ìœ  / ê°¯ìˆ˜: 2ê°œì„±: ì´ / ê°¯ìˆ˜: 2ê°œì„±: ê³½ / ê°¯ìˆ˜: 1ê°œì„±: í¸ / ê°¯ìˆ˜: 1ê°œì„±: í•œ / ê°¯ìˆ˜: 1ê°œì„±: í™© / ê°¯ìˆ˜: 1ê°œì„±: ê¶Œ / ê°¯ìˆ˜: 1ê°œì„±: í˜„ / ê°¯ìˆ˜: 1ê°œì„±: ìš© / ê°¯ìˆ˜: 1ê°œì„±: ì› / ê°¯ìˆ˜: 1ê°œì„±: ì„± / ê°¯ìˆ˜: 1ê°œsql ë¡œê·¸ì™€ ê²°ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. ì´ë²ˆì—ë„ JPQLì´ ì˜¬ë°”ë¥¸ sqlë¡œ ë³€í™˜ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ê²°ë¡ Hibernate6 ë²„ì „ë¶€í„° ì‰½ê²Œ JSON íƒ€ì…ì˜ ì»¬ëŸ¼ì„ ë‹¤ë¥¼ ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ë¿ë§Œ ì•„ë‹ˆë¼ 6.2 ë²„ì „ë¶€í„°ëŠ” ì¡°íšŒ ë˜í•œ JPQLë¡œ í‘œí˜„í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆëŠ”ë°ìš”,ì´ë¥¼ í†µí•´ ë§Œì•½ QueryDSLì„ ì‚¬ìš©í•œë‹¤ë©´ querydsl-sql, blaze-persistence ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  querydsl-jpaë§Œìœ¼ë¡œ type-safeí•œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.ë˜í•œ CTE ì™€ Partitioning ë“± ìƒˆë¡œìš´ ê¸°ëŠ¥ë“¤ì´ Hibernate 6.2 ë²„ì „ì—ì„œ ì„ ë³´ì—¬ì§ˆ ì˜ˆì •ì…ë‹ˆë‹¤.JPAì˜ íƒœìƒì ì¸ í•œê³„ë¥¼ Hibernateë¥¼ í†µí•´ í•˜ë‚˜ ë‘˜ í•´ê²°í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìœ¼ë‹ˆ ì•ìœ¼ë¡œëŠ” ê°œë°œìê°€ ì¡°ê¸ˆë” ì‰½ê³  ê°„ë‹¨í•˜ê²Œ ìë°”ë¡œ dbë¥¼ ì»¨íŠ¸ë¡¤ í•  ìˆ˜ ìˆì„ê²ƒ ê°™ìŠµë‹ˆë‹¤." }, { "title": "ë™ì¼í•œ í´ë˜ìŠ¤ ì•ˆì—ì„œ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ ìƒì„±í•˜ê¸°", "url": "/posts/spring-new-transaction-in-same-class/", "categories": "Spring", "tags": "Spring, JPA", "date": "2023-02-19 20:12:00 +0900", "snippet": "ë™ì¼í•œ í´ë˜ìŠ¤ ì•ˆì—ì„œ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ ìƒì„±í•˜ê¸°ë™ì¼í•œ í´ë˜ìŠ¤ ë‚´ì—ì„œ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ë§Œë“¤ì–´ ì˜ˆì™¸ë¥¼ íšŒí”¼í•˜ë ¤ê³  í•˜ëŠ” ê²½ìš°, ì˜ë„í–ˆë˜ ê²ƒê³¼ëŠ” ë‹¤ë¥¸ ê²°ê³¼ê°€ ë‚˜ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.@Transactionalpublic void answer(Inquiry inquiry) { System.out.println(TransactionSynchronizationManager.getCurrentTransactionName()); try { this.updateAnswer(inquiry); } catch (Exception ignored) { } try { this.updateAnswerer(inquiry); } catch (Exception ignored) { }}@Transactional(propagation = Propagation.REQUIRES_NEW)public void updateAnswer(Inquiry inquiry) { System.out.println(TransactionSynchronizationManager.getCurrentTransactionName()); // update answer}@Transactionalpublic void updateAnswerer(Inquiry inquiry) { System.out.println(TransactionSynchronizationManager.getCurrentTransactionName()); // update answerer // exception}ì˜ˆë¥¼ë“¤ì–´ ìœ„ ì½”ë“œì™€ ê°™ì´ updateAnswer ë¡œì§ì„ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.ë”°ë¼ì„œ updateAnswererAndThrowException ë©”ì†Œë“œì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë”ë¼ë„ ë³„ë„ì˜ íŠ¸ëœì­ì…˜ì—ì„œ update ì‘ì—…ì´ ìˆ˜í–‰ë˜ì—ˆê¸° ë•Œë¬¸ì— ê°’ì´ ì •ìƒì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆì„ ê²ƒì´ë¼ ìƒê°í–ˆìŠµë‹ˆë‹¤.ê·¸ëŸ¬ë‚˜ ì‘ì—…ì´ ëë‚œ ì´í›„ ì¡°íšŒí•´ë³´ë‹ˆ ê°’ì´ ì—…ë°ì´íŠ¸ ë˜ì§€ ì•Šì€ ê²ƒì„ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤. ì•„ë¬´ë¦¬ë´ë„ ì½”ë“œì— ì´ìƒí•œì ì€ ì—†ì–´ TransactionSynchronizationManager.getCurrentTransactionName() ë¥¼ í†µí•´ ê° ë©”ì†Œë“œë¡œ ì§„ì…í• ë•Œ íŠ¸ëœì­ì…˜ ì´ë¦„ì„ í™•ì¸í•´ë³´ê¸°ë¡œ í•˜ì˜€ìŠµë‹ˆë‹¤.com.keencho.application.service.InquiryService.answercom.keencho.application.service.InquiryService.answercom.keencho.application.service.InquiryService.answerupdateAnswer ë©”ì†Œë“œì˜ ì „íŒŒë ˆë²¨ì„ REQUIRES_NEWë¡œ ì§€ì •í–ˆìŒì—ë„ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.ì›ì¸ì›ì¸ì€ ìŠ¤í”„ë§ ê³µì‹ ë¬¸ì„œ ì— ì„¤ëª…ë˜ì–´ ìˆìŠµë‹ˆë‹¤. In proxy mode (which is the default), only external method calls coming in through the proxy are intercepted. This means that self-invocation (in effect, a method within the target object calling another method of the target object) does not lead to an actual transaction at runtime even if the invoked method is marked with @Transactional. Also, the proxy must be fully initialized to provide the expected behavior, so you should not rely on this feature in your initialization codeâ€‰â€”â€‰for example, in a @PostConstruct method.ë¬¸ì œëŠ” Springì˜ AOP í”„ë¡ì‹œëŠ” í™•ì¥ë˜ì§€ ì•Šê³  ì™¸ë¶€ì—ì„œì˜ í˜¸ì¶œì„ ê°€ë¡œì±„ê¸° ìœ„í•´ ì„œë¹„ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°ì‹¼ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.ë§Œì•½ ì„œë¹„ìŠ¤ ë‚´ë¶€ì—ì„œ this í†µí•´ ë‹¤ë¥¸ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤ë©´ ì´ëŠ” ì¸ìŠ¤í„´ìŠ¤ì— ì˜í•´ ë°”ë¡œ í˜¸ì¶œë˜ë©° ë˜í•‘ í”„ë¡ì‹œëŠ” ì´ë¥¼ ê°€ë¡œì±Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ë‹¹ì—°íˆ í”„ë¡ì‹œëŠ” ì´ëŸ¬í•œ ì¸ìŠ¤í„´ìŠ¤ ë‚´ë¶€ì˜ í˜¸ì¶œì„ ì „í˜€ ì¸ì‹í•˜ì§€ ëª»í•©ë‹ˆë‹¤.)í•´ê²°í•´ê²° ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. Spring AOP ëŒ€ì‹  AspectJ ì‚¬ìš© self-injection í´ë˜ìŠ¤ ë¶„ë¦¬AOP ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë³€ê²½í•˜ëŠ”ê²ƒì€ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì˜ˆìƒí•˜ëŠ” ê²°ê³¼ì™€ ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.self-injectionì€ í´ë˜ìŠ¤ ë‚´ë¶€ì—ì„œ ìê¸° ìì‹ ì„ ë˜ ì£¼ì…í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.@Servicepublic class InquiryService { @Lazy @Autowired private InquiryService self; ...}ë‹¤ë§Œ bean ì´ë¦„ì´ ê²¹ì³ ë“±ë¡ì´ ì•ˆë ìˆ˜ë„ ìˆìœ¼ë‹ˆ ìœ„ì™€ê°™ì´ @Lazy ì–´ë…¸í…Œì´ì…˜ê³¼ í•¨ê»˜ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.ì‚¬ì‹¤ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì´ í•„ìš”í•œ ê²½ìš° í´ë˜ìŠ¤ë¥¼ ë¶„ë¦¬í•˜ì—¬ Spring AOPê°€ í˜¸ì¶œì„ ê°€ë¡œì±„ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ”ê²Œ ê°€ì¥ ì¢‹ì€ ë°©ë²•ì…ë‹ˆë‹¤. ë‹¤ë§Œ í´ë˜ìŠ¤ê°€ ë¶„ë¦¬ë¨ì— ë”°ë¼ ê´€ë¦¬ í¬ì¸íŠ¸ê°€ ì¡°ê¸ˆ ëŠ˜ì–´ë‚  ìˆ˜ ìˆë‹¤ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.ê·¸ ì™¸ì—ë„ ëŒë‹¤ë¥¼ ì‚¬ìš©í•œ ì´ëŸ° ë°©ë²•ë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ì „ì²´ì ì¸ ì„¤ê³„ë¥¼ ë§ì¹˜ì§€ ì•ŠëŠ” ë²”ìœ„ì—ì„œ ë°©ë²•ì„ ì°¾ì•„ ì ìš©í•´ ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤." }, { "title": "Spring Data JPA - Custom QueryDSL Repository ë§Œë“¤ê¸°", "url": "/posts/spring-data-jpa-custom-querydsl-repository/", "categories": "JPA", "tags": "JPA, Spring Data JPA, QueryDSL", "date": "2023-01-31 20:12:00 +0900", "snippet": "Spring Data JPA - Custom QueryDSL Repository ë§Œë“¤ê¸°Spring Data JPAë¥¼ ì‚¬ìš©í•œë‹¤ë©´ JpaRepositoryë¥¼ ìƒì†í•œ repositoryë¥¼ ë§Œë“¤ê³  ë¯¸ë¦¬ ì •í•´ì§„ í‚¤ì›Œë“œ ë“¤ì„ ì‚¬ìš©í•˜ì—¬ ë©”ì†Œë“œ(ì¿¼ë¦¬)ë¥¼ ì‚¬ìš©í•˜ê³¤ í•©ë‹ˆë‹¤.ê·¸ëŸ¬ë‚˜ ë©”ì†Œë“œì˜ ê¸¸ì´ê°€ ê¸¸ì–´ì§„ë‹¤ë©´ (findByNameAndAgeAndGenderAndPhoneNumberAndâ€¦) ì—¬ê°„ ë³´ê¸°ì‹«ì€ê²Œ ì•„ë‹™ë‹ˆë‹¤. ë¬¼ë¡  @Queryì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆì§€ë§Œ sqlì„ ì§ì ‘ ì‘ì„±í•´ì•¼ í•œë‹¤ëŠ” ë‹¨ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤.ë˜í•œ QueryDSLì„ ì‚¬ìš©í•˜ê³ ì í•œë‹¤ë©´ ì´ë¥¼ ì‚¬ìš©í•  ê³„ì¸µì´ í•„ìš”í•©ë‹ˆë‹¤. service ê³„ì¸µì— ê´€ë ¨ ë©”ì†Œë“œë¥¼ ì‘ì„±í•  ìˆ˜ë„ ìˆê² ì§€ë§Œ ì„¤ê³„ ì¸¡ë©´ì—ì„œ ë´¤ì„ë•Œ ì¿¼ë¦¬ëŠ” repository ê³„ì¸µì—ì„œ ì‘ì„±í•˜ëŠ”ê²Œ ì¢‹ê² ì£ .Customizing Individual Repositoriesê°œë³„ repositoryë¥¼ í™•ì¥í•˜ê³  í•„ìš”í•œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•´(Query DSLì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´) ìƒˆë¡œìš´ ì»¤ìŠ¤í…€ í´ë˜ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤. ë‹¤í–‰íˆ Spring Data JPA ê³µì‹ë¬¸ì„œì—ëŠ” ê´€ë ¨ ë‚´ìš©ê³¼ ì ìš© ë°©ë²•ì´ ìì„¸íˆ ì í˜€ ìˆìŠµë‹ˆë‹¤.ì»¤ìŠ¤í…€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ê³  í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“  í›„ì— ê¸°ì¡´ repositoryê°€ ì»¤ìŠ¤í…€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†í•˜ê²Œ í•˜ë©´ ëœë‹¤ê³  í•˜ë„¤ìš”.// ê¸°ì¡´ repositorypublic interface CustomerRepository extends JpaRepository&lt;Customer, UUID&gt; {}// custom interfacepublic interface CustomCustomerRepository { List&lt;Customer&gt; findVIPCustomer();}// custom interfaceë¥¼ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤@Componentpublic interface CustomCustomerRepositoryImpl implements CustomCustomerRepository { @PersistenceUnit EntityManagerFactory emf; @Autowired JPAQueryFactory queryFactory; @Override List&lt;Customer&gt; findVIPCustomer() { ... }}// ê¸°ì¡´ repository ìˆ˜ì •public interface CustomerRepository extends JpaRepository&lt;Customer, UUID&gt;, CustomCustomerRepository {}ë³´í†µì€ ìœ„ì™€ê°™ì´ ì¸í„°í˜ì´ìŠ¤, í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•˜ì—¬ repositoryë¥¼ í™•ì¥í•´ì„œ ì‚¬ìš©í•˜ë©° QueryDSLì´ í•„ìš”í•œ ê²½ìš° JPAQueryFactoryë¥¼ ì£¼ì…ë°›ì•„ ì‚¬ìš©í•˜ê³¤ í•©ë‹ˆë‹¤. :warning: ê³µì‹ ë¬¸ì„œì— ì˜í•˜ë©´ custom interfaceë¥¼ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤ëŠ” Implì„ ì ‘ë¯¸ì‚¬ë¡œ ë¶™ì—¬ì•¼ í•œë‹¤ê³  ë‚˜ì™€ ìˆìŠµë‹ˆë‹¤. @EnableJpaRepositories(repositoryImplementationPostfix = â€œMyPostfixâ€) ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ë©´ ì ‘ë¯¸ì‚¬ë¥¼ ë³€ê²½í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.QueryDSLì„ ëª¨ë“ˆí™”í•˜ì—¬ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•˜ê¸°QueryDSLì„ ì‚¬ìš©í•œë‹¤ë©´ ë­”ê°€ ì•„ì‰½ìŠµë‹ˆë‹¤. ë™ì¼í•œ í˜•íƒœì˜ ì¸í„°í˜ì´ìŠ¤, í´ë˜ìŠ¤ë¥¼ repositoryë§ˆë‹¤ ë§Œë“¤ì–´ì„œ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œê°€ ëŠ˜ì–´ë‚˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.Spring Data JPAëŠ” ì´ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” QuerydslPredicateExecutor ë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.í•˜ì§€ë§Œ í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚´í´ë³´ë©´ ì¡°íšŒ ê²°ê³¼ë¥¼ DTOë¡œ ë°˜í™˜í•˜ê±°ë‚˜ ëª…ì‹œì  joinì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤ëŠ” ë‹¨ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤. QuerydslRepositorySupport ì¶”ìƒí´ë˜ìŠ¤ë¥¼ ìƒì†í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ë„ ìˆì§€ë§Œ í•´ë‹¹ ë°©ë²•ë„ í•œê³„ëŠ” ì¡´ì¬í•©ë‹ˆë‹¤.ì´ëŸ¬í•œ ë‹¨ì ë“¤ì„ ê·¹ë³µí•œ CustomRepositoryë¥¼ ë§Œë“¤ì–´ ë³´ê³ ì í•©ë‹ˆë‹¤. ê¸°ì¡´ì˜ JpaRepositoryì²˜ëŸ¼ ì¸í„°í˜ì´ìŠ¤ ìƒì†ë§Œìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ”ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.@FunctionalInterfacepublic interface QueryHandler { JPAQuery&lt;?&gt; apply(JPAQuery&lt;?&gt; query);}public interface CustomJpaSearchQuery&lt;T&gt; { List&lt;T&gt; findList(Predicate predicate, QueryHandler queryHandler, Sort sort); Page&lt;T&gt; findPage(Predicate predicate, QueryHandler queryHandler, Pageable pageable); &lt;P&gt; List&lt;P&gt; selectList(Predicate predicate, Class&lt;P&gt; type, Map&lt;String, Expression&lt;?&gt;&gt; bindings, QueryHandler queryHandler, Sort sort); &lt;P&gt; Page&lt;P&gt; selectPage(Predicate predicate, Class&lt;P&gt; type, Map&lt;String, Expression&lt;?&gt;&gt; bindings, QueryHandler queryHandler, Pageable pageable);}êµ¬í˜„í•´ì•¼í•  ì¸í„°í˜ì´ìŠ¤ëŠ” ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤. ì¡°íšŒ ê²°ê³¼ë¥¼ entity íƒ€ì…ìœ¼ë¡œ ë°›ê±°ë‚˜ Projection(DTO)ìœ¼ë¡œ ë°›ì„ ìˆ˜ ìˆëŠ” ë©”ì†Œë“œ ë“¤ì…ë‹ˆë‹¤. í˜ì´ì§•ë„ ì§€ì›í•©ë‹ˆë‹¤.public class DefaultCustomJpaSearchQuery&lt;T&gt; implements CustomJpaSearchQuery&lt;T&gt; { private final EntityManager entityManager; private final JPAQueryFactory queryFactory; private final EntityPath&lt;T&gt; path; // querydsl-apt ì— ì˜í•´ ìƒì„±ëœ q í´ë˜ìŠ¤ê°€ ì¡´ì¬í•  ê²½ìš° -&gt; pathë¡œ q í´ë˜ìŠ¤ ì‚¬ìš© public DefaultCustomJpaSearchQuery(JpaEntityInformation&lt;T, ?&gt; entityInformation, EntityManager entityManager) { this.entityManager = entityManager; this.queryFactory = new JPAQueryFactory(entityManager); this.path = SimpleEntityPathResolver.INSTANCE.createPath(entityInformation.getJavaType()); } // ìƒì„±ëœ q í´ë˜ìŠ¤ê°€ ì—†ê±°ë‚˜ ì´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ê²½ìš° (ex. unit test) - ìƒˆë¡œìš´ entity path ìƒì„± public DefaultCustomJpaSearchQuery(Class&lt;T&gt; type, EntityManager entityManager) { this.entityManager = entityManager; this.queryFactory = new JPAQueryFactory(entityManager); this.path = new EntityPathBase&lt;&gt;(type, \"entity\"); } ...}CustomJpaSearchQueryë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ì…ë‹ˆë‹¤. JpaQueryFactoryì™€ EntityPathë¥¼ í´ë˜ìŠ¤ ìƒì„± ì‹œì ì— ì •ì˜í•˜ì˜€ìŠµë‹ˆë‹¤. ë©”ì†Œë“œë“¤ì€ ê¸€ì´ ë„ˆë¬´ ê¸¸ì–´ì§€ê¸° ë•Œë¬¸ì— í¬í•¨í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì „ì²´ ì½”ë“œëŠ” ë¸”ë¡œê·¸ í•˜ë‹¨ì˜ ë§í¬ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë‹¤ìŒìœ¼ë¡œ CustomJpaSearchQuery ì¸í„°í˜ì´ìŠ¤ë¥¼ í™•ì¥í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤. ì´ ì¸í„°í˜ì´ìŠ¤ëŠ” CustomJpaSearchQuery ë¿ë§Œ ì•„ë‹ˆë¼ JpaRepositoryì¸í„°í˜ì´ìŠ¤ë„ í™•ì¥í•˜ì—¬ ê¸°ì¡´ì˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¸í„°í˜ì´ìŠ¤ ì…ë‹ˆë‹¤.@NoRepositoryBeanpublic interface CustomJpaQueryDSLRepository&lt;T, ID&gt; extends JpaRepository&lt;T, ID&gt;, CustomJpaSearchQuery&lt;T&gt; {}@NoRepositoryBean ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ ìµœì¢…ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” repositoryì— @Repository ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì´ì§€ ì•Šì•„ë„ ë™ì‘í•˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.ìœ„ ì¸í„°í˜ì´ìŠ¤ëŠ” í•œê°€ì§€ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ repositoryì˜ êµ¬í˜„ì²´ëŠ” JpaRepositoryFactoryBean ì— ì˜í•´ ê²°ì •ë˜ëŠ”ë° ì•„ë¬´ëŸ° ì„¤ì •ë„ í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ìœ„ì—ì„œ ë§Œë“  êµ¬í˜„ì²´ëŠ” ë‹¹ì—°íˆ repositoryì˜ êµ¬í˜„ì²´ë¡œì„œ ì¸ì‹(ë™ì‘)í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ êµ¬í˜„ì²´ë¥¼ ì¸ì‹í•˜ê²Œ í•˜ê¸° ìœ„í•´ì„œëŠ” Custom Factory Beanì´ í•„ìš”í•©ë‹ˆë‹¤.public class CustomJpaQueryDSLRepositoryFactory&lt;T extends Repository&lt;E, ID&gt;, E, ID&gt; extends JpaRepositoryFactoryBean&lt;T, E, ID&gt; { public CustomJpaQueryDSLRepositoryFactory(Class&lt;? extends T&gt; repositoryInterface) { super(repositoryInterface); } @Override protected RepositoryFactorySupport createRepositoryFactory(EntityManager entityManager) { return new QueryDSLRepositoryFactory(entityManager); } private static class QueryDSLRepositoryFactory extends JpaRepositoryFactory { private final EntityManager entityManager; public QueryDSLRepositoryFactory(EntityManager entityManager) { super(entityManager); this.entityManager = entityManager; } @Override protected RepositoryComposition.RepositoryFragments getRepositoryFragments(RepositoryMetadata metadata) { var fragments = super.getRepositoryFragments(metadata); if (CustomJpaQueryDSLRepository.class.isAssignableFrom(metadata.getRepositoryInterface())) { var impl = super.instantiateClass( DefaultCustomJpaSearchQuery.class, this.getEntityInformation(metadata.getDomainType()), this.entityManager ); fragments = fragments.append(RepositoryFragment.implemented(impl)); } return fragments; } }}Beanì´ ìƒì„±ë˜ëŠ” ì‹œì ì— repositoryë¥¼ ê²€ìƒ‰í•˜ì—¬ ë§Œì•½ repositoryê°€ CustomJpaQueryDSLRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ í™•ì¥í•˜ê³  ìˆë‹¤ë©´ DefaultCustomJpaSearchQuery í´ë˜ìŠ¤ë¥¼ ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ë¡œ ì§€ì •í•˜ê³  repository ë¡œì¨ ë™ì‘í•˜ê²Œ í•˜ëŠ” Custom Factory Bean í´ë˜ìŠ¤ ì…ë‹ˆë‹¤.ì´ì œ Custom Factory Bean í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê² ë‹¤ê³  ì„ ì–¸ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.@SpringBootApplication@EnableJpaRepositories(repositoryFactoryBeanClass = CustomJpaQueryDSLRepositoryFactory.class)public class SpringBootApplication { ...}ì„¤ì •ì€ ëª¨ë‘ ëë‚¬ìŠµë‹ˆë‹¤. CustomJpaQueryDSLRepositoryë¥¼ ìƒì†í•˜ì—¬ ì‚¬ìš©í•˜ë©´ ëì…ë‹ˆë‹¤. ë‹¹ì—°íˆ ê¸°ì¡´ì²˜ëŸ¼ ë©”ì†Œë“œ ê¸°ë°˜ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ìƒì„±í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.public interface OrderRepository extends CustomJpaQueryDSLRepository&lt;Product, UUID&gt; { List&lt;Order&gt; findByProductPriceGreaterThanOrderByNameDesc(Long price);}ì•„ë˜ëŠ” ì‚¬ìš© ì˜ˆì‹œ ì…ë‹ˆë‹¤.private Map&lt;String, Expression&lt;?&gt;&gt; buildBindings() { var oq = QOrder.order; var cq = QCustomer.customer; var bindings = new HashMap&lt;String, Expression&lt;?&gt;&gt;(); bindings.put(\"id\", oq.id); bindings.put(\"name\", oq.name); bindings.put(\"dtCreatedAt\", oq.dtCreatedAt); bindings.put(\"customerId\", cq.id); bindings.put(\"customerName\", cq.name); bindings.put(\"customerAge\", cq.age); bindings.put(\"customerGender\", cq.gender); return bindings;} private void select() { var predicate = new BooleanBuilder(); predicate.and(oq.product.price.gt(3000L)); var customRepositorySelectList = orderRepository.selectList( predicate, OrderDTO.class, this.buildBindings(), query -&gt; query.leftJoin(cq).on(cq.id.eq(oq.customerId)), new QSort(oq.name.desc()) ); ...}:memo: ì „ì²´ ì½”ë“œ ë° í…ŒìŠ¤íŠ¸ëŠ” ë§í¬ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤." }, { "title": "Hibernate, Spring Data JPA, QueryDSL ì—ì„œ UNION ì‚¬ìš©í•˜ê¸°", "url": "/posts/jpa-union/", "categories": "JPA", "tags": "JPA, Hibernate, Spring Data JPA, QueryDSL", "date": "2023-01-15 14:12:00 +0900", "snippet": "JPA ì—ì„œ union ì‚¬ìš©í•˜ê¸°JPA í™˜ê²½ì—ì„œ ì§‘í•© ì—°ì‚°ì(UNION, UNION ALL, INTERSECT, EXCEPT)ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì„ê¹Œìš”? JPAì˜ ë²„ì „ì´ 3.1ê¹Œì§€ ì˜¬ë¼ì™”ì–´ë„ ì•„ì§ ì´ì—ëŒ€í•œ ëª…ì„¸, ì§€ì›ì€ ì—†ëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.native sqlë¡œ ì‘ì„±í•˜ë©´ ì•ˆë˜ëŠ” ì¿¼ë¦¬ëŠ” ì—†ê¸´ í•©ë‹ˆë‹¤ë§Œ, ì¶”ìƒí™”ëœ SQLì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤ëŠ” ë‹¨ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤.Hibernateê°€ ì´ì— ëŒ€í•œ í•´ë‹µì´ ë  ìˆ˜ ìˆëŠ”ë°ìš”, Hibernate6 ë²„ì „ë¶€í„°ëŠ” ì§‘í•© ì—°ì‚°ìë“¤ì„ ì§€ì›í•˜ê¸° ì‹œì‘í–ˆìœ¼ë©° QueryDSLì€ JPASQLQuery í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ì¼ë°˜ì ì¸ native sqlë³´ë‹¤ëŠ” type-safe í•˜ê²Œ ì¿¼ë¦¬ ì‘ì„±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.ì´ í¬ìŠ¤íŒ…ì—ì„œëŠ” ê°„ë‹¨í•œ ì˜ˆì œë¡œ JPA í™˜ê²½ì—ì„œ UNIONì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê³ ì í•©ë‹ˆë‹¤.0. ë¬¸ì œ í™•ì¸ &amp; ì˜ˆì œ ì„¸íŒ…Order ë¼ëŠ” íŒŒí‹°ì…˜ í…Œì´ë¸”ì´ ì¡´ì¬í•´ì•¼ í•˜ëŠ”ë° ëª¨ì¢…ì˜ ì´ìœ ë¡œ íŒŒí‹°ì…˜ í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ì§€ ëª»í•˜ê³  ì£¼ê¸°ì ìœ¼ë¡œ í…Œì´ë¸”ì„ ì§ì ‘ ë¶„ë¦¬í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ë¼ê³  ê°€ì •í•©ë‹ˆë‹¤.ìš”ì²­ë°›ì€ ë°ì´í„°ì˜ ì¡°ê±´ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. Order í…Œì´ë¸”ì„ ìƒì†í•˜ëŠ” ëª¨ë“  í…Œì´ë¸”ì˜ ì£¼ë¬¸ì„ í•©ì³ ì£¼ì„¸ìš”. 22ë…„ 6ì›” ë°ì´í„°ëŠ” ë°›ëŠ”ë¶„ì˜ ì„±ì”¨ê°€ â€˜ê¹€â€™ì”¨ì¸ ì£¼ë¬¸ë§Œ ì¡°íšŒí•´ ì£¼ì„¸ìš”. 23ë…„ 1ì›” ë°ì´í„°ëŠ” ìƒí’ˆê°€ê²©ì´ 10ë§Œì› ì´ìƒì¸ ì£¼ë¬¸ë§Œ ì¡°íšŒí•´ ì£¼ì„¸ìš”. í•©ì³ì§„ ì£¼ë¬¸ì—ì„œ ìƒíƒœê°’ì´ FAILEDì¸ ì£¼ë¬¸ì€ ì œì™¸í•´ ì£¼ì„¸ìš”. ì´ë¥¼ sqlë¡œ í‘œí˜„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ê°„ë‹¨íˆ í‘œí˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (PostgreSQL ê¸°ì¤€)select o.*from ( select * from order_2206 where order_2206.toname like 'ê¹€%' union all select * from order_2209 union all select * from order_2301 where order_2301.itemprice &gt;= 100000 ) as owhere status &lt;&gt; 'FAILED'FROM ì ˆì— ì„œë¸Œì¿¼ë¦¬ë¥¼ ì¨ì•¼í•˜ê³  ê·¸ ì„œë¸Œì¿¼ë¦¬ëŠ” UNION ALL ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ì œ ìœ„ sqlë¬¸ì„ JPAë¡œ ì˜®ê²¨ë³´ë ¤ê³  í•©ë‹ˆë‹¤.ë‹¤ìŒì€ í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©ë  ë¼ì´ë¸ŒëŸ¬ë¦¬ &amp; ì—”í‹°í‹° ì…ë‹ˆë‹¤.dependencies { implementation group: 'org.postgresql', name: 'postgresql', version: '42.5.1' implementation 'org.hibernate.orm:hibernate-core:6.2.0.Final' implementation group: 'org.apache.logging.log4j', name: 'log4j-core', version: '2.19.0' implementation 'com.querydsl:querydsl-jpa:5.0.0:jakarta' implementation 'com.querydsl:querydsl-sql:5.0.0' annotationProcessor 'com.querydsl:querydsl-apt:5.0.0:jakarta' annotationProcessor 'jakarta.persistence:jakarta.persistence-api:3.1.0' implementation 'org.projectlombok:lombok:1.18.24' annotationProcessor 'org.projectlombok:lombok:1.18.24' testImplementation 'org.springframework.boot:spring-boot-starter-test:3.0.1' testImplementation 'org.junit.jupiter:junit-jupiter-api:5.8.1' testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.8.1'}@Getter@Setter@MappedSuperclasspublic class Order { @Id @GeneratedValue(strategy = GenerationType.AUTO) Long id; @Enumerated(EnumType.STRING) protected OrderStatus status; protected String fromAddress; protected String fromName; protected String fromPhoneNumber; protected String toAddress; protected String toName; protected String toPhoneNumber; protected String itemName; protected int itemPrice; protected LocalDateTime createdDateTime;}@Entity@Getterpublic class Order_2206 extends Order { // Order_2209 Order_2301 ë™ì¼}1. HibernateHibernateëŠ” 6 ë²„ì „ë¶€í„° ì§‘í•© ì—°ì‚°ìë“¤ì— ëŒ€í•œ ì§€ì›ì„ ì‹œì‘í•˜ì˜€ìŠµë‹ˆë‹¤.ì´ë¡œì¨ JPQLê³¼ Criteria API ì—ì„œ UNIONì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ê²Œ ê°€ëŠ¥í•œ ì´ìœ ëŠ” SQM (Semantic Query Model) ë•Œë¬¸ì¸ë°ìš”, SQMì— ëŒ€í•´ì„œëŠ” ì´ ë¬¸ì„œë¥¼ ì½ì–´ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤.Hibernate6 ì´ì „ ë²„ì „ë“¤ì˜ ê²½ìš° Criteria API -&gt; JPQL / HQL -&gt; SQL ë¡œ ë³€í™˜ë˜ì—ˆë˜ ê²ƒì— ë¹„í•´ Hibernate6ë¶€í„°ëŠ” Criteria APiì™€ JPQL / HQLì´ ëª¨ë‘ SQMìœ¼ë¡œ ì»´íŒŒì¼ë˜ê³  ìµœì¢…ì ìœ¼ë¡œ SQMì´ SQLë¡œ ë³€í™˜ëœë‹¤ê³  í•˜ë„¤ìš”.ì¿¼ë¦¬ ëª¨ë¸ì„ í†µí•© í•¨ìœ¼ë¡œì¨ Hibernate Criteria Queryê°€ JPA (JPQL) ìŠ¤í™ì—ì„œ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ë“¤ì„ ì§€ì›í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤ê³  í•©ë‹ˆë‹¤. ê·¸ì¤‘ í•˜ë‚˜ê°€ UNIONì¸ ì…ˆì´ì£ .1-1. HQLì²«ë²ˆì§¸ëŠ” HQL ì…ë‹ˆë‹¤. ì´ì œ FROM ì ˆì—ì„œì˜ ì„œë¸Œì¿¼ë¦¬ì™€ UNIONì„ ì‚¬ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— aliasë§Œ ì˜ ì§€ì¼œì„œ ì •ì§í•˜ê²Œ sqlì„ ì‘ì„±í•˜ë©´ ë©ë‹ˆë‹¤.@Test@DisplayName(\"Hibernate HQL UNION ALL\")void hibernateHQL() { // o.id AS id, o.status AS status, o.fromAddress AS fromAddress, o.fromName AS fromName, o.fromPhoneNumber AS fromPhoneNumber, o.toAddress AS toAddress, o.toName AS toName, o.toPhoneNumber AS toPhoneNumber, o.itemName AS itemName, o.itemPrice AS itemPrice, o.createdDateTime AS createdDateTime var fieldsWithAlias = Arrays.stream(Order.class.getDeclaredFields()).map(i -&gt; \"o.\" + i.getName() + \" AS \" + i.getName()).collect(Collectors.joining(\", \")); var query = String.format(\"\"\" SELECT %1$s FROM ( SELECT %1$s FROM Order_2206 AS o WHERE o.toName LIKE :name UNION ALL SELECT %1$s FROM Order_2209 AS o UNION ALL SELECT %1$s FROM Order_2301 AS o WHERE o.itemPrice &gt;= :price ) AS o WHERE o.status &lt;&gt; :status \"\"\", fieldsWithAlias); var list = entityManager .createQuery(query) .setParameter(\"name\", \"ê¹€%\") .setParameter(\"price\", 100000) .setParameter(\"status\", OrderStatus.FAILED) .getResultList(); System.out.println(list);}ìƒì„±ë˜ëŠ” ì¿¼ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. [DEBUG] [main] SQL - select o4_0.id, o4_0.status, o4_0.fromAddress, o4_0.fromName, o4_0.fromPhoneNumber, o4_0.toAddress, o4_0.toName, o4_0.toPhoneNumber, o4_0.itemName, o4_0.itemPrice, o4_0.createdDateTime from (select o1_0.id, o1_0.status, o1_0.fromAddress, o1_0.fromName, o1_0.fromPhoneNumber, o1_0.toAddress, o1_0.toName, o1_0.toPhoneNumber, o1_0.itemName, o1_0.itemPrice, o1_0.createdDateTime from Order_2206 o1_0 where o1_0.toName like ? escape '' union all select o2_0.id, o2_0.status, o2_0.fromAddress, o2_0.fromName, o2_0.fromPhoneNumber, o2_0.toAddress, o2_0.toName, o2_0.toPhoneNumber, o2_0.itemName, o2_0.itemPrice, o2_0.createdDateTime from Order_2209 o2_0 union all select o3_0.id, o3_0.status, o3_0.fromAddress, o3_0.fromName, o3_0.fromPhoneNumber, o3_0.toAddress, o3_0.toName, o3_0.toPhoneNumber, o3_0.itemName, o3_0.itemPrice, o3_0.createdDateTime from Order_2301 o3_0 where o3_0.itemPrice&gt;=? ) o4_0(id,status,fromAddress,fromName,fromPhoneNumber,toAddress,toName,toPhoneNumber,itemName,itemPrice,createdDateTime)where o4_0.status!=?[TRACE] [main] bind - binding parameter [1] as [VARCHAR] - [ê¹€%][TRACE] [main] bind - binding parameter [2] as [INTEGER] - [100000][TRACE] [main] bind - binding parameter [3] as [VARCHAR] - [FAILED]sqlë¬¸ì´ ì˜ ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì°¸ê³ ë¡œ ì´ì „ ë²„ì „ì˜ Hibernateì™€ ë‹¬ë¦¬ selectë¬¸ì— ë³„ì¹­ì´ ë“¤ì–´ê°€ì§€ ì•Šì•„ sqlë¬¸ì´ ì¡°ê¸ˆ ì˜ˆë»(?) ì¡ŒëŠ”ë°ìš”, ì´ëŠ” Hibernate6ì˜ ìƒˆë¡œìš´ ë°ì´í„° ì¶”ì¶œ ë°©ì‹ê³¼ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤.JDBC APIê°€ ì œê³µí•˜ëŠ” ResultSetìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ëŠ” ë°©ë²•ì—ëŠ” read-by-name ê³¼ read-by-position ì´ ìˆëŠ”ë°ìš”,Hibernate6 ì´ì „ ë²„ì „ë“¤ì—ì„œëŠ” read-by-nameì„ ì‚¬ìš©í•´ ì™”ì§€ë§Œ ì´ì œëŠ” read-by-positionì„ ì‚¬ìš©í•œë‹¤ê³  í•©ë‹ˆë‹¤. Hibernate ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ ê³¼ JDBC driver maintainerì˜ ê¸€ì— ë”°ë¥´ë©´ read-by-position ë°©ì‹ì´ ë” ë¹ ë¥´ë‹¤ê³  í•˜ë„¤ìš”.-- ì´ì „select o1_0.id as id_1_0_0_, o1_0.status as status_1_0_0, o1_0.fromAddress as from_address_1_0_0, o1_0.fromName as from_name_1_0_0, o1_0.fromPhoneNumber as from_phone_number_1_0_0,-- í˜„ì¬select o1_0.id, o1_0.status, o1_0.fromAddress, o1_0.fromName, o1_0.fromPhoneNumber,1-2. Criteria API (Hibernate 6.2 ++)ì´ë²ˆì—ëŠ” Criteria APIë¥¼ ì´ìš©í•˜ì—¬ HQLë³´ë‹¤ type-safe í•˜ê²Œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤. ë‹¹ì—°í•œ ì´ì•¼ê¸°ì§€ë§Œ ì–´ë””ê¹Œì§€ë‚˜ Hibernateì˜ ê¸°ëŠ¥ë“¤ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ì¼ë°˜ CriteiaBuilderì„ ì‚¬ìš©í•˜ë©´ ì•ˆë˜ê³  HibernateCriteriaBuilderì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.Hibernate 6.2 ì´ì „ ë²„ì „ì—ì„œëŠ” from ì ˆì˜ ì„œë¸Œì¿¼ë¦¬ì—ì„œ union allì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ HibernateCriteriaBuilder ì¸í„°í˜ì´ìŠ¤ì— ìœ„ ë©”ì†Œë“œê°€ ì¡´ì¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì¸ë°ìš”,ìœ„ ë©”ì†Œë“œê°€ ì¡´ì¬í•¨ìœ¼ë¡œì¨ union allì˜ ê²°ê³¼ê°’ìœ¼ë¡œ JPASubQuery íƒ€ì…ì„ ë¦¬í„´ë°›ì„ ìˆ˜ ìˆê³  from ì ˆì˜ ì„œë¸Œì¿¼ë¦¬ì—ì„œ union all ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. Hibernate 6.2 ë²„ì „ë¶€í„°ëŠ” with cte as ( ... ) êµ¬ë¬¸ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆëŠ”ë° ì•„ë§ˆ ì´ì— ì˜í–¥ì„ ë°›ì•„ ì¶”ê°€ë˜ì§€ ì•Šì•˜ë‚˜ ì‹¶ìŠµë‹ˆë‹¤.@Test@DisplayName(\"Hibernate Criteria API UNION ALL\")void hibernateCriteriaAPI() { Function&lt;JpaRoot&lt;?&gt;, Selection&lt;?&gt;[]&gt; rootPath = (root) -&gt; Arrays.stream(Order.class.getDeclaredFields()).map(field -&gt; root.get(field.getName()).alias(field.getName())).toArray(Selection[]::new); var scq = hibernateCriteriaBuilder.createQuery(Order.class); BiFunction&lt;Class&lt;? extends Order&gt;, Function&lt;JpaRoot&lt;? extends Order&gt;, Expression&lt;Boolean&gt;&gt;, JpaSubQuery&lt;Tuple&gt;&gt; jpaCriteriaQuery = (clazz, condition) -&gt; { var sq = scq.subquery(Tuple.class); var root = sq.from(clazz); sq.multiselect(rootPath.apply(root)); if (condition != null) { sq.where(condition.apply(root)); } return sq; }; var sq1 = jpaCriteriaQuery.apply(Order_2206.class, (root) -&gt; hibernateCriteriaBuilder.ilike(root.get(\"toName\"), \"ê¹€%\")); var sq2 = jpaCriteriaQuery.apply(Order_2209.class, null); var sq3 = jpaCriteriaQuery.apply(Order_2301.class, (root) -&gt; hibernateCriteriaBuilder.ge(root.get(\"itemPrice\"), 100000)); var cq = hibernateCriteriaBuilder.createQuery(Order.class); var root = cq.from(hibernateCriteriaBuilder.unionAll(sq1, sq2, sq3)); cq.multiselect(rootPath.apply(root)); cq.where(hibernateCriteriaBuilder.notEqual(root.get(\"status\"), OrderStatus.FAILED)); var list = entityManager.createQuery(cq).getResultList(); System.out.println(list);} select derived1_0.id, derived1_0.status, derived1_0.fromAddress, derived1_0.fromName, derived1_0.fromPhoneNumber, derived1_0.toAddress, derived1_0.toName, derived1_0.toPhoneNumber, derived1_0.itemName, derived1_0.itemPrice, derived1_0.createdDateTime from (select o1_0.id, o1_0.status, o1_0.fromAddress, o1_0.fromName, o1_0.fromPhoneNumber, o1_0.toAddress, o1_0.toName, o1_0.toPhoneNumber, o1_0.itemName, o1_0.itemPrice, o1_0.createdDateTime from Order_2206 o1_0 where o1_0.toName ilike ? escape '' union all select o2_0.id, o2_0.status, o2_0.fromAddress, o2_0.fromName, o2_0.fromPhoneNumber, o2_0.toAddress, o2_0.toName, o2_0.toPhoneNumber, o2_0.itemName, o2_0.itemPrice, o2_0.createdDateTime from Order_2209 o2_0 union all select o3_0.id, o3_0.status, o3_0.fromAddress, o3_0.fromName, o3_0.fromPhoneNumber, o3_0.toAddress, o3_0.toName, o3_0.toPhoneNumber, o3_0.itemName, o3_0.itemPrice, o3_0.createdDateTime from Order_2301 o3_0 where o3_0.itemPrice&gt;=? ) derived1_0(id,status,fromAddress,fromName,fromPhoneNumber,toAddress,toName,toPhoneNumber,itemName,itemPrice,createdDateTime)where derived1_0.status!=?[TRACE] [main] bind - binding parameter [1] as [VARCHAR] - [ê¹€%][TRACE] [main] bind - binding parameter [2] as [INTEGER] - [100000][TRACE] [main] bind - binding parameter [3] as [VARCHAR] - [FAILED]HQLë¡œ ì‘ì„±í•œ ì¿¼ë¦¬ì™€ëŠ” í…Œì´ë¸” ë³„ì¹­ë§Œ ë‹¤ë¥¼ë¿ ë‹¤ë¥¸ ë¶€ë¶„ì€ ì¼ì¹˜í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.2. Spring Data JPA :warning: ì˜ˆì œ ì„¸íŒ…ì—ëŠ” Spring Data JPA ë””íœë˜ì‹œê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤. ì§ì ‘ í…ŒìŠ¤íŠ¸ë¥¼ ì›í•˜ì‹œëŠ” ë¶„ë“¤ì€ 3.x.x ë²„ì „ ì´ìƒì˜ Spring Data JPAë¥¼ ì¶”ê°€í•˜ì—¬ ì£¼ì„¸ìš”.Spring Data JPAì˜ ê²½ìš° 3.x.x ë²„ì „ë¶€í„° Hibernate 6 ë²„ì „ì„ ì‚¬ìš©í•˜ê¸° ì‹œì‘í•˜ì˜€ìŠµë‹ˆë‹¤. ê¸°ì¡´ì—ëŠ” @Query ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ union ì¿¼ë¦¬ë¥¼ ì‘ì„±í–ˆì—ˆëŠ”ë°ìš”,í¬ê²Œ ë‹¬ë¼ì§„ ê²ƒì€ ì—†ì§€ë§Œ ì´ì œ Hibernate ì°¨ì›ì—ì„œ unionì„ ì§€ì›í•˜ê¸° ë•Œë¬¸ì— ì´ì œ native sqlë¡œ ë³€í™˜í•  í•„ìš”ê°€ ì—†ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ Spring Boot ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ë‹¨ê³„ì—ì„œ ì¿¼ë¦¬ë¥¼ ê²€ì¦í•  ìˆ˜ ìˆì–´ ì•ˆì „í•œ ì¿¼ë¦¬ ì‘ì„±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.@Query ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•  ë•Œ nativeQuery = true ì˜µì…˜ì„ ì£¼ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.@Repositorypublic interface OrderRepository extends JpaRepository&lt;Order_2206, Long&gt; { @Query( value = \"\"\" SELECT u.toAddress, u.toName, u.itemName, u.itemPrice FROM ( SELECT o1.status as status, o1.toAddress as toAddress, o1.toName as toName, o1.itemName as itemName, o1.itemPrice as itemPrice FROM Order_2206 o1 WHERE o1.toName like :name UNION ALL SELECT o2.status as status, o2.toAddress as toAddress, o2.toName as toName, o2.itemName as itemName, o2.itemPrice as itemPrice FROM Order_2209 o2 UNION ALL SELECT o3.status as status, o3.toAddress as toAddress, o3.toName as toName, o3.itemName as itemName, o3.itemPrice as itemPrice FROM Order_2301 o3 where o3.itemPrice &gt;= :itemPrice ) AS u WHERE u.status != :status \"\"\" ) List&lt;Tuple&gt; selectResult(@Param(\"name\") String name, @Param(\"itemPrice\") int itemPrice, @Param(\"status\") OrderStatus orderStatus);}3. QueryDSLJPQLì´ unionì„ ì§€ì›í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— í”íˆ ì‚¬ìš©í•˜ëŠ” JPAQuery ì¸í„°í˜ì´ìŠ¤ë¡œëŠ” ì„œë¸Œì¿¼ë¦¬ì™€ unionì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.Githubì˜ ì´ìŠˆì™€ ë‹µë³€ì— ë”°ë¥´ë©´ Hibernate6ê°€ ì¢€ ë” í° ë²”ìœ„ì—ì„œ ì‚¬ìš©ë˜ë©´ QueryDSL 6.0 ë²„ì „ë¶€í„°ëŠ” JPQLëŒ€ì‹  HQLì„ ì§ì ‘ ì‚¬ìš©í•˜ê²Œ ë ìˆ˜ë„ ìˆë‹¤ê³  í•˜ë„¤ìš”.1. querydsl-sqlë°©ë²•ì´ ì—†ëŠ”ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. JPQLì„ ì‚¬ìš©í•˜ëŠ” JPAQuery ëŒ€ì‹  ë°”ë¡œ native sqlë¡œ ë³€í™˜ë˜ëŠ” JPASQLQuery ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤. ì¸í„°í˜ì´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ë‹¤ë©´ ì¢…ì†ì„±ì— querydsl-sqlì´ í¬í•¨ë˜ì–´ìˆëŠ”ì§€ ë‹¤ì‹œí•œë²ˆ í™•ì¸í•´ ë³´ì„¸ìš”.private static JPASQLQuery&lt;?&gt; query() { return new JPASQLQuery&lt;&gt;(entityManager, new PostgreSQLTemplates());}@Test@DisplayName(\"QueryDSL UNION ALL\")void queryDSL() { var q = QOrder.order; var q1 = QOrder_2206.order_2206; var q2 = QOrder_2209.order_2209; var q3 = QOrder_2301.order_2301; var unionList = query().select(q.toName, q.toAddress, q.itemName, q.itemPrice).from( query().unionAll( query() .select(q1.toName.as(q.toName), q1.toAddress.as(q.toAddress), q1.itemName.as(q.itemName), q1.itemPrice.as(q.itemPrice)) .from(q1) .where(q1.toName.like(\"ê¹€%\")) , query() .select(q2.toName.as(q.toName), q2.toAddress.as(q.toAddress), q2.itemName.as(q.itemName), q2.itemPrice.as(q.itemPrice)) .from(q2), query() .select(q3.toName.as(q.toName), q3.toAddress.as(q.toAddress), q3.itemName.as(q.itemName), q3.itemPrice.as(q.itemPrice)) .from(q3) .where(q3.itemPrice.goe(100000)) ).as(String.valueOf(q)) ).fetch(); System.out.println(unionList);}select order1.toName, order1.toAddress, order1.itemName, order1.itemPricefrom ((select order_2206.toName as toName, order_2206.toAddress as toAddress, order_2206.itemName as itemName, order_2206.itemPrice as itemPrice from order_2206 where order_2206.toName like ?) union all (select order_2209.toName as toName, order_2209.toAddress as toAddress, order_2209.itemName as itemName, order_2209.itemPrice as itemPrice from order_2209) union all (select order_2301.toName as toName, order_2301.toAddress as toAddress, order_2301.itemName as itemName, order_2301.itemPrice as itemPrice from order_2301 where order_2301.itemPrice &gt;= ?)) as order1;ì½”ë“œì™€ sql ì…ë‹ˆë‹¤. ì¿¼ë¦¬ë¥¼ ì§ì ‘ dbì— ë‚ ë¦¬ê¸° ì „ê¹Œì§€ ì—ëŸ¬(ì˜ˆ. PostgreSQL - FROM ì ˆ ë‚´ì˜ subquery ì—ëŠ” ë°˜ë“œì‹œ aliasë¥¼ ê°€ì ¸ì•¼ë§Œ í•©ë‹ˆë‹¤. ì—ëŸ¬ ë°œìƒ) ë¥¼ ì¡ì„ìˆ˜ ì—†ì§€ë§Œ ì¼ë‹¨ ëŒì•„ê°€ê¸°ë§Œ í•˜ë©´ ìœ„ì˜ ë‘ ë°©ì‹ë“¤ë³´ë‹¤ëŠ” ë” type-safeí•œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.ë‹¤ë§Œ ì½”ë“œë¥¼ ë³´ì‹œë©´ ì•ì„  ì¿¼ë¦¬ë“¤ê³¼ ë‹¬ë¦¬ unioní•œ ê²°ê³¼ë¬¼ì—ì„œ FAILED ìƒíƒœë¥¼ ì œì™¸í•˜ì§€ ì•Šì•˜ëŠ”ë°ìš”,ë§Œì•½ ìƒíƒœë¥¼ ì œì™¸í•˜ê³ ì ì¡°ê±´ì„ ì¶”ê°€í•œë‹¤ë©´ JPQLë¡œ ë³€í™˜ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— status column (varchar)ì„ ìë°” enumê³¼ ë§¤í•‘í•  ìˆ˜ ì—†ì–´ ì—ëŸ¬ê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.ì´ì²˜ëŸ¼ querydslì„ ì‚¬ìš©í•˜ëŠ” ì˜ë¯¸ê°€ ì•½ê°„ì€ í‡´ìƒ‰ë  ìˆ˜ ìˆë‹¤ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.2. Blaze Persistence (QueryDSL Integration)querydsl-sqlì„ ì‚¬ìš©í• ë•Œ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤. ë°”ë¡œ Blaze Persistence ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.Hibernate, QueryDSLì˜ ê¹ƒí—™ ì´ìŠˆë‚˜ PRë“¤ì„ ë³¼ë•Œ ìì£¼ ë“±ì¥í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ë° í•œë²ˆ ì‚¬ìš©í•´ ë³´ì•˜ìŠµë‹ˆë‹¤. ì´ê²Œ ë¬´ì—‡ì´ê³  ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ì§€ëŠ”ë¬¸ì„œì— ìƒì„¸í•˜ê²Œ ì„¤ëª…ë˜ì–´ ìˆìœ¼ë‹ˆ í•œë²ˆ ì½ì–´ë³´ì‹œê¸¸ ë°”ëë‹ˆë‹¤.Blaze PersistenceëŠ” CTEë¥¼ ì§€ì›í•©ë‹ˆë‹¤. ì•ì„  ì˜ˆì œë“¤ì—ì„œ ì‚¬ìš©í•´ì™”ë˜ ì„œë¸Œì¿¼ë¦¬ í˜•íƒœì˜ ì¿¼ë¦¬ë¥¼ CTEë¡œ ë³€ê²½í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.with cte as ( select * from order_2206 where order_2206.toname like 'ê¹€%' union all select * from order_2209 union all select * from order_2301 where order_2301.itemprice &gt;= 100000) select * from cte where status &lt;&gt; 'FAILED'ì´ë¥¼ ìë°”ì½”ë“œë¡œ ë³€í™˜í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.@CTE@Entitypublic class OrderCTE { @Id String id; @Enumerated(EnumType.STRING) OrderStatus status; String fromAddress; String fromName; String fromPhoneNumber; String toAddress; String toName; String toPhoneNumber; String itemName; int itemPrice; LocalDateTime createdDateTime;}private BlazeJPAQueryFactory jpaQueryFactory() { var config = Criteria.getDefault(); criteriaBuilderFactory = config.createCriteriaBuilderFactory(entityManagerFactory); return new BlazeJPAQueryFactory(entityManager, criteriaBuilderFactory);}private &lt;T extends EntityPathBase&lt;? extends Order&gt;&gt; Expression&lt;?&gt;[] binding(T targetQ) { var q = QOrderCTE.orderCTE; return new Expression[] { JPQLNextExpressions.bind(q.id, Expressions.stringPath(targetQ, \"id\")), JPQLNextExpressions.bind(q.status, Expressions.path(OrderStatus.class, \"status\")), JPQLNextExpressions.bind(q.fromAddress, Expressions.stringPath(targetQ, \"fromAddress\")), JPQLNextExpressions.bind(q.fromName, Expressions.stringPath(targetQ, \"fromName\")), JPQLNextExpressions.bind(q.fromPhoneNumber, Expressions.stringPath(targetQ, \"fromPhoneNumber\")), JPQLNextExpressions.bind(q.toAddress, Expressions.stringPath(targetQ, \"toAddress\")), JPQLNextExpressions.bind(q.toName, Expressions.stringPath(targetQ, \"toName\")), JPQLNextExpressions.bind(q.toPhoneNumber, Expressions.stringPath(targetQ, \"toPhoneNumber\")), JPQLNextExpressions.bind(q.itemName, Expressions.stringPath(targetQ, \"itemName\")), JPQLNextExpressions.bind(q.itemPrice, Expressions.path(Integer.class, \"itemPrice\")), JPQLNextExpressions.bind(q.createdDateTime, Expressions.path(LocalDateTime.class, \"createdDateTime\")) };}@Test@DisplayName(\"QueryDSL Blaze Persistence Integration\")void queryDSLBlazePersistenceIntegration() { var q = QOrderCTE.orderCTE; var q1 = QOrder_2206.order_2206; var q2 = QOrder_2209.order_2209; var q3 = QOrder_2301.order_2301; var list = jpaQueryFactory() .with( q, jpaQueryFactory().unionAll( JPQLNextExpressions .select(binding(q1)) .from(q1) .where(q1.toName.like(\"ê¹€%\")), JPQLNextExpressions .select(binding(q2)) .from(q2), JPQLNextExpressions .select(binding(q3)) .from(q3) .where(q3.itemPrice.goe(100000)) ) ) .select(q) .from(q) .where(q.status.ne(OrderStatus.FAILED)) .fetch(); System.out.println(list.size());}OrderCTE ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ê³  @CTE ì–´ë…¸í…Œì´ì…˜ê³¼ QClassë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ @Entity ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì˜€ìŠµë‹ˆë‹¤. OrderCTE í´ë˜ìŠ¤ëŠ” ì¼ì¢…ì˜ ì„ì‹œ í…Œì´ë¸” (dbë¡œ ì¹˜ë©´ view) ì´ë¼ê³  ë³´ì‹œë©´ ë ê²ƒ ê°™ìŠµë‹ˆë‹¤.ì£¼ì˜í•´ì•¼ í•  ì ì€ A, B, C 3ê°œì˜ ì—”í‹°í‹°ë¥¼ union all í•˜ê³ ì í•  ë•Œ @Idê°€ ë¶™ì€ ì»¬ëŸ¼ì˜ ê°’ì€ ì¤‘ë³µë˜ì§€ ì•Šì•„ì•¼ í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ë§Œì•½ A id 1, B id 1, C id 1 3ê°œì˜ í…Œì´ë¸”ì„ union all í•˜ë©´ 3ê°œì˜ rowê°€ ë¦¬í„´ë˜ëŠ” ê²ƒì´ ì•„ë‹Œ 1ê°œì˜ rowë§Œ ë¦¬í„´ë˜ê²Œ ë©ë‹ˆë‹¤.JPAì—ì„œ @Id ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ í•„ë“œëŠ” ìœ ì§€í¬í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì–´ì°Œë³´ë©´ ë‹¹ì—°í•œ(?) ê²ƒì´ë¼ ìƒê°ë©ë‹ˆë‹¤.select o1_0.id, o1_0.createdDateTime, o1_0.fromAddress, o1_0.fromName, o1_0.fromPhoneNumber, o1_0.itemName, o1_0.itemPrice, o1_0.status, o1_0.toAddress, o1_0.toName, o1_0.toPhoneNumberfrom (select o1_0.id, o1_0.status, o1_0.fromAddress, o1_0.fromName, o1_0.fromPhoneNumber, o1_0.toAddress, o1_0.toName, o1_0.toPhoneNumber, o1_0.itemName, o1_0.itemPrice, o1_0.createdDateTime from Order_2206 o1_0 where o1_0.toName like ? escape '!' union all select o2_0.id, o2_0.status, o2_0.fromAddress, o2_0.fromName, o2_0.fromPhoneNumber, o2_0.toAddress, o2_0.toName, o2_0.toPhoneNumber, o2_0.itemName, o2_0.itemPrice, o2_0.createdDateTime from Order_2209 o2_0 union all select o3_0.id, o3_0.status, o3_0.fromAddress, o3_0.fromName, o3_0.fromPhoneNumber, o3_0.toAddress, o3_0.toName, o3_0.toPhoneNumber, o3_0.itemName, o3_0.itemPrice, o3_0.createdDateTime from Order_2301 o3_0 where o3_0.itemPrice&gt;=?) o1_0(id,status,fromAddress,fromName,fromPhoneNumber,toAddress,toName,toPhoneNumber,itemName,itemPrice,createdDateTime)where o1_0.status!=?ìƒì„±ë˜ëŠ” sqlì€ ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤. ìë°” ì½”ë“œë¡œëŠ” CTEë¥¼ ì‚¬ìš©í–ˆë”ë¼ë„ ë§ˆì§€ë§‰ì—ëŠ” ì„œë¸Œì¿¼ë¦¬ í˜•íƒœì˜ ì¿¼ë¦¬ë¡œ ë³€í™˜ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì‹¤ë¬´ì—ì„œ ê½¤ ë³µì¡í•œ í†µê³„ ì¿¼ë¦¬ì—ë„ ì ìš©í•´ ë³´ì•˜ëŠ”ë° ê²°ê³¼ê°’ì´ ë™ì¼í•˜ê²Œ ë‚˜ì˜¤ëŠ” ê²ƒìœ¼ë¡œ ë³´ì•„ ê³„ì† ì‚¬ìš©í•´ë„ ë¬¸ì œì—†ì„ ê²ƒì´ë¼ ìƒê°ë©ë‹ˆë‹¤.ê²°ë¡ JPA í™˜ê²½ì—ì„œ unionì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ë“¤ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. QueryDSLì„ ì‚¬ìš©í•œë‹¤ë©´ Blaze Persistenceë¥¼ ë¶™ì—¬ ì‚¬ìš©í•˜ëŠ”ê²ƒì´ ìµœê³ ì˜ ë°©ë²•ì´ë¼ê³  ìƒê°ë©ë‹ˆë‹¤.Hibernate ë²„ì „ì´ 6ê¹Œì§€ ì˜¬ë¼ì˜¤ë©´ì„œ ê¸°ì¡´ì˜ JPAë¡œëŠ” ë¶ˆê°€ëŠ¥í–ˆë˜ ì¼ë“¤ì´ ì–´ëŠì •ë„ ê°€ëŠ¥í•´ì§„ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. (EclipseLinkëŠ” ì˜¤ë˜ì „ë¶€í„° ì§€ì›í–ˆë˜ê²ƒâ€¦)íŠ¹ì • ìƒí™©ì—ì„œ ì–´ì©” ìˆ˜ ì—†ì´ ì‚¬ìš©í•´ ì™”ë˜ native sqlì„ ìˆœìˆ˜ ìë°” ì½”ë“œë¡œë§Œ í‘œí˜„í•˜ê²Œ ë  ë‚ ë„ ë¨¸ì§€ ì•Šì•„ ë³´ì…ë‹ˆë‹¤. ì´ í¬ìŠ¤íŒ…ì— ì‚¬ìš©ëœ ì˜ˆì œ ì½”ë“œëŠ” ì´ê³³ ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤." }, { "title": "22ë…„ íšŒê³ ", "url": "/posts/2022-retrospect/", "categories": "ETC", "tags": "ETC", "date": "2022-12-31 17:12:00 +0900", "snippet": "2022ë…„ì–´ëŠë§ ë˜ í•œ í•´ì˜ ë§ˆì§€ë§‰ ë‚ ì´ ë˜ì—ˆë‹¤. ì•„ë¬´ë¦¬ ìƒê°í•´ë„ 12ì›” 31ì¼ì´ ìƒì¼ì´ë©´ ë‚˜ì´ë¥¼ ë³¼ ë•Œ ë„ˆë¬´ ì†í•´ì¸ê²ƒ ê°™ë‹¤. ê°“ ì„±ì¸ì´ ë˜ì—ˆì„ë•ŒëŠ” ì¢‹ì•˜ì§€ë§Œ ì´ì œëŠ” í•œì‚´ í•œì‚´ì´ í° ë¶€ë‹´ìœ¼ë¡œ ë‹¤ê°€ì˜¤ëŠ”ê²ƒ ê°™ë‹¤.ê·¸ë˜ë„ ì•„ì§ ë§Œìœ¼ë¡œëŠ” 20ëŒ€ ì¤‘ë°˜ì„ì— ê°ì‚¬í•œë‹¤. ë˜ ê·¸ë•Œ ê°€ë´ì•¼ ì•Œê² ì§€ë§Œ ë‚´ë…„ 6ì›”ë¶€í„°ëŠ” ë§Œ ë‚˜ì´ë¡œ í†µì¼í•œë‹¤ê³  í•˜ë‹ˆ ê¸°ëŒ€í•´ ë´ì•¼ê² ë‹¤.19ë…„, 20ë…„, 21ë…„ì—ëŠ” 1ë…„ì— í•œë²ˆì”© ê±´ê°•ì— í° ë¬¸ì œê°€ ìƒê¸°ê³¤ í–ˆëŠ”ë°, ì˜¬í•´ëŠ” ìì˜í•œ ë¬¸ì œë§Œ ìˆì„ë¿ ì‚¶ì„ ë°”ê¿€ë§Œí•œ ë¬¸ì œëŠ” ì—†ì—ˆë˜ ê²ƒ ê°™ë‹¤. ë‚´ë…„ì—ë„ ë¬¸ì œì—†ì´ ê±´ê°•í•œ ì‚¶ì„ ì‚´ìˆ˜ ìˆê¸°ë¥¼ ë°”ë€ë‹¤. (ìš´ë™í•˜ìâ€¦)ì§ì¥ìƒí™œ 4ë…„ì°¨í–‡ìˆ˜ë¡œë§Œ ë³´ë©´ ë§Œ 3ë…„ì´ ì§€ë‚˜ 4ë…„ì°¨ ê°œë°œìê°€ ë˜ì—ˆë‹¤. ì˜¬í•´ ë‚´ì²´ê³µë„ ëë‚˜ê³  ì—°ë´‰ë„ ì‘ì§€ ì•Šì€ í­ìœ¼ë¡œ ì˜¬ë¼ ë§Œì¡±í•˜ë©° ë‹¤ë…”ë˜ ê²ƒ ê°™ë‹¤.ì¸ìˆ˜ì¸ê³„ ë°›ì€ ì‹œìŠ¤í…œë„ ì˜ ìš´ì˜í–ˆë‹¤ê³  ìƒê°í•œë‹¤. 1ë…„ì „ ì´ì¯”ìŒ ìƒˆë¡œìš´ íŒ€ì¥ë‹˜ì´ ì˜¤ì…”ì„œ 2ëª…ì´ì„œ í”„ë¡œì íŠ¸ë¥¼ ì´ëŒê²Œ ë˜ì—ˆëŠ”ë°, ì´ë¶„ì´ ì˜ ì´ëŒì–´ ì£¼ì…”ì„œ í° ë¬¸ì œì—†ì´ ì‹œìŠ¤í…œì„ ìš´ì˜í•˜ê³  íšŒì‚¬ìƒí™œì„ í•  ìˆ˜ ìˆì—ˆë˜ê²ƒ ê°™ë‹¤.ì²« íšŒì‚¬ì—ì„œ 3ë…„ì„ ë²„í…¨ë³´ì. ë¼ëŠ” ì†Œê¸°ì˜ ëª©ì ë„ ë‹¬ì„±í–ˆë‹¤. ì†”ë£¨ì…˜ íšŒì‚¬ë¼ì„œ ê·¸ëŸ°ê°€ ê·¸ë™ì•ˆ ì¨ë³´ê³  ì‹¶ì—ˆë˜ ê¸°ìˆ ì€ íƒ€í˜‘ì—†ì´ ì›í•˜ëŠ”ë§Œí¼ ì¨ë´¤ë˜ê²ƒ ê°™ë‹¤. í•œê°€ì§€ ì•„ì‰¬ìš´ì ì€ AWS ECSë‚˜ EKS, í˜¹ì€ ec2ì— ì§ì ‘ ì»¨í…Œì´ë„ˆë¥¼ ì´ìš©í•´ ì„œë²„ë¥¼ êµ¬ì¶•í•´ë³´ê³  ì‹¶ì—ˆëŠ”ë° ëª»í•´ì„œ ì•„ì‰¬ìš´ê²ƒ ê°™ë‹¤.ì„±ì¥ê³¡ì„ ì´ ì™„ë§Œí•´ì§€ê¸° ì‹œì‘í•œ ì´ì œëŠ” ìƒˆë¡œìš´ ë„ì „ì„ í• ë•Œê°€ ì•„ë‹Œê°€ ì‹¶ë‹¤. ì¼ë‹¨ ë‚´ë…„ ì—°ë´‰ì´ ì˜¤ë¥´ëŠ”ê±¸ ë´ì•¼ê² ì§€ë§Œ, ì˜¬í•´ í–ˆë˜ê²ƒë“¤ì„ ëŒì´ì¼œë³´ë©´ ì‘ë…„ë§Œí¼ì˜ ì—°ë´‰ì¸ìƒì€ ì—†ì„ë“¯ í•˜ë‹¤.(ã… ã… ) ì›í•˜ëŠ” ë§Œí¼ ì˜¬ë ¤ì£¼ë©´ ë‹¤ë‹ˆëŠ”ê±°ê³ â€¦ì›í•˜ëŠ” ë•Œì— ì´ì§ í•  ìˆ˜ ìˆê²Œ 23ë…„ì€ ì—°ì´ˆë¶€í„° í™•ì‹¤í•˜ê²Œ ì¤€ë¹„ í•´ì•¼ê² ë‹¤. ì½”ë”© í…ŒìŠ¤íŠ¸ ì¤€ë¹„í•˜ì!ê°œì¸ ì½”ë”©, ê°œì¸ ëª©í‘œê½‰ ì±„ì›Œì§„ ì”ë””ë°­ì€ ì•„ë‹ˆì§€ë§Œ ì´ì •ë„ë©´ ë§Œì¡±í•œë‹¤. ë‚´ë…„ì—ëŠ” ë” ë¹¼ê³¡í•œ ì”ë””ë°­ì„ ë§Œë“¤ìˆ˜ ìˆë„ë¡ í•´ì•¼ê² ë‹¤.ë‚´ë…„ì—ëŠ” ìë°” ì˜¤í”ˆì†ŒìŠ¤ì— ê¸°ì—¬ë¥¼ í•´ë³´ê³ ì í•œë‹¤. ì˜¬í•´ëŠ” ì˜¤í”ˆì†ŒìŠ¤ë¥¼ ëœ¯ì–´ë³´ëŠ” ì¼ì´ ê½¤ ë§ì•˜ë˜ê²ƒ ê°™ì€ë° ëœ¯ì–´ë³´ë©´ì„œ ì½”ë“œ ë¶„ì„ì˜ ì¬ë¯¸(?)ë¥¼ ëŠë‚€ê²ƒ ê°™ë‹¤. ë‚´ë…„ì—ë„ ê³„ì† ì¬ë¯¸ë¥¼ ëŠë‚„ìˆ˜ ìˆì—ˆìœ¼ë©´ ì¢‹ê² ë‹¤.ë˜ ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ë¥¼ í•˜ë‚˜ ì§„í–‰í•´ë³´ê³ ì í•œë‹¤. ì˜¬í•´ëŠ” ì´ë ‡ë‹¤í•  ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ê°€ ì—†ì—ˆëŠ”ë° ë‚´ë…„ì—ëŠ” ì„¤ë ¹ ë‚˜ë§Œ ì‚¬ìš©í• ì§€ë¼ë„ ì„¤ê³„ë¶€í„° ë°°í¬ê¹Œì§€ ëì„ ë³´ëŠ” í”„ë¡œì íŠ¸ í•˜ë‚˜ë¥¼ ë§Œë“¤ì–´ê°€ê³  ì‹¶ë‹¤.ê·¼ 10ë…„ ê°€ê¹Œì´ í•´ì˜¨ ë©”ì´í”Œê³¼ ê´€ë ¨ëœ ì‚¬ì´íŠ¸ë„ í•˜ë‚˜ ë§Œë“¤ì–´ ë´ì•¼ê² ë‹¤. ì‚¬ì‹¤ ì´ë¯¸ ì¡´ì¬í•œë‹¤. í”„ë¡ íŠ¸ë§Œ vercelì— ë°°í¬ì¤‘ì¸ë°, ë‚´ë…„ì—” ì„œë²„ì™€ ì—°ë™í•˜ì—¬ ì´ê²ƒì €ê²ƒ í•´ë´ì•¼ì§€.ì§€ê¸ˆê¹Œì§€ ê°œë°œì ìƒí™œì„ ëŒì•„ë³´ë©´ ì§€ë‚˜ì¹˜ê²Œ ìƒˆë¡œìš´ ë¬´ì–¸ê°€ì—ë§Œ ëª°ë‘í•œê²ƒ ê°™ë‹¤. ì‚¬ì‹¤ ê¸°ìˆ ì´ë€ê²Œ ì‹œê°„ì´ ì§€ë‚œë‹¤ê³  ì•ˆëŒì•„ ê°€ê±°ë‚˜ ë‚¡ì•„ì§€ëŠ”ê²ƒì´ ì•„ë‹Œë°â€¦ ëŒì´ì¼œë³´ë©´ ì™œì´ë ‡ê²Œ ì‹ ê¸°ìˆ ì—ë§Œ ì§‘ì°©í–ˆë‚˜ ì‹¶ë‹¤.ê·¸ë˜ì„œ ë‚´ë…„ì—” ì§€ê¸ˆ ê°€ì§€ê³  ìˆëŠ” ê¸°ìˆ ë“¤ì„ ì˜ ë‹¤ë“¬ê³ , ê¹Šê²Œ íŒŒë³´ê³ ì í•œë‹¤. 23ë…„ íšŒê³ ë¡ì„ ì‘ì„±í• ë•ŒëŠ” í•œë‹¨ê³„ ë” ì„±ì¥í•´ ìˆì—ˆìœ¼ë©´ ì¢‹ê² ë‹¤.ì‘ë…„ì— ë¹„í•´ ë…ì„œëŸ‰ì´ ì ˆëŒ€ì ìœ¼ë¡œ ì ì–´ì§„ê²ƒ ê°™ë‹¤. ë‚´ë…„ì—ëŠ” ì±…ì„ ë§ì´ë§ì´ ì½ë„ë¡ í•˜ì.ì´ê²ƒì €ê²ƒ..ì°¨ ìƒ€ë‹¤!ì°¨ ìƒ€ë‹¤. ë‹ˆë¡œ í•˜ì´ë¸Œë¦¬ë“œë¼ëŠ” ì°¨ë‹¤. 15ë…„ëœ ìŠ¤í¬í‹°ì§€ë¥¼ íƒ€ë‹¤ê°€ ì˜¨ê°– ê¸°ìˆ ë“¤ì´ ì ‘ëª©ëœ ì°¨ë¥¼ íƒ€ë‹ˆ ìš´ì „í•˜ê¸° ë„ˆë¬´ í¸í•œê²ƒ ê°™ë‹¤. íŠ¹íˆ ì˜¤í† í™€ë“œë‚˜ ì°¨ì„  ì´íƒˆë°©ì§€, ìŠ¤ë§ˆíŠ¸ í¬ë£¨ì¦ˆ ì»¨íŠ¸ë¡¤ ê°™ì€ ê¸°ëŠ¥ë“¤ì€ ì´ì œ ì—†ìœ¼ë©´ ìš´ì „ ëª»í• ê²ƒ ê°™ë‹¤.ë‚ ì´ ì¶¥ì§€ ì•Šì„ë•ŒëŠ” ì‹ ê²½ì¨ì„œ ì£¼í–‰í•˜ë©´ ì—°ë¹„ê°€ 25km ì´ìƒê¹Œì§€ë„ ë‚˜ì˜¤ê³¤ í–ˆì—ˆëŠ”ë° ë‚ ì´ ì¶”ì›Œì§€ë‹ˆ 20km ì°ê¸°ë„ í˜ë“ ê²ƒ ê°™ë‹¤. ê²¨ìš¸ì—ëŠ” ëŒ€ì¤‘êµí†µ íƒ€ì•¼ì§€.ê±´ê°•ì§€ë‚œ 3ë…„ê°„ ì°¸ ë§ì€ ì¼ë“¤ì´ ìˆì—ˆë‹¤. ê°‘ìê¸° ëŒë°œì„± ë‚œì²­ì´ ì˜¤ê³  (ì§€ê¸ˆë„ í•œìª½ì€ ì˜ ì•ˆë“¤ë¦°ë‹¤.) ê·¸ë¡œì¸í•´ ë¨¹ì€ ìŠ¤í…Œë¡œì´ë“œë¡œ ì¸í•´ ìŠ¤í…Œë¡œì´ë“œì„± ì—¬ë“œë¦„ì´ ì˜¨ëª¸ì„ ë’¤ë®ê³ ,ê·¸ë¡œì¸í•´ ë˜ ë¨¹ì€ ì•½ìœ¼ë¡œ ì¸í•´ ì•ˆêµ¬ ê±´ì¡°ì¦ì´ ì˜¤ê³ , ì•ˆêµ¬ ê±´ì¡°ì¦ì´ ì˜¨ ìƒíƒœì—ì„œ ëˆˆ ê´€ë¦¬ë¥¼ í•˜ì§€ ì•Šì•„ 26ë…„ ì¸ìƒ ì²˜ìŒìœ¼ë¡œ ì•ˆê²½ì„ ì“°ê²Œ ëì—ˆë‹¤. êµ°ëŒ€ì—ì„œë„ 2.0 1.5ë¥¼ ìœ ì§€í–ˆì—ˆë˜ ë‚˜ì˜€ëŠ”ë°â€¦ ì•ˆê²½ì„ ì¨ì•¼í•œë‹¤ëŠ” ë§ì„ ë“¤ì—ˆì„ë•Œ ì–¼ë§ˆë‚˜ ìƒì‹¬í–ˆëŠ”ì§€ ëª¨ë¥¸ë‹¤.ì–´ì¨Œë“  ì˜¬ 2022ë…„ì€ ìˆ ì„ ë§ì´ ë§ˆì‹ ê²ƒ ì¹˜ê³¤ ì§€ë‚œ 3ë…„ê³¼ ë‹¤ë¥´ê²Œ ì´ë ‡ë‹¤í•œ í° ì¼ ì—†ì´ ê±´ê°•í•˜ê²Œ ì§€ë‚¸ê²ƒ ê°™ë‹¤. 2023ë…„ì—ë„ ì œë°œ ê±´ê°•í–ˆìœ¼ë©´ ì¢‹ê² ë‹¤â€¦ì—¬í–‰ì—¬í–‰ê°€ê³  ì‹¶ë‹¤. ì‘ë…„ í•˜ë°˜ê¸°ë¶€í„° ì˜¬í•´ê¹Œì§€ ì—¬í–‰ì„ ë”± í•œë²ˆ ê°”ë‹¤ì™”ë‹¤. ê·¸ê²ƒë„ 1ë°• 2ì¼ë¡œ. í•œë‹¬ë§Œ ì•ˆì‹ íœ´ê°€ë¥¼ ë°›ì•˜ìœ¼ë©´ ì¢‹ê² ë‹¤. ì • ì•ˆë˜ë©´ 2~3ì¼ íœ´ê°€ì“°ê³  ì§§ê²Œ ë¶€ì‚°ìª½ì´ë¼ë„ ë‹¤ë…€ì™€ì•¼ê² ë‹¤. ì•„ ì¼ë‹¨ ê°™ì´ ê°ˆ ì‚¬ëŒë¶€í„° ë§Œë“œëŠ”ê²Œ ë¨¼ì €ì¸ê°€?ëìœ¼ë¡œâ€¦ì˜¬í•´ë„ ì—­ì‹œ ë§ì€ ì¼ë“¤ì´ ìˆì—ˆë‹¤. 22ë…„ ë„˜ì–´ì˜¬ë•ŒëŠ” ê·¸ëƒ¥ ì•„ë¬´ ìƒê°ì—†ì´ ë„˜ì–´ì˜¨ê²ƒ ê°™ì€ë°, 23ë…„ì„ ê¸°ë‹¤ë¦¬ëŠ” ì§€ê¸ˆì€ ì™ ì§€ ì„¤ë ˆì´ê³  ê¸°ëŒ€ëœë‹¤. ë­”ê°€ ì¸ìƒì— ìˆì–´ ì¤‘ìš”í•œ í•œ í•´ê°€ ë  ê²ƒ ê°™ì€ ê¸°ë¶„ì´ë‹¤.ì¢‹ì€ ì¼ë“¤ì´ ê°€ë“í•˜ê³ , ì›í•˜ëŠ” ë°”ë¥¼ ëª¨ë‘ ì´ë£°ìˆ˜ ìˆëŠ” í•œ í•´ê°€ ë˜ì—ˆìœ¼ë©´ ì¢‹ê² ë‹¤." }, { "title": "JPA 3.1", "url": "/posts/jpa3.1/", "categories": "JPA", "tags": "JPA", "date": "2022-12-26 10:12:00 +0900", "snippet": "JPA 3.1Spring 6.0, Spring Boot 3.0 ë²„ì „ì´ ë¦´ë¦¬ì¦ˆëœì§€ í•œë‹¬ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤. í˜„ì¬ ë‚ ì§œ (2022-12-26) ê¸°ì¤€ìœ¼ë¡œëŠ” Springì˜ ê²½ìš° 6.0.3, Spring Bootì˜ ê²½ìš° 3.0.1 ë²„ì „ê¹Œì§€ ì˜¬ë¼ì™”ë„¤ìš”.Spring Bootë¥¼ ì£¼ìš” ì„œë²„ í”„ë ˆì„ì›Œí¬ë¡œ ì‚¬ìš©í•˜ëŠ” ì €ë¡œì¨ëŠ” Spring Data JPAê°€ ê°€ì¥ ê¸°ëŒ€ë©ë‹ˆë‹¤. ê·¸ì¤‘ì—ì„œë„ ìµœì‹  JPA 3.1 ìŠ¤í™ì„ ì‚¬ìš©í•´ë³´ê¸°ë¥¼ ê¸°ëŒ€í•´ ë³´ê³  ìˆëŠ”ë°ìš”, ì•„ì§ê¹Œì§€ í•˜ì´ë²„ë„¤ì´íŠ¸ ë©”ì´ì € ë²„ì „ì—ì„œëŠ” JPA 3.0ì— ì˜ì¡´í•˜ê³  ìˆëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.ìœ„ ì´ë¯¸ì§€ëŠ” Hibernate 6.1.6 Final ë²„ì „ì´ ì˜ì¡´í•˜ê³  ìˆëŠ” ë””íœë˜ì‹œ ëª©ë¡ì…ë‹ˆë‹¤. JPA 3.0ì— ì˜ì¡´í•˜ê³  ìˆë„¤ìš”.ìœ„ ì´ë¯¸ì§€ëŠ” ìµœê·¼(2022-12-23)ì— ì¶œì‹œëœ Hibernate 6.2.0 CR ë²„ì „ì´ ì˜ì¡´í•˜ê³  ìˆëŠ” ë””íœë˜ì‹œ ëª©ë¡ì…ë‹ˆë‹¤. JPA 3.1ì— ì˜ì¡´í•˜ê³  ìˆì£ ? Spring Data JPA 3.0.0 ë²„ì „ì´ Hibernate 6.1.4 Final ë²„ì „ì„ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì— 2023ë…„ ì•ˆì—ëŠ” JPA 3.1 ìŠ¤í™ì˜ ê¸°ëŠ¥ë“¤ì„ Spring Bootì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì„ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.ê·¸ë˜ì„œ ì˜¤ëŠ˜ì€ ìƒˆë¡œìš´ Spring Data JPAë¥¼ ê¸°ë‹¤ë¦¬ë©° JPA 3.1ì˜ ìƒˆë¡œìš´ ê¸°ëŠ¥ë“¤, ë³€ê²½ì ì— ëŒ€í•´ ì•Œì•„ë³´ê³ ì í•©ë‹ˆë‹¤.JPA 3.0JPA 3.1 ì¶œì‹œ ì´ì „ì— JPA 3.0ì´ ë¨¼ì € ì¶œì‹œë˜ì—ˆê² ì£ ? í˜„ì¬ ì‹œì ì˜ ìµœì‹  Hibernate ëŠ” JPA 3.0 ìŠ¤í™ì„ ì™„ì „íˆ ì§€ì›í•©ë‹ˆë‹¤. Hibernate 6.0.x, 6.1.x ë²„ì „ì´ ì˜ì¡´í•˜ê³  ìˆëŠ” ì¢…ì†ì„±ì„ í™•ì¸í•´ë³´ë©´ jakarta.persistence-api:3.x ë¥¼ ì˜ì¡´í•˜ê³  ìˆëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.JPAê°€ 3.0 ë²„ì „ìœ¼ë¡œ ì˜¬ë¼ì˜¤ë©´ì„œ ê¸°ì¡´ JPA 2.2ê³¼ ë¹„êµí•´ ìƒˆë¡œìƒê¸´ ê¸°ëŠ¥ì€ ì—†ìŠµë‹ˆë‹¤. ë‹¨, ëª¨ë“  APIí´ë˜ìŠ¤, íŒ¨í‚¤ì§€, ì ë‘ì‚¬, ë° ëª¨ë“  XML ê¸°ë°˜ êµ¬ì„± íŒŒì¼ì˜ ìŠ¤í‚¤ë§ˆ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëŠ” ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ê°„ë‹¨íˆ ë§í•´ javax.persistence íŒ¨í‚¤ì§€ ë‚´ì— ì¡´ì¬í–ˆë˜ í´ë˜ìŠ¤ë“¤ì´ jakarta.persistence íŒ¨í‚¤ì§€ ë‚´ë¶€ë¡œ ë“¤ì–´ê°”ë‹¤ê³  ë³´ì‹œë©´ ë˜ëŠ”ë°ìš”,ê´€ë ¨í•´ì„œëŠ” ì´ ê¸€ ì„ ì½ì–´ë³´ì‹œë©´ ë„ì›€ì´ ë ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì™œ ìë°”EEê°€ ì´í´ë¦½ìŠ¤ ì¬ë‹¨ìœ¼ë¡œ ì´ê´€ë˜ê³  ìì¹´ë¥´íƒ€EE ë¼ëŠ” ëª…ì¹­ì„ ê°€ì§€ê²Œ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.JPA 3.1JPA 3.1ì€ Jakarta 10 ì˜ ì¼ë¶€ë¡œì„œ 2022ë…„ 3ì›” 30ì¼ì— ë¦´ë¦¬ì¦ˆ ë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ë¶€í„°ëŠ” ë³€ê²½ì ê³¼ ìƒˆë¡œìš´ ê¸°ëŠ¥ë“¤ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.ìƒˆë¡œ ì¶”ê°€ëœ ê¸°ëŠ¥ë“¤ì€ ì˜ˆì œë¥¼ í†µí•´ ì•Œì•„ë³´ê³ ì í•©ë‹ˆë‹¤. ì¼ë‹¨ ì˜ˆì œ í”„ë¡œì íŠ¸ë¶€í„° êµ¬ì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤.ì²«ë²ˆì§¸ë¡œ build.gradle íŒŒì¼ì…ë‹ˆë‹¤. hibernate-core 6.2.0 CR1 ë²„ì „ì„ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤. íŒŒë¼ë¯¸í„° ë¡œê¹…ì„ ìœ„í•´ log4j2ë¥¼ ì‚¬ìš©í•˜ë©° dbëŠ” h2ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.plugins { id 'java'}group 'com.keencho'version '1.0-SNAPSHOT'repositories { mavenCentral()}tasks.withType(JavaCompile) { options.encoding = 'UTF-8'}test { useJUnitPlatform()}dependencies { implementation 'org.hibernate.orm:hibernate-core:6.2.0.CR1' implementation 'com.h2database:h2:2.1.214' implementation group: 'org.apache.logging.log4j', name: 'log4j-core', version: '2.19.0' implementation 'org.projectlombok:lombok:1.18.24' annotationProcessor 'org.projectlombok:lombok:1.18.24' testImplementation 'org.junit.jupiter:junit-jupiter-api:5.9.1' testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.9.1'}log4j2.xml íŒŒì¼ì…ë‹ˆë‹¤. ë¡œê¹…ì„ ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.&lt;Configuration monitorInterval=\"60\"&gt; &lt;Properties&gt; &lt;Property name=\"log-path\"&gt;PropertiesConfiguration&lt;/Property&gt; &lt;/Properties&gt; &lt;Appenders&gt; &lt;Console name=\"Console-Appender\" target=\"SYSTEM_OUT\"&gt; &lt;PatternLayout&gt; &lt;pattern&gt; [%-5level] %d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %c{1} - %msg%n &lt;/pattern&gt;&gt; &lt;/PatternLayout&gt; &lt;/Console&gt; &lt;/Appenders&gt; &lt;Loggers&gt; &lt;Logger name=\"org.hibernate.SQL\" level=\"debug\" additivity=\"false\"&gt; &lt;AppenderRef ref=\"Console-Appender\"/&gt; &lt;/Logger&gt; &lt;Logger name=\"org.hibernate.orm.jdbc.bind\" level=\"trace\" additivity=\"false\"&gt; &lt;AppenderRef ref=\"Console-Appender\"/&gt; &lt;/Logger&gt; &lt;Logger name=\"org.hibernate.stat\" level=\"trace\" additivity=\"false\"&gt; &lt;AppenderRef ref=\"Console-Appender\"/&gt; &lt;/Logger&gt; &lt;Logger name=\"org.hibernate.SQL_SLOW\" level=\"trace\" additivity=\"false\"&gt; &lt;AppenderRef ref=\"Console-Appender\"/&gt; &lt;/Logger&gt; &lt;Logger name=\"org.hibernate.cache\" level=\"trace\" additivity=\"false\"&gt; &lt;AppenderRef ref=\"Console-Appender\"/&gt; &lt;/Logger&gt; &lt;Root level=\"info\"&gt; &lt;AppenderRef ref=\"Console-Appender\"/&gt; &lt;/Root&gt; &lt;/Loggers&gt;&lt;/Configuration&gt;ë‹¤ìŒì€ /src/main/resources/META-INF/persistence.xml ê²½ë¡œì— ì¡´ì¬í•´ì•¼ í•˜ëŠ” persistence.xml íŒŒì¼ì…ë‹ˆë‹¤.&lt;persistence xmlns=\"https://jakarta.ee/xml/ns/persistence\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"https://jakarta.ee/xml/ns/persistence https://jakarta.ee/xml/ns/persistence/persistence_3_1.xsd\" version=\"3.1\"&gt; &lt;persistence-unit name=\"pu\" transaction-type=\"RESOURCE_LOCAL\"&gt; &lt;description&gt;JPA3.1 Test with hibernate6 persistence-unit&lt;/description&gt; &lt;provider&gt;org.hibernate.jpa.HibernatePersistenceProvider&lt;/provider&gt; &lt;class&gt;com.keencho.jpa31.model.Book&lt;/class&gt; &lt;properties&gt; &lt;property name=\"hibernate.archive.autodetection\" value=\"class, hbm\"/&gt; &lt;property name=\"hibernate.dialect\" value=\"org.hibernate.dialect.H2Dialect\"/&gt; &lt;property name=\"hibernate.connection.driver_class\" value=\"org.h2.Driver\"/&gt; &lt;property name=\"hibernate.connection.url\" value=\"jdbc:h2:mem:db1;DB_CLOSE_DELAY=-1\"/&gt; &lt;property name=\"hibernate.connection.username\" value=\"sa\"/&gt; &lt;property name=\"hibernate.connection.pool_size\" value=\"5\"/&gt; &lt;property name=\"hibernate.format_sql\" value=\"true\"/&gt; &lt;property name=\"hibernate.hbm2ddl.auto\" value=\"create-drop\"/&gt; &lt;property name=\"hibernate.max_fetch_depth\" value=\"5\"/&gt; &lt;property name=\"hibernate.jdbc.batch_versioned_data\" value=\"true\"/&gt; &lt;property name=\"jakarta.persistence.validation.mode\" value=\"NONE\"/&gt; &lt;property name=\"hibernate.service.allow_crawling\" value=\"false\"/&gt; &lt;property name=\"hibernate.session.events.log\" value=\"true\"/&gt; &lt;/properties&gt; &lt;/persistence-unit&gt;&lt;/persistence&gt;Book ì—”í‹°í‹° ì…ë‹ˆë‹¤. ì´ ì—”í‹°í‹°ë¡œ ìƒˆë¡œìš´ ê¸°ëŠ¥ë“¤ì„ í™•ì¸í•´ ë³¼ ê²ƒì…ë‹ˆë‹¤.@Data@NoArgsConstructor@Entitypublic class Book { @Id @GeneratedValue(strategy = GenerationType.AUTO) private UUID id; private String title; private int pages; // íŒë§¤ìœ¨ (ì†Œìˆ˜ì ) private BigDecimal sellingRates; // ë¶„ë¥˜ê¸°í˜¸ (ì†Œìˆ˜ì ) private BigDecimal classificationSymbol; // ë°œë§¤ì¼ private LocalDateTime releaseDateTime;}ë‹¤ìŒì€ í…ŒìŠ¤íŠ¸ë¥¼ ë„ì™€ì¤„ ì„¤ì • í´ë˜ìŠ¤ ì…ë‹ˆë‹¤.public class HibernateHelper { public static final HibernateHelper instance = new HibernateHelper(); @Getter private final EntityManagerFactory entityManagerFactory; @Getter private final EntityManager entityManager; private HibernateHelper() { this.entityManagerFactory = Persistence.createEntityManagerFactory(\"pu\"); this.entityManager = entityManagerFactory.createEntityManager(); } public static void beginTransaction() { instance.getEntityManager().getTransaction().begin(); } public static void commit() { instance.getEntityManager().getTransaction().commit(); } public static void close() { instance.getEntityManagerFactory().close(); } public static void persist(Object entity) { instance.getEntityManager().persist(entity); } //////////////////////////////////////////////////////////////////// /////////////////////////////////// SELECT //////////////////////////////////////////////////////////////////// @FunctionalInterface public interface SelectHelper { Selection&lt;?&gt; apply(CriteriaBuilder cb, Root&lt;?&gt; root); } private static CriteriaBuilder getCriteriaBuilder() { // https://hibernate.zulipchat.com/#narrow/stream/132096-hibernate-user/topic/New.20functions.20in.20JPA.203.2E1/near/289429903 // hibernate 6.1.x final ë²„ì „ê¹Œì§€ jpa3.0ì— ì˜ì¡´í•˜ê³  ìˆê¸° ë•Œë¬¸ì— HibernateCriteriaBuilder ë¡œ í˜•ë³€í™˜ í•´ì•¼í•œë‹¤. // ì•„ì§ finalì€ ì•„ë‹ˆì§€ë§Œ hibernate 6.2.x CR ë²„ì „ì—ì„œëŠ” jpa 3.1ì— ì˜ì¡´í•˜ê³  ìˆìœ¼ë©° ê·¸ëƒ¥ ì´ ì½”ë“œë¡œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤. (í˜•ë³€í™˜ì´ í•„ìš” ì—†ë‹¤.) return instance.getEntityManager().getCriteriaBuilder(); } public static &lt;T&gt; List&lt;T&gt; listAll(Class&lt;T&gt; rootClass) { return list(rootClass).stream().map(i -&gt; (T) i.get(0)).collect(Collectors.toList()); } public static List&lt;Tuple&gt; list(Class&lt;?&gt; rootClass, SelectHelper... selectHelper) { var cb = getCriteriaBuilder(); var query = cb.createTupleQuery(); var root = query.from(rootClass); var list = new ArrayList&lt;Selection&lt;?&gt;&gt;(); for (SelectHelper helper : selectHelper) { list.add(helper.apply(cb, root)); } if (!list.isEmpty()) { query.multiselect(list); } return instance.getEntityManager().createQuery(query).getResultList(); } public static List&lt;?&gt; list(String query) { return instance.getEntityManager().createQuery(query).getResultList(); }}Hibernate 6.1.x ì´í•˜ ë²„ì „ì„ ì‚¬ìš©í•˜ì‹ ë‹¤ë©´ ì¤‘ê°„ì˜ getCriteriaBuilder() ë©”ì†Œë“œëŠ” HibernateCriteriaBuilderë¥¼ ë¦¬í„´í•´ì•¼ í•©ë‹ˆë‹¤. Hibernate 6.1.x ì´í•˜ ë²„ì „ì€ JPA 3.0ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì¸ ê²ƒìœ¼ë¡œ ë³´ì´ë©° ì´ ê¸€ì„ ê·¸ëŒ€ë¡œ ë”°ë¼í•˜ì…¨ê±°ë‚˜ Hibernate 6.2.x ì´ìƒ ë²„ì „ì„ ì‚¬ìš©í•œë‹¤ë©´ ì´ëŠ” JPA 3.1ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì˜ˆì œ ê·¸ëŒ€ë¡œ CriteriaBuilderë¥¼ ë¦¬í„´í•˜ê²Œ ë‘ì‹œë©´ ë©ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ì´ ìŠ¤ë ˆë“œë¥¼ í™•ì¸í•´ ë³´ì„¸ìš”.ë§ˆì§€ë§‰ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ ì…ë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ ì „ì— íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³  2ê°œì˜ ì—”í‹°í‹°ë¥¼ ì˜ì†í™” í•©ë‹ˆë‹¤. ì•„ë˜ì—ì„œ ì‘ì„±í•  ëª¨ë“  ì˜ˆì œ í…ŒìŠ¤íŠ¸ë“¤ì€ ì´ í´ë˜ìŠ¤ ë‚´ë¶€ì— ìœ„ì¹˜í•˜ê²Œ ë©ë‹ˆë‹¤.public class JPA31Test { @BeforeAll public static void init() { // disable hibernate info log Logger logger = Logger.getLogger(\"org.hibernate\"); logger.setLevel(Level.OFF); HibernateHelper.beginTransaction(); var book1 = new Book(); book1.setTitle(\"Effective Java\"); book1.setPages(342); book1.setSellingRates(new BigDecimal(\"48.54\")); book1.setClassificationSymbol(new BigDecimal(\"170.537\")); book1.setReleaseDateTime(LocalDateTime.of(2020, 3, 13, 17, 20, 30)); var book2 = new Book(); book2.setTitle(\"Modern Java in Action\"); book2.setPages(573); book2.setSellingRates(new BigDecimal(\"51.46\")); book2.setClassificationSymbol(new BigDecimal(\"2096.331\")); book2.setReleaseDateTime(LocalDateTime.of(2022, 8, 13, 10, 43, 0)); HibernateHelper.persist(book1); HibernateHelper.persist(book2); HibernateHelper.commit(); } @AfterAll public static void close() { HibernateHelper.close(); }}1. EntityManagerFactory, EntityManager ì¸í„°í˜ì´ìŠ¤ê°€ java.lang.AutoCloseable ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†í•©ë‹ˆë‹¤. (ë³€ê²½)ìˆœì„œëŒ€ë¡œ JPA 3.0ì˜ EntityManagerFactory, JPA 3.1ì˜ EntityManagerFactory ì¸í„°í˜ì´ìŠ¤ ì…ë‹ˆë‹¤. ì´ì œ SessionFactoryì™€ ê´€ë ¨ëœ ìì›ë“¤ì„ ìë™ìœ¼ë¡œ ì¢…ë£Œí•˜ê²Œ ë©ë‹ˆë‹¤.2. ClassTransformer.transform ë©”ì†Œë“œê°€ Persistence API ìŠ¤í™ì˜ ì˜ˆì™¸ë¥¼ ë˜ì§‘ë‹ˆë‹¤. (ë³€ê²½)ê¸°ì¡´ transform ë©”ì†Œë“œëŠ” IllegalClassFormatExceptionë¥¼ ë˜ì¡Œì—ˆëŠ”ë° ì´ì œëŠ” TransformerExceptionë¥¼ ë˜ì§€ê²Œ ë©ë‹ˆë‹¤.3. java.util.UUIDì™€ GenerationType.UUID ì§€ì› (ì¶”ê°€)@GeneratedValue ì–´ë…¸í…Œì´ì…˜ì˜ ìƒì„±ì „ëµì„ AUTO ë¡œ ì €ì¥í•˜ê±°ë‚˜ ìƒˆë¡­ê²Œ ì¶”ê°€ëœ UUIDë¡œ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ë² ì´ì§ íƒ€ì…ì„ UUIDë¡œ ë§ì¶”ê³  ìƒì„± ì „ëµì„ AUTOë¡œ í•˜ì˜€ë‹¤ë©´ ìë™ìœ¼ë¡œ UUIDì „ëµì„ ë”°ë¥´ê²Œ ë©ë‹ˆë‹¤.ë‹¤ìŒì€ ì˜ˆì œì…ë‹ˆë‹¤. ì˜ì†í™”ëœ ì—”í‹°í‹°ì˜ idê°€ uuidí˜•íƒœê°€ ë§ëŠ”ì§€ ì •ê·œ í‘œí˜„ì‹ìœ¼ë¡œ í™•ì¸í•©ë‹ˆë‹¤.static final String UUID_PATTERN = \"[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}\";@Test@DisplayName(\"GenerationType.UUID test\")void testUUID() { var resultList = HibernateHelper.listAll(Book.class); resultList.forEach(book -&gt; { var id = book.getId().toString(); System.out.println(\"uuid: \" + id); Assertions.assertTrue(Pattern.matches(UUID_PATTERN, id)); });}uuid: 9a612d02-1905-497a-9d9b-719918eec58fuuid: 39824f2f-ac89-4357-9a3d-8b67d24a6fe14. Numeric í•¨ìˆ˜ ì¶”ê°€ (ì¶”ê°€)CEILING, EXP, FLOOR, LN, POWER, ROUND, SIGN í•¨ìˆ˜ê°€ JPQLì— ì¶”ê°€ë˜ì—ˆìœ¼ë©° ceiling(), exp(), floor(), ln(), power(), round(), sign() í•¨ìˆ˜ê°€ Criteria APIì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.@Test@DisplayName(\"new numeric functions test\")void testNewNumericFunctions() { var listAll = HibernateHelper.listAll(Book.class); var resultList = HibernateHelper.list( Book.class, // ìˆ˜ ì˜¬ë¦¼ (cb, root) -&gt; cb.ceiling(root.get(\"sellingRates\")), // ìˆ˜ ë‚´ë¦¼ (cb, root) -&gt; cb.floor(root.get(\"sellingRates\")), // në²ˆì§¸ ìë¦¬ ë°˜ì˜¬ë¦¼ (cb, root) -&gt; cb.round(root.get(\"sellingRates\"), 1), // xë¥¼ ì¸ìˆ˜ë¡œ í•˜ëŠ” e^x ê°’ì„ ë°˜í™˜ (cb, root) -&gt; cb.exp(root.get(\"sellingRates\")), // ìì—° ë¡œê·¸ë¥¼ ë°˜í™˜ (cb, root) -&gt; cb.ln(root.get(\"sellingRates\")), // në§Œí¼ ê±°ë“­ì œê³±í•˜ì—¬ ë°˜í™˜ (cb, root) -&gt; cb.power(root.get(\"sellingRates\"), 2), // ì¸ìˆ˜ì˜ ë¶€í˜¸ë¥¼ ë°˜í™˜ (-1, 0, 1) (cb, root) -&gt; cb.sign(root.get(\"sellingRates\")) ); System.out.println(\"\\n\\n\"); for (var i = 0; i &lt; listAll.size(); i ++) { System.out.println(\"==========================\"); System.out.printf(\"ì›ë˜ ê°’: %s%n\", listAll.get(i).getSellingRates().toString()); System.out.printf(\"ceiling í•¨ìˆ˜: %s%n\", resultList.get(i).get(0)); System.out.printf(\"floor í•¨ìˆ˜: %s%n\", resultList.get(i).get(1)); System.out.printf(\"round í•¨ìˆ˜: %s%n\", resultList.get(i).get(2)); System.out.printf(\"exp í•¨ìˆ˜: %s%n\", resultList.get(i).get(3)); System.out.printf(\"ln í•¨ìˆ˜: %s%n\", resultList.get(i).get(4)); System.out.printf(\"power í•¨ìˆ˜: %s%n\", resultList.get(i).get(5)); System.out.printf(\"sign í•¨ìˆ˜: %s%n\", resultList.get(i).get(6)); } System.out.println(\"\\n\\n\");}==========================ì›ë˜ ê°’: 48.54ceiling í•¨ìˆ˜: 49floor í•¨ìˆ˜: 48round í•¨ìˆ˜: 48.50exp í•¨ìˆ˜: 1.2040766975298458E21ln í•¨ìˆ˜: 3.8823882002984553power í•¨ìˆ˜: 2356.1315999999997sign í•¨ìˆ˜: 1==========================ì›ë˜ ê°’: 51.46ceiling í•¨ìˆ˜: 52floor í•¨ìˆ˜: 51round í•¨ìˆ˜: 51.50exp í•¨ìˆ˜: 2.232513217248359E22ln í•¨ìˆ˜: 3.940804806853598power í•¨ìˆ˜: 2648.1316sign í•¨ìˆ˜: 15. Date Time ê´€ë ¨ í•¨ìˆ˜ ì¶”ê°€ (ì¶”ê°€)LOCAL DATE, LOCAL DATETIME, LOCAL TIME í•¨ìˆ˜ê°€ JPQLì— ì¶”ê°€ë˜ì—ˆìœ¼ë©° localDate(), localDateTime(), localTime()í•¨ìˆ˜ê°€ Criteria APIì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.ì´ í•¨ìˆ˜ë“¤ì€ ë‚ ì§œë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ê°€ ì•„ë‹Œ í˜„ì¬ ì‹œê°„ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ë“¤ ì…ë‹ˆë‹¤.@Test@DisplayName(\"new DateTime functions test\")void testNewDateTimeFunctions() { var now = LocalDateTime.now(); var firstResult = HibernateHelper.list( Book.class, // í˜„ì¬ ì‹œê°„ (cb, root) -&gt; cb.localTime(), // í˜„ì¬ ë‚ ì§œ (cb, root) -&gt; cb.localDate(), // í˜„ì¬ ë‚ ì§œ + í˜„ì¬ ì‹œê°„ (cb, root) -&gt; cb.localDateTime() ).get(0); System.out.println(\"\\n\\n\"); System.out.println(\"í˜„ì¬ì‹œê°„: \" + now.format(DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\"))); System.out.println(\"ì‹œê°„: \" + firstResult.get(0)); System.out.println(\"ë‚ ì§œ: \" + firstResult.get(1)); System.out.println(\"ë‚ ì§œ + ì‹œê°„: \" + firstResult.get(2)); System.out.println(\"\\n\\n\");}í˜„ì¬ì‹œê°„: 2022-12-26 16:23:16ì‹œê°„: 16:23:16ë‚ ì§œ: 2022-12-26ë‚ ì§œ + ì‹œê°„: 2022-12-26T16:23:16.3235096. EXTRACT í•¨ìˆ˜ ì¶”ê°€ (ì¶”ê°€)EXTRACT í•¨ìˆ˜ê°€ JPQLì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. ì•ˆíƒ€ê¹ê²Œë„ Criteria APIì—ëŠ” ì´ì— ëŒ€ì‘í•˜ëŠ” í•¨ìˆ˜ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤. PRì— ê²Œë¹ˆ í‚¹ì´ ìš”ì²­í•œ í”ì ì´ ìˆê¸´ í•©ë‹ˆë‹¤ë§Œ JPA 3.1ì—ëŠ” ì¶”ê°€ë˜ì§€ ì•Šì€ë“¯ í•©ë‹ˆë‹¤.@Test@DisplayName(\"new extract functions test\")void textExtractFunctions() { // https://github.com/jakartaee/persistence/pull/356 // criteria apiì—ëŠ” extract í•¨ìˆ˜ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ í‘í‘ var query = \"\"\" SELECT b.releaseDateTime as releaseDateTime, EXTRACT(YEAR from b.releaseDateTime) as year, EXTRACT(MONTH from b.releaseDateTime) as month, EXTRACT(DAY from b.releaseDateTime) as day, EXTRACT(HOUR from b.releaseDateTime) as hour, EXTRACT(MINUTE from b.releaseDateTime) as minute, EXTRACT(SECOND from b.releaseDateTime) as second FROM Book b \"\"\"; System.out.println(\"\\n\\n\"); var list = HibernateHelper.list(query); for (var i = 0; i &lt; list.size(); i ++) { var result = (Object[]) list.get(i); System.out.println(\"==========================\"); System.out.println(\"ì˜¤ë¦¬ì§€ë„ ê°’ (ë°œë§¤ì¼): \" + result[0]); System.out.println(\"ë…„ë„: \" + result[1]); System.out.println(\"ë‹¬: \" + result[2]); System.out.println(\"ë‚ ì§œ: \" + result[3]); System.out.println(\"ì‹œ: \" + result[4]); System.out.println(\"ë¶„: \" + result[5]); System.out.println(\"ì´ˆ: \" + result[6]); } System.out.println(\"\\n\\n\");}==========================ì˜¤ë¦¬ì§€ë„ ê°’ (ë°œë§¤ì¼): 2020-03-13T17:20:30ë…„ë„: 2020ë‹¬: 3ë‚ ì§œ: 13ì‹œ: 17ë¶„: 20ì´ˆ: 30.0==========================ì˜¤ë¦¬ì§€ë„ ê°’ (ë°œë§¤ì¼): 2022-08-13T10:43ë…„ë„: 2022ë‹¬: 8ë‚ ì§œ: 13ì‹œ: 10ë¶„: 43ì´ˆ: 0.07. Criteria CASE í‘œí˜„ì‹ì—ì„œ Expressionsë¥¼ ì¡°ê±´ì‹ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì§€ì› (ì¶”ê°€)SimpleCase&lt;C, R&gt; when(Expression&lt;? extends C&gt; condition, R result) ë©”ì†Œë“œì™€ SimpleCase&lt;C, R&gt; when(Expression&lt;? extends C&gt; condition, Expression&lt;? extends R&gt; result) ë©”ì†Œë“œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.@Test@DisplayName(\"new criteria simple case expressions\")void testCriteriaCaseExpressions() { var list = HibernateHelper.list( Book.class, (cb, root) -&gt; root.get(\"title\"), (cb, root) -&gt; cb.selectCase(root.get(\"title\")) .when(cb.literal(\"Effective Java\"), cb.literal(true)) .otherwise(false) ); System.out.println(\"\\n\\n\"); list.forEach(item -&gt; System.out.println(\"title: \" + item.get(0) + \" / title is 'Effective Java'?: \" + item.get(1))); System.out.println(\"\\n\\n\");}ì°¸ê³ ë¡œ í˜„ì¬ ì˜ì†í™”ëœ book ì—”í‹°í‹°ëŠ” 2ê°œì´ë©° ê°ê° Effective Java, Modern Java in Action ì´ë¼ëŠ” ì œëª©ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.select b1_0.title, case b1_0.title when 'Effective Java' then true else cast(? as boolean) end from Book b1_0[TRACE] 2022-12-27 08:17:10.015 [main] bind - binding parameter [1] as [BOOLEAN] - [false]title: Effective Java / title is 'Effective Java'?: truetitle: Modern Java in Action / title is 'Effective Java'?: falseìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ëŒë ¤ë³´ë©´ ê²°ê³¼ëŠ” ìœ„ì™€ê°™ì´ ë‚˜ì˜¤ëŠ”ë°ìš”, sqlë¬¸ì„ ë³´ì‹œë©´ ìƒìˆ˜í‘œí˜„ì‹(literal)ìœ¼ë¡œ ì‘ì„±í•œ ì²«ë²ˆì§¸ when êµ¬ë¬¸ì€ íŒŒë¼ë¯¸í„°ê°€ ë‚˜ì¤‘ì— ë°”ì¸ë”© ë˜ëŠ”ê²ƒì´ ì•„ë‹ˆê³  ë°”ë¡œ ë°”ì¸ë”© ë˜ê²Œ ë©ë‹ˆë‹¤. ì´ë ‡ê²Œ ë˜ë©´ ë‚´ë¶€ì ìœ¼ë¡œ Prepared Statementsë¡œì¨ ë™ì‘í•˜ì§€ëŠ” ì•Šê² ìŠµë‹ˆë‹¤ë§Œ sqlêµ¬ë¬¸ì„ Prepared Statementsë¡œ í’€ì–´ë‚¼ìˆ˜ ì—†ëŠ” ìƒí™©ì€ ë¶„ëª…íˆ ì¡´ì¬í•˜ë¯€ë¡œ í•„ìš”í•œ ê¸°ëŠ¥ì´ë¼ê³  ìƒê°ë©ë‹ˆë‹¤.8. ê¸°íƒ€ (ìˆ˜ì •)ê¸°íƒ€ ìˆ˜ì •ëœ ì‚¬í•­ë“¤ë„ ìˆìŠµë‹ˆë‹¤. ì´ë“¤ì€ ì–´ë–¤ ê¸°ëŠ¥ì„ ì¶”ê°€ / ìˆ˜ì •í•œ ê²ƒì´ ì•„ë‹ˆë¼ ì–´ë–¤ ì£¼ì œë¥¼ ëª…í™•íˆ, ë”°ì§€ìë©´ ë¬¸ì„œ ìˆ˜ì •ì‘ì—… ì •ë„ë¡œ ë³´ì‹œë©´ ë ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë³€ê²½ì  ì›ë¬¸ ê·¸ëŒ€ë¡œì™€ Github PR ë§í¬ë¥¼ ê±¸ì–´ë“œë¦¬ë‹ˆ í•œë²ˆ ì½ì–´ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤. Adds missing definition of single_valued_embeddable_object_field in Jakarta Persistence QL BNF Clarifies mixing types of query input parameters Clarifies definition of the Basic type Clarifies the order of parameters in the LOCATE function Clarifies SqlResultSetMapping with multiple EntityResults and conflicting aliasesë§ˆì¹˜ë©°JPA 3.1ì— ëŒ€í•´ ê°„ëµíˆ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. JPA 3.1ì— ì˜ì¡´í•˜ëŠ” Hibernate Final ë²„ì „ê³¼ ì´ Hibernate Final ë²„ì „ì— ì˜ì¡´í•˜ëŠ” Spring Data JPAê°€ ì–¼ë¥¸ ë‚˜ì˜¤ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. Spring íŒ€ì´ ì–´ë–»ê²Œ ì´ë¥¼ ì‘ìš©í•´ ìƒˆë¡œìš´ ê¸°ëŠ¥ë“¤ì„ ë§Œë“¤ì–´ë‚¼ì§€ ê¶ê¸ˆí•˜ë„¤ìš”." }, { "title": "Dirty Checking", "url": "/posts/dirty-checking/", "categories": "Hibernate", "tags": "JPA, Hibernate", "date": "2022-10-16 07:12:00 +0900", "snippet": "Dirty Checking1. ê°œìš”í•˜ì´ë²„ë„¤ì´íŠ¸ / jpaë¥¼ ì‚¬ìš©í•˜ë‹¤ë³´ë©´ ì´ë¯¸ ì €ì¥ëœ ì—”í‹°í‹°ì˜ ê²½ìš° jpa repositoryì˜ save() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šì•„ë„ í•œ íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ë©´ ì—”í‹°í‹°ì˜ ë³€ê²½ì ì´ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ëŠ” í˜„ìƒì„ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.var delivery = deliveryRepository.findById(1L).orElseThrow(() -&gt; new RuntimeException(\"delivery entity not exist!\"));delivery.setDtDeliveryStartedAt(LocalDateTime.now());ìœ„ì™€ê°™ì´ save ë©”ì†Œë“œ ì—†ì´ ì½”ë“œë¥¼ ì‘ì„±í•´ë„ íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ë©´ dtDeliveryStartedAt ì»¬ëŸ¼ì´ ì—…ë°ì´íŠ¸ë˜ê²Œ ë©ë‹ˆë‹¤.ìœ„ ë™ì‘ì„ Dirty Checking ì´ë¼ í•˜ëŠ”ë°ìš”, Dirty Checkingì˜ ë™ì‘ ë©”ì»¤ë‹ˆì¦˜ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ì˜ì†ì„  ì»¨í…ìŠ¤íŠ¸ëŠ” í”ŒëŸ¬ì‹œê°€ ì¼ì–´ë‚  ê²½ìš° ì—”í‹°í‹°ì˜ ë³€ê²½ì ë“¤ì„ ëŒ€ê¸°ì—´ì— ë„£ìŠµë‹ˆë‹¤.í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” ê´€ë¦¬ë˜ëŠ” ì—”í‹°í‹°ë“¤ì˜ ëª¨ë“  ë³€ê²½ì„ ìë™ìœ¼ë¡œ ê°ì§€í•˜ê³  ê°œë°œìë“¤ì„ ëŒ€ì‹ í•˜ì—¬ SQL Updateë¬¸ì„ ê³„íší•˜ê³  ìˆ˜í–‰í•©ë‹ˆë‹¤.í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ì—”í‹°í‹°ì˜ ì†ì„± / ë³€ê²½ì ì„ í™•ì¸í•©ë‹ˆë‹¤. ì—”í‹°í‹°ê°€ ë¡œë”©ë  ë•Œë§ˆë‹¤ í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” ëª¨ë“  ì—”í‹°í‹° ì†ì„±ê°’ì„ ê°€ì§€ê³  ìˆëŠ” ìŠ¤ëƒ…ìƒ·(ë³µì‚¬ë³¸)ì„ ìƒì„±í•©ë‹ˆë‹¤. ê·¸ í›„ í”ŒëŸ¬ì‹œê°€ ì¼ì–´ë‚˜ëŠ” ì‹œì ì— ì—”í‹°í‹°ì™€ ìŠ¤ëƒ…ìƒ·ì„ ë¹„êµí•˜ì—¬ ë³€ê²½ëœ ë¶€ë¶„ì„ ì²´í¬í•˜ê³  ì—…ë°ì´íŠ¸ í•©ë‹ˆë‹¤.ë‹¨ìˆœíˆ ë¶ˆëŸ¬ì™€ì„œ ê°’ì„ ë³€ê²½í–ˆë‹¤í•˜ì—¬ ëª¨ë‘ ì—…ë°ì´íŠ¸ë˜ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. Dirty Checkingì´ ì¼ì–´ë‚˜ë ¤ë©´ ì•„ë˜ ì¡°ê±´ì„ ì¶©ì¡±í•´ì•¼ í•©ë‹ˆë‹¤. ì—”í‹°í‹°ê°€ ì˜ì†ìƒíƒœì¸ ê²½ìš° Transaction ì•ˆì—ì„œ ì—”í‹°í‹°ì˜ ê°’ì„ ë³€ê²½í•˜ëŠ” ê²½ìš° ì´ë¯¸ ì €ì¥ëœ ì—”í‹°í‹°ì¸ ê²½ìš°ìŠ¤í”„ë§ì„ ì‚¬ìš©í•œë‹¤ë©´ @Transactional ì–´ë…¸í…Œì´ì…˜ì„ ì„œë¹„ìŠ¤ ë ˆì´ì–´ì—ì„œ ì‚¬ìš©í•˜ë©´ ìœ„ ì¡°ê±´ì€ ë§Œì¡±í•˜ê²Œ ë©ë‹ˆë‹¤.2. íŠ¹ì • ì»¬ëŸ¼ë§Œ ì—…ë°ì´íŠ¸í•˜ê¸°JPAì—ì„œëŠ” ëª¨ë“  í•„ë“œë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ë°©ì‹ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì¥ì ì„ ê°–ê³  ìˆìŠµë‹ˆë‹¤. ìƒì„±ë˜ëŠ” ì¿¼ë¦¬ê°€ ëª¨ë‘ ê°™ì•„ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë˜ëŠ” ì‹œì ì— ë§Œë“¤ì–´ì„œ ì¬ì‚¬ìš© ê°€ëŠ¥ ì—…ë°ì´íŠ¸ë˜ëŠ” ì»¬ëŸ¼ìˆ˜ê°€ ë™ì¼í•˜ê¸° ë•Œë¬¸ì— ìºì‹±ëœ SQL êµ¬ë¬¸ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , ë°ì´í„°ë² ì´ìŠ¤ ì…ì¥ì—ì„œ ì—…ë°ì´íŠ¸ ì»¬ëŸ¼ì´ ì‘ë‹¤ë©´ íŠ¹ì • ì»¬ëŸ¼ë§Œ ì—…ë°ì´íŠ¸í•˜ëŠ” êµ¬ë¬¸ì— ë¹„í•´ ì„±ëŠ¥ìƒ ì´ì ì„ ê°€ì ¸ê°ˆ ìˆ˜ ìˆìŒíŠ¹ì • ì»¬ëŸ¼ë§Œ ì—…ë°ì´íŠ¸í•˜ëŠ” ë°©ë²•ë“¤ì„ ëª‡ê°€ì§€ ì†Œê°œí•˜ê¸´ í• í…Œì§€ë§Œ, íŠ¹ì • ìƒí™©ì´ ì•„ë‹Œ ê²½ìš° ì˜¤íˆë ¤ ì´ëŸ¬í•œ ë°©ë²•ë“¤ì€ ì „ì²´ ì»¬ëŸ¼ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ë°©ë²•ë³´ë‹¤ ì˜¤íˆë ¤ ë§ì€ ìì›ì„ ì†Œëª¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì»¬ëŸ¼ì´ 30ê°œì •ë„ ëœë‹¤ë©´ íŠ¹ì • ì»¬ëŸ¼ë§Œ ì—…ë°ì´íŠ¸ í•˜ëŠ” ê²ƒì´ ë„ì›€ì´ ë í…Œì§€ë§Œ ì• ì´ˆì— ì»¬ëŸ¼ì´ 30ê°œë¼ë©´ ì •ê·œí™”ê°€ ì˜ëª»ë˜ì–´ ìˆë‹¤ëŠ” ì˜ë¯¸ê² ì£ ? í•­ìƒ ìƒê°í•˜ëŠ” ê²ƒì´ì§€ë§Œ ì—­ì‹œ ì œì¼ ì¤‘ìš”í•œ ê²ƒì€ db ì„¤ê³„ ê°™ìŠµë‹ˆë‹¤.1. @DynamicUpdate ì‚¬ìš©ì²«ë²ˆì§¸ ë°©ë²•ì€ ì—”í‹°í‹°ì— @DynamicUpdate ì–´ë…¸í…Œì´ì…˜ì„ ì„ ì–¸í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.@Entity@Data@NoArgsConstructor@Table(name = \"delivery\")@DynamicUpdatepublic class Delivery { ...}ìœ„ì™€ê°™ì´ ì–´ë…¸í…Œì´ì…˜ì„ ì„ ì–¸í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ë³€ê²½ í•„ë“œë§Œ ë°˜ì˜ë˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.2. @Query ì‚¬ìš©ë‘ë²ˆì§¸ ë°©ë²•ì€ @Queryì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ update êµ¬ë¬¸ì„ ì‘ì„±í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.@Modifying@Query(\"UPDATE Delivery d set d.dtDeliveryStartedAt = :date where d.deliveryId = :id\")void updateDtDeliveryStartedAtById(@Param(\"date\") LocalDateTime date, @Param(\"id\") Long id);ì´ë ‡ë“¯ ì§ì ‘ update ë¬¸ì„ ì‘ì„±í•˜ì—¬ íŠ¹ì • ì»¬ëŸ¼ë§Œ ì—…ë°ì´íŠ¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. selectê°€ ì•„ë‹Œ DML ì´ê¸° ë•Œë¬¸ì— @Modifying ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì•¼ í•¨ì„ ìŠì§€ ë§ˆì„¸ìš”.3. QueryDSL JPAUpdateClause ì‚¬ìš©ì„¸ë²ˆì§¸ ì œê°€ ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ QueryDSLì˜ JPAUpdateClause í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.@Testpublic void test() { EntityManager em = emf.createEntityManager(); QDelivery q = QDelivery.delivery; JPAUpdateClause jpaUpdateClause = new JPAUpdateClause(em, q); Map&lt;Path&lt;?&gt;, Object&gt; map = new HashMap&lt;&gt;(); map.put(q.dtDeliveryStartedAt, LocalDateTime.now()); List&lt;Path&lt;?&gt;&gt; paths = new ArrayList&lt;&gt;(); List&lt;Object&gt; values = new ArrayList&lt;&gt;(); for (var entry : map.entrySet()) { paths.add(entry.getKey()); values.add(entry.getValue()); } long result = jpaUpdateClause.where(q.deliveryId.eq(1L)).set(paths, values).execute(); Assert.isTrue(result == 1, \"update result is not 1\");}ìœ„ì™€ê°™ì´ JPAUpdateClause ë¥¼ ì‚¬ìš©í•˜ë©´ @Query ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì— ë¹„í•´ ì¡°ê¸ˆë” type-safeí•˜ê²Œ update ë¬¸ì„ ìë°” ì½”ë“œë¡œ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ„ ì½”ë“œëŠ” ë§ì€ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œë¥¼ ë§Œë“¤ìˆ˜ ìˆëŠ”ë°ìš”, ì œ ê²½ìš° ë³„ë„ì˜ repositoryë¥¼ ë§Œë“¤ì–´ì„œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³¤ í•©ë‹ˆë‹¤. (ë§í¬ ì—ì„œ í™•ì¸í•´ë³´ì„¸ìš”.)ê·¸ë ‡ë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ ì½”ë“œëŸ‰ì´ ì¤„ê²Œ ë˜ì§€ìš”.@Testpublic void test() { var q = QDelivery.delivery; var map = Q.newUpdateMap(); map.put(q.dtDeliveryStartedAt, LocalDateTime.now()); deliveryRepository.updateOne(q.deliveryId.eq(1L), map);}3. ê²°ë¡ Dirty Checkingê³¼ íŠ¹ì • ì»¬ëŸ¼ë§Œ ì—…ë°ì´íŠ¸ í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. ëª¨ë“  ì»¬ëŸ¼ì„ ì—…ë°ì´íŠ¸ í•œë‹¤ê³  í•˜ì—¬ ì„±ëŠ¥ìƒì— ë¬¸ì œê°€ ìƒê¸°ê²ƒì€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— í…Œì´ë¸”ì˜ ì»¬ëŸ¼ ìˆ˜ì™€ ìƒí™©ì„ ì˜ ê³ ë ¤í•˜ì—¬ ì „ì²´ë¥¼ ì—…ë°ì´íŠ¸ í• ì§€, íŠ¹ì • ì»¬ëŸ¼ë§Œ ì—…ë°ì´íŠ¸ í• ì§€ ê³ ë¯¼í•´ ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤." }, { "title": "QueryProjection ì—ì„œ í•œë‹¨ê³„ ë” ë‚˜ì•„ê°€ QueryProjectionBuilder ë§Œë“¤ê¸° (2)", "url": "/posts/querydsl-qbuilder-qsetter-2/", "categories": "QueryDSL", "tags": "Java, JPA, QueryDSL", "date": "2022-10-02 07:12:00 +0900", "snippet": "QueryProjection ì—ì„œ í•œë‹¨ê³„ ë” ë‚˜ì•„ê°€ QueryProjectionBuilder ë§Œë“¤ê¸° (2) - ê°œë°œ ê³¼ì •, ì½”ë“œ ì´ í¬ìŠ¤íŒ…ì—ì„œ ì„¤ëª…í•˜ëŠ” ì½”ë“œëŠ” í•œ í”„ë¡œì íŠ¸ ë‚´ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.ë¼ì´ë¸ŒëŸ¬ë¦¬ í”„ë¡œì íŠ¸ A, ì‹¤ì œ ì–´í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œì íŠ¸ B ë¡œ ë‚˜ë‰˜ì–´ì•¼ í•©ë‹ˆë‹¤.java17, maven ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.1. @QueryProjection ìœ¼ë¡œ ìƒì„±ë˜ëŠ” í´ë˜ìŠ¤ ë¶„ì„í´ë˜ìŠ¤ë¥¼ í”„ë¡œì ì…˜ íƒ€ì…ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ìš°ë¦¬ëŠ” í´ë˜ìŠ¤ ìƒì„±ìì— @QueryProjection ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì´ê³  Q í´ë˜ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ìƒì„±ë˜ëŠ” Q í´ë˜ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤./** * com.keencho.libormtest.model.QCustomerDTO is a Querydsl Projection type for CustomerDTO */@Generated(\"com.querydsl.codegen.DefaultProjectionSerializer\")public class QCustomerDTO extends ConstructorExpression&lt;CustomerDTO&gt; { private static final long serialVersionUID = -785800583L; public QCustomerDTO(com.querydsl.core.types.Expression&lt;Long&gt; id, com.querydsl.core.types.Expression&lt;String&gt; loginId, com.querydsl.core.types.Expression&lt;String&gt; password, com.querydsl.core.types.Expression&lt;String&gt; name, com.querydsl.core.types.Expression&lt;Integer&gt; age) { super(CustomerDTO.class, new Class&lt;?&gt;[]{long.class, String.class, String.class, String.class, int.class}, id, loginId, password, name, age); }}ConstructorExpression í´ë˜ìŠ¤ë¥¼ ìƒì†í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ í´ë˜ìŠ¤ì˜ ìƒì„±ìë¥¼ ì‚´í´ë´…ì‹œë‹¤. ìƒì„±ìì˜ ì¸ìë¡œ ì œë„¤ë¦­ í´ë˜ìŠ¤ íƒ€ì…ê³¼ í”„ë¡œì ì…˜ì˜ íƒ€ì…ì„ ë‹´ì€ ë°°ì—´, ê·¸ë¦¬ê³  í”„ë¡œì ì…˜ì˜ ê°’ì„ ì¸ìë¡œ ë°›ê³  ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì•„ë˜ë¡œ ë‚´ë˜ë³´ë©´ newInstance(Object... args) ë¼ëŠ” ë©”ì†Œë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë©”ì†Œë“œê°€ ë°”ë¡œ í”„ë¡œì ì…˜ì„ ìƒì„±í•˜ëŠ” ë©”ì†Œë“œ ì…ë‹ˆë‹¤.ìƒì„±ìì™€ ë©”ì†Œë“œë¥¼ í†µí•´ ì–´ë–»ê²Œ ìƒì„±ìë¥¼ í†µí•´ ì¡°íšŒ ê²°ê³¼ë¥¼ ë°˜í™˜ ë°›ì„ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.2. ìƒˆë¡œìš´ Expression í´ë˜ìŠ¤ ë§Œë“¤ê¸°ìœ„ì—ì„œ ì‚´í´ë³¸ ConstructorExpression ì€ ì–´ë””ê¹Œì§€ë‚˜ í´ë˜ìŠ¤ì˜ ëª¨ë“  í•„ë“œë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ê°–ëŠ” ìƒì„±ìë¥¼ ìœ„í•œ ì¡°íšŒ ë°©ì‹ì´ê¸° ë•Œë¬¸ì— ë¹Œë”íŒ¨í„´ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. FactoryExpressionBase í´ë˜ìŠ¤ë¥¼ ìƒì†í•˜ëŠ” ìƒˆë¡œìš´ í”„ë¡œì ì…˜ í´ë˜ìŠ¤ë¥¼ ë§Œë“œëŠ”ê²Œ ë‚«ê² ë„¤ìš”. public KcExpression(Class&lt;? extends T&gt; type, Map&lt;String, Expression&lt;?&gt;&gt; bindings) { super(type); this.type = type; if (bindings == null || bindings.isEmpty()) { throw new RuntimeException(\"bindings must not be null or empty!\"); } this.bindings = Collections.unmodifiableMap( bindings .entrySet() .stream() .filter(entry -&gt; entry.getValue() != null) .collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue, (x, y) -&gt; y, LinkedHashMap::new)) );}í”„ë¡œì ì…˜ í´ë˜ìŠ¤ì˜ ìƒì„±ì ì…ë‹ˆë‹¤. í´ë˜ìŠ¤ íƒ€ì…ê³¼ Map&lt;String, Expression&lt;?&gt;&gt;ì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ìŠµë‹ˆë‹¤. ì „ë‹¬ë°›ì€ mapì—ì„œ nullê°’ì„ ì œì™¸í•˜ê³  ìˆœì„œë¥¼ ë³´ì¥í•˜ëŠ” LinkedHashMapìœ¼ë¡œ ë‹¤ì‹œ ìƒì„±í•˜ì—¬ bindings ë³€ìˆ˜ì— í• ë‹¹í•©ë‹ˆë‹¤.@Overridepublic T newInstance(Object... a) { try { var arr = this.bindings.keySet().toArray(); var rv = this.type.getDeclaredConstructor().newInstance(); for (var i = 0; i &lt; a.length; i ++) { var value = a[i]; if (value != null) { var field = this.type.getDeclaredField((String) arr[i]); field.setAccessible(true); field.set(rv, value); } } return rv; } catch (InstantiationException | IllegalAccessException | NoSuchFieldException | InvocationTargetException | NoSuchMethodException e) { throw new ExpressionException(e.getMessage(), e); }}newInstance ë©”ì†Œë“œì—ì„œëŠ” ë¦¬í”Œë ‰ì…˜ìœ¼ë¡œ ë¹ˆ ìƒì„±ìë¥¼ ìƒì„±í•˜ê³  ê°’ì´ ë„˜ì–´ì˜¨ ìˆœì„œëŒ€ë¡œ í•„ë“œì— ê°’ì„ ì €ì •í•©ë‹ˆë‹¤. ë¬¸ì œëŠ” ì´ ë©”ì†Œì—ëŠ” í•„ë“œì˜ ì •ë³´ë‚˜ íƒ€ì…ê°™ì€ê±´ ë„˜ì–´ì˜¤ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì ì…ë‹ˆë‹¤.ì˜¤ì§ Object... í˜•ì‹ìœ¼ë¡œ ìˆœìˆ˜í•œ ê°’ë§Œ ë„˜ì–´ì˜¤ê¸° ë•Œë¬¸ì— í˜„ì¬ ë„˜ì–´ì˜¤ëŠ” ê°’ì´ ì–´ë– í•œ í•„ë“œì— ë§¤í•‘ë˜ëŠ”ì§€ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê·¸ë˜ë„ ë‹¤í–‰ì¸ ê²ƒì€ ê°’ì´ í•„ë“œ ìˆœì„œëŒ€ë¡œ ë„˜ì–´ì˜¨ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.ì œê°€ ìœ„ì—ì„œ ìˆœì„œë¥¼ ë³´ì¥í•˜ëŠ” LinkedHashMapì„ ì‚¬ìš©í–ˆë˜ ê²ƒì€ ìœ„ì™€ê°™ì€ ì´ìœ  ë•Œë¬¸ì…ë‹ˆë‹¤. ë¬¼ë¡  ì• ì´ˆì— ì´ í´ë˜ìŠ¤ê°€ ìƒì„±ë˜ëŠ” ì‹œì ì—ë„ ìˆœì„œê°€ ë³´ì¥ëœ mapì„ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ì•¼ í•©ë‹ˆë‹¤. ë©”ì†Œë“œì— ë„˜ì–´ì˜¤ëŠ” ê°’ì´ ìˆœì„œë¥¼ ë³´ì¥í•˜ê¸° ë•Œë¬¸ì— í´ë˜ìŠ¤ì˜ í•„ë“œì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” map ê°ì²´ì˜ ìš”ì†Œê°€ ë°˜í™˜ë°›ì„ í´ë˜ìŠ¤ì˜ í•„ë“œ ì„ ì–¸ ìˆœì„œì™€ ë™ì¼í•˜ë‹¤ë©´ ë¬¸ì œì—†ì´ ë°˜í™˜ë°›ì„ í´ë˜ìŠ¤ì— ê°’ì„ ì €ì¥í•˜ê³  ë„˜ê²¨ë°›ì„ ìˆ˜ ìˆê² ì£ .3. recordë¥¼ ë°˜í™˜ ë°›ì„ ìˆ˜ ìˆëŠ” Expression ë§Œë“¤ê¸°ìœ„ì—ì„œ ë§Œë“  Expression í´ë˜ìŠ¤ì—ëŠ” ë¬¸ì œê°€ í•˜ë‚˜ ìˆìŠµë‹ˆë‹¤. ë¹ˆ ìƒì„±ìë¥¼ ë§Œë“¤ê³  ê·¸ ì´í›„ì— ê°’ì„ ì„¸íŒ…í•˜ëŠ” ë°©ì‹ì´ê¸° ë•Œë¬¸ì— ë¹ˆ ìƒì„±ìê°€ ì¡´ì¬í•  ìˆ˜ ì—†ëŠ” record íƒ€ì…ì˜ í´ë˜ìŠ¤ëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.ì´ë¥¼ ìœ„í•´ record í´ë˜ìŠ¤ ì— ì‚¬ìš©í•  Expression í´ë˜ìŠ¤ëŠ” ë”°ë¡œ ë§Œë“¤ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.public class KcRecordExpression&lt;T extends Record&gt; extends KcExpression&lt;T&gt; { private final Class&lt;? extends T&gt; type; public KcRecordExpression(Class&lt;? extends T&gt; type, Map&lt;String, Expression&lt;?&gt;&gt; bindings) { super(type, bindings); if (!type.isRecord()) { throw new RuntimeException(\"This expression is an expression for record. Use KcExpression to bind a regular class.\"); } this.type = type; } @Override public T newInstance(Object... a) { if (this.type.getDeclaredFields().length != a.length) { throw new RuntimeException(\"Because a record type must create an object as a constructor that accepts all variables as arguments, the number of declared fields and the number of parameters to bind must be the same.\"); } try { var arr = getBindings().keySet().toArray(); var fields = new Field[a.length]; for (var i = 0; i &lt; fields.length; i ++) { fields[i] = this.type.getDeclaredField((String) arr[i]); } var matchedConstructor = Arrays .stream(this.type.getConstructors()) .filter(constructor -&gt; { var parameterTypes = constructor.getParameterTypes(); for (var i = 0; i &lt; a.length; i ++) { var constructorType = parameterTypes[i]; var field = fields[i]; if (!constructorType.getTypeName().equals(field.getType().getTypeName())) { return false; } } return true; }).toList(); if (matchedConstructor.size() != 1) { throw new RuntimeException(\"No or more than one constructor exists with the same number and type of parameters. It seems record is not suitable for this case.\"); } var constructor = matchedConstructor.get(0); return (T) constructor.newInstance(a); } catch (Exception e) { throw new ExpressionException(e.getMessage(), e); } }}í´ë˜ìŠ¤ ìƒì„± ì‹œì ì— íƒ€ì…ì´ record íƒ€ì…ì¸ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.newInstance ë©”ì†Œë“œì—ëŠ” ë°©ì–´ ì½”ë“œê°€ ì¡´ì¬í•©ë‹ˆë‹¤. ì²«ì§¸ë¡œ ë°˜í™˜ë°›ì„ record í´ë˜ìŠ¤ì˜ í•„ë“œ ê°¯ìˆ˜ì™€ ë©”ì†Œë“œì— ë„˜ì–´ì˜¨ íŒŒë¼ë¯¸í„°ì˜ ê°¯ìˆ˜ê°€ ë˜‘ê°™ì•„ì•¼ í•©ë‹ˆë‹¤. í´ë˜ìŠ¤ ë‚´ì— ìˆëŠ” ëª¨ë“  ë³€ìˆ˜ë“¤ì„ ì¸ìˆ˜ë¡œ ë°›ì„ ìƒì„±ìë¥¼ ë§Œë“¤ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë‹¹ì—°í•©ë‹ˆë‹¤.ë‘˜ì§¸ë¡œ ì‚¬ìš©í•  ìƒì„±ìê°€ ëª…í™•í•´ì•¼ í•©ë‹ˆë‹¤. record í´ë˜ìŠ¤ ë‚´ì—ë„ ìƒì„±ìëŠ” ì—¬ëŸ¬ê°œ ì¡´ì¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì—¬ê¸°ì„œ ì‚¬ìš©í•  ìƒì„±ìëŠ” ìë°”ê°€ ê¸°ë³¸ìœ¼ë¡œ ë§Œë“¤ì–´ì£¼ëŠ” ëª¨ë“  ë³€ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ê°–ëŠ” ìƒì„±ìì—¬ì•¼ í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ê°’ì˜ íƒ€ì…ê³¼ ë§¤ê°œë³€ìˆ˜ì˜ íƒ€ì…, ìƒì„±ì ë§¤ê°œë³€ìˆ˜ì˜ ìˆ«ìë¥¼ ê²€ì¦í•˜ì—¬ ìƒì„±ìì˜ ì¡°ê±´ê³¼ ì¼ì¹˜í•˜ëŠ” ë‹¨ í•˜ë‚˜ì˜ ìƒì„±ìë§Œì„ ì‚¬ìš©í•˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.4. AnnotationProcessor ë§Œë“¤ê¸°ì»¤ìŠ¤í…€ ì–´ë…¸í…Œì´ì…˜ì„ ë§Œë“¤ê³  í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì–´ìˆëŠ” í´ë˜ìŠ¤ë¥¼ ìœ„ì—ì„œ ë§Œë“  í”„ë¡œì ì…˜ í´ë˜ìŠ¤ë¥¼ ìƒì†í•˜ëŠ” í´ë˜ìŠ¤ë¡œì¨ ìƒˆë¡­ê²Œ ë§Œë“¤ê¸° ìœ„í•´ AnnotationProcessorë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.ì²«ì§¸ë¡œ í´ë˜ìŠ¤ ìœ„ì— ë¶™ì¼ ì–´ë…¸í…Œì´ì…˜ ì…ë‹ˆë‹¤.@Documented@Target(ElementType.TYPE)@Retention(RUNTIME)public @interface KcQueryProjection {}ë‹¤ìŒì€ AbstractProcessorë¥¼ ìƒì†í•˜ëŠ” AnnotationProcessor í´ë˜ìŠ¤ ì…ë‹ˆë‹¤. ì „ì²´ ì½”ë“œëŠ” ì´ ê¸€ í•˜ë‹¨ì˜ ë§í¬ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë­”ê°€ íŠ¹ë³„í•œ ë°©ì‹ì´ ìˆì„ê²ƒ ê°™ì§€ë§Œ ì „ ê·¸ëƒ¥ ë‹¤ìŒê³¼ ê°™ì´ ë¬´ì‹í•˜ê²Œ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì ì€ ì„¸ê°€ì§€ ì…ë‹ˆë‹¤. í˜„ì¬ í´ë˜ìŠ¤ê°€ record ì¸ì§€ ì¼ë°˜ í´ë˜ìŠ¤ì¸ì§€ êµ¬ë¶„ -&gt; Expression í´ë˜ìŠ¤ê°€ ë‹¤ë¦„ ì œë„¤ë¦­ íƒ€ì…ìœ¼ë¡œ ì›ì‹œ íƒ€ì…ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì›ì‹œ íƒ€ì…ì„ ì°¸ì¡° íƒ€ì…ìœ¼ë¡œ ë³€ê²½ ë°”ì¸ë”© map ê°ì²´ë¥¼ ë§Œë“¤ë•ŒëŠ” ìˆœì„œë¥¼ ë³´ì¥í•˜ëŠ” LinkedHashMap ì‚¬ìš© (ìœ„ì—ì„œ ì„¤ëª…)ì´ì œ í˜„ì¬ í”„ë¡œì íŠ¸ê°€ AnnotationProcessorë¡œì¨ ë™ì‘í•˜ê²Œ í•˜ê¸° ìœ„í•´ ì¶”ê°€ë¡œ í•„ìš”í•œ ì‘ì—…ì„ ì§„í–‰í•©ë‹ˆë‹¤. resources/META-INF/services/javax.annotation.processing.Processor íŒŒì¼ì— AnnotationProcessor í´ë˜ìŠ¤ ëª…ì‹œ pom.xml ì— ì•„ë˜ í”ŒëŸ¬ê·¸ì¸ì„ ì¶”ê°€í•˜ì—¬ ì»´íŒŒì¼ëŸ¬ê°€ í˜„ì¬ í”„ë¡œì íŠ¸ë¥¼ ì»´íŒŒì¼í• ë•Œ annotation processing ì‘ì—…ì„ ê±´ë„ˆ ë›°ë„ë¡ í•¨í•„ìš”í•œ ì‘ì—…ì„ ì§„í–‰í•˜ì˜€ë‹¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ local maven repositoryì— í˜„ì¬ í”„ë¡œì íŠ¸ê°€ ë°°í¬ë  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.clean install -DskipTests5. í…ŒìŠ¤íŠ¸ì´ì œ ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ í•˜ë‚˜ ë§Œë“¤ê³  ìœ„ì—ì„œ ë§Œë“  ì‘ì—…ë¬¼ì„ í…ŒìŠ¤íŠ¸í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.ë°°í¬ëœ í”„ë¡œì íŠ¸ì™€ querydsl-aptë¥¼ ì˜ì¡´ì„±ì— ì¶”ê°€í•˜ê³  maven compiler pluginì„ ì¶”ê°€í•˜ê³  annotationProcessorë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.&lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.11.0&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;17&lt;/source&gt; &lt;target&gt;17&lt;/target&gt; &lt;generatedSourcesDirectory&gt;target/generated-sources/querydsl&lt;/generatedSourcesDirectory&gt; &lt;annotationProcessors&gt; &lt;annotationProcessor&gt; com.querydsl.apt.jpa.JPAAnnotationProcessor &lt;/annotationProcessor&gt; &lt;annotationProcessor&gt; com.keencho.querydsl.KcQuerydslAnnotationProcessor &lt;/annotationProcessor&gt; &lt;/annotationProcessors&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt;&lt;/build&gt;ì´ì œ ë°˜í™˜ë°›ê¸° ì›í•˜ëŠ” class, recordì— ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì´ê³  í”„ë¡œì íŠ¸ë¥¼ ì»´íŒŒì¼ í•©ë‹ˆë‹¤. :warning: í”„ë¡œì ì…˜ í´ë˜ìŠ¤ì—ì„œ ë¹ˆ ìƒì„±ìë¥¼ í•„ìš”ë¡œ í•˜ê¸° ë•Œë¬¸ì— ì•„ë˜ ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ í´ë˜ìŠ¤ì—ëŠ” ë¹ˆ ìƒì„±ìê°€ í•„ìˆ˜ë¡œ ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤. (ì—†ë‹¤ë©´ NoSuchMethodException ë°œìƒ)@KcQueryProjectionpublic record CustomerRecord( Long id, String loginId, String password, String name) { }í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.var q = QCustomer.customer;var predicate = new BooleanBuilder();predicate.and(q.name.contains(\"1\"));var bindings = KcQCustomerDTO.builder() .id(q.id) .name(q.name) .loginId(q.loginId) .password(q.password) .build();var list = jpaQueryFactory .select(bindings) .from(q) .where(predicate) .orderBy(q.loginId.asc()) .fetch();var bindings2 = KcQCustomerRecord.builder() .id(q.id) .name(q.name) .loginId(q.loginId) .password(q.password) .build();var list2 = jpaQueryFactory .select(bindings2) .from(q) .where(predicate) .orderBy(q.loginId.asc()) .fetch();for (var i = 0; i &lt; list.size(); i ++) { Assert.isTrue(list.get(i).getName().equals(list2.get(i).name())); Assert.isTrue(list.get(i).getPassword().equals(list2.get(i).password())); Assert.isTrue(list.get(i).getId().equals(list2.get(i).id())); Assert.isTrue(list.get(i).getLoginId().equals(list2.get(i).loginId()));}ì½”ë“œ í™•ì¸ì „ì²´ ì½”ë“œëŠ” ì´ê³³ ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤." }, { "title": "QueryProjection ì—ì„œ í•œë‹¨ê³„ ë” ë‚˜ì•„ê°€ QueryProjectionBuilder ë§Œë“¤ê¸° (1)", "url": "/posts/querydsl-qbuilder-qsetter-1/", "categories": "QueryDSL", "tags": "Java, JPA, QueryDSL", "date": "2022-09-28 07:12:00 +0900", "snippet": "QueryProjection ì—ì„œ í•œë‹¨ê³„ ë” ë‚˜ì•„ê°€ QueryProjectionBuilder ë§Œë“¤ê¸° (1) - ê°œìš”Querydslì„ ì‚¬ìš©í•´ dbì¡°íšŒë¥¼ í•˜ëŠ” ê²½ìš° ì—”í‹°í‹° ìì²´ë¥¼ ë°˜í™˜í•˜ëŠ” ê²½ìš°ëŠ” ì˜ ì—†ìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ í•„ìš”í•œ í•„ë“œë§Œ ì§€ì •í•˜ì—¬ Projectionsë¥¼ ì‚¬ìš©í•˜ì—¬ ì¡°íšŒí•˜ê²Œ ë˜ëŠ”ê²ƒ ê°™ìŠµë‹ˆë‹¤.ì˜ ì•Œë ¤ì§„ projection ë°©ë²•ì—ëŠ” 3ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤. Projections.bean - getter / setter í•„ìš” Projections.constructor - field ì§ì ‘ ì ‘ê·¼ @QueryProjection - ConstructorExpressionë¥¼ ìƒì†ë°›ì€ Q í´ë˜ìŠ¤ ìƒì„± ì²«ë²ˆì§¸ ë°©ì‹ê³¼ ë‘ë²ˆì§¸ ë°©ì‹ì€ ì¡°íšŒí•˜ë ¤ëŠ” í•„ë“œëª…ì´ ì¼ì¹˜í•´ì•¼ í•œë‹¤ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.public class SimpleDTO { Long deliveryId; Long orderId; String field;}...var p = Projections.fields(SimpleDTO.class, q.deliveryId, q.order.orderId, q.fromAddress);ì˜ˆë¥¼ë“¤ì–´ ìœ„ì™€ê°™ì´ ì¡°íšŒí–ˆì„ë•Œ SimpleDTOì˜ field ì™€ entity q ê°ì²´ì˜ fromAdressì˜ í•„ë“œëª…ì´ ì¼ì¹˜í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ê²°ê³¼ë¥¼ ì¡°íšŒí–ˆì„ë•Œ nullì´ ë„˜ì–´ì˜¤ê²Œ ë©ë‹ˆë‹¤.ê·¸ë˜ì„œ ì²˜ìŒ querydslì„ ì‚¬ìš©í•˜ê³  ì‹¤ë¬´ì— ì ìš©ë•ŒëŠ” @QueryProjection ë°©ì‹ì„ ì‚¬ìš©í–ˆì—ˆìŠµë‹ˆë‹¤. Entityì˜ Qê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì²˜ëŸ¼ DTO Classì˜ Qê°ì²´ë¥¼ ìƒì„±í•˜ê³ , ìƒì„±í•œ Q ê°ì²´ì˜ ìƒì„±ìë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ê¸° ë•Œë¬¸ì— ì¡°íšŒí•˜ê³ ì í•˜ëŠ” í•„ë“œì˜ ìˆœì„œê°€ ì •í™•í•´ì•¼ í•œë‹¤ëŠ” ì¡°ê±´ì´ ìˆìŠµë‹ˆë‹¤.ë˜, ê¸°ì¡´ ì½”ë“œì™€ì˜ í˜¸í™˜ì„±ì„ ìœ ì§€í•˜ë ¤ë©´ ì˜¤ë¦¬ì§€ë‚  DTO Classì— í•„ë“œë¥¼ ì¶”ê°€í• ë•Œë§ˆë‹¤ ìƒì„±ìë¥¼ í•˜ë‚˜ì”© ì¶”ê°€í•´ì•¼ í•œë‹¤ëŠ” ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤.public class SimpleDTO { Long deliveryId; Long orderId; String field; @QueryProjection public SimpleDTO(Long deliveryId, Long orderId, String field) { this.deliveryId = deliveryId; this.orderId = orderId; this.field = field; } @QueryProjection public SimpleDTO(Long deliveryId) { this.deliveryId = deliveryId; } @QueryProjection public SimpleDTO(Long deliveryId, Long orderId) { this.deliveryId = deliveryId; this.orderId = orderId; } @QueryProjection public SimpleDTO(Long orderId, String field) { this.orderId = orderId; this.field = field; }}ì‚¬ì‹¤ ìœ„ ë¬¸ì œëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì„¤ê³„í• ë•Œ â€˜ì´ë ‡ê²Œ ì €ë ‡ê²Œ í•˜ì~â€™ ë¼ê³  ë¯¸ë¦¬ ì •í•´ë‘ê³  ê°€ë©´ ì¶©ë¶„íˆ í•´ê²°í• ìˆ˜ ìˆëŠ” ë¬¸ì œì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì‹¤ë¬´ì—ì„œëŠ” ê¸°íšì´ ë°”ë€ŒëŠ”ì¼ì´ í—ˆë‹¤í•˜ì£ . ê·¸ë˜ì„œ ì €ëŠ” ì €ë§Œì˜ ë°©ì‹ìœ¼ë¡œ Projectionì„ ë§Œë“¤ì–´ë³´ê¸°ë¡œ í•˜ì˜€ìŠµë‹ˆë‹¤.ì´ˆê¸°ì˜ ìƒê°ì²˜ìŒì— ìƒê°í–ˆë˜ ë°©ì‹ì€ mapì„ ë§Œë“¤ê³ , ì¡°íšŒí•  í•„ë“œì™€ Expressionì„ mapì— ì§‘ì–´ë„£ê³  ì¡°íšŒí›„ì— ë‹¤ì‹œ ë¦¬í”Œë ‰ì…˜ìœ¼ë¡œ dtoì— ê°’ì„ ê½‚ì•„ë„£ëŠ” ë°©ì‹ì´ì—ˆìŠµë‹ˆë‹¤. ì½”ë“œë¡œ í’€ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.public class SimpleDTO { Long deliveryId; Long orderId; String field; private static Map&lt;String, Expression&lt;?&gt;&gt; bindings; static { var q = Q.delivery; bindings.put(\"deliveryId\", q.deliveryId); bindings.put(\"orderId\", q.order.orderId); bindings.put(\"field\", q.fromAddress); }}...queryFactory.select(SimpleDTO.bindings).from(q).fetch();ì´ ë°©ì‹ì€ querydslì— ê·¸ë‹¤ì§€ ì˜ì¡´ì ì´ì§€ ì•Šìœ¼ë‚˜ ì»´íŒŒì¼ ì‹œì ì— ì˜¤ë¥˜ë¥¼ ì¡ì„ìˆ˜ ì—†ë‹¤ëŠ” ë¬¸ì œê°€ ì¡´ì¬í•©ë‹ˆë‹¤. ì €ëŠ” querydslì— ì˜ì¡´ì ì´ë”ë¼ë„ ì˜¤ë¥˜ë¥¼ ì¡ì„ìˆ˜ ìˆëŠ” ë°©ì‹ì„ ì„ í˜¸í•˜ê¸° ë•Œë¬¸ì— ìœ„ ë°©ì‹ì€ ì„ íƒí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.QBuilderë¥¼ ë§Œë“¤ì!QueryProjectionì´ Qí´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì²˜ëŸ¼ builder, setterë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì €ë§Œì˜ Qí´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ë³´ê¸°ë¡œ í•˜ì˜€ìŠµë‹ˆë‹¤. ìƒì„±ë˜ëŠ” Q í´ë˜ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤./** * com.keencho.libormtest.model.KcQCustomerDTO is a KcQuerydsl Projection type for CustomerDTO */public class KcQCustomerDTO extends KcExpression&lt;CustomerDTO&gt; { private static final long serialVersionUID = 842345744L; public KcQCustomerDTO(Builder builder) { super(CustomerDTO.class, builder.buildBindings()); } public static Builder builder() { return new Builder(); } public static class Builder { private com.querydsl.core.types.Expression&lt;java.lang.Long&gt; id; public Builder id(com.querydsl.core.types.Expression&lt;java.lang.Long&gt; id) { this.id = id; return this; } private com.querydsl.core.types.Expression&lt;java.lang.String&gt; loginId; public Builder loginId(com.querydsl.core.types.Expression&lt;java.lang.String&gt; loginId) { this.loginId = loginId; return this; } private com.querydsl.core.types.Expression&lt;java.lang.String&gt; password; public Builder password(com.querydsl.core.types.Expression&lt;java.lang.String&gt; password) { this.password = password; return this; } private com.querydsl.core.types.Expression&lt;java.lang.String&gt; name; public Builder name(com.querydsl.core.types.Expression&lt;java.lang.String&gt; name) { this.name = name; return this; } private com.querydsl.core.types.Expression&lt;java.lang.Integer&gt; age; public Builder age(com.querydsl.core.types.Expression&lt;java.lang.Integer&gt; age) { this.age = age; return this; } public KcQCustomerDTO build() { return new KcQCustomerDTO(this); } public Map&lt;String, Expression&lt;?&gt;&gt; buildBindings() { Map&lt;String, Expression&lt;?&gt;&gt; bindings = new LinkedHashMap&lt;&gt;(); bindings.put(\"id\", this.id); bindings.put(\"loginId\", this.loginId); bindings.put(\"password\", this.password); bindings.put(\"name\", this.name); bindings.put(\"age\", this.age); return bindings; } }}ì´ë ‡ê²Œ ë˜ë©´ í•„ë“œë¥¼ ì¶”ê°€í•´ë„ ê¸°ì¡´ì˜ ì½”ë“œì— ì˜í–¥ì„ ì£¼ì§€ ì•Šê³  ëŸ°íƒ€ì„ì— ì˜¤ë¥˜ë„ ì¡ì„ìˆ˜ ìˆê³  builder íŒ¨í„´ìœ¼ë¡œ projectionì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¬¼ë¡  ë°”ì¸ë”© ê°ì²´ë¥¼ ë§Œë“œëŠ”ê²ƒì´ type-safeí•˜ì§„ ì•Šì§€ë§Œ í´ë˜ìŠ¤ë¥¼ ë§Œë“œëŠ” ì‹œì  (ì»´íŒŒì¼ ì‹œì )ì— ì—ëŸ¬ê°€ ë°œìƒí•˜ê¸° ë•Œë¬¸ì— ì ì–´ë„ ëŸ°íƒ€ì„ì— ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ”ê±´ ë§‰ì„ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.ì¡°íšŒí• ë•ŒëŠ” ì´ëŸ°ì‹ìœ¼ë¡œ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.var q = QCustomer.customer;var bindings = KcQCustomerDTO.builder() .id(q.id) .name(q.name) .loginId(q.loginId) .build();var predicate = new BooleanBuilder();predicate.and(q.name.contains(\"ê¹€\"));var list = jpaQueryFactory .select(bindings) .from(q) .where(predicate) .fetch();ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œâ€¦ë¼ì´ë¸ŒëŸ¬ë¦¬ ì œì‘ ê³¼ì • ë° ìì„¸í•œ ì½”ë“œëŠ” ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œ ë‹¤ë£¨ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤." }, { "title": "Spring Security custom library ë§Œë“¤ê¸°", "url": "/posts/spring-security-custom-library/", "categories": "Spring Security", "tags": "Java, Spring, Spring Security", "date": "2022-09-08 08:12:00 +0900", "snippet": "Spring Security custom library ë§Œë“¤ê¸°ìš´ì˜ì¤‘ì¸ ì‹œìŠ¤í…œì— ì ìš©ëœ Spring Security custom libraryë¥¼ ì œ ë°©ì‹ëŒ€ë¡œ ë°”ê¿”ë³´ê³  ê²¸ì‚¬ê²¸ì‚¬ Spring Securityì˜ ë™ì‘ ë°©ì‹, ì›ë¦¬ì— ëŒ€í•´ ë” ê¹Šê²Œ ê³µë¶€í•˜ê³ ì ì‘ì„±í•œ ê¸€ì…ë‹ˆë‹¤. ì´ í¬ìŠ¤íŒ…ì€ Spring Securityê°€ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì¸ì¦ / ì¸ê°€ ì²˜ë¦¬í•˜ëŠ”ì§€ ì–´ëŠì •ë„ ì´í•´í•˜ê³  ìˆë‹¤ëŠ” ê°€ì • í•˜ì— ì‘ì„±ëœ í¬ìŠ¤íŒ…ì…ë‹ˆë‹¤.ì‚¬ìš©ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ì¡´ì„±dependencies { // spring implementation 'org.springframework.boot:spring-boot-starter-web' implementation 'org.springframework.boot:spring-boot-starter-security' implementation 'org.springframework.boot:spring-boot-starter-data-jpa' // jwt implementation 'io.jsonwebtoken:jjwt-api:0.11.5' implementation 'io.jsonwebtoken:jjwt-impl:0.11.5' implementation 'io.jsonwebtoken:jjwt-jackson:0.11.5' // lombok compileOnly 'org.projectlombok:lombok' annotationProcessor 'org.projectlombok:lombok'}Spring Data JPAë¥¼ ì‚¬ìš©í•˜ì—¬ entity ê°ì²´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì¸ì¦ì´ ì§„í–‰ë˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.í•µì‹¬ ì½”ë“œ ì‘ì„±1. ë² ì´ìŠ¤ ëª¨ë¸ì²«ì§¸ëŠ” ë² ì´ìŠ¤ ëª¨ë¸ì…ë‹ˆë‹¤. ì¶”í›„ ì‘ì„±ë  ëŒ€ë¶€ë¶„ì˜ ì½”ë“œì˜ ì œë„¤ë¦­ì—ì„œ ì´ ëª¨ë¸ì´ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— ê°€ì¥ ì¤‘ìš”í•œ ì½”ë“œë¼ê³  ìƒê°ë©ë‹ˆë‹¤.@EqualsAndHashCode(callSuper = false)@Data@MappedSuperclasspublic abstract class KcAccountBaseModel { @Column(nullable = false) protected String loginId; @Column(nullable = false) protected String password; @Column(nullable = false) protected boolean accountNonExpired = true; @Column(nullable = false) protected boolean accountNonLocked = true; @Column(nullable = false) protected boolean credentialsNonExpired = true; @Column(nullable = false) protected boolean enabled = true; @Column(nullable = false) protected LocalDateTime dtCreatedAt = LocalDateTime.now(); @Column(nullable = false) protected LocalDateTime dtUpdatedAt = LocalDateTime.now(); protected LocalDateTime dtPasswordChangedAt = LocalDateTime.now(); protected LocalDateTime dtLastLoggedInAt; protected LocalDateTime dtLastAccessedAt; @Column(nullable = false) protected int loginAttemptCount = 0;}ê°ê°ì˜ í…Œì´ë¸”ì€ ìš©ë„ (ì‚¬ìš©ì, ê´€ë¦¬ì, ì‹œìŠ¤í…œ ë“±..) ìœ¼ë¡œ ë‚˜ë‰˜ê²Œ ë˜ê³  ê°ê°ì˜ í…Œì´ë¸” ì—”í‹°í‹°ë“¤ì€ ìœ„ì˜ ë² ì´ìŠ¤ ëª¨ë¸ì„ ìƒì†ë°›ì•„ ì‘ì„±ë  ê²ƒì…ë‹ˆë‹¤.ë˜ë‹¤ë¥¸ í•µì‹¬ ë² ì´ìŠ¤ ëª¨ë¸ì€ Security Account ëª¨ë¸ì…ë‹ˆë‹¤.@Datapublic class KcSecurityAccount implements UserDetails, CredentialsContainer { private final Class&lt;?&gt; accountEntityClass; private final String loginId; private String password; private final Set&lt;GrantedAuthority&gt; authorities; private final boolean accountNonExpired; private final boolean accountNonLocked; private final boolean credentialsNonExpired; private final boolean enabled; private final Object data; public KcSecurityAccount(Class&lt;?&gt; accountEntityClass, String loginId, String password, Set&lt;GrantedAuthority&gt; authorities, boolean accountNonExpired, boolean accountNonLocked, boolean credentialsNonExpired, boolean enabled, Object data) { this.accountEntityClass = accountEntityClass; this.loginId = loginId; this.password = password; this.authorities = authorities; this.accountNonExpired = accountNonExpired; this.accountNonLocked = accountNonLocked; this.credentialsNonExpired = credentialsNonExpired; this.enabled = enabled; this.data = data; } @Override public void eraseCredentials() { this.password = null; } @Override public String getUsername() { return null; }}ìœ„ ëª¨ë¸ì€ ë¡œê·¸ì¸ì‹œ ì¸ì¦ ê°ì²´ë¡œ ì“°ì¼ ëª¨ë¸ì´ë©°(UserDetails, CredentialsContainer êµ¬í˜„) ê°ê°ì˜ ì—”í‹°í‹°ë³„ë¡œ ë˜ë‹¤ë¥¸ ê°ì²´ ë°ì´í„°ë¥¼ ê°€ì§€ê³  ìˆì–´ì•¼ í• ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì— Object data ë¥¼ í†µí•´ ì´ë¥¼ ì¶©ì¡±ì‹œí‚¤ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.2. ë² ì´ìŠ¤ ëª¨ë¸ ë¦¬í¬ì§€í† ë¦¬public interface KcAccountRepository&lt;T extends KcAccountBaseModel, ID&gt; extends JpaRepository&lt;T, ID&gt; { T findByLoginId(String loginId);}JPARepository ë¥¼ ìƒì†í•˜ëŠ” ë² ì´ìŠ¤ëª¨ë¸ ë¦¬í¬ì§€í† ë¦¬ì´ë©° í…Œì´ë¸” ì—”í‹°í‹°ë“¤ì€ ì´ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ìƒì†í•˜ëŠ” ë˜í•˜ë‚˜ì˜ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.3. ë¡œê·¸ì¸ ë§¤ë‹ˆì €public interface KcLoginManager&lt;T extends KcAccountBaseModel, R extends KcAccountRepository&lt;T, ?&gt;&gt; extends UserDetailsService, KcAccountResolver&lt;T&gt; { Collection&lt;? extends GrantedAuthority&gt; getAuthorities(); int getMaxLoginAttemptCount(); int getMaxLongTermNonUseAllowDay(); @Transactional(readOnly = true) T findByLoginId(String loginId); @Transactional void updateOnLoginSuccess(String loginId); @Transactional int updateLoginAttemptAccount(String loginId); @Transactional void lockAccount(String loginId);}Spring Securityë¥¼ ì ‘í•´ë³´ì…¨ë‹¤ë©´ í•œë²ˆì¯¤ì€ ë´¤ì„ loadUserByUsername(String username) ë©”ì†Œë“œë¥¼ ê°€ì§€ê³ ìˆëŠ” ì¸í„°ë„¤ì´ìŠ¤ëŠ” UserDetailsServiceë¥¼ ìƒì†í•˜ëŠ” ë¡œê·¸ì¸ ë§¤ë‹ˆì € ì¸í„°í˜ì´ìŠ¤ ì…ë‹ˆë‹¤.ë’¤ì— ë³´ë©´ KcAccountResolverë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ì•˜ëŠ”ë°ìš”, ì´ê²ƒì€ í•µì‹¬ ì½”ë“œ ì‘ì„± ì´í›„ ì„¤ëª…í•  ì˜ˆì •ì…ë‹ˆë‹¤.public interface KcAccountResolver&lt;T extends KcAccountBaseModel&gt; { T getAccountBySecurityAccount(KcSecurityAccount securityAccount);}ì´ëŸ° í˜•íƒœë¼ëŠ”ê²ƒë§Œ ì•Œì•„ë‘ì‹œë©´ ì¢‹ì„ê²ƒ ê°™ìŠµë‹ˆë‹¤.ë‹¤ìŒì€ ë¡œê·¸ì¸ ë§¤ë‹ˆì €ë¥¼ êµ¬í˜„í•˜ëŠ” ê¸°ë³¸ ë¡œê·¸ì¸ ë§¤ë‹ˆì € í´ë˜ìŠ¤ ì…ë‹ˆë‹¤.public abstract class KcDefaultLoginManager&lt;T extends KcAccountBaseModel, R extends KcAccountRepository&lt;T, ?&gt;&gt; implements KcLoginManager&lt;T, R&gt; { private final R repo; public KcDefaultLoginManager(R r) { this.repo = r; } public abstract Collection&lt;? extends GrantedAuthority&gt; getAuthorities(); public abstract int getMaxLoginAttemptCount(); public abstract int getMaxLongTermNonUseAllowDay(); public abstract UserDetails loadUserByUsername(String username) throws UsernameNotFoundException; @Override public T findByLoginId(String loginId) { return repo.findByLoginId(loginId); } @Override public void updateOnLoginSuccess(String loginId) { var account = this.findByLoginId(loginId); Assert.notNull(account, \"account must not be null!\"); var now = LocalDateTime.now(); account.setDtLastAccessedAt(now); account.setDtLastLoggedInAt(now); account.setLoginAttemptCount(0); repo.save(account); } @Override public int updateLoginAttemptAccount(String loginId) { var account = this.findByLoginId(loginId); if (account == null) { return -1; } var currentCount = account.getLoginAttemptCount(); var targetCount = currentCount + 1; if (targetCount &gt;= this.getMaxLoginAttemptCount()) { // ì ê¶ˆì•¼ í•œë‹¤ë©´ ë¡œê·¸ì¸ì‹œë„ëŠ” ì´ˆê¸°í™”í•œë‹¤. targetCount = 0; account.setAccountNonLocked(false); } account.setLoginAttemptCount(targetCount); repo.save(account); return targetCount; } @Override public void lockAccount(String loginId) { var account = this.findByLoginId(loginId); Assert.notNull(account, \"account must not be null!\"); account.setAccountNonLocked(false); repo.save(account); } @Override public T getAccountBySecurityAccount(KcSecurityAccount securityAccount) { return this.findByLoginId(securityAccount.getLoginId()); }}ì¶”ìƒë©”ì†Œë“œë¡œ ì„ ì–¸ëœ ë©”ì†Œë“œë“¤ì€ ì—”í‹°í‹°ë³„, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë³„ë¡œ ë‹¤ë¥¼ìˆ˜ ìˆëŠ” ë¶€ë¶„ì´ê¸° ë•Œë¬¸ì— ë”°ë¡œ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. (ì˜ˆ - ê´€ë¦¬ìëŠ” ë¡œê·¸ì¸ì‹œë„ 3íšŒ í—ˆìš©, ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ì‹œë„ 5íšŒ í—ˆìš© ë“±)ê·¸ ì™¸ ê³„ì • ì ê¸ˆì´ë‚˜ ë¡œê·¸ì¸ íšŸìˆ˜ ê´€ë¦¬ë“± ì œê°€ ìƒê°í–ˆì„ë•Œ ë¡œê·¸ì¸ì— ìˆì–´ ê°€ì¥ ê¸°ë³¸ì´ë¼ ìƒê°ë˜ëŠ” ë¶€ë¶„ì„ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.4. ì¸ì¦ í”„ë¡œë°”ì´ë”ë‹¤ìŒì€ ì¸ì¦ í”„ë¡œë°”ì´ë”ì…ë‹ˆë‹¤. AbstractUserDetailsAuthenticationProvider ë¥¼ ìƒì†ë°›ì€ í´ë˜ìŠ¤ì´ë©° PasswordEncoderì™€ UserDetailsServiceë¥¼ ìƒì„±ìë¡œ ì£¼ì…ë°›ìŠµë‹ˆë‹¤.ì•„ê¹Œ ê¸°ë³¸ ë¡œê·¸ì¸ ë§¤ë‹ˆì €ë¥¼ ì‘ì„±í• ë•Œ loadUserByUsername() ë©”ì†Œë“œë¥¼ êµ¬í˜„í•´ì•¼ í–ˆì§€ë§Œ ëŒ€ë¶€ë¶„ ì—”í‹°í‹°ë³„ë¡œ ë‹¤ë¥¸ ë¡œì§ì„ ì ìš©í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì¶”ìƒ ë©”ì†Œë“œë¡œ ë‘ì—ˆì§€ìš”? ë°”ë¡œ ê·¸ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ UserDetailsServiceë¥¼ ì£¼ì…ë°›ìŠµë‹ˆë‹¤.ë˜í•œ AbstractUserDetailsAuthenticationProvider í´ë˜ìŠ¤ì˜ 2ê°œì˜ ì¶”ìƒ ë©”ì†Œë“œë¥¼ ì¬ì •ì˜ í•©ë‹ˆë‹¤. ì‚¬ìš©í•˜ëŠ” ìš©ë„ì— ë”°ë¼ ë‹¤ë¥¸ ë©”ì†Œë“œë“¤ë„ ì¬ì •ì˜ í• ìˆ˜ ìˆê² ë„¤ìš”.public class KcAuthenticationProvider extends AbstractUserDetailsAuthenticationProvider { private final PasswordEncoder passwordEncoder; @Getter private final UserDetailsService userDetailsService; public KcAuthenticationProvider(PasswordEncoder passwordEncoder, UserDetailsService userDetailsService) { this.passwordEncoder = passwordEncoder; this.userDetailsService = userDetailsService; } @Override protected void additionalAuthenticationChecks(UserDetails userDetails, UsernamePasswordAuthenticationToken authentication) throws AuthenticationException { if (authentication.getCredentials() == null) { throw new BadCredentialsException(messages.getMessage(\"AbstractUserDetailsAuthenticationProvider.badCredentials\", \"Bad credentials\")); } var passedPassword = authentication.getCredentials().toString(); if (!passwordEncoder.matches(passedPassword, userDetails.getPassword())) { throw new BadCredentialsException(messages.getMessage(\"AbstractUserDetailsAuthenticationProvider.badCredentials\", \"Bad credentials\")); } } @Override protected UserDetails retrieveUser(String username, UsernamePasswordAuthenticationToken authentication) throws AuthenticationException { UserDetails loadedUser; try { loadedUser = this.userDetailsService.loadUserByUsername(username); } catch (UsernameNotFoundException notFoundException) { throw notFoundException; } catch (Exception ex) { throw new InternalAuthenticationServiceException(ex.getMessage(), ex); } if (loadedUser == null) { throw new InternalAuthenticationServiceException(\"DefaultUserDetailsService returned null, it must be not null!\"); } return loadedUser; }}5. ì¸ì¦ í”„ë¡œë°”ì´ë” ë§¤ë‹ˆì €ì¸ì¦ í”„ë¡œë°”ì´ë”ë“¤ì„ ê´€ë¦¬í•  ë§¤ë‹ˆì € í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.public class KcAuthenticationProviderManagerImpl implements KcAuthenticationProviderManager { private final Map&lt;Class&lt;?&gt;, KcAuthenticationProvider&gt; authenticationProviderMap = new HashMap&lt;&gt;(); @Override public Collection&lt;KcAuthenticationProvider&gt; getProviders() { return this.authenticationProviderMap.values(); } @Override public KcAuthenticationProvider getAuthenticationProvider(Class&lt;?&gt; accountEntityClass) { return this.authenticationProviderMap.get(accountEntityClass); } public void addAuthenticationProvider(Class&lt;?&gt; accountEntityClass, KcAuthenticationProvider authenticationProvider) { Assert.isTrue(!this.authenticationProviderMap.containsKey(accountEntityClass), \"authenticationProviderMap already has key\"); this.authenticationProviderMap.put(accountEntityClass, authenticationProvider); }}ìœ„ í´ë˜ìŠ¤ëŠ” ì¶”í›„ ì‚¬ìš©í•  ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ bean ìœ¼ë¡œ ë“±ë¡ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ê°ê°ì˜ ì—”í‹°í‹°ì™€ ì¸ì¦ í”„ë¡œë°”ì´ë”ë¥¼ addAuthenticationProvider ë©”ì†Œë“œë¥¼ í†µí•´ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤. (ì´ëŠ” ì˜ˆì œ ì‘ì„±í• ë•Œ ë‹¤ë£¨ê²Œ ë©ë‹ˆë‹¤.)6. JWT í”„ë¡œë°”ì´ë”Spring SecurityëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì„¸ì…˜ ë°©ì‹ì…ë‹ˆë‹¤. ë‹¤ë§Œ ì„¸ì…˜ ì‚¬ìš©ì´ ì œì•½ë˜ëŠ” í™˜ê²½ì´ ìˆì„í…ë°ìš”. ì˜ˆë¥¼ ë“¤ì–´ ì œ ê²½ìš° ì•±ê°œë°œì„ í•˜ëŠ”ë° ì„¸ì…˜ì´ ì˜ë„í•œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•Šì•„ ëª‡ì¼ë™ì•ˆ ì• ë¨¹ì€ ì ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ° ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬ jwt í† í°ë°©ì‹ìœ¼ë¡œ ì¸ì¦í•˜ëŠ” ëŒ€ë¹„ì±…ì„ ì„¸ì›Œë³´ì•˜ìŠµë‹ˆë‹¤. ì£¼ì˜! ì´ í¬ìŠ¤íŒ…ì—ì„œëŠ” refresh tokenì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  1ê°œì˜ ì˜¤ë¦¬ì§€ë„ í† í°ë§Œì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì˜¤ë¦¬ì§€ë„ í† í°ì˜ ìœ íš¨ê¸°ê°„ì„ ê¸¸ê²Œ ì¡ê±°ë‚˜ refresh token ì¸ì¦ ë°©ì‹ì„ ì¶”ê°€ë¡œ ì ìš©í•´ë³´ì„¸ìš”.public abstract class KcDefaultJwtTokenProvider implements KcJwtTokenProvider { private final UserDetailsService userDetailsService; private final String claimsKeyName = \"loginId\"; private final SecretKey secretKey; public KcDefaultJwtTokenProvider(String secretKey, UserDetailsService userDetailsService) { this.secretKey = Keys.hmacShaKeyFor(secretKey.getBytes(StandardCharsets.UTF_8)); this.userDetailsService = userDetailsService; } public abstract long getExpireDays(); public abstract String getCookieName(); @Override public Authentication getAuthentication(String token) { var claims = this.getClaims(token); var loginId = claims.get(this.claimsKeyName, String.class); if (!StringUtils.hasText(loginId)) { return null; } var userDetails = userDetailsService.loadUserByUsername(loginId); return new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities()); } @Override public String resolveToken(HttpServletRequest request) { var cookies = request.getCookies(); if (cookies != null) { for (var cookie: cookies) { if (this.getCookieName().equals(cookie.getName())) { return cookie.getValue(); } } } return null; } @Override public String createToken(KcSecurityAccount securityAccount) { var claims = Jwts.claims().setSubject(UUID.randomUUID().toString()); claims.put(this.claimsKeyName, securityAccount.getLoginId()); claims.put(\"data\", securityAccount.getData()); var limit = LocalDateTime.now().plusDays(this.getExpireDays()); var date = new Date(); return Jwts.builder().setClaims(claims) .setIssuedAt(date) .setExpiration(Date.from(limit.atZone(ZoneId.systemDefault()).toInstant())) .signWith(this.secretKey, SignatureAlgorithm.HS256) .compact(); } @Override public boolean isValidate(String jwtToken) { if (!StringUtils.hasText(jwtToken)) { return false; } try { var claims = this.getClaims(jwtToken); return claims.getExpiration().after(new Date()); } catch (Exception e) { // ExpiredJwtException, MalformedJwtException, SignatureException ì´ ë„˜ì–´ì˜¬ìˆ˜ ìˆë‹¤. // ë§Œë£Œê°€ ë˜ì—ˆë‹¤ë©´ ì•„ì˜ˆ ì˜ˆì™¸ê°€ ë„˜ì–´ì˜¬ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì˜ˆì™¸ì²˜ë¦¬ ë¸”ë¡ìœ¼ë¡œ ë¬¶ê³  falseë¥¼ ë¦¬í„´í•¨. return false; } } private Claims getClaims(String jwtToken) { return Jwts .parserBuilder() .setSigningKey(this.secretKey) .build() .parseClaimsJws(jwtToken) .getBody(); }}ìœ íš¨ê¸°ê°„ getExpiresDays()ì™€ ì¿ í‚¤ ì´ë¦„ getCookieName()ì€ ì¶”ìƒë©”ì†Œë“œë¡œ ì„ ì–¸í•˜ì˜€ìŠµë‹ˆë‹¤. jwt í† í° ê´€ë ¨í•´ì„œëŠ” jjwt ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.7. jwt ì¸ì¦ í•„í„°jwt ì¸ì¦ì„ ì‚¬ìš©í•˜ë ¤ë©´ ê²°êµ­ í•„í„°ë‹¨ì—ì„œ cookieë¥¼ íŒŒì‹±í•˜ì—¬ SecurityContextHolder ì— ê°ì²´ë¥¼ ì„¸íŒ…í•´ì¤˜ì•¼ í•˜ëŠ”ë°ìš”, ì´ë¥¼ìœ„í•œ ê³µìš© í•„í„° ì½”ë“œë¥¼ ì‘ì„± í•˜ê² ìŠµë‹ˆë‹¤.public class KcJwtAuthenticationFilter extends GenericFilterBean { private final KcJwtTokenProvider jwtTokenProvider; public KcJwtAuthenticationFilter(KcJwtTokenProvider jwtTokenProvider) { this.jwtTokenProvider = jwtTokenProvider; } @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException { var token = this.jwtTokenProvider.resolveToken((HttpServletRequest) request); if (this.jwtTokenProvider.isValidate(token)) { var authentication = this.jwtTokenProvider.getAuthentication(token); SecurityContextHolder.getContext().setAuthentication(authentication); } chain.doFilter(request, response); }}8. ë¡œê·¸ì¸ ì„œë¹„ìŠ¤ë§ˆì§€ë§‰ í•µì‹¬ ì½”ë“œì¸ ë¡œê·¸ì¸ ì„œë¹„ìŠ¤ ì…ë‹ˆë‹¤.public abstract class KcDefaultLoginService&lt;T extends KcAccountBaseModel, R extends KcAccountRepository&lt;T, ?&gt;&gt; implements KcLoginService&lt;T, R&gt; { private final Logger logger = LoggerFactory.getLogger(getClass()); private final KcAuthenticationProviderManager authenticationProviderManager; private final KcLoginManager&lt;T, R&gt; accountLoginManager; private final KcJwtTokenProvider jwtTokenProvider; private boolean isUseJwtToken = false; public KcDefaultLoginService(KcAuthenticationProviderManager authenticationProviderManager, KcLoginManager&lt;T, R&gt; accountLoginManager, KcJwtTokenProvider jwtTokenProvider) { this.authenticationProviderManager = authenticationProviderManager; this.accountLoginManager = accountLoginManager; this.jwtTokenProvider = jwtTokenProvider; // jwtTokenProviderê°€ ì£¼ì…ë˜ì—ˆë‹¤ë©´ jwt token ë°©ì‹ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë¼ê³  ê°„ì£¼í•œë‹¤. if (this.jwtTokenProvider != null) { this.isUseJwtToken = true; } } public abstract Class&lt;T&gt; getAccountEntityClass(); @Override public Object login(HttpServletResponse response, String loginId, String password) { Authentication authentication; var token = new UsernamePasswordAuthenticationToken(loginId, password); try { var authenticationProvider = authenticationProviderManager.getAuthenticationProvider(getAccountEntityClass()); // ì½”ë”© ì˜ëª»ì„. beanì— ì—”í‹°í‹° í´ë˜ìŠ¤ / ë§¤ë‹ˆì € ë“±ë¡ ì•ˆí•¨. if (authenticationProvider == null) { logger.error(\"system error: authentication provider manager doesn't have target entity class. check your bean configuration\"); throw new KcSystemException(); } authentication = authenticationProvider.authenticate(token); // ì—¬ê¸°ê¹Œì§€ ë“¤ì–´ì™”ìœ¼ë©´ ì•„ì´ë”” / ë¹„ë°€ë²ˆí˜¸ëŠ” ì¼ì¹˜í•œë‹¤ëŠ” ì˜ë¯¸ì„ // ê³„ì •ì„ ì ê¸ˆì²˜ë¦¬í•˜ëŠ” batch ë”°ë¡œ ëŒì•„ì•¼ í•˜ê² ì§€ë§Œ ëŒê¸° ì „ì— ì´ê³³ì— ë“¤ì–´ì™”ë‹¤ê³  ê°€ì •í•˜ê³  ì¥ê¸° ë¯¸ì ‘ì† ê³„ì • ì ê¸ˆì²˜ë¦¬ if (this.isLongTermNotUsed(loginId)) { accountLoginManager.lockAccount(loginId); throw new LockedException(\"account locked\"); } // jwt ì¸ì¦ì€ ë³„ë„ë¡œ êµ¬í˜„í•œ ì¸ì¦ê³¼ì •ì„ ê±°ì³ì•¼ í•œë‹¤ëŠ” ëœ». if (!this.isUseJwtToken) { SecurityContextHolder.getContext().setAuthentication(authentication); } } catch (BadCredentialsException ex) { var cnt = accountLoginManager.updateLoginAttemptAccount(loginId); // ê³„ì • ì—†ìŒ if (cnt == -1) { throw new KcLoginFailureException(); } else { throw new KcLoginFailureException(cnt, accountLoginManager.getMaxLoginAttemptCount()); } } catch (LockedException ex) { // ê³„ì •ì´ ì ê¸´ ì´ìœ ëŠ” ì¼ë‹¨ 2ê°€ì§€ë¼ê³  ìƒê°í•¨. // 1. NíšŒ ë¹„ë°€ë²ˆí˜¸ í‹€ë¦° ê²½ìš° // 2. ì¥ê¸° ë¯¸ì ‘ì† // ë”°ë¼ì„œ ì¥ê¸° ë¯¸ì ‘ì† ì—¬ë¶€ íŒë‹¨í•´ì•¼í•¨. if (isLongTermNotUsed(loginId)) { throw new KcAccountLongTermNotUsedException(); } throw new KcAccountLockedException(); } catch (DisabledException ex) { throw new KcAccountDisabledException(); } catch (KcSystemException ex) { throw new KcSystemException(); } catch (Exception ex) { throw new KcLoginFailureException(\"login failure\"); } accountLoginManager.updateOnLoginSuccess(token.getPrincipal().toString()); var securityUser = (KcSecurityAccount) authentication.getPrincipal(); if (this.isUseJwtToken) { var jwtToken = this.jwtTokenProvider.createToken(securityUser); // í† í°ì„ ì¿ í‚¤ì— ì €ì¥í•œë‹¤. ì´ë•Œ ì´ë¦„ì€ tokenProviderì— ì •ì˜í•´ë‘” ì´ë¦„ì„ ì‚¬ìš©í•œë‹¤. // í•„í„°ê°€ ê·¸ ì´ë¦„ì„ ì•Œìˆ˜ ìˆì–´ì•¼ í•˜ëŠ”ë°, ì—¬ê¸°ì„œëŠ” KcDefaultJwtTokenProviderì—ë„ ë™ì¼í•œ jwtTokenProviderë¥¼ ì£¼ì…ë°›ê²Œ í•´ë‘ì—ˆë‹¤. // êµ¬í˜„í•˜ëŠ” ì‚¬ëŒ ë§˜ëŒ€ë¡œ í•˜ë©´ ëœë‹¤. ì–´ì¨Œë“  ì´ ì¿ í‚¤ ì´ë¦„ì„ í•„í„°ê°€ ì•Œì•„ì•¼ í•œë‹¤. var cookie = ResponseCookie.from(this.jwtTokenProvider.getCookieName(), jwtToken) .sameSite(\"None\") .httpOnly(true) .secure(true) .maxAge(this.jwtTokenProvider.getExpireDays() * 86400) .build(); response.addHeader(\"Set-Cookie\", cookie.toString()); return jwtToken; } return securityUser.getData(); } /** * ì¥ê¸° ë¯¸ì ‘ì†ì—¬ë¶€ íŒë‹¨ * * @param loginId * @return true if not use for long time */ private boolean isLongTermNotUsed(String loginId) { var account = accountLoginManager.findByLoginId(loginId); var maxLongTermNonUseAllowDay = accountLoginManager.getMaxLongTermNonUseAllowDay(); if (account != null) { if (maxLongTermNonUseAllowDay &gt; 0) { if (account.getDtLastAccessedAt() != null) { if (account.getDtLastAccessedAt().plusDays(maxLongTermNonUseAllowDay).isBefore(LocalDateTime.now())) { return true; } } } } return false; }}jwt í† í° í”„ë¡œë°”ì´ë”ê°€ ì£¼ì…ë˜ì—ˆë‹¤ë©´ jwt ì¸ì¦ë°©ì‹ì„ ì‚¬ìš©í•œë‹¤ê³  ì²´í¬í•©ë‹ˆë‹¤. ë˜í•œ jwt ì¸ì¦ë°©ì‹ì„ ì‚¬ìš©í•œë‹¤ë©´ ` SecurityContextHolder.getContext().setAuthentication()` ì„ í†µí•´ ì„¸ì…˜ì— ì¸ì¦ì •ë³´ë¥¼ ì €ì¥í•˜ì§€ ì•Šê³  ì¿ í‚¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.ë˜í•œ ì¥ê¸°ë¯¸ì ‘ì† ì—¬ë¶€ íŒë‹¨ì„ ê¸°ë³¸ì ìœ¼ë¡œ í•˜ê²Œ í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ ë˜í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ë”°ë¼ ì¬ì •ì˜ ë ìˆ˜ ìˆê² ë„¤ìš”.ì˜ˆì œ ì‘ì„±ê°„ë‹¨í•œ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì˜ˆì œë¥¼ ì‘ì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤.ê´€ë¦¬ì ì™€ ì¼ë°˜ ì‚¬ìš©ìê°€ ìˆìŠµë‹ˆë‹¤. ì´ì¤‘ ê´€ë¦¬ìëŠ” jwt í† í° ì¸ì¦ ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.1. ì—”í‹°í‹° ëª¨ë¸KcAccountBaseModelì„ ìƒì†ë°›ëŠ” ì—”í‹°í‹° ëª¨ë¸ì„ ì‘ì„±í•©ë‹ˆë‹¤.@EqualsAndHashCode(callSuper = false, onlyExplicitlyIncluded = true)@Data@Entity@Table(name = \"ADMIN_ACCOUNT\")public class AdminAccount extends KcAccountBaseModel { @Id @GeneratedValue(strategy = GenerationType.AUTO) private Long id;}@EqualsAndHashCode(callSuper = false, onlyExplicitlyIncluded = true)@Data@Entity@Table(name = \"USER_ACCOUNT\")public class UserAccount extends KcAccountBaseModel { @Id @GeneratedValue(strategy = GenerationType.AUTO) private Long id;}2. ë¦¬í¬ì§€í† ë¦¬KcAccountRepositoryë¥¼ ìƒì†ë°›ëŠ” ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.@Repositorypublic interface AdminAccountRepository extends KcAccountRepository&lt;AdminAccount, Long&gt; {}@Repositorypublic interface UserAccountRepository extends KcAccountRepository&lt;UserAccount, Long&gt; {}3. ë¡œê·¸ì¸ ë§¤ë‹ˆì €KcDefaultLoginManager ë¥¼ ìƒì†ë°›ëŠ” ë¡œê·¸ì¸ ë§¤ë‹ˆì €ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.ë¡œê·¸ì¸ ë§¤ë‹ˆì €ë¥¼ ì‘ì„±í•˜ê¸° ì „ KcSeurityAccount ê°ì²´ì˜ dataì— ë“¤ì–´ê°ˆ ê°ì²´ë¥¼ ì •ì˜í•˜ê² ìŠµë‹ˆë‹¤.@Datapublic class LoginAccountData { private String loginId; private LoginAccountType loginAccountType; private Set&lt;String&gt; authorities;}ë‹¤ìŒì€ ì—”í‹°í‹°ë³„ ë¡œê·¸ì¸ ë§¤ë‹ˆì € ì…ë‹ˆë‹¤.@Componentpublic class AdminLoginManager extends KcDefaultLoginManager&lt;AdminAccount, AdminAccountRepository&gt; { public AdminLoginManager(AdminAccountRepository adminAccountRepository) { super(adminAccountRepository); } @Override public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() { var set = new HashSet&lt;String&gt;(); set.add(AccountRoleCode.ROLE_COMMON); set.add(AccountRoleCode.ROLE_ADMIN); return set.stream().map(SimpleGrantedAuthority::new).collect(Collectors.toList()); } @Override public int getMaxLoginAttemptCount() { return 5; } @Override public int getMaxLongTermNonUseAllowDay() { return 90; } @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException { if (!StringUtils.hasText(username)) { throw new UsernameNotFoundException(\"Username must be provided!\"); } var account = this.findByLoginId(username); if (account == null) { throw new UsernameNotFoundException(\"Username not found, username=\" + username); } var authorities = this.getAuthorities(); var loginData = new LoginAccountData(); loginData.setLoginId(account.getLoginId()); loginData.setLoginAccountType(LoginAccountType.ADMIN); loginData.setAuthorities(authorities.stream().map(GrantedAuthority::getAuthority).collect(Collectors.toSet())); return new KcSecurityAccount( AdminAccount.class, account.getLoginId(), account.getPassword(), new HashSet&lt;&gt;(authorities), account.isAccountNonExpired(), account.isAccountNonLocked(), account.isCredentialsNonExpired(), account.isEnabled(), loginData ); }}@Componentpublic class UserLoginManager extends KcDefaultLoginManager&lt;UserAccount, UserAccountRepository&gt; { public UserLoginManager(UserAccountRepository userAccountRepository) { super(userAccountRepository); } @Override public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() { var set = new HashSet&lt;String&gt;(); set.add(AccountRoleCode.ROLE_COMMON); set.add(AccountRoleCode.ROLE_USER); return set.stream().map(SimpleGrantedAuthority::new).collect(Collectors.toList()); } @Override public int getMaxLoginAttemptCount() { return 3; } @Override public int getMaxLongTermNonUseAllowDay() { return 30; } @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException { if (!StringUtils.hasText(username)) { throw new UsernameNotFoundException(\"Username must be provided!\"); } var account = this.findByLoginId(username); if (account == null) { throw new UsernameNotFoundException(\"Username not found, username=\" + username); } var authorities = this.getAuthorities(); var loginData = new LoginAccountData(); loginData.setLoginId(account.getLoginId()); loginData.setLoginAccountType(LoginAccountType.USER); loginData.setAuthorities(authorities.stream().map(GrantedAuthority::getAuthority).collect(Collectors.toSet())); return new KcSecurityAccount( UserAccount.class, account.getLoginId(), account.getPassword(), new HashSet&lt;&gt;(authorities), account.isAccountNonExpired(), account.isAccountNonLocked(), account.isCredentialsNonExpired(), account.isEnabled(), loginData ); }}ì—¬ê¸°ì„œ GrantedAuthority ì— í•´ë‹¹ë˜ëŠ” roleë“¤ì€ ê·¸ëƒ¥ ì¼ë°˜ String textë¡œ ë¶€ì—¬í•´ë„ ë˜ì§€ë§Œ, ì œ ê²½ìš° ì•„ë˜ì™€ ê°™ì´ ìƒìˆ˜ë§Œ ê°€ì§€ê³  ìˆëŠ” í´ë˜ìŠ¤ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.public class AccountRoleCode { public static final String ROLE_COMMON = \"ROLE_COMMON\"; public static final String ROLE_ADMIN = \"ROLE_ADMIN\"; public static final String ROLE_USER = \"ROLE_USER\";}ì´ë ‡ê²Œ ê´€ë¦¬í•˜ëŠ” í¸ì´ ì¶”í›„ hasAuthority()ë¡œ ê²½ë¡œ ê¶Œí•œ ì²´í¬í•˜ëŠ” ì½”ë“œì—ì„œ ì´ì ì„ ê°€ì§ˆìˆ˜ ìˆì„ ê²ƒì´ë¼ ìƒê°í–ˆìŠµë‹ˆë‹¤.4. bean ì£¼ì…ë‹¤ìŒì€ KcAccountResolverManager ì™€ ê´€ë¦¬ì ì—”í‹°í‹° ì¸ì¦ì—ì„œ ì‚¬ìš©ë  KcJwtTokenProvider ë¥¼ beanìœ¼ë¡œ ì£¼ì…í•´ì•¼ í•©ë‹ˆë‹¤. PasswordEncoderì˜ ê²½ìš° BcryptPasswordEncoderë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.@Configurationpublic class SecurityBeanContainer { private static final String JWT_SECRET_KEY = \"Qi0P4mU8ABq6M9nMZG5y67E6hmNad14n\"; @Autowired AdminLoginManager adminAccountLoginManager; @Autowired UserLoginManager userLoginManager; @Bean public BCryptPasswordEncoder bCryptPasswordEncoder() { return new BCryptPasswordEncoder(); } @Bean public KcAuthenticationProviderManager authenticationProviderManager() { var authenticationProviderManager = new KcAuthenticationProviderManagerImpl(); authenticationProviderManager.addAuthenticationProvider( AdminAccount.class, new KcAuthenticationProvider(this.bCryptPasswordEncoder(), this.adminAccountLoginManager) ); authenticationProviderManager.addAuthenticationProvider( UserAccount.class, new KcAuthenticationProvider(this.bCryptPasswordEncoder(), this.userLoginManager) ); return authenticationProviderManager; } @Bean(\"adminJwtTokenProvider\") public KcJwtTokenProvider adminJwtTokenProvider() { return new KcDefaultJwtTokenProvider(JWT_SECRET_KEY, this.adminAccountLoginManager) { @Override public long getExpireDays() { return 30; } @Override public String getCookieName() { return \"KEENCHO_JWT_TOKEN\"; } }; }}JWT_SECRET_KEY ì˜ ê²½ìš° ì´ê³³ì—ì„œëŠ” ìƒìˆ˜ë¡œ ì„ ì–¸í•˜ì˜€ì§€ë§Œ ë”°ë¡œ .properties ë‚˜ .yml ì„¤ì •íŒŒì¼ë¡œ ë¹¼ëŠ” í¸ì´ ë³´ì•ˆìƒ ì¢‹ì„ê²ƒ ê°™ìŠµë‹ˆë‹¤.ê°ê°ì˜ ë¡œê·¸ì¸ ì„œë¹„ìŠ¤ë¥¼ ì‘ì„±í• ë•Œ KcJwtTokenProviderë¥¼ ì£¼ì…ë°›ì•„ì•¼ í•˜ëŠ”ë° @AutowiredëŠ” ì‚¬ìš©í•˜ì§€ ëª»í•˜ê³  @Qualifierë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— KcJwtTokenProviderì˜ ê²½ìš° ë³„ë„ì˜ ì´ë¦„ì„ ë¶€ì—¬í•˜ì˜€ìŠµë‹ˆë‹¤.5. ë¡œê·¸ì¸ ì„œë¹„ìŠ¤ë‹¤ìŒì€ ë¡œê·¸ì¸ ì„œë¹„ìŠ¤ ì…ë‹ˆë‹¤. ì•ì„œ ë§í•œëŒ€ë¡œ ê´€ë¦¬ìì˜ ê²½ìš° KcJwtTokenProviderë¥¼ ìƒì„±ì ìƒì„±ì‹œ ì£¼ì…í•©ë‹ˆë‹¤.@Servicepublic class AdminLoginService extends KcDefaultLoginService&lt;AdminAccount, AdminAccountRepository&gt; { public AdminLoginService( KcAuthenticationProviderManager authenticationProviderManager, AdminLoginManager accountLoginManager, @Qualifier(\"adminJwtTokenProvider\") KcJwtTokenProvider jwtTokenProvider ) { super(authenticationProviderManager, accountLoginManager, jwtTokenProvider); } @Override public Class&lt;AdminAccount&gt; getAccountEntityClass() { return AdminAccount.class; }}@Servicepublic class UserLoginService extends KcDefaultLoginService&lt;UserAccount, UserAccountRepository&gt; { public UserLoginService( KcAuthenticationProviderManager authenticationProviderManager, UserLoginManager accountLoginManager ) { super(authenticationProviderManager, accountLoginManager, null); } @Override public Class&lt;UserAccount&gt; getAccountEntityClass() { return UserAccount.class; }}6. ì›¹ ì˜ˆì œì²«ì§¸ë¡œ ì»¤ìŠ¤í…€ securityFilterChainì„ beanìœ¼ë¡œ ì£¼ì…í•©ë‹ˆë‹¤. ì°¸ê³ ë¡œ Spring Security ìµœì‹ ë²„ì „ì—ì„œëŠ” WebSecurityConfigurerAdapter ê°€ deprecatedë˜ì—ˆê³  ì´ì œëŠ” ê·¸ëƒ¥ beanìœ¼ë¡œ ì£¼ì…í•˜ë©´ ë©ë‹ˆë‹¤.@Configuration@EnableWebSecuritypublic class WebSecurityConfiguration { @Autowired KcAuthenticationProviderManager kcAuthenticationProviderManager; @Autowired KcJwtTokenProvider kcJwtTokenProvider; @Bean public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception { for (var provider : kcAuthenticationProviderManager.getProviders()) { http.authenticationProvider(provider); } // POST ìš”ì²­ ì˜¤í”ˆ http.csrf().disable(); http.headers().frameOptions().disable(); http.httpBasic().disable(); // jwt token ì¸ì¦ë¶€ í•„í„°ë“±ë¡ http.addFilterBefore(new KcJwtAuthenticationFilter(kcJwtTokenProvider), UsernamePasswordAuthenticationFilter.class); http .antMatcher(\"/**\").authorizeRequests() // .antMatchers(\"/api/auth/test/admin\").hasAuthority(AccountRoleCode.ROLE_ADMIN) // .antMatchers(\"/api/auth/test/user\").hasAuthority(AccountRoleCode.ROLE_USER) // .antMatchers(\"/**\").permitAll() // .anyRequest().authenticated(); return http.build(); }}api/auth/test/** ì˜ ê²½ìš° ê°ê° ê²½ë¡œì— ë”°ë¼ roleì„ ê°€ì§„ ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•˜ì˜€ìŠµë‹ˆë‹¤.ë‹¤ìŒì€ ë¡œê·¸ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ ë¶€ë¶„ì…ë‹ˆë‹¤.@RestController@RequestMapping(\"/api\")public class ApiController { @Autowired List&lt;KcLoginService&lt;? extends KcAccountBaseModel, ? extends KcAccountRepository&lt;?, ?&gt;&gt;&gt; kcLoginService; Map&lt;Class&lt;? extends KcAccountBaseModel&gt;, KcLoginService&lt;? extends KcAccountBaseModel, ? extends KcAccountRepository&lt;?, ?&gt;&gt;&gt; loginServiceMap; @PostConstruct public void initMap() { loginServiceMap = new HashMap&lt;&gt;(); for (var svc : kcLoginService) { loginServiceMap.put(svc.getAccountEntityClass(), svc); } } @PostMapping(\"/login\") public Object login( @RequestBody Map&lt;String, String&gt; map, @RequestParam String type, HttpServletResponse response ) { var id = map.get(\"id\"); var pw = map.get(\"pw\"); var clazz = \"admin\".equals(type) ? AdminAccount.class : UserAccount.class; return this.loginServiceMap.get(clazz).login(response, id, pw); } @GetMapping(\"/auth/test/admin\") public String authTestAdmin() { return \"success\"; } @GetMapping(\"/auth/test/user\") public String authTestUser() { return \"success\"; }}ìµœì´ˆ ì‹œì‘ì‹œ ê°ê°ì˜ ë¡œê·¸ì¸ ì„œë¹„ìŠ¤ë“¤ì„ mapì— ë„£ì–´ ë¡œê·¸ì¸ì‹œ ì—”í‹°í‹°ë¥¼ í†µí•´ ì˜¬ë°”ë¥¸ ì„œë¹„ìŠ¤ë¥¼ ì°¾ì•„ê°ˆ ìˆ˜ ìˆë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.ë§ˆì§€ë§‰ìœ¼ë¡œ ìœ„ apië¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” htmlì„ ë§Œë“¤ì–´ í…ŒìŠ¤íŠ¸í•˜ë©´ ëª¨ë‘ ì™„ë£Œì…ë‹ˆë‹¤. ë‹¤ë§Œ ì—¬ê¸°ì—ì„œëŠ” ë”°ë¡œ ë‹¤ë£¨ì§€ ì•Šê² ìŠµë‹ˆë‹¤. (ê¹ƒí—ˆë¸Œ ë§í¬ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.)ë§ˆë¬´ë¦¬ì»¤ìŠ¤í…€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§Œë“¤ì–´ë³´ë©° Spring Securityì— ëŒ€í•´ ì¡°ê¸ˆë” ìì„¸íˆ ì•Œì•„ë³¼ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ìœ„ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ëŠ” ëª‡ê°œì˜ ë¬¸ì œê°€ ìˆëŠ”ë°ìš”, ê°€ì¥ í° ë¬¸ì œëŠ” ì¤‘ë³µ ì¸ì¦ ë¬¸ì œì…ë‹ˆë‹¤.A ì—”í‹°í‹°ê°€ jwt í† í° ì¸ì¦ë°©ì‹ì„ ì‚¬ìš©í•˜ê³  B ì—”í‹°í‹°ëŠ” ê¸°ì¡´ ì„¸ì…˜ ì¸ì¦ë°©ì‹ì„ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •í–ˆì„ë•Œ, jwt ì¸ì¦ í•„í„°ê°€ í•­ìƒ ì„¸ì…˜ ì¸ì¦ í•„í„° ë’¤ì— ìˆê¸° ë•Œë¬¸ì— Aì™€ B ëª¨ë‘ ë¡œê·¸ì¸ëœ ìƒíƒœí•´ì„œ ì¸ì¦ì„ ì§„í–‰í•˜ë©´ Aë§Œ ì¸ì¦ì´ ë˜ëŠ” ë¬¸ì œê°€ ì¼ì–´ë‚˜ê²Œ ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ëŠ” í•˜ë‚˜ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì¼ë•Œë§Œ ë¬¸ì œê°€ ë˜ë©° ë§Œì•½ ì—”í‹°í‹°ë³„ë¡œ ë‹¤ë¥¸ ëª¨ë“ˆì„ ë§Œë“¤ì–´ ê°ê°ì˜ beanì„ ì£¼ì…ë°›ëŠ” ë°©ì‹ìœ¼ë¡œ ë©€í‹°ëª¨ë“ˆ í”„ë¡œì íŠ¸ë¥¼ êµ¬ì„±í•˜ë©´ ë¬¸ì œê°€ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.ì—¬ê¸°ì„œëŠ” ì„¤ëª…í•˜ì§€ ì•Šì•˜ì§€ë§Œ WebMvcConfigurer ì¸í„°í˜ì´ìŠ¤ì˜ addArgumentResolvers ë©”ì†Œë“œë¥¼ í†µí•´ ControllerAdvice í˜¹ì€ Controllerì˜ ì‹œì‘ì ì— í˜„ì¬ ì¸ì¦ëœ ì¸ì¦ ê°ì²´ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ìˆ˜ ìˆê²Œ í• ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ë“¤ì–´ ì•„ë˜ì™€ ê°™ì´ ë§ì´ì§€ìš”. (ê¹ƒí—ˆë¸Œ ë§í¬ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.)@GetMapping(\"/auth/test/admin\")public AdminAccount authTestAdmin( @KcsAccount(required = true) AdminAccount adminAccount, @KcsAccount(accountType = KcsAccountType.SECURITY_ACCOUNT) KcSecurityAccount securityAccount ) { return adminAccount;}ì–´ì¨Œë“  ì´ í¬ìŠ¤íŒ…ì´ ìì‹ ë§Œì˜ Spring Security ì¸ì¦ì„ êµ¬í˜„í•˜ë ¤ëŠ” ë¶„ë“¤ê»˜ ë„ì›€ì´ ë˜ì—ˆìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. ë¼ì´ë¸ŒëŸ¬ë¦¬: https://github.com/keencho/lib-spring/tree/master/src/main/java/com/keencho/lib/spring/securityì˜ˆì œ: https://github.com/keencho/java-sandbox/tree/master/spring-security" }, { "title": "Hibernate, JPA ì—ì„œ ë°œìƒí•˜ëŠ” Cross Join ë¬¸ì œ í•´ê²°í•˜ê¸°", "url": "/posts/hibernate-cross-join/", "categories": "Hibernate", "tags": "JPA, Hibernate", "date": "2022-07-20 20:12:00 +0900", "snippet": "Hibernate, JPA ì—ì„œ ë°œìƒí•˜ëŠ” Cross Join ë¬¸ì œ í•´ê²°í•˜ê¸°ê°œìš”í‰í™”ë¡­ê²Œ ì½”ë”©í•˜ë˜ ì–´ëŠë‚ , ì¿¼ë¦¬ ê²°ê³¼ê°€ ì˜ë„í•œëŒ€ë¡œ ë¦¬í„´ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤. ì¿¼ë¦¬ì— ë¬¸ì œê°€ ìˆë‚˜ ì‹¶ì–´ ìì„¸íˆ ì‚´í´ë´¤ì§€ë§Œ (queryDSLì„ ì‚¬ìš©ì¤‘ì´ì—ˆìŠµë‹ˆë‹¤.) ìë°” ì½”ë“œìƒì˜ ë¬¸ì œëŠ” ì°¾ì„ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.ë°ì´í„°ë² ì´ìŠ¤ì— ë‚ ë¼ê°€ëŠ” sqlë¬¸ì„ ë³´ê³  ë‚˜ì„œì•¼ ë¬¸ì œë¥¼ ì°¾ì„ìˆ˜ ìˆì—ˆê³  ì´ í¬ìŠ¤íŒ…ì—ì„œëŠ” ê·¸ ë¬¸ì œì™€ í•´ê²° ê³¼ì •ì„ ì ì–´ë³´ë ¤ê³  í•©ë‹ˆë‹¤.Cross Join ë°œìƒë¬¸ì œëŠ” cross join ë°œìƒí•œë‹¤ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤. ë‹¹ì—°íˆ left joinì´ ë°œìƒí•  ê²ƒì´ë¼ê³  ìƒê°í•˜ì˜€ì§€ë§Œ cross joinì´ ë°œìƒí•˜ì—¬ ê²°ê³¼ê°€ ì˜ë„í•œëŒ€ë¡œ ë¦¬í„´ë˜ì§€ ì•Šì€ ê²ƒì´ì§€ìš”.cross joinì€ ë‘ í…Œì´ë¸”ì—ì„œ í–‰ì˜ ëª¨ë“  ì¡°í•©ì„ ë°˜í™˜í•˜ëŠ” joinì…ë‹ˆë‹¤. í•˜ì´ë²„ë„¤ì´íŠ¸ê°€ ì¿¼ë¦¬ë¥¼ ìƒì„±í•˜ëŠ” ê³¼ì •ì— where ì¡°ê±´ì ˆì— cross joinê³¼ ê´€ë ¨ëœ ì¡°ê±´ì´ ì¶”ê°€ë˜ì–´ ì›í•˜ëŠ” ê²°ê³¼ê°€ ë„˜ì–´ì˜¤ì§€ ì•Šì•˜ë˜ ê²ƒì´ì§€ìš”.í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” joinì„ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ì•”ë¬µì ìœ¼ë¡œ cross joinìœ¼ë¡œ ì§€ì •í•˜ëŠ” ê²½í–¥(?) ì´ ì—ˆë‹¤ê³  í•©ë‹ˆë‹¤. í•˜ì´ë²„ë„¤ì´íŠ¸ì˜ ì°½ì‹œìì¸ Gavin King, Christian Bauerì˜ ì±…ì¸ Hibernate in Action ì—ëŠ” ì´ëŸ° ë‚´ìš©ì´ ìˆìŠµë‹ˆë‹¤. Implicit joins are always directed along many-to-one or one-to-one association, never through a collection-valued association.ì•”ë¬µì  joinì€ í•­ìƒ many-to-one í˜¹ì€ one-to-one ì—°ê´€ì„±ì— ë”°ë¼ ê²°ì •ë˜ë©° ì»¬ë ‰ì…˜ ê°’ì— ë”°ë¼ ì§€ì •ë˜ì§€ ì•ŠëŠ”ë‹¤ê³  í•©ë‹ˆë‹¤.ë˜í•œ ëŒ€ë¶€ë¶„ì˜ ë°ì´í„°ë² ì´ìŠ¤ ì—”ì§„ë“¤ì€ cross joinì— ëŒ€í•´ where ì¡°ê±´ì„ ì¶”ê°€í•˜ê¸° ë•Œë¬¸ì— ê²°ê³¼ì ìœ¼ë¡œ cross join / where ì— ì˜í•´ ì›í•˜ëŠ” ê²°ê³¼ê°’ì´ ë‚˜ì˜¤ì§€ ì•Šê²Œ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.ë¬¸ì œ ì¬êµ¬í˜„jpa / querydslì„ ì‚¬ìš©í•´ ë¬¸ì œë¥¼ ì¬êµ¬í˜„ í•´ë³´ê² ìŠµë‹ˆë‹¤.â€˜ì¼â€™ì„ ìœ„í•œ í…Œì´ë¸”ì´ ìˆìŠµë‹ˆë‹¤. ì´ ì¼ì€ ê°œë°œìë‚˜ ì˜ì—…ì‚¬ì›ì—ê²Œ ë°°ì •ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°œë°œìë‚˜ ì˜ì—…ì‚¬ì›ì€ í•œ íšŒì‚¬ì— ì†í•´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.@Entity@Data@AllArgsConstructor@NoArgsConstructor@Table(name = \"COMPANY\")public class Company { @Id @GeneratedValue(strategy = GenerationType.AUTO) private Long id; private String name; public Company(String name) { this.name = name; }}@Entity@Data@AllArgsConstructor@NoArgsConstructor@Table(name = \"DEV_TEAM_MEMBERS\")public class DevTeamMember { @Id @GeneratedValue(strategy = GenerationType.AUTO) private Long id; private String name; @ManyToOne(optional = false, fetch = FetchType.LAZY) @JoinColumn(name = \"COMPANY_ID\", foreignKey = @ForeignKey(name = \"DEV_TEAM_MEMBERS___COMPANY\")) private Company company; public DevTeamMember(String name, Company company) { this.name = name; this.company = company; }}@Entity@Data@AllArgsConstructor@NoArgsConstructor@Table(name = \"SALES_TEAM_MEMBERS\")public class SalesTeamMembers { @Id @GeneratedValue(strategy = GenerationType.AUTO) private Long id; private String name; @ManyToOne(optional = false, fetch = FetchType.LAZY) @JoinColumn(name = \"COMPANY_ID\", foreignKey = @ForeignKey(name = \"FK_SALES_TEAM_MEMBERS___COMPANY\")) private Company company; public SalesTeamMembers(String name, Company company) { this.name = name; this.company = company; }}@Entity@Data@AllArgsConstructor@NoArgsConstructor@Table(name = \"JOB\")public class Job { @Id @GeneratedValue(strategy = GenerationType.AUTO) private Long id; private String name; private LocalDateTime dtCreatedAt = LocalDateTime.now(); @ManyToOne(fetch = FetchType.LAZY) @JoinColumn(name = \"DEV_TEAM_MEMBERS_ID\", foreignKey = @ForeignKey(name = \"FK_JOB___DEV_TEAM_MEMBERS\")) private DevTeamMember devTeamMembers; @ManyToOne(fetch = FetchType.LAZY) @JoinColumn(name = \"SALES_TEAM_MEMBERS_ID\", foreignKey = @ForeignKey(name = \"FK_JOB___SALES_TEAM_MEMBERS\")) private SalesTeamMembers salesTeamMembers; public Job(String name, DevTeamMember devTeamMembers, SalesTeamMembers salesTeamMembers) { if (devTeamMembers == null &amp;&amp; salesTeamMembers == null) { throw new RuntimeException(\"Work must be assigned to one person.\"); } this.name = name; this.devTeamMembers = devTeamMembers; this.salesTeamMembers = salesTeamMembers; }}ìˆœì„œëŒ€ë¡œ íšŒì‚¬, ê°œë°œì, ì˜ì—…ì‚¬ì›, ì¼ ìˆœì„œì…ë‹ˆë‹¤. í…Œì´ë¸”ì„ ë§Œë“¤ì—ˆìœ¼ë‹ˆ repositoryë“¤ì„ ê°ê° ìƒì„±í•©ë‹ˆë‹¤.repositoryë¥¼ ìƒì„±í•˜ì˜€ë‹¤ë©´ testì½”ë“œë¥¼ ì‘ì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤. ì¼ë‹¨ ë”ë¯¸ë°ì´í„° ìƒì„± ì½”ë“œì…ë‹ˆë‹¤.@BeforeEachvoid initDummyData() { var kakao = companyRepository.save(new Company(\"ì¹´ì¹´ì˜¤\")); var naver = companyRepository.save(new Company(\"ë„¤ì´ë²„\")); var kakao_dev_1 = devTeamMembersRepository.save(new DevTeamMember(\"ì¹´ì¹´ì˜¤_ê°œë°œì_1\", kakao)); var kakao_dev_2 = devTeamMembersRepository.save(new DevTeamMember(\"ì¹´ì¹´ì˜¤_ê°œë°œì_2\", kakao)); var naver_dev_1 = devTeamMembersRepository.save(new DevTeamMember(\"ë„¤ì´ë²„_ê°œë°œì_1\", naver)); var naver_dev_2 = devTeamMembersRepository.save(new DevTeamMember(\"ë„¤ì´ë²„_ê°œë°œì_2\", naver)); var kakao_sales_1 = salesTeamMembersRepository.save(new SalesTeamMembers(\"ì¹´ì¹´ì˜¤_ì˜ì—…ì‚¬ì›_1\", kakao)); var kakao_sales_2 = salesTeamMembersRepository.save(new SalesTeamMembers(\"ì¹´ì¹´ì˜¤_ì˜ì—…ì‚¬ì›_2\", kakao)); var naver_sales_1 = salesTeamMembersRepository.save(new SalesTeamMembers(\"ë„¤ì´ë²„_ì˜ì—…ì‚¬ì›_1\", naver)); var naver_sales_2 = salesTeamMembersRepository.save(new SalesTeamMembers(\"ë„¤ì´ë²„_ì˜ì—…ì‚¬ì›_2\", naver)); jobRepository.save(new Job(\"AWS EC2 ì¸ìŠ¤í„´ìŠ¤ ìƒì„±\", kakao_dev_1, null)); jobRepository.save(new Job(\"AWS RDS ì¸ìŠ¤í„´ìŠ¤ ìƒì„±\", kakao_dev_2, null)); jobRepository.save(new Job(\"Spring Boot í”„ë¡œì íŠ¸ ìƒì„±\", naver_dev_1, null)); jobRepository.save(new Job(\"React í”„ë¡œì íŠ¸ ìƒì„±\", naver_dev_2, null)); jobRepository.save(new Job(\"ë§¤ì¶œëª©í‘œ ì„¤ì •\", null, kakao_sales_1)); jobRepository.save(new Job(\"ì™¸ê·¼\", null, kakao_sales_2)); jobRepository.save(new Job(\"ì œí’ˆ ì†Œê°œì„œ ë§Œë“¤ê¸°\", null, naver_sales_1)); jobRepository.save(new Job(\"ì›”ë§ ìˆ˜ê¸ˆ\", null, naver_sales_2));}ë‹¤ìŒì€ í…ŒìŠ¤íŠ¸ ì½”ë“œì…ë‹ˆë‹¤.@Testvoid test() { var q = QJob.job; var r = jpaQueryFactory .select( q.id, new CaseBuilder() .when(q.devTeamMembers.isNotNull()).then(q.devTeamMembers.name) .otherwise(q.salesTeamMembers.name), new CaseBuilder() .when(q.devTeamMembers.isNotNull()).then(q.devTeamMembers.company.name) .otherwise(q.salesTeamMembers.company.name) ) .from(q) .fetch(); Assert.isTrue(r.size() == 8, \"ì˜ˆìƒëœ ê²°ê³¼ì™€ ë‹¤ë¦…ë‹ˆë‹¤.\");}jobì„ 8ê°œ ìƒì„±í•˜ì˜€ê¸° ë•Œë¬¸ì— ìœ„ í…ŒìŠ¤íŠ¸ëŠ” ì •ìƒì ìœ¼ë¡œ í†µê³¼í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì¿¼ë¦¬ ê²°ê³¼ listì˜ sizeê°€ 0ì´ë˜ì–´ í…ŒìŠ¤íŠ¸ì— ì‹¤íŒ¨í•©ë‹ˆë‹¤.select job0_.id as col_0_0_, case when job0_.dev_team_members_id is not null then devteammem1_.name else salesteamm2_.name end as col_1_0_, case when job0_.dev_team_members_id is not null then company4_.name else company6_.name end as col_2_0_from job job0_ cross join dev_team_members devteammem1_ cross join company company4_ cross join sales_team_members salesteamm2_ cross join company company6_where job0_.dev_team_members_id = devteammem1_.id and devteammem1_.company_id = company4_.id and job0_.sales_team_members_id = salesteamm2_.id and salesteamm2_.company_id = company6_.idìƒì„±ëœ sql ë¬¸ì…ë‹ˆë‹¤. ë‹¹ì—°íˆ left joinì´ ê±¸ë¦´ì¤„ ì•Œì•˜ìœ¼ë‚˜ cross joinì´ ê±¸ë ¸ìŠµë‹ˆë‹¤. ë˜í•œ where ì¡°ê±´ì´ ì¶”ê°€ë˜ì–´ ì›í•˜ëŠ” ê²°ê³¼ê°€ ë‚˜ì˜¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.ë¬¸ì œ í•´ê²°ë¬¸ì œ í•´ê²°ì€ ê°„ë‹¨í•©ë‹ˆë‹¤. joinì„ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•´ì£¼ë©´ ë©ë‹ˆë‹¤.@Testvoid test() { var q = QJob.job; var r = jpaQueryFactory .select( q.id, new CaseBuilder() .when(q.devTeamMembers.isNotNull()).then(q.devTeamMembers.name) .otherwise(q.salesTeamMembers.name), new CaseBuilder() .when(q.devTeamMembers.isNotNull()).then(q.devTeamMembers.company.name) .otherwise(q.salesTeamMembers.company.name) ) .from(q) .leftJoin(q.devTeamMembers).leftJoin(q.devTeamMembers.company) .leftJoin(q.salesTeamMembers).leftJoin(q.salesTeamMembers.company) .fetch(); Assert.isTrue(r.size() == 8, \"ì˜ˆìƒëœ ê²°ê³¼ì™€ ë‹¤ë¦…ë‹ˆë‹¤.\");}joinì„ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•˜ê³  í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ë‹ˆ ì •ìƒì ìœ¼ë¡œ í†µê³¼í•©ë‹ˆë‹¤!select job0_.id as col_0_0_, case when job0_.dev_team_members_id is not null then devteammem2_.name else salesteamm5_.name end as col_1_0_, case when job0_.dev_team_members_id is not null then company3_.name else company6_.name end as col_2_0_from job job0_ left outer join dev_team_members devteammem1_ on job0_.dev_team_members_id = devteammem1_.id left outer join dev_team_members devteammem2_ on job0_.dev_team_members_id = devteammem2_.id left outer join company company3_ on devteammem2_.company_id = company3_.id left outer join sales_team_members salesteamm4_ on job0_.sales_team_members_id = salesteamm4_.id left outer join sales_team_members salesteamm5_ on job0_.sales_team_members_id = salesteamm5_.id left outer join company company6_ on salesteamm5_.company_id = company6_.id;ìƒì„±ëœ sqlë¬¸ì„ ë³´ë©´ ì˜ë„í•œëŒ€ë¡œ joinì´ ê±¸ë¦° ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ê²°ë¡ joinì„ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ cross joinì´ ê±¸ë ¤ ì›í•˜ëŠ” ê²°ê³¼ë¥¼ ì–»ì„ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í”¼í•˜ê¸° ìœ„í•œ ì„¤ì •(?) ê°™ì€ê²Œ ìˆìœ¼ë©´ ì¢‹ê² ì§€ë§Œ ê·¸ëŸ° ì„¤ì •ì€ ì•„ì§ê¹Œì§€ ì—†ëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.ìœ„ ë¬¸ì œëŠ” joinì„ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•˜ì—¬ ë¬¸ì œë¥¼ ì‰½ê²Œ í•´ê²°í•  ìˆ˜ ìˆìœ¼ë‹ˆ ë¬¸ì œ í•´ê²°ì— ë„ì›€ì´ ë˜ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤." }, { "title": "AWS Application Load Balancerì— SSL ì¸ì¦ì„œ ì ìš©í•˜ê¸°", "url": "/posts/aws-alb-ssl/", "categories": "AWS", "tags": "AWS, DevOps", "date": "2022-07-09 20:12:00 +0900", "snippet": "AWS Application Load Balancerì— SSL ì¸ì¦ì„œ ì ìš©í•˜ê¸°ê°œìš”ì´ í¬ìŠ¤íŒ…ì—ì„œëŠ” .pem í™•ì¥ìì˜ ì¸ì¦ì„œë¥¼ AWS Application Load Balancerì— ì ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í•©ë‹ˆë‹¤. AWS ACMì´ ì œê³µí•˜ëŠ” ì¸ì¦ì„œê°€ ì•„ë‹Œ ì™¸ë¶€ì—ì„œ ACMìœ¼ë¡œ ê°€ì ¸ì˜¨ ì¸ì¦ì„œë¥¼ ì ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í•©ë‹ˆë‹¤.1. AWS Certificate Manager ì½˜ì†” ì´ë™AWS ì½˜ì†” í™”ë©´ì—ì„œ Certificate Managerë¥¼ ê²€ìƒ‰í•˜ì—¬ ì¸ì¦ì„œ ê´€ë¦¬ í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ê³ , ì¢Œì¸¡ì˜ ì¸ì¦ì„œ ê°€ì ¸ì˜¤ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¸ì¦ì„œë¥¼ ê°€ì ¸ì˜¤ëŠ” í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.2. ì¸ì¦ì„œ ì„¸ë¶€ì •ë³´ì¸ì¦ì„œ ì„¸ë¶€ì •ë³´ì— ì…ë ¥í•  ì¸ì¦ì„œ ë³¸ë¬¸, ì¸ì¦ì„œ í”„ë¼ì´ë¹— í‚¤, ì¸ì¦ì„œ ì²´ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.ì œ ê²½ìš° DigiCert Global Root CA ë¼ëŠ” ë°œê¸‰ìì—ê²Œ ë°œê¸‰ë°›ì•˜ê¸° ë•Œë¬¸ì— DigiCertCA ì´ë¦„ì˜ pem íŒŒì¼ì´ ì¡´ì¬í•©ë‹ˆë‹¤.ì¼ë‹¨ ì¸ì¦ì„œ í”„ë¼ì´ë¹— í‚¤ í•­ëª©ì— ì…ë ¥í•  í‚¤ë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. í‚¤ì— í•´ë‹¹í•˜ëŠ” íŒŒì¼ì„ ì—´ê³  ì•”í˜¸í™”ë¥¼ í•´ì œí•´ì•¼ í•˜ëŠ” íŒŒì¼ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤. ì•„ë˜ ìº¡ì³ì™€ ê°™ì´ Proc-Type í•­ëª©ê³¼ DEK-Info í•­ëª©ì´ ë³´ì¸ë‹¤ë©´ ì•”í˜¸í™”ë¥¼ í•´ì²´í•´ì•¼ í•˜ëŠ” í‚¤íŒŒì¼ ì…ë‹ˆë‹¤.ì•”í˜¸í™”ë¥¼ í•´ì œí•œ ìƒˆë¡œìš´ .pem íŒŒì¼ì„ ë§Œë“œëŠ” ë°©ë²•ì€ ê°„ë‹¨í•©ë‹ˆë‹¤. ì¼ë‹¨ openssl ì´ ì„¤ì¹˜ëœ í™˜ê²½ì´ í•„ìš”í•œë°ìš”, Windowsê±´ Linuxê±´ ìƒê´€ ì—†ìŠµë‹ˆë‹¤. ê¸°ì¡´ key.pem íŒŒì¼ì„ ì˜®ê¸°ê³  ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.openssl rsa -in private-key.pem -out {ìƒì„±í•  íŒŒì¼ ì´ë¦„}ì •ìƒì ì¸ íŒŒì¼ì´ë¼ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë¼ëŠ” ì•ˆë‚´ë¬¸êµ¬ê°€ ëœ¨ëŠ”ë°ìš”, ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ì„ ë‹¹ì‹œ ë°œê¸‰ìì—ê²Œ ì œì¶œí•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤. íŒŒì¼ì´ ìƒì„±ë˜ì—ˆë‹¤ë©´ ì„±ê³µì…ë‹ˆë‹¤.ì¸ì¦ì„œ ë³¸ë¬¸ - cert.pemì¸ì¦ì„œ í”„ë¼ì´ë¹— í‚¤ - ì•”í˜¸í™” í•´ì œí•œ í‚¤.pemì¸ì¦ì„œ ì²´ì¸ - ë°œê¸‰ê¸°ê´€ëª….pemì´ì¤‘ ì¸ì¦ì„œ ì²´ì¸ì˜ ê²½ìš° ë¶ˆí•„ìš”í•œ ê²½ìš°ë„ ìˆê³  ë°œê¸‰ë°›ì€ ì¸ì¦ì„œ í˜•íƒœì— ë”°ë¼ ì—¬ëŸ¬ê°€ì§€ ë‹¨ê³„ë¡œ ì¡°í•©í•´ì•¼ í•˜ëŠ” ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤. ìì‹ ì˜ ì¸ì¦ì„œì™€ ì¼ì¹˜í•˜ëŠ” ì¸ì¦ì„œ ì²´ì¸ ìƒì„± ë°©ë²•ì€ ê²€ìƒ‰ì„ í†µí•´ ì•Œì•„ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤.3. ì¸ì¦ì„œ í™•ì¸ &amp; ìƒì„±ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì˜€ë‹¤ë©´ 2ë‹¨ê³„ì—ì„œëŠ” íƒœê·¸ë¥¼ ì¶”ê°€í•˜ê³  3ë‹¨ê³„ì—ì„œëŠ” ë„ë©”ì¸, ë§Œë£Œ ê¸°ê°„ë“±ì„ í™•ì¸í•œ í›„ì— ê°€ì ¸ì˜¤ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¸ì¦ì„œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.4. ì¸ì¦ì„œ ì ìš© &amp; ê²°ê³¼í•™ì¸ì¸ì¦ì„œë¥¼ ê°€ì ¸ì™”ìœ¼ë‹ˆ ALBì— ì ìš©í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ë¡œë“œ ë°¸ëŸ°ì„œ ì½˜ì†” í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ì—¬ ë¡œë“œ ë°¸ëŸ°ì„œë¥¼ ì„ íƒí•˜ê³  ë¦¬ìŠ¤ë„ˆ -&gt; ì¸ì¦ì„œ ë³´ê¸°/í¸ì§‘ ìˆœìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.ì €ëŠ” ì´ë¯¸ ì¸ì¦ì„œë¥¼ ì ìš©í•œ ìƒíƒœë¼ ì•„ë˜ ìº¡ì³ì™€ ê°™ì´ ì¸ì¦ì„œê°€ í™œì„±í™”ëœ ìƒíƒœì´ì§€ë§Œ ì²˜ìŒ ì ìš©í•˜ëŠ” ê²½ìš° ì•„ë¬´ê²ƒë„ ì—†ì„ ê²ƒì…ë‹ˆë‹¤. Add certificate ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ Add certificate to listener í™”ë©´ì´ ë“±ì¥í•˜ëŠ”ë°ìš”, ACM and IAM certificates ë¶€ë¶„ì— ë°©ê¸ˆ ë“±ë¡í•œ ì¸ì¦ì„œê°€ í‘œì‹œë  ê²ƒì…ë‹ˆë‹¤. í•´ë‹¹ ì¸ì¦ì„œë¥¼ ì²´í¬í•˜ê³  Include as pending below ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¸ì¦ì„œë¥¼ ì ìš©í•˜ë©´ ëì…ë‹ˆë‹¤.ì´ì œ ì¡°ê¸ˆ ì‹œê°„ì„ ë‘ê³  ìƒˆë¡œê³ ì¹¨í•˜ë©° ë‚´ ì‚¬ì´íŠ¸ì— ì ‘ì†í•´ë³´ì„¸ìš”.ìœ„ ìº¡ì³ì™€ ê°™ì´ ë¸Œë¼ìš°ì €ì—ì„œ ssl ì¸ì¦ì„œë¥¼ í™•ì¸í•  ìˆ˜ ìˆê³  https í”„ë¡œí† ì½œë¡œ ì ‘ì†í•  ìˆ˜ ìˆë‹¤ë©´ ì„±ê³µì…ë‹ˆë‹¤." }, { "title": "AWSë¥¼ ì‚¬ìš©í•´ ë¬´ì¤‘ë‹¨ ë°°í¬ ìë™í™” í™˜ê²½ êµ¬ì¶•í•˜ê¸° - 6. CodeDeploy ì—°ë™ / ë§ˆë¬´ë¦¬", "url": "/posts/aws-cicd-6/", "categories": "AWS", "tags": "AWS, DevOps", "date": "2022-06-17 20:12:00 +0900", "snippet": "AWSë¥¼ ì‚¬ìš©í•´ ë¬´ì¤‘ë‹¨ ë°°í¬ ìë™í™” í™˜ê²½ êµ¬ì¶•í•˜ê¸° ì‹œë¦¬ì¦ˆ ê°œìš” VPCì™€ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ VPCì™€ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ ìƒì„±í•˜ê¸° ì–´í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¶• ë° ë¡œë“œë°¸ëŸ°ì„œ ì ìš© AWS ë¦¬ì†ŒìŠ¤ ì„¸íŒ… CodeDeploy ì—°ë™ / ë§ˆë¬´ë¦¬CodeDeploy ì—°ë™ / ë§ˆë¬´ë¦¬S3 ì ‘ê·¼ IAM ì‚¬ìš©ì ìƒì„±ë¬´ì¤‘ë‹¨ ë°°í¬ì˜ íë¦„ì€ ì½”ë“œ ì»¤ë°‹ - ì»¤ë°‹ íŠ¸ë¦¬ê±°ë¡œ github action ìˆ˜í–‰ - gradle ë¹Œë“œ - jar íŒŒì¼ s3 ì „ì†¡ - code deploy íŠ¸ë¦¬ê±° - code deployê°€ ë°°í¬ ìˆ˜í–‰ ìœ¼ë¡œ ì´ë£¨ì–´ ì§‘ë‹ˆë‹¤.ê·¸ ì¤‘ github actionìœ¼ë¡œ ë¹Œë“œí•œ jar íŒŒì„ s3ì— ì „ì†¡í•˜ë ¤ë©´ ê¶Œí•œì´ ìˆì–´ì•¼ í•˜ê² ì£ ? ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ìë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤. IAM -&gt; ì‚¬ìš©ì ìƒì„±ìœ¼ë¡œ ì‚¬ìš©ì ì¶”ê°€ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.ìê²© ì¦ëª… ìœ í˜•ì€ í”„ë¡œê·¸ë˜ë° ë°©ì‹ ì•¡ì„¸ìŠ¤ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.ì •ì±… í•„í„°ì— AmazonS3FullAccess || AWSCodeDeployFullAccess ë¥¼ ê²€ìƒ‰í•´ ë‚˜ì˜¨ ë‘ê°€ì§€ ì •ì±…ì„ ì—°ê²°í•©ë‹ˆë‹¤. ê·¸ í›„ ì­‰ì­‰ ë„˜ê²¨ ì‚¬ìš©ìë¥¼ ìƒì„±í•©ë‹ˆë‹¤.ë§ˆì§€ë§‰ 5ë‹¨ê³„ì— ë„ë‹¬í•˜ë©´ ì•¡ì„¸ìŠ¤ í‚¤ì™€ ë¹„ë°€ ì•¡ì„¸ìŠ¤ í‚¤ë¥¼ ë‹¤ìš´ë°›ì„ ìˆ˜ ìˆëŠ” í™”ë©´ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ì´ ìê²© ì¦ëª… csvëŠ” í•´ë‹¹ í™”ë©´ì—ì„œë§Œ ë‹¤ìš´ë°›ì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì˜ ì €ì¥í•´ ë‘ë„ë¡ í•©ë‹ˆë‹¤.S3 ë²„í‚· ìƒì„±ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ì˜€ìœ¼ë‹ˆ S3 ë²„í‚·ì„ ìƒì„±í•˜ê² ìŠµë‹ˆë‹¤. AWS ì½˜ì†” -&gt; S3 -&gt; ë²„í‚· ë§Œë“¤ê¸° ë¡œ ì´ë™í•˜ì—¬ ë²„í‚·ì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ë•Œ ëª¨ë“  í¼ë¸”ë¦­ ì•¡ì„¸ìŠ¤ë¥¼ ì°¨ë‹¨í•©ë‹ˆë‹¤.Github Repository ìƒì„± ë° ì½”ë“œ commit &amp; pushê°„ë‹¨í•œ Spring boot ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ì–´ Githubì— ì˜¬ë¦½ë‹ˆë‹¤.@RestController@SpringBootApplicationpublic class SimpleApplication { public static void main(String[] args) { SpringApplication.run(SimpleApplication.class, args); } @GetMapping(\"/ip\") public Map&lt;String, String&gt; ip(HttpServletRequest request) throws UnknownHostException { var map = new HashMap&lt;String, String&gt;(); map.put(\"hostIp\", InetAddress.getLocalHost().getHostAddress()); map.put(\"accessIp\", request.getHeader(\"x-forwarded-for\")); return map; }}Github Repositoryì— ì‹œí¬ë¦¿ í‚¤ ë“±ë¡Github Actionì— ì‹œí¬ë¦¿ í‚¤ë¥¼ ê·¸ëŒ€ë¡œ ë…¸ì¶œì‹œí‚¤ë©´ ë³´ì•ˆìƒ í° ë¬¸ì œê°€ ë˜ê² ì£ ? ë”°ë¼ì„œ Workflowì—ì„œ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •ì— ì‹œí¬ë¦¿ í‚¤ë¥¼ ë“±ë¡í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.ìœ„ ìº¡ì³ì™€ ê°™ì´ repository -&gt; settings -&gt; ì¢Œì¸¡ secrets -&gt; actions ë¡œ ì´ë™í•˜ë©° IAM ì‚¬ìš©ì ìƒì„± ë§ˆì§€ë§‰ ë‹¨ê³„ì—ì„œ ì €ì¥í•´ ë‘ì—ˆë˜ í‚¤ê°’ë“¤ì„ ë“±ë¡í•©ë‹ˆë‹¤.S3ì— ì—…ë¡œë“œí•˜ê¸°github workflowì—ì„œ s3ë¡œ ë¹Œë“œëœ jar íŒŒì¼ì„ ì˜®ê¸°ëŠ” jobì„ ì¶”ê°€í•©ë‹ˆë‹¤. .github/workflows/gradle.yml íŒŒì¼ì„ ë§Œë“¤ê³  ì•„ë˜ ë‚´ìš©ì„ ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤.name: github action codedeploy CI/CDon: push: branches: [ \"master\" ] pull_request: branches: [ \"master\" ]permissions: contents: readjobs: build: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - name: Set up JDK 11 uses: actions/setup-java@v3 with: java-version: '11' distribution: 'temurin' - name: Gradlew permission run: chmod +x gradlew - name: Build with Gradle run: ./gradlew clean build - name: Make Directory run: mkdir dist - name: Copy jar run: cp ./build/libs/*.jar ./dist/ - name: zip run: tar -zcvf deploy.tar.gz ./dist - name: Upload to S3 env: AWS_ACCESS_KEY_ID: $ AWS_SECRET_ACCESS_KEY: $ run: | aws s3 cp \\ --region ap-northeast-2 \\ --acl private \\ ./deploy.tar.gz \\ s3://keencho-codedeploy-s3-bucket/$/deploy.tar.gz \\run_numberë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ actionì´ ìˆ˜í–‰ë ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ íŒŒì¼ì´ overwirte ë˜ê¸° ë•Œë¬¸ì— ë°±ì—… íŒŒì¼ì„ ë‚¨ê¸¸ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ run_numberë¥¼ ì‚¬ìš©í•˜ì—¬ ë°±ì—… íŒŒì¼ì„ ë‚¨ê¸¸ìˆ˜ ìˆë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.ì´ì œ repositoryì— push í•˜ê³  actionsíƒ­ì— ë“¤ì–´ê°€ ì‘ì—…ì´ ì˜ ìˆ˜í–‰ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ì‘ì—…ì´ ëª¨ë‘ ì„±ê³µí•˜ì˜€ë‹¤ë©´ s3ë¡œ ì´ë™í•´ deploy.tar.gz íŒŒì¼ì´ ì—…ë¡œë“œì™¸ì–´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.CodeDeploy í˜¸ì¶œs3ì— íŒŒì¼ì´ ì˜ ì—…ë¡œë“œ ë˜ì—ˆìœ¼ë‹ˆ CodeDeployë¥¼ í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤. ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆ˜ì •í•˜ê¸° ì „ ê¸°ì¡´ AutoScaling Groupì— í¬í•¨ëœ ì¸ìŠ¤í„´ìŠ¤ì— CodeDeploy Agentê°€ ì‹¤í–‰ì¤‘ì¸ì§€ ì²´í¬í•˜ì„¸ìš”.sudo service codedeploy-agent statusThe AWS CodeDeploy agent is running as PID 23029ë‹¤ìŒì€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆ˜ì •í•´ ë³´ê² ìŠµë‹ˆë‹¤.name: github action codedeploy CI/CDon: push: branches: [ \"master\" ] pull_request: branches: [ \"master\" ]permissions: contents: readjobs: build: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - name: Set up JDK 11 uses: actions/setup-java@v3 with: java-version: '11' distribution: 'temurin' - name: Gradlew permission run: chmod +x gradlew - name: Build with Gradle run: ./gradlew clean build - name: Make Directory run: mkdir dist - name: Copy jar run: cp ./build/libs/*.jar ./dist/ - name: zip run: tar -zcvf deploy.tar.gz ./dist - name: Configure AWS Credentials uses: aws-actions/configure-aws-credentials@v1 with: aws-access-key-id: $ aws-secret-access-key: $ aws-region: ap-northeast-2 - name: Upload to S3 run: | aws s3 cp \\ --region ap-northeast-2 \\ --acl private \\ ./deploy.tar.gz \\ s3://keencho-codedeploy-s3-bucket/$/deploy.tar.gz \\ - name: Call CodeDeploy run: | aws deploy create-deployment \\ --application-name keencho-codedeploy-app \\ --deployment-group-name keencho-codedeploy-app-group \\ --region ap-northeast-2 \\ --s3-location bucket=keencho-codedeploy-s3-bucket,bundleType=tgz,key=$/deploy.tar.gz \\aws ì¸ì¦ë¶€ë¶„ì„ Configure AWS Credentialsë¡œ ë”°ë¡œ ë»ˆê³ , Call CodeDeploy ë¶€ë¶„ì„ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤. application-nameê³¼ deployment-group-name ì´ awsì½˜ì†”ìƒì˜ ì´ë¦„ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ ë‹¤ì‹œí•œë²ˆ í™•ì¸í•´ ë³´ì„¸ìš”.ì´ì œ ë‹¤ì‹œ github actionì„ ì‹¤í–‰ì‹œí‚¤ê³  CodeDeploy ì½˜ì†”ë¡œ ì´ë™í•˜ì—¬ ë°°í¬ê°€ ì§„í–‰ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. CodeDeploy agent was not able to receive the lifecycle event. Check the CodeDeploy agent logs on your host and make sure the agent is running and can connect to the CodeDeploy server. ë¼ëŠ” ì—ëŸ¬ë©”ì‹œì§€ê°€ ëœ¨ë©´ì„œ CodeDeployê°€ ë”ì´ìƒ ì§„í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì´ëŠ” CodeDeploy Agentê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•Šë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.ì• í¬ìŠ¤íŒ…ì—ì„œ ì–¸ê¸‰í•œ ê²ƒì²˜ëŸ¼ ì‰˜ ìŠ¤í¬ë¦½íŠ¸ì˜ ì²«ë²ˆì§¸ ë¶€ë¶„ì—ì„œ -xeë¥¼ ì œê±°í•´ ë³´ì‹œê³ , ê·¸ë˜ë„ ì•ˆëœë‹¤ë©´ êµ¬ê¸€ë§ì„ í†µí•´ CodeDeploy Agentë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ë°©ë²•ì„ ì°¾ì•„ë³´ì„¸ìš”.The CodeDeploy agent did not find an AppSpec file within the unpacked revision directory at revision-relative path \"appspec.yml\" ë¼ëŠ” ë©”ì‹œì§€ê°€ ëœ¨ë©° ë°°í¬ê°€ ì‹¤íŒ¨í•œë‹¤ë©´ ì§€ê¸ˆê¹Œì§€ëŠ” ì„±ê³µì…ë‹ˆë‹¤.appspec.yml ì„¸íŒ…CodeDeployëŠ” AppSpec fileì„ ë°°í¬ ê´€ë¦¬ yaml íŒŒì¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ì „ì— ë§Œë“  í…œí”Œë¦¿ì—ëŠ” codedeploy-agent ì„¤ì¹˜ ê¹Œì§€ë§Œ ì§„í–‰í–ˆì—ˆëŠ”ë°ìš”, nginxë‚˜ ê¸°íƒ€ í•„ìš”í•œ ì„¸íŒ…ì€ ì´ê³³ì—ì„œ ì§„í–‰ë©ë‹ˆë‹¤.ë°°í¬ë  ìŠ¤í”„ë§ ë¶€íŠ¸ í”„ë¡œì íŠ¸ì˜ rootì—ì„œ codedeploy ë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ê³  appspec.yml íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ë˜ ë‚´ìš©ì„ ë¶™ì—¬ë„£ìŠµë‹ˆë‹¤.version: 0.0os: linuxfiles: - source: / destination: /home/ec2-userpermissions: - object: / pattern: \"**\" owner: ec2-user group: ec2-userhooks: AfterInstall: - location: init.sh timeout: 300 runas: root ApplicationStart: - location: deploy.sh timeout: 300 runas: ec2-user ValidateService: - location: validate.sh timeout: 200 runas: ec2-userìœ„ íŒŒì¼ì„ ë³´ì‹œë©´ hooks ì„¹ì…˜ì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. hooks ì„¹ì…˜ì€ ì´ë¦„ì—ì„œë„ ìœ ì¶” ê°€ëŠ¥í•˜ë“¯ì´ ì¸ìŠ¤í„´ìŠ¤ ë°°í¬ì‹œ ê°ê° í•œë²ˆ ì‹¤í–‰ë©ë‹ˆë‹¤. ê°ê°ì˜ í›…ì´ ì‹¤í–‰ë˜ëŠ” ì‹œì ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ ì´ê³³ì„ ì°¸ê³  í•˜ì„¸ìš”.ë§ì€ í›…ë“¤ì´ ìˆì§€ë§Œ ì—¬ê¸°ì„œ ì‚¬ìš©í•  í›…ì€ ì„¸ê°€ì§€ ì…ë‹ˆë‹¤. ê·¸ì¤‘ ë¨¼ì € AfterInstall í›…ì— ì‚¬ìš©ë  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì •ì˜í•´ ë³´ê² ìŠµë‹ˆë‹¤.AfterInstallappspec.yml íŒŒì¼ì´ ìœ„ì¹˜í•œ ê³³ì— init.sh íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.#!/bin/bash# íƒ€ì„ì¡´ ì„¸íŒ…rm /etc/localtimeln -s /usr/share/zoneinfo/Asia/Seoul /etc/localtime# nginx ì„¤ì¹˜amazon-linux-extras install nginx1 -ysystemctl enable nginxsystemctl start nginxchmod 755 /var/log/nginx# nginx config file ìœ„ì¹˜ ì´ë™mv /home/ec2-user/nginx/*.conf /etc/nginx/conf.d/rm -rf /home/ec2-user/nginxsystemctl restart nginx# open jdk 11 ì„¤ì¹˜amazon-linux-extras install java-openjdk11 -y# deploy.sh ê¶Œí•œ ë³€ê²½chmod +x /home/ec2-user/deploy.shíƒ€ì„ì¡´ ì„¸íŒ…, nginx ì„¤ì¹˜, nginx config ì„¤ì •, open jdk 11 ì„¤ì¹˜, deploy.sh ê¶Œí•œ ë³€ê²½ ì‘ì—…ì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. ì´ê²ƒì´ ì‹œì‘ í…œí”Œë¦¿ì˜ ì‚¬ìš©ì ë°ì´í„°ì—ì„œ nginxë‚˜ jdkë“±ì„ ì„¤ì¹˜í•˜ì§€ ì•ŠëŠ” ì´ìœ ì…ë‹ˆë‹¤.ìœ„ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë³´ì‹œë©´ ì¤‘ê°„ì— ë¯¸ë¦¬ ì •ì˜í•´ë‘” nginx config íŒŒì¼ì„ ì˜®ê¸°ëŠ” ë¶€ë¶„ì´ ìˆìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ root &gt; codedeploy &gt; nginx í´ë”ë¥¼ ìƒì„±í•˜ê³  nginx.conf íŒŒì¼ì„ ë§Œë“¤ê³  ì•„ë˜ ë‚´ìš©ì„ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.server { set $proxy_pass http://127.0.0.1:8090; listen 80; location /health { access_log off; return 200; } location / { proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Host $server_name; proxy_read_timeout 120; proxy_buffer_size 128k; proxy_buffers 4 256k; proxy_busy_buffers_size 256k; proxy_pass $proxy_pass; }}ì´ì „ í¬ìŠ¤íŒ…ì—ì„œ ë¡œë“œë°¸ëœì„œ / ëŒ€ìƒê·¸ë£¹ì— ëŒ€í•´ ì•Œì•„ë³¸ ì ì´ ìˆìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ë„ í•˜ë‚˜ ë§Œë“¤ì—ˆì§€ìš”. ê·¸ë•Œ /health ê²½ë¡œì— ëŒ€í•´ 200 ìƒíƒœê°’ì„ ë°˜í™˜í•˜ë„ë¡ ì„¤ì •í•˜ì˜€ì—ˆëŠ”ë°ìš”, ì—¬ê¸°ì„œë„ ë™ì¼í•©ë‹ˆë‹¤. ëŒ€ìƒ ê·¸ë£¹ì´ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ì˜ health ìƒíƒœë¥¼ ì²´í¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.ApplicationStartì¸ìŠ¤í„´ìŠ¤ ì„¸íŒ…ì´ ëë‚¬ìœ¼ë‹ˆ SpringBoot ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ê°€ í•„ìš”í•©ë‹ˆë‹¤. appspec.yml íŒŒì¼ì´ ìœ„ì¹˜í•œ ê³³ì— deploy.yml íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.#!/bin/bashnohup java -jar -Dserver.port=8090 /home/ec2-user/application.jar 1&gt; /dev/null 2&gt;&amp;1 &amp;sleep 30sìŠ¤í”„ë§ë¶€íŠ¸ì˜ í¬íŠ¸ì™€ nginxì˜ í¬íŠ¸ê°€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.ValidateServiceí˜¹ì‹œ ìŠ¤í”„ë§ë¶€íŠ¸ê°€ ëœ¨ì§€ ì•Šì•˜ë‹¤ë©´ ì–´ë–»ê²Œ í• ê¹Œìš”?(ì˜ˆë¥¼ë“¤ì–´ í•˜ì´ë²„ë„¤ì´íŠ¸ì˜ ìŠ¤í‚¤ë§ˆ ê²€ì¦â€¦) íƒ€ê²Ÿê·¸ë£¹ì€ í˜„ì¬ì¸ìŠ¤í„´ìŠ¤/health ê²½ë¡œë¡œ health-check ë¥¼ ì§„í–‰í•˜ì˜€ê¸° ë•Œë¬¸ì— ì¸ìŠ¤í„´ìŠ¤ ë‚´ë¶€ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ ê¹Œì§€ëŠ” í™•ì¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì—¬ê¸°ì„œëŠ” ë³„ë„ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì˜ ì‹œì‘ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê² ìŠµë‹ˆë‹¤.ì¼ë‹¨ ìŠ¤í”„ë§ë¶€íŠ¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ë©”ì†Œë“œë¥¼ ì¶”ê°€í•´ ë³´ê² ìŠµë‹ˆë‹¤. ë‹¨ìˆœíˆ 200 ìƒíƒœê°’ì„ ì²´í¬í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” ë©”ì†Œë“œ ì…ë‹ˆë‹¤.@GetMapping(\"/script-health-check\") public ResponseEntity&lt;?&gt; scriptHealthCheck() { return ResponseEntity.ok().build(); }appspec.yml íŒŒì¼ì´ ìœ„ì¹˜í•œ ê³³ì— validate.sh íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.#!/bin/bashvalidate () {\tcount=1\twhile [ ${count} -le 11 ]; do\t\tresponse=$(curl --write-out '%{http_code}' --silent --output /dev/null $1)\t\tif [ ${response} -eq 200 ]; then\t\t\tbreak\t\telse\t\t\tif [ ${count} -eq 11 ]; then\t\t\t\techo \"$2 ì–´í”Œë¦¬ì¼€ì´ì…˜ ê²€ì¦ ì‹¤íŒ¨\"\t\t\t\texit 1\t\t\tfi\t\t\techo \"$2 ì–´í”Œë¦¬ì¼€ì´ì…˜ ê²€ì¦ ì¬ì‹œë„... ${count}\"\t\t\tsleep 10s\t\t\tcount=$((count + 1))\t\tfi\tdone}validate \"localhost:8090/script-health-check\" \"ìƒ˜í”Œ\"ì´ ì—´ë²ˆ, ê° ì‹œë„ë§ˆë‹¤ 10ì´ˆì˜ ìœ íœ´ì‹œê°„ì„ ê°€ì§€ëŠ” ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸ ì…ë‹ˆë‹¤. ê²€ì¦ì— ì‹¤íŒ¨í•œë‹¤ë©´ exit1 ì½”ë“œë¥¼ í†µí•´ CodeDeploy ë°°í¬ê°€ ì¢…ë£Œë˜ê²Œ ë©ë‹ˆë‹¤.gradle.yml ìµœì¢…ìˆ˜ì •í•„ìš”í•œ ìŠ¤í¬ë¦½íŠ¸ë“¤ì´ ìŠ¤í”„ë§ë¶€í„° jar íŒŒì¼ê³¼ ê°™ì´ ì••ì¶•ë ìˆ˜ ìˆë„ë¡ yml íŒŒì¼ì„ ìµœì¢… ìˆ˜ì •í•©ë‹ˆë‹¤.name: github action codedeploy CI/CDon: push: branches: [ \"master\" ] pull_request: branches: [ \"master\" ]permissions: contents: readjobs: build: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - name: Set up JDK 11 uses: actions/setup-java@v3 with: java-version: '11' distribution: 'temurin' - name: Gradlew permission run: chmod +x gradlew - name: Build with Gradle run: ./gradlew clean build - name: Make Directory run: mkdir dist - name: Move Jar run: mv ./build/libs/*.jar ./dist/application.jar - name: Move CodeDeploy Script run: mv ./codedeploy/* ./dist/ - name: zip run: tar -zcvf deploy.tar.gz ./dist - name: Configure AWS Credentials uses: aws-actions/configure-aws-credentials@v1 with: aws-access-key-id: $ aws-secret-access-key: $ aws-region: ap-northeast-2 - name: Upload to S3 run: | aws s3 cp \\ --region ap-northeast-2 \\ --acl private \\ ./deploy.tar.gz \\ s3://keencho-codedeploy-s3-bucket/$/deploy.tar.gz \\ - name: Call CodeDeploy run: | aws deploy create-deployment \\ --application-name keencho-codedeploy-app \\ --deployment-group-name keencho-codedeploy-app-group \\ --region ap-northeast-2 \\ --s3-location bucket=keencho-codedeploy-s3-bucket,bundleType=tgz,key=$/deploy.tar.gz \\ Move CodeDeploy Script ë¶€ë¶„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.ê²°ê³¼ í™•ì¸ì´ì œ í•„ìš”í•œ ìŠ¤í¬ë¦½íŠ¸ëŠ” ëª¨ë‘ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. Githubì— pushí•˜ì—¬ ê²°ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.CodeDeploy ì½˜ì†”ì—ì„œ ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ëë‚œê²ƒì„ í™•ì¸í•˜ì˜€ë‹¤ë©´ ë¡œë“œë°¸ëŸ°ì„œì˜ DNS ë¥¼ í†µí•´ ì‚¬ì´íŠ¸ë¡œ ì ‘ì†í•˜ì—¬ ê²°ê³¼ë¬¼ì„ í™•ì¸í•©ë‹ˆë‹¤. ê²°ê³¼ë¥¼ í™•ì¸í•˜ì˜€ë‹¤ë©´ ì´ì œëŠ” ìŠ¤í”„ë§ë¶€íŠ¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— í…ŒìŠ¤íŠ¸ ë©”ì†Œë“œë¥¼ ì¶”ê°€í•˜ì—¬ ë‹¤ì‹œí•œë²ˆ CodeDeploy ë°°í¬ë¥¼ ìˆ˜í–‰í•´ ë³´ì„¸ìš”.CodeDeploy ë¥¼ í™•ì¸í•˜ë©´ì„œ ìˆ˜ì‹œë¡œ ì‚¬ì´íŠ¸ì— ì ‘ì†í•´ ë³´ì„¸ìš”. ì´ì „ ì–´í”Œë¦¬ì¼€ì´ì…˜ê³¼ ìµœì‹  ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë²ˆê°ˆì•„ê°€ë©° í˜¸ì¶œë˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¡œë“œë°¸ëŸ°ì„œê°€ ì–´ë–¤ ì‹ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ íŒŒì•… / í™•ì¸í•˜ëŠ”ê²ƒì€ ì¤‘ìš”í•©ë‹ˆë‹¤. (í¬ìŠ¤íŒ…ì—ì„œ ì‚¬ìš©ëœ í˜•íƒœì˜ ìŠ¤í”„ë§ ë¶€íŠ¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‚¬ìš©í•˜ì…¨ë‹¤ë©´ ec2 ì¸ìŠ¤í„´ìŠ¤ì˜ private ipë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.) ì´ ì‹œì ì—ì„œ ë§Œì•½ CodeDeploy Taskê°€ ì‹œì‘ì¡°ì°¨ ëª»í•˜ê³  ì²«ë²ˆì§¸ ë‹¨ê³„ì¸ Application Stop ì—ì„œ ë©ˆì¶°ë²„ë¦°ë‹¤ë©´, ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ì— CodeDeploy Agentê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤./var/log/cloud-init-output.log ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆëŠ”ë°ìš”, ì œ ê²½ìš°ëŠ” ì‹¤ìˆ˜ë¡œ NAT ê²Œì´íŠ¸ì›¨ì´ë¥¼ ì‚­ì œí•´ ì™¸ë¶€ ì¸í„°ë„· ì—°ê²°ì´ ë˜ì§€ ì•Šì•„ yum íŒ¨í‚¤ì§€ë¥¼ ë‹¤ìš´ë°›ì„ ìˆ˜ ì—†ì–´ ì—ëŸ¬ê°€ ë°œìƒ í•˜ì˜€ìŠµë‹ˆë‹¤.ë‹¤ì–‘í•œ ì›ì¸ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë¬¸ì œ ë°œìƒì‹œ ìœ„ ë¡œê·¸ë¥¼ í™•ì¸í•´ ë³´ì„¸ìš”.ëª¨ë“  TASKê°€ ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤!ë§ˆë¬´ë¦¬ì´ ì‹œë¦¬ì¦ˆì—ì„œëŠ” VPCìƒì„±, ì„œë¸Œë„· ìƒì„±ë¶€í„° Github Action, CodeDeployê¹Œì§€ ì§„í–‰í•´ ë³´ì•˜ìŠµë‹ˆë‹¤. ì‚¬ì‹¤ ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ì‹¤ê²½ì¨ì¤˜ì•¼í•  ë¶€ë¶„ì´ ë” ë§ìŠµë‹ˆë‹¤.ì˜ˆë¥¼ë“¤ì–´ CodeDeploy ë°°í¬ì— ì‹¤íŒ¨í•œ ê²½ìš° CodeDeploy ì— ì˜í•´ ìƒˆë¡­ê²Œ ì‹œì‘ëœ Auto Scaling Groupì€ ìë™ì¢…ë£Œë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ê°€ ì‹¤í–‰ëœ ìƒíƒœ(ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠëŠ” ìƒíƒœ)ë¡œ ë©ˆì¶”ì–´ ì´ì¤‘ ê³¼ê¸ˆì´ ë°œìƒí•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ì— ëŒ€ì‘í•  ì „ëµì´ í•„ìš”í•©ë‹ˆë‹¤. ì œ ê²½ìš° CodeDeployì˜ ì„±ê³µ / ì‹¤íŒ¨ ì—¬ë¶€ë¥¼ 30ì´ˆë§ˆë‹¤ Polling í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ Jenkinsì— í¬í•¨ì‹œì¼œì„œ ì‹¤íŒ¨í•œ ê²½ìš° ë¯¸ë¦¬ ì •ì˜í•´ë‘” ë¡¤ë°± ëŒë‹¤ë¥¼ í˜¸ì¶œí•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.ì„¸ì„¸í•œ ë¶€ë¶„ê¹Œì§€ ì‹ ê²½ì“°ì§€ ëª»í–ˆì§€ë§Œ ì´ í¬ìŠ¤íŒ…ì´ AWSë¥¼ ì´ìš©í•´ ë¬´ì¤‘ë‹¨ ë°°í¬ë¥¼ êµ¬í˜„í•˜ì‹œë ¤ëŠ” ë¶„ë“¤ê»˜ ë„ì›€ì´ ë˜ê¸¸ ë°”ëë‹ˆë‹¤. ì´ í¬ìŠ¤íŒ…ì—ì„œ ì‚¬ìš©ëœ ì „ì²´ ì½”ë“œëŠ” ì´ê³³ ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤." }, { "title": "AWSë¥¼ ì‚¬ìš©í•´ ë¬´ì¤‘ë‹¨ ë°°í¬ ìë™í™” í™˜ê²½ êµ¬ì¶•í•˜ê¸° - 5. AWS ë¦¬ì†ŒìŠ¤ ì„¸íŒ…", "url": "/posts/aws-cicd-5/", "categories": "AWS", "tags": "AWS, DevOps", "date": "2022-06-08 20:12:00 +0900", "snippet": "AWSë¥¼ ì‚¬ìš©í•´ ë¬´ì¤‘ë‹¨ ë°°í¬ ìë™í™” í™˜ê²½ êµ¬ì¶•í•˜ê¸° ì‹œë¦¬ì¦ˆ ê°œìš” VPCì™€ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ VPCì™€ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ ìƒì„±í•˜ê¸° ì–´í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¶• ë° ë¡œë“œë°¸ëŸ°ì„œ ì ìš© AWS ë¦¬ì†ŒìŠ¤ ì„¸íŒ… CodeDeploy ì—°ë™ / ë§ˆë¬´ë¦¬AWS ë¦¬ì†ŒìŠ¤ ì„¸íŒ…Auto Scaling ê·¸ë£¹ ìƒì„±AWS ë¦¬ì†ŒìŠ¤ ì„¸íŒ… ì²«ë²ˆì§¸ ë‹¨ê³„ë¡œ Auto Scaling ê·¸ë£¹ì„ ìƒì„±í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.í…œí”Œë¦¿ ë§Œë“¤ê¸°ê·¸ë£¹ì„ ìƒì„±í•˜ê¸° ì „ì— í…œí”Œë¦¿ì„ ë¨¼ì € ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. ê¸°ì¡´ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¢…ë£Œí•˜ê³  ìƒˆë¡­ê²Œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë„ìš°ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•  ê²ƒì´ê¸° ë•Œë¬¸ì— ìƒˆë¡­ê²Œ ì¸ìŠ¤í„´ìŠ¤ê°€ ì‹œì‘ë ë•Œ ì‚¬ìš©ë  í…œí”Œë¦¿ì…ë‹ˆë‹¤.EC2 ì½˜ì†” -&gt; ì¸ìŠ¤í„´ìŠ¤ -&gt; ì‹œì‘í…œí”Œë¦¿ -&gt; ì‹œì‘ í…œí”Œë¦¿ ìƒì„±ìœ¼ë¡œ ì´ë™í•˜ì—¬ ìƒì„± í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤. ì´ë¦„ì€ ì„ì˜ë¡œ ì§€ì •í•©ë‹ˆë‹¤.ìœ„ì™€ ê°™ì´ ì„¸íŒ…í›„ì— ì‹œì‘ í…œí”Œë¦¿ì„ ìƒì„±í•©ë‹ˆë‹¤. ê°€ì¥ ì¤‘ìš”í•œê²ƒì€ ë§ˆì§€ë§‰ ê³ ê¸‰ ì„¸ë¶€ì •ë³´ ë¶€ë¶„ì˜ IAM ì¸ìŠ¤í„´ìŠ¤ í”„ë¡œíŒŒì¼ê³¼ ì‚¬ìš©ì ë°ì´í„° ì…ë‹ˆë‹¤.IAM ì¸ìŠ¤í„´ìŠ¤ í”„ë¡œíŒŒì¼ì€ AmazonS3FullAccess, AWSCodeDeployRole ì™€ AWSCodeDeployFullAccess ì •ì±…ì„ í•„ìš”ë¡œ í•©ë‹ˆë‹¤. ì‚¬ìš©ì ë°ì´í„°ëŠ” ì¸ìŠ¤í„´ìŠ¤ê°€ ì‹œì‘ëœ í›„ì— codedeploy-agent ë¥¼ ì‹¤í–‰í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— codedeploy-agent ì‹¤í–‰ì— í•„ìš”í•œ íŒŒì´ì¬, ë£¨ë¹„ë“±ì„ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì„¤ì¹˜í•˜ê³  codedeploy-agentë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.#!/bin/bash -xesudo yum install -y python3sudo python3 -m pip install --upgrade pipsudo python3 -m pip install awsclisudo yum -y install rubysudo yum -y install wgetsudo wget https://aws-codedeploy-ap-northeast-2.s3.ap-northeast-2.amazonaws.com/latest/installsudo chmod +x ./installsudo ./install autosudo service codedeploy-agent start ìœ„ ìŠ¤í¬ë¦½íŠ¸ì— ë¬¸ì œê°€ ë°œìƒí•˜ì‹œë©´ #!/bin/bash -xe ì—ì„œ -xeë¥¼ ë¹¼ê³  ì§„í–‰í•´ ë³´ì„¸ìš”.Auto Scaling ê·¸ë£¹ ìƒì„±ë‹¤ìŒì€ ì˜¤í†  ìŠ¤ì¼€ì¼ë§ ê·¸ë£¹ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. EC2 ì½˜ì†” -&gt; Auto Scaling -&gt; Auto Scaling ê·¸ë£¹ -&gt; ìƒì„± ìœ¼ë¡œ ì´ë™í•˜ì—¬ ê·¸ë£¹ì„ ìƒì„±í•˜ê² ìŠµë‹ˆë‹¤.ë°©ê¸ˆ ë§Œë“  í…œí”Œë¦¿ì„ ì‹œì‘ í…œí”Œë¦¿ìœ¼ë¡œ ì§€ì •í•©ë‹ˆë‹¤.ë‹¤ìŒ ë‹¨ê³„ì—ì„œëŠ” VPCë¥¼ ì§€ì •í•˜ê³  ê°€ìš© ì˜ì—­ì„ ì„¸íŒ…í•©ë‹ˆë‹¤. ë¬¼ë¡  ê°€ìš© ì˜ì—­ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.3ë‹¨ê³„ ì—ì„œëŠ” ë¡œë“œë°¸ëŸ°ì„œë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ë§Œë“¤ì–´ë‘” ë¡œë“œë°¸ëŸ°ì„œì™€ íƒ€ê²Ÿ ê·¸ë£¹ì´ ìˆê¸° ë•Œë¬¸ì— ê·¸ê²ƒì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤. ìƒíƒœ í™•ì¸ì˜ ê²½ìš° ê¸°ë³¸ì´ 300ì´ˆë¡œ ë˜ì–´ìˆëŠ”ë°ìš”, í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ë„ˆë¬´ ê¸¸ê¸° ë•Œë¬¸ì— 30ì´ˆë¡œ ì¤„ì—¬ì£¼ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.4ë‹¨ê³„ëŠ” ê·¸ë£¹ í¬ê¸° ì…ë‹ˆë‹¤. ì›í•˜ëŠ” ìš©ëŸ‰, ìµœì†Œ ìš©ëŸ‰, ìµœëŒ€ ìš©ëŸ‰ì„ ì§€ì •í• ìˆ˜ ìˆìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ê¸° ë•Œë¬¸ì— ëª¨ë‘ í•œê°œë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤. ì•„ë˜ ì„¤ì • ë°•ìŠ¤ì—ì„œëŠ” ìŠ¤ì¼€ì¼ in - outí•  ì •ì±…ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.5ë‹¨ê³„, 6ë‹¨ê³„ëŠ” ê°ê° ì•Œë¦¼, íƒœê·¸ë¡œ í•„ìš”í•˜ì‹  ë¶„ë“¤ì€ ì„¤ì •í•˜ì‹œë©´ ë©ë‹ˆë‹¤.ê²°ê³¼ í™•ì¸í•˜ê¸°ì˜¤í†  ìŠ¤ì¼€ì¼ë§ ê·¸ë£¹ì´ ì˜ ìƒì„±ë˜ì—ˆë‹¤ë©´ ì¸ìŠ¤í„´ìŠ¤ê°€ í•˜ë‚˜ ìƒì„±ë˜ì—ˆì„ ê²ƒì…ë‹ˆë‹¤. ì¸ìŠ¤í„´ìŠ¤ ì½˜ì†”ë¡œ ì´ë™í•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ ë³´ë„ë¡ í•©ì‹œë‹¤.ë¡œë“œë°¸ëŸ°ì„œì˜ ëŒ€ìƒ ê·¸ë£¹ì—ë„ ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤ê°€ íƒ€ê²Ÿìœ¼ë¡œ ë“±ë¡ë˜ì–´ìˆëŠ”ì§€ í™•ì¸í•´ ë´…ë‹ˆë‹¤.Health statusê°€ unhealthyë¡œ ë˜ì–´ìˆìŠµë‹ˆë‹¤. í˜„ì¬ ë‹¨ê³„ì—ì„œëŠ” ì •ìƒì ì¸ íë¦„ì…ë‹ˆë‹¤. ì• í¬ìŠ¤íŒ…ì—ì„œ ì„¤ëª…í–ˆë‹¤ì‹œí”¼ ë¡œë“œë°¸ëŸ°ì„œê°€ ëŒ€ìƒ ê·¸ë£¹ì˜ health statusë¥¼ ê²€ì‚¬í•˜ê¸° ìœ„í•´ì„  ë¯¸ë¦¬ ì§€ì •í•´ë‘” ê²½ë¡œì˜ response status codeê°€ 200ì´ ë–¨ì–´ì ¸ì•¼ í•©ë‹ˆë‹¤.í•˜ì§€ë§Œ ìš°ë¦¬ê°€ ë°©ê¸ˆ ë§Œë“  í…œí”Œë¦¿ì€ nginxë‚˜ ë‹¤ë¥¸ ì›¹ì„œë²„ë“± ë¡œë“œë°¸ëŸ°ì„œì˜ 80í¬íŠ¸ ìš”ì²­ì— ì‘ë‹µí• ë§Œí•œ ë¬´ì–¸ê°€ë¥¼ ì„¤ì¹˜í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì¼ë‹¨ ì •ìƒì´ë‹ˆ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.CodeDeployë¬´ì¤‘ë‹¨ ë°°í¬ëŠ” AWS CodeDeployë¥¼ ì‚¬ìš©í•˜ì—¬ ì§„í–‰í•©ë‹ˆë‹¤. CodeDeployì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì€ ì´ê³³ ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.CodeDeploy ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„±ë‹¤ìŒì€ CodeDeploy ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. AWS ì½˜ì†”ì—ì„œ CodeDeployë¥¼ ê²€ìƒ‰í•˜ì—¬ ì§„ì…í•œ í›„ì— ì¢Œì¸¡ ë©”ë‰´ì˜ ë°°í¬ -&gt; ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ì´ë™í›„ ìš°ì¸¡ ìƒë‹¨ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„± ë²„íŠ¼ì„ ëˆŒëŸ¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤.ì»´í“¨íŒ… í”Œë«í¼ì˜ ê²½ìš° EC2ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ëŒë‹¤ë‚˜ ECS ì»¨í…Œì´ë„ˆë„ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.IAM ì—­í•  ìƒì„±ë‹¤ìŒì€ ë°°í¬ ê·¸ë£¹ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. ë°°í¬ ê·¸ë£¹ì„ ìƒì„±í•˜ê¸° ì „ì— ì„ í–‰ë˜ì–´ì•¼í•  ì‘ì—…ì´ ëª‡ê°€ì§€ ìˆëŠ”ë°ìš”, ë¨¼ì € IAM ì—­í• ì„ ìƒì„±í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.AWS ì½˜ì†”ì—ì„œ IAMì„ ê²€ìƒ‰í•´ IAM ê´€ë¦¬ ì½˜ì†”ë¡œ ì´ë™í•©ë‹ˆë‹¤. ê·¸ í›„ CodeDeploy ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ê¶Œí•œì„ ë¶€ì—¬í•˜ê³  ì—­í• ì„ ìƒì„±í•©ë‹ˆë‹¤.AutoScalingFullAccess ì™€ AWSCodeDeployRole ëŠ” ë¯¸ë¦¬ ì •í•´ì§„ ì •ì±…ì„ ì—°ê²°í•˜ë©´ ë©ë‹ˆë‹¤. ë§ˆì§€ë§‰ AmazonAutoScalingPolicyì˜ ê²½ìš° ê°œë°œìê°€ ìƒì„±í•´ì•¼ í•˜ëŠ” ì¸ë¼ì¸ ì •ì±…ì´ë©°, ì•„ë˜ jsonì„ ì •ì±…ì— ë¶™ì—¬ë„£ê³  ìƒì„±í•˜ë©´ ë©ë‹ˆë‹¤.{ \"Version\": \"2012-10-17\", \"Statement\": [ { \"Sid\": \"VisualEditor0\", \"Effect\": \"Allow\", \"Action\": [ \"iam:PassRole\", \"ec2:CreateTags\", \"ec2:RunInstances\" ], \"Resource\": \"*\" } ]}ë°°í¬ ê·¸ë£¹ ìƒì„±ìƒì„±í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìƒì„¸í™”ë©´ìœ¼ë¡œ ì´ë™í•œ í›„ ë°°í¬ ê·¸ë£¹ ìƒì„± í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.ìœ„ì—ì„œ ìƒì„±í•œ ì—­í• ì„ ì„œë¹„ìŠ¤ ì—­í• ë¡œ ì§€ì •í•˜ê³  ë°°í¬ ìœ í˜•ì€ ë¸”ë£¨/ê·¸ë¦°ì„ ì„ íƒí•©ë‹ˆë‹¤.ìœ„ì—ì„œ ìƒì„±í•œ Auto Scaling ê·¸ë£¹ì„ ì„ íƒí•©ë‹ˆë‹¤.ë°°í¬ ì„¤ì •ì˜ ê²½ìš° íŠ¸ë˜í”½ì€ ì¦‰ì‹œ ë‹¤ì‹œ ë¼ìš°íŒ…í•˜ê³  ì›ë³¸ ì¸ìŠ¤í„´ìŠ¤ì˜ ì¦‰ì‹œì¢…ë£Œ ì—¬ë¶€ëŠ” ê°ê°ì˜ ì •ì±…ì— ë§ê²Œ ì„¤ì •í•˜ì‹œë©´ ë ê²ƒ ê°™ìŠµë‹ˆë‹¤.ë¡œë“œë°¸ëŸ°ì„œ ì—­ì‹œ ê¸°ì¡´ì˜ ë¡œë“œë°¸ëŸ°ì„œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.ë¬´ì¤‘ë‹¨ ë°°í¬ì— í•„ìš”í•œ 1ì°¨ AWS ì„¸íŒ…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì¶”ê°€ë¡œ í•„ìš”í•œ ì„¸íŒ…ì´ë‚˜ ê²°ê³¼ í™•ì¸ì€ ì´í›„ Github - CodeDeploy ì—°ë™ì‹œ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤." }, { "title": "Hibernate @Where", "url": "/posts/hibernate-where/", "categories": "Hibernate", "tags": "Hibernate, JPA", "date": "2022-05-26 08:12:00 +0900", "snippet": "Hibernate @Where@Where ë€?ë–„ë•Œë¡œ ì»¤ìŠ¤í…€í•œ SQLì„ ì´ìš©í•´ ì—”í‹°í‹° í˜¹ì€ ì»¬ë ‰ì…˜ì„ í•„í„°ë§í•˜ê³  ì‹¶ì€ ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° Hibernate ì—ì„œ ì œê³µí•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ì¤‘ @Where ì´ë¼ëŠ” ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ ì‰½ê²Œ í•„í„°ë§ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.@Target({TYPE, METHOD, FIELD})@Retention(RUNTIME)public @interface Where {\tString clause();}ì–´ë…¸í…Œì´ì…˜ ìì²´ë„ ê°„ë‹¨í•©ë‹ˆë‹¤. where ì ˆì„ clause ë©¤ë²„ë³€ìˆ˜ì— ì‘ì„±í•˜ë¼ê³  ì•ˆë‚´í•˜ê³  ìˆìŠµë‹ˆë‹¤.Entityì— ì ìš©í•˜ê¸°ê°„ë‹¨í•œ ì˜ˆì œ ì—”í‹°í‹°ë¥¼ ì‘ì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤. ë¶€ëª¨ ì—”í‹°í‹° (MainOrder)ì™€ ìì‹ ì—”í‹°í‹°(SubOrder)ê°€ ì¡´ì¬í•˜ë©°, ì–‘ë°©í–¥ìœ¼ë¡œ ë§¤í•‘ì„ í•´ì£¼ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.@Entity@Data@AllArgsConstructor@NoArgsConstructor@ToString(exclude = {\"activeSubOrderList\", \"deActivatedSubOrderList\", \"fromNameLikeCList\"})@Table(name = \"main_order\")public class MainOrder { @Id @GeneratedValue(strategy = GenerationType.AUTO) private Long id; private LocalDate orderDate = LocalDate.now(); @OneToMany(mappedBy = \"mainOrder\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY) @Where(clause = \"active = true\") private List&lt;SubOrder&gt; activeSubOrderList; @OneToMany(mappedBy = \"mainOrder\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY) @Where(clause = \"active = false\") private List&lt;SubOrder&gt; deActivatedSubOrderList; @OneToMany(mappedBy = \"mainOrder\", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY) @Where(clause = \"LOWER(from_name) LIKE 'c%'\") private List&lt;SubOrder&gt; fromNameLikeCList;}@Entity@Data@AllArgsConstructor@NoArgsConstructor@Table(name = \"sub_order\")public class SubOrder { @Id @GeneratedValue(strategy = GenerationType.AUTO) private Long id; private String fromName; private String fromPhoneNumber; private String fromAddress; private String toName; private String toPhoneNumber; private String toAddress; @ManyToOne(optional = false, fetch = FetchType.LAZY) private MainOrder mainOrder; private boolean active;}@Where ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ê°ê°ì˜ ì¡°ê±´ì— ë¶€í•©í•˜ëŠ” ìì‹ ì—”í‹°í‹° ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜¬ìˆ˜ ìˆë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤. @Where ì–´ë…¸í…Œì´ì…˜ì˜ sql ë¬¸ì˜ í•„ë“œëª…ì€ ë°ì´í„°ë² ì´ìŠ¤ì˜ í•„ë“œëª…ì´ì–´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ë“¤ì–´ ìœ„ MainOrder ì—”í‹°í‹°ì˜ fromNameLikeCList ì˜ ê²½ìš° â€œLOWER(fromName) LIKE â€˜c%â€™â€ ë¼ê³  ì‘ì„±í•˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.ì¡°íšŒ ê²°ê³¼ í™•ì¸í•˜ê¸°ì—”í‹°í‹° ê°ì²´ë¥¼ ì‘ì„±í•˜ì˜€ìœ¼ë‹ˆ ì´ì œ ë”ë¯¸ë°ì´í„°ë¥¼ ë„£ê³  í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•´ë³´ê² ìŠµë‹ˆë‹¤. ë”ë¯¸ë°ì´í„°ëŠ” java-faker ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.public void initData() { var mainOrderList = new ArrayList&lt;MainOrder&gt;(); for (int i = 0; i &lt; 5; i ++) { var mainOrder = new MainOrder(); mainOrderList.add(mainOrderRepository.save(mainOrder)); } for (int i = 0; i &lt; 100; i ++) { var subOrder = new SubOrder(); subOrder.setActive(i % 3 == 0); subOrder.setFromName(JavaFakerGenerator.getName()); subOrder.setFromPhoneNumber(JavaFakerGenerator.getPhoneNumber()); subOrder.setFromAddress(JavaFakerGenerator.getAddress()); subOrder.setToName(JavaFakerGenerator.getName()); subOrder.setToPhoneNumber(JavaFakerGenerator.getPhoneNumber()); subOrder.setToAddress(JavaFakerGenerator.getAddress()); subOrder.setMainOrder(mainOrderList.get(i % 5)); subOrderRepository.save(subOrder); }}í™œì„±:ë¹„í™œì„±ì˜ ë¹„ìœ¨ì„ ì•½ 1:2 ì •ë„ì˜ ë¹„ìœ¨ë¡œ ì„¸íŒ…í•˜ì—¬ í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤.@Test@Transactionalvoid whereAnnotationTest1() { var mainOrderList = mainOrderRepository.findAll(); mainOrderList.forEach(mainOrder -&gt; { mainOrder.getActiveSubOrderList(); mainOrder.getDeActivatedSubOrderList(); mainOrder.getFromNameLikeCList(); });}í…ŒìŠ¤íŠ¸ ì½”ë“œì…ë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•œë‹¤ê¸° ë³´ë‹¤ ì¿¼ë¦¬ë¥¼ í™•ì¸í•  ëª©ì ìœ¼ë¡œ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.select activesubo0_.main_order_id as main_ord9_2_0_, activesubo0_.id as id1_2_0_, activesubo0_.id as id1_2_1_, activesubo0_.active as active2_2_1_, activesubo0_.from_address as from_add3_2_1_, activesubo0_.from_name as from_nam4_2_1_, activesubo0_.from_phone_number as from_pho5_2_1_, activesubo0_.main_order_id as main_ord9_2_1_, activesubo0_.to_address as to_addre6_2_1_, activesubo0_.to_name as to_name7_2_1_, activesubo0_.to_phone_number as to_phone8_2_1_ from sub_order activesubo0_ where ( activesubo0_.active = true ) and activesubo0_.main_order_id=1select deactivate0_.main_order_id as main_ord9_2_0_, deactivate0_.id as id1_2_0_, deactivate0_.id as id1_2_1_, deactivate0_.active as active2_2_1_, deactivate0_.from_address as from_add3_2_1_, deactivate0_.from_name as from_nam4_2_1_, deactivate0_.from_phone_number as from_pho5_2_1_, deactivate0_.main_order_id as main_ord9_2_1_, deactivate0_.to_address as to_addre6_2_1_, deactivate0_.to_name as to_name7_2_1_, deactivate0_.to_phone_number as to_phone8_2_1_ from sub_order deactivate0_ where ( deactivate0_.active = false ) and deactivate0_.main_order_id=1select fromnameli0_.main_order_id as main_ord9_2_0_, fromnameli0_.id as id1_2_0_, fromnameli0_.id as id1_2_1_, fromnameli0_.active as active2_2_1_, fromnameli0_.from_address as from_add3_2_1_, fromnameli0_.from_name as from_nam4_2_1_, fromnameli0_.from_phone_number as from_pho5_2_1_, fromnameli0_.main_order_id as main_ord9_2_1_, fromnameli0_.to_address as to_addre6_2_1_, fromnameli0_.to_name as to_name7_2_1_, fromnameli0_.to_phone_number as to_phone8_2_1_ from sub_order fromnameli0_ where ( LOWER(fromnameli0_.from_name) LIKE 'c%' ) and fromnameli0_.main_order_id=1ì„¸ ì¿¼ë¦¬ë¥¼ ë³´ë‹ˆ ëª¨ë‘ @Where ì–´ë…¸í…Œì´ì…˜ì— ì‘ì„±í•œ sqlë¬¸ ëŒ€ë¡œ ì˜ ìˆ˜í–‰ëœê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.QueryDSL ì—ì„œ ì‚¬ìš©í•˜ê¸°QueryDSL ì—ì„œë„ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ë“¤ì–´ fromNameì´ cë¡œ ì‹œì‘í•˜ëŠ” SubOrderê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°ì—ë§Œ MainOrderë¥¼ ê°€ì ¸ì™€ì•¼ í•œë‹¤ê³  ê°€ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.í‰ì†Œë¼ë©´ whereì ˆì— ì§ì ‘ ì„œë¸Œì¿¼ë¦¬ë¥¼ ì‘ì„±í•´ì•¼ í•˜ê² ì§€ë§Œ, @Where ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ë©´ ì‰½ê²Œ í‘œí˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒì€ ì˜ˆì œ / í…ŒìŠ¤íŠ¸ ì½”ë“œì…ë‹ˆë‹¤.@Test@Transactionalvoid whereAnnotationTest2() { var mq = QMainOrder.mainOrder; var sq = QSubOrder.subOrder; var subQueryFetch = jpaQueryFactory .select(mq) .from(mq) .where(JPAExpressions.select(sq.mainOrder.count()).from(sq).where(mq.eq(sq.mainOrder).and(sq.fromName.startsWithIgnoreCase(\"c\"))).gt(0L)) .fetch(); var whereAnnotationFetch = jpaQueryFactory .select(mq) .from(mq) .where(mq.fromNameLikeCList.size().gt(0L)) .fetch(); Assert.isTrue(subQueryFetch.size() == whereAnnotationFetch.size(), \"test failed\");}ì²«ë²ˆì§¸ subQueryFetchì˜ ê²½ìš° whereì ˆì— ì§ì ‘ ì„œë¸Œì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ì˜€ê³ , ë‘ë²ˆì§¸ whereAnnotationFetchì˜ ê²½ìš° ë‹¨ìˆœíˆ @OneToManyë¡œ ë§¤í•‘ëœ ì—”í‹°í‹°ì˜ ì‚¬ì´ì¦ˆë¥¼ ë¶ˆëŸ¬ì™€ ë¹„êµí•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.select mainorder0_.id as id1_0_, mainorder0_.order_date as order_da2_0_ from main_order mainorder0_ where ( select count(suborder1_.main_order_id) from sub_order suborder1_ cross join main_order mainorder2_ where suborder1_.main_order_id=mainorder2_.id and mainorder0_.id=suborder1_.main_order_id and ( lower(suborder1_.from_name) like 'c%' escape '!' ) )&gt;0select mainorder0_.id as id1_0_, mainorder0_.order_date as order_da2_0_ from main_order mainorder0_ where ( select count(fromnameli1_.main_order_id) from sub_order fromnameli1_ where mainorder0_.id = fromnameli1_.main_order_id and ( LOWER(fromnameli1_.from_name) LIKE 'c%' ) )&gt;0í…ŒìŠ¤íŠ¸ë„ í†µê³¼í•˜ê³  ê²°ê³¼ë„ ë™ì¼í•œê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì²˜ëŸ¼ QueryDSLì—ë„ ì‰½ê²Œ ì‚¬ìš©ê°€ëŠ¥í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." }, { "title": "ë¦¬ì•¡íŠ¸ë¡œ ë©€í‹°íƒ­ êµ¬í˜„í•˜ê¸° (feat. Recoil)", "url": "/posts/react-multitab/", "categories": "React", "tags": "React, Recoil", "date": "2022-04-17 08:12:00 +0900", "snippet": "ë¦¬ì•¡íŠ¸ë¡œ ë©€í‹°íƒ­ êµ¬í˜„í•˜ê¸°íƒ­ì„ í´ë¦­í–ˆì„ë•Œ í•´ë‹¹ íƒ­ì˜ ì»´í¬ë„ŒíŠ¸ë¥¼ ë³´ì—¬ì£¼ëŠ” ë°©ì‹ì˜ ì½”ë“œë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì¸í„°ë„·ì— ê²€ìƒ‰í•´ë³´ë©´ ë§ìŠµë‹ˆë‹¤. ë‹¹ì¥ npmì—ë§Œ ë´ë„ ì¡°ê¸ˆ ì˜¤ë˜ë˜ê¸´ í–ˆì§€ë§Œ ì´ëŸ° ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ ì¡´ì¬í•©ë‹ˆë‹¤.í•˜ì§€ë§Œ íƒ­ì„ í´ë¦­í–ˆì„ë•Œ í•´ë‹¹ íƒ­ì„ ìƒˆë¡œìš´ ì»´í¬ë„ŒíŠ¸ë¡œì¨ ì˜¤í”ˆí•˜ê³  ì˜¤í”ˆëœ ì»´í¬ë„ŒíŠ¸ë“¤ì˜ ë¦¬ìŠ¤íŠ¸ë¥¼ ê´€ë¦¬í•˜ëŠ” í˜•íƒœì˜ ì˜ˆì œì½”ë“œëŠ” ë³„ë¡œ ì—†ëŠ”ê²ƒ ê°™ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì˜¤ëŠ˜ì€ ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ ë©€í‹°íƒ­ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.ì‚¬ìš© ë¼ì´ë¸ŒëŸ¬ë¦¬ì•„ë˜ëŠ” ì´ ì˜ˆì œì—ì„œ ì‚¬ìš©ë  ë¼ì´ë¸ŒëŸ¬ë¦¬ ì…ë‹ˆë‹¤. bootstrap, react-dnd, recoil, sass ë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.package.json{ \"name\": \"react-multi-tab\", \"private\": true, \"version\": \"0.0.0\", \"scripts\": { \"dev\": \"vite\", \"build\": \"tsc &amp;&amp; vite build\", \"preview\": \"vite preview\" }, \"dependencies\": { \"bootstrap\": \"^5.1.3\", \"path\": \"^0.12.7\", \"react\": \"^18.0.0\", \"react-bootstrap\": \"^2.3.0\", \"react-dnd\": \"^16.0.1\", \"react-dnd-html5-backend\": \"^16.0.1\", \"react-dom\": \"^18.0.0\", \"recoil\": \"^0.7.2\", \"sass\": \"^1.50.1\" }, \"devDependencies\": { \"@types/react\": \"^18.0.0\", \"@vitejs/plugin-react\": \"^1.3.0\", \"typescript\": \"^4.6.3\", \"vite\": \"^2.9.5\" }}recoil ì½”ë“œ ì¤€ë¹„ì´ ì˜ˆì œëŠ” recoilì„ ì‚¬ìš©í•©ë‹ˆë‹¤. í˜„ì¬ ì‹œì ì—ëŠ” ëª¨ë¥´ëŠ” ë¶„ì´ ê±°ì˜ ì—†ë‹¤ê³  ìƒê°ë©ë‹ˆë‹¤ë§Œ, í˜¹ì‹œ ì²˜ìŒë“¤ì–´ë³´ì•˜ê±°ë‚˜ ì˜ ëª¨ë¥´ì‹œë‹¤ë©´ ì´ê³³ ì„ ì½ìœ¼ë©° í•™ìŠµí•´ë³´ì„¸ìš”. ê°œì¸ì ìœ¼ë¡œ ê³µì‹ ë¬¸ì„œë¥¼ ì½ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ì‰½ê²Œ ì´í•´ ê°€ëŠ¥í•˜ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.ë¨¼ì € RecoilNexusë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤. recoilì€ ì¼ì¢…ì˜ í›…ì´ê¸° ë•Œë¬¸ì— í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸ ì•ˆì—ì„œë§Œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì €ëŠ” ìœ í‹¸ì„± í´ë˜ìŠ¤ì—ì„œ recoilì„ ì‚¬ìš©í•˜ê³  ì‹¶ê¸° ë•Œë¬¸ì— RecoilNexusë¥¼ ë§Œë“¤ì–´ ì¼ë°˜ í´ë˜ìŠ¤ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ í•˜ê² ìŠµë‹ˆë‹¤.import {RecoilState, RecoilValue, useRecoilCallback} from 'recoil';interface Nexus { get?: &lt;T&gt;(atom: RecoilValue&lt;T&gt;) =&gt; T getPromise?: &lt;T&gt;(atom: RecoilValue&lt;T&gt;) =&gt; Promise&lt;T&gt; set?: &lt;T&gt;(atom: RecoilState&lt;T&gt;, valOrUpdater: T | ((currVal: T) =&gt; T)) =&gt; void reset?: (atom: RecoilState&lt;any&gt;) =&gt; void}const nexus: Nexus = {}export default function RecoilNexus() { nexus.get = useRecoilCallback&lt;[atom: RecoilValue&lt;any&gt;], any&gt;(({ snapshot }) =&gt; function &lt;T&gt;(atom: RecoilValue&lt;T&gt;) { return snapshot.getLoadable(atom).contents }, []) nexus.getPromise = useRecoilCallback&lt;[atom: RecoilValue&lt;any&gt;], Promise&lt;any&gt;&gt;(({ snapshot }) =&gt; function &lt;T&gt;(atom: RecoilValue&lt;T&gt;) { return snapshot.getPromise(atom) }, []) // @ts-ignore nexus.set = useRecoilCallback(({ set }) =&gt; set, []) nexus.reset = useRecoilCallback(({ reset }) =&gt; reset, []) return null}export function getRecoil&lt;T&gt;(atom: RecoilValue&lt;T&gt;): T { return nexus.get!(atom)}export function getRecoilPromise&lt;T&gt;(atom: RecoilValue&lt;T&gt;): Promise&lt;T&gt; { return nexus.getPromise!(atom)}export function setRecoil&lt;T&gt;(atom: RecoilState&lt;T&gt;, valOrUpdater: T | ((currVal: T) =&gt; T)) { nexus.set!(atom, valOrUpdater)}export function resetRecoil(atom: RecoilState&lt;any&gt;) { nexus.reset!(atom)}ì´ë ‡ê²Œ ë§Œë“  RecoilNexusë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ì»´í¬ë„ŒíŠ¸ ë Œë”ë§í•˜ëŠ” Main ì½”ë“œì— ì „ì²´ ì»´í¬ë„ŒíŠ¸ë¥¼ RecoilRootë¡œ ê°ì‹¸ì£¼ê³  ë‚´ë¶€ì— RecoilNexusë¥¼ ì„ ì–¸í•´ì•¼ í•©ë‹ˆë‹¤.ReactDOM.createRoot(document.getElementById('root')!).render( &lt;RecoilRoot&gt; &lt;RecoilNexus /&gt; &lt;/RecoilRoot&gt;)React18 ë¶€í„°ëŠ” ReactDOM.render ëŒ€ì‹  ReactDOM.createRoot ë¥¼ ì¨ì•¼ ì—ëŸ¬ê°€ ë‚˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì ì„ ìŠì§€ ë§ì•„ì£¼ì„¸ìš”.ë‹¤ìŒì€ íƒ­ ì»´í¬ë„ŒíŠ¸ì— ì“°ì¼ recoil atomì˜ ë°ì´í„° íƒ€ì…ì…ë‹ˆë‹¤.export default interface RouterComponentModel { displayName: string, uniqueKey: string, sequence: number, active: boolean, component: JSX.Element}ë¸Œë¼ìš°ì €ì— ë³´ì—¬ì§ˆ ì´ë¦„, ì‹œí€€ìŠ¤, ìœ ë‹ˆí¬í‚¤, í™œì„±í™” ì—¬ë¶€, ë Œë”ë§í•  ì»´í¬ë„ŒíŠ¸ì˜ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.ë‹¤ìŒì€ recoil atom ì…ë‹ˆë‹¤.import {atom} from 'recoil';import RouterComponentModel from '@/model/router-component.model';const RouterComponentAtom = atom&lt;RouterComponentModel[]&gt;({ key: 'routerComponent', default: []});export default RouterComponentAtom;RouterControlUtil í´ë˜ìŠ¤ë‹¤ìŒìœ¼ë¡œ ì‘ì„±í•  ì½”ë“œëŠ” RouterControlUtil í´ë˜ìŠ¤ ì…ë‹ˆë‹¤. ì•ì—ì„œ ë§í–ˆë‹¤ì‹œí”¼ ì €ëŠ” RouterComponentAtomì„ ì»¨íŠ¸ë¡¤í•˜ëŠ” ì½”ë“œë¥¼ ëª¨ë‘ í•œê³³ì—ì„œ ëª¨ì•„ ì²˜ë¦¬í•  ê³³ì´ê¸° ë•Œë¬¸ì— ì´ ìœ í‹¸ í´ë˜ìŠ¤ê°€ ì œì¼ ì¤‘ìš”í•˜ë‹¤ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.1. ì»´í¬ë„ŒíŠ¸ ë¦¬ìŠ¤íŠ¸ ì¶”ê°€ / ì—…ë°ì´íŠ¸ìœ„ ì´ë¯¸ì§€ì²˜ëŸ¼ íƒ­ì„ í´ë¦­í–ˆì„ì‹œ ì»´í¬ë„ŒíŠ¸ë¥¼ ì¶”ê°€í•˜ê³ , ë§Œì•½ ì¤‘ë³µíƒ­ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš° ì´ë¯¸ ì—´ë ¤ìˆëŠ” íƒ­ì„ activeë¡œ ë§Œë“œëŠ” ì½”ë“œë¥¼ ì‘ì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤.export default class RouterControlUtil { static MAX_TAB_SIZE = 15; static MAX_TAB_MESSAGE = `ìµœëŒ€ íƒ­ ê°¯ìˆ˜ì— ë„ë‹¬í•˜ì˜€ìŠµë‹ˆë‹¤. (${this.MAX_TAB_SIZE} ê°œ)`; static atom = RouterComponentAtom; static saveOrUpdateComponent = (component: JSX.Element, allowDuplicateTab?: boolean) =&gt; { const value: RouterComponentModel[] = getRecoil(this.atom) if (value.length &gt;= this.MAX_TAB_SIZE) { alert(this.MAX_TAB_MESSAGE); return; } //////////////////// ì¤‘ë³µíƒ­ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš° //////////////////// if (allowDuplicateTab !== true) { // ë§Œì•½ ì´ë¯¸ recoilì— ì €ì¥ëœ ì»´í¬ë„ŒíŠ¸ê°€ ìˆë‹¤ë©´ í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ì˜ showë¥¼ trueë¡œ ì„¸íŒ…í•˜ê³  ëë‚¸ë‹¤. if (value.some(v =&gt; v.displayName === component.type.name)) { this.setRecoil([ ...value.map(v =&gt; { return { ...v, active: v.displayName === component.type.name} as RouterComponentModel; })]); return; } // ì—†ë‹¤ë©´ ìƒˆë¡œ ì¶”ê°€í•œë‹¤. this.setRecoil([ ...value.map(v =&gt; { return { ...v, active: false } as RouterComponentModel }), this.generateComponentModel(component)]); return; } //////////////////// ì¤‘ë³µíƒ­ì„ í—ˆìš©í•˜ëŠ” ê²½ìš° //////////////////// const componentModel: RouterComponentModel = this.generateComponentModel(component); // ì¤‘ë³µíƒ­ì„ í—ˆìš©í•˜ëŠ”ê²½ìš° ë§ˆì§€ë§‰ ì‹œí€€ìŠ¤ë¥¼ ì°¾ì•„ì„œ ìƒˆë¡­ê²Œ ë§Œë“¤ íƒ­ì˜ ì‹œí€€ìŠ¤ë¥¼ +1 ì‹œì¼œì¤˜ì•¼ í•œë‹¤. const filteredList = value.filter(v =&gt; v.displayName === component.type.name); if (filteredList.length === 0) { this.setRecoil([ ...value.map(v =&gt; { return { ...v, active: false } as RouterComponentModel }), componentModel ]); return; } const lastComponent = filteredList.sort((pv, nx) =&gt; pv.sequence - nx.sequence)[filteredList.length - 1]; componentModel.sequence = lastComponent.sequence + 1; this.setRecoil([ ...value.map(v =&gt; { return { ...v, active: false } as RouterComponentModel }), componentModel ]); } private static generateComponentModel = (component: JSX.Element): RouterComponentModel =&gt; { return { displayName: component.type.name, uniqueKey: crypto.randomUUID(), component: component, active: true, sequence: 1 } as RouterComponentModel }} ë¨¼ì € í˜„ì¬ íƒ­ì˜ ê°¯ìˆ˜ë¥¼ íŒŒì•…í•˜ì—¬ ë§Œì•½ ìµœëŒ€ íƒ­ ê°¯ìˆ˜ì— ë„ë‹¬í•˜ì˜€ë‹¤ë©´ ë©”ì‹œì§€ë¥¼ alertí•˜ê³  ì¢…ë£Œ í•©ë‹ˆë‹¤. ì¤‘ë³µíƒ­ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš° ì´ë¯¸ ì—´ë¦° íƒ­ì´ ìˆë‹¤ë©´ í•´ë‹¹ íƒ­ì„ í™œì„± ìƒíƒœë¡œ ë§Œë“¤ê³  ì¢…ë£Œ í•©ë‹ˆë‹¤. ì—´ë¦° íƒ­ì´ ì—†ë‹¤ë©´ ìƒˆë¡œìš´ íƒ­ì„ ì¶”ê°€í•©ë‹ˆë‹¤. ì´ë–„ uniqueKeyëŠ” crpyto.randomUUID() ë¥¼ ì´ìš©í•˜ì˜€ìŠµë‹ˆë‹¤. ì¤‘ë³µíƒ­ì„ í—ˆìš©í•˜ëŠ” ê²½ìš° ì´ë¯¸ ì—´ë¦° íƒ­ì´ ìˆë‹¤ë©´ ì´ë¯¸ ì—´ë¦° íƒ­ë“¤ì¤‘ ë§ˆì§€ë§‰ íƒ­ì„ ì°¾ì•„ ìƒˆë¡­ê²Œ ë§Œë“¤ íƒ­ì˜ ì‹œí€€ìŠ¤ë¥¼ ë§ˆì§€ë§‰íƒ­ì˜ ì‹œí€€ìŠ¤ + 1 ì²˜ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤. ì—´ë¦´íƒ­ì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ íƒ­ë“¤ì˜ activeëŠ” falseë¡œ ì„¸íŒ…í•©ë‹ˆë‹¤.2. ì»´í¬ë„ŒíŠ¸ ì—´ê¸°ë‹¤ìŒì€ ì—´ë¦° íƒ­ì¤‘ í•˜ë‚˜ë¥¼ í´ë¦­í•´ í´ë¦­í•œ íƒ­ì„ í™œì„±í™”í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.static openComponent = (component: RouterComponentModel) =&gt; { const value: RouterComponentModel[] = getRecoil(this.atom) this.setRecoil([ ...value.map((v) =&gt; { return { ...v, active: this.isUniqueKeyEqual(v, component) } as RouterComponentModel })]);}í´ë¦­í•œ íƒ­ì˜ ì»´í¬ë„ŒíŠ¸ë¥¼ ì¸ìë¡œ ë°›ì•„ loopë¥¼ ëŒë©° uniqueKeyê°€ ë™ì¼í•˜ë©´ activeë¥¼ trueë¡œ ì„¸íŒ…í•˜ê³ , ê·¸ë ‡ì§€ ì•Šë‹¤ë©´ falseë¡œ ì„¸íŒ…í•©ë‹ˆë‹¤.3. ì»´í¬ë„ŒíŠ¸ ë‹«ê¸°ë‹¤ìŒì€ ì—´ë ¤ ìˆëŠ” íƒ­ì¤‘ í•˜ë‚˜ë¥¼ ë‹«ëŠ” ì½”ë“œì…ë‹ˆë‹¤.static closeComponent = (component: RouterComponentModel) =&gt; { let value: RouterComponentModel[] = getRecoil(this.atom); const activeComponent: RouterComponentModel | undefined = value.find(v =&gt; v.active &amp;&amp; this.isUniqueKeyEqual(component, v)); const activeComponentIdx: number = value.findIndex(v =&gt; this.isUniqueKeyEqual(component, v)); // ë‹«ìœ¼ë ¤ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ í™œì„±í™”ëœ ì»´í¬ë„ŒíŠ¸ë¼ë©´ ë§¨ ì•ì—ìˆëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ í™œì„± ìƒíƒœë¡œ ë§Œë“ ë‹¤ (0ì´ë¼ë©´ 1) if (value.length &gt; 1) { if (activeComponent !== undefined) { if (this.isUniqueKeyEqual(activeComponent, component)) { value = value.map((v, idx) =&gt; { return { ...v, active: (activeComponentIdx === 0 ? (idx === 1) : idx === 0) } as RouterComponentModel }) } } } let filteredValue = value.filter(v =&gt; !this.isUniqueKeyEqual(v, component)); // ì‹œí€€ìŠ¤ ì¬ì •ë ¬ if (filteredValue.length &gt; 0) { filteredValue = filteredValue.map(v =&gt; { // ì§€ì›Œì§„ ì»´í¬ë„ŒíŠ¸ì˜ ì‹œí€€ìŠ¤ë³´ë‹¤ í° ì‹œí€€ìŠ¤ë¥¼ ê°€ì§„ ì»´í¬ë„ŒíŠ¸ if (v.displayName === component.displayName &amp;&amp; v.sequence &gt; component.sequence) { return { ...v, sequence: v.sequence - 1 } as RouterComponentModel; } return v ; }); } this.setRecoil(filteredValue);}ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹«ëŠ” ì½”ë“œì—ëŠ” ì£¼ì˜í•´ì•¼í• ì ì´ ìˆìŠµë‹ˆë‹¤. ë‹«ìœ¼ë ¤ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ í™œì„±í™”ëœ ì»´í¬ë„ŒíŠ¸ë¼ë©´ í™œì„±í™”ë  ì»´í¬ë„ŒíŠ¸ë¥¼ ì§€ì •í•´ì¤˜ì•¼ í•˜ì§€ìš”. ë”°ë¼ì„œ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚­ì œí•˜ê¸° ì „ì— ë¨¼ì € í™œì„±í™”ë  ì»´í¬ë„ŒíŠ¸ë¥¼ ì§€ì •í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚­ì œí•œ í›„ì—ëŠ” ì‹œí€€ìŠ¤ë¥¼ ì¬ì •ë ¬í•˜ëŠ” ì½”ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤. ë§Œì•½ ì§€ì›Œì§„ ì»´í¬ë„ŒíŠ¸ì˜ ì‹œí€€ìŠ¤ê°€ 2ë¼ë©´ 2ë³´ë‹¤ í° ì‹œí€€ìŠ¤ë¥¼ ê°€ì§„ ê°™ì€ ì´ë¦„ì˜ ì»´í¬ë„ŒíŠ¸ë“¤ì€ ê·¸ ì‹œí€€ìŠ¤ì—ì„œ -1ì„ í•´ì¤˜ì•¼ í•˜ì§€ìš”.RouterControlUtil í´ë˜ìŠ¤ ë§ˆë¬´ë¦¬RouterControlUtil í´ë˜ìŠ¤ ì‘ì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‚¨ì€ê²ƒì€ ë·°ë¥¼ ì´ì˜ê²Œ ê·¸ë¦¬ê³  ì•Œë§ì€ ì‹œì ì— ì•Œë§ì€ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ”ê²ƒ ë¿ì…ë‹ˆë‹¤.Drag and Drop êµ¬í˜„ì´ëŒ€ë¡œ ëë‚´ê¸´ ë­”ê°€ì¢€ ì•„ì‰½ìŠµë‹ˆë‹¤. Drag and dropìœ¼ë¡œ ì»´í¬ë„ŒíŠ¸ë“¤ì˜ ìˆœì„œë¥¼ ë³€ê²½í•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì´ ë™ì‘í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.1. RouterControlUtil í´ë˜ìŠ¤ ìˆ˜ì •ì¼ë‹¨ RouterControlUtil í´ë˜ìŠ¤ì— ìˆœì„œë¥¼ ì¬ì§€ì •í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì¶”ê°€í•˜ê² ìŠµë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” ëŒ€ìƒ ì»´í¬ë„ŒíŠ¸ì™€ ëŒ€ìƒ ì»´í¬ë„ŒíŠ¸ê°€ ì´ë™ë  ìœ„ì¹˜ ì¸ë±ìŠ¤ë¥¼ ì¸ìë¡œ ë°›ìŠµë‹ˆë‹¤.static controlOrder = (currentComponent: RouterComponentModel, targetIndex: number) =&gt; { const componentModelValue: RouterComponentModel[] = getRecoil(this.atom) const draggedComponentIndex: number = componentModelValue.findIndex(value =&gt; value.uniqueKey === currentComponent.uniqueKey); if (targetIndex === draggedComponentIndex) return; const existingComponent = componentModelValue[targetIndex]; const newComponentModelValue = componentModelValue.map((item, idx) =&gt; { if (idx === targetIndex) return { ...currentComponent, active: true } as RouterComponentModel; if (idx === draggedComponentIndex) return { ...existingComponent, active: false } as RouterComponentModel; return { ...item, active: false } as RouterComponentModel; }); this.setRecoil(newComponentModelValue);} ëŒ€ìƒ ì»´í¬ë„ŒíŠ¸ì˜ ì¸ë±ìŠ¤ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤. ë§Œì•½ ì´ë™ë  ìœ„ì¹˜ì™€ ëŒ€ìƒ ì»´í¬ë„ŒíŠ¸ì˜ ìœ„ì¹˜ê°€ ë™ì¼í•˜ë‹¤ë©´ í•¨ìˆ˜ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤. ì´ë™ë  ìœ„ì¹˜ì— ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ existingComponent ì— í• ë‹¹í•©ë‹ˆë‹¤. ì´ì œ ë£¨í”„ë¥¼ ëŒë©° ìˆœì„œë¥¼ ì¬ì§€ì • í•©ë‹ˆë‹¤. ì´ë•Œ ê¸°ì¡´ì˜ í™œì„±í™” ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ ëŒ€ìƒ ì»´í¬ë„ŒíŠ¸ë“¤ í™œì„± ìƒíƒœë¡œ ë§Œë“­ë‹ˆë‹¤.2. Drag and Drop ì½”ë“œ ì‘ì„±Drag and drop ì½”ë“œë¥¼ ì‘ì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤. ìœ„ íŒ¨í‚¤ì§€ ì„¤ëª…ì—ë„ ë‚˜ì™€ìˆë“¯ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” react-dndë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.interface Props { component: RouterComponentModel, index: number,}const Tab = (props: Props): JSX.Element =&gt; { const [{isDragging}, dragRef] = useDrag(() =&gt; ({ type: 'item', item: props.component, collect: monitor =&gt; ({ isDragging: monitor.isDragging(), }), })) const [spec, dropRef] = useDrop({ accept: 'item', hover: (item, monitor) =&gt; { RouterControlUtil.controlOrder(item as RouterComponentModel, props.index); } }) const ref = useRef(null); const dragDropRef = dragRef(dropRef(ref)); const opacity = isDragging ? 0.3 : 1; return ( &lt;div // @ts-ignore ref={dragDropRef} className={`${style.item} ${RouterControlUtil.isActiveComponent(props.component) ? style.active : ''}`} style={{ ...style, opacity }} &gt; &lt;button className={style.btn} onClick={() =&gt; RouterControlUtil.openComponent(props.component)}&gt; {RouterControlUtil.getTabName(props.component)} &lt;/button&gt; &lt;button className={style.btnClose} onClick={() =&gt; RouterControlUtil.closeComponent(props.component)} /&gt; &lt;/div&gt; )}export default Tabê°„ë‹¨í•œ ì½”ë“œì…ë‹ˆë‹¤. í•µì‹¬ì€ [spec, dropRef] ë¶€ë¶„ì¸ë°ìš”, hover ì´ë²¤íŠ¸ê°€ ì¼ì–´ë‚˜ë©´ ìœ„ì—ì„œ ì‘ì„±í•œ controlOrder() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ìˆœì„œê°€ ë³€ê²½ë  ìˆ˜ ìˆë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.ë§ˆë¬´ë¦¬ë¦¬ì•¡íŠ¸ ë¼ìš°í„°ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ë©€í‹°íƒ­ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì†Œê°œí•´ ë³´ì•˜ìŠµë‹ˆë‹¤. ë‹¨, ìœ„ì˜ ì½”ë“œë¡œëŠ” ì‹¤ì œ urlì´ ë³€ê²½ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë§Œì•½ urlì´ ë³€ê²½ë˜ê²Œ í•˜ê³  ì‹¶ë‹¤ë©´ ì¶”ê°€ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.ì´ê³³ ì—ì„œ ì „ì²´ ì½”ë“œë¥¼ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤." }, { "title": "Spring Transaction Propagation", "url": "/posts/spring-transactional-propagation/", "categories": "Spring", "tags": "Spring, Transaction", "date": "2022-03-31 08:12:00 +0900", "snippet": "íŠ¸ëœì­ì…˜ ì „íŒŒë ˆë²¨Springì˜ @Transactional ì–´ë…¸í…Œì´ì…˜ì—ëŠ” ë§ì€ ì˜µì…˜ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì €ë²ˆì— ì•Œì•„ë³¸ ê²©ë¦¬ ë ˆë²¨ ë„ ê·¸ì¤‘ í•˜ë‚˜ì´ì§€ìš”. ì´ë²ˆì— ì•Œì•„ë³¼ ì˜µì…˜ì€ Propagation(ì „íŒŒë ˆë²¨) ì˜µì…˜ì…ë‹ˆë‹¤.íŠ¸ëœì­ì…˜ì—ì„œì˜ ì „íŒŒëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ íŠ¸ëœì­ì…˜ ê²½ê³„ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. ìŠ¤í”„ë§ì€ ê°œë°œìê°€ ì„¤ì •í•œ ë ˆë²¨ì— ë”°ë¼ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³  ì¤‘ì§€í•©ë‹ˆë‹¤. ìŠ¤í”„ë§ì€ TransactionManager:getTransaction()ì„ í˜¸ì¶œí•˜ì—¬ ì „íŒŒë ˆë²¨ì— ë”°ë¼ íŠ¸ëœì­ì…˜ì„ ê°€ì ¸ì˜¤ê±°ë‚˜ ë§Œë“­ë‹ˆë‹¤. ì´ëŠ” Transaction Managerì˜ ëª¨ë“  ìœ í˜•ì˜ ì „íŒŒë ˆë²¨ì¤‘ ì¼ë¶€ë¥¼ ì§€ì›í•˜ì§€ë§Œ, íŠ¹ì •í•œ êµ¬í˜„ì²´ì—ì„œë§Œ ì§€ì›ë˜ëŠ” ì „íŒŒë ˆë²¨ë„ ì¼ë¶€ ìˆìŠµë‹ˆë‹¤.1. REQUIREDREQUIREDëŠ” ê¸°ë³¸ ì „íŒŒë ˆë²¨ ì…ë‹ˆë‹¤. ìŠ¤í”„ë§ì€ í™œì„±í™”ëœ íŠ¸ëœì­ì…˜ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ë§Œì•½ ì—†ë‹¤ë©´ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤. ì¡´ì¬í•˜ëŠ” íŠ¸ëœì­ì…˜ì´ ìˆë‹¤ë©´ ì‹¤í–‰í•  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ í™œì„±í™”ëœ íŠ¸ëœì­ì…˜ì— ì¶”ê°€ë©ë‹ˆë‹¤.@Entity@Data@NoArgsConstructor@AllArgsConstructor@Table(name = \"soccer_player\")public class SoccerPlayer { @Id @GeneratedValue(strategy = GenerationType.AUTO) Long id; String name; @ManyToOne SoccerTeam soccerTeam; @Override public String toString() { return String.format(\"name = %s / soccerTeamName = %s\", name, soccerTeam != null ? soccerTeam.getName() : null); }}@Repositorypublic interface SoccerPlayerRepository extends JpaRepository&lt;SoccerPlayer, Long&gt; {}@Servicepublic class TransactionService { @Autowired SoccerPlayerRepository soccerPlayerRepository; @Autowired TransactionChildService transactionChildService; @Transactional public void required() { SoccerPlayer player1 = new SoccerPlayer(); player1.setName(\"ì†í¥ë¯¼\"); try { transactionChildService.insert(player1); } catch (Exception ex) { ex.printStackTrace(); } SoccerPlayer player2 = new SoccerPlayer(); player2.setName(\"ë°•ì§€ì„±\"); soccerPlayerRepository.save(player2); }}@Servicepublic class TransactionChildService { @Autowired SoccerPlayerRepository soccerPlayerRepository; @Transactional(propagation = Propagation.REQUIRED) public void insert(SoccerPlayer soccerPlayer) { soccerPlayerRepository.save(soccerPlayer); throw new RuntimeException(\"throw exception\"); }}@SpringBootTestpublic class TransactionPropagationTest { @Autowired TransactionService transactionService; @Autowired SoccerPlayerRepository soccerPlayerRepository; @Test public void REQUIRED() { transactionService.required(); var list = soccerPlayerRepository.findAll(); Assert.notNull(list, \"soccer player list must not be null\"); }}ì˜ˆì œ ì½”ë“œì…ë‹ˆë‹¤. ì²«ë²ˆì§¸ ì˜ˆì œë¼ ì•ìœ¼ë¡œì˜ í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©ë˜ëŠ” entity, repository, service ë° test class ê¹Œì§€ ëª¨ë‘ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.ë¶€ëª¨ ë©”ì†Œë“œì—ì„œ ìì‹ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ê³  ìì‹ ë©”ì†Œë“œëŠ” ì—ëŸ¬ë¥¼ throw í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤. transactionChildService.insert() ë¥¼ try - catch êµ¬ë¬¸ìœ¼ë¡œ ê°ìŒŒê¸°ë•Œë¬¸ì— ë¬¸ì œì—†ëŠ” ì½”ë“œë¼ê³  ìƒê°ì´ ë“¤ ìˆ˜ë„ ìˆì§€ë§Œ ë§‰ìƒ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë³´ë©´ Transaction silently rolled back because it has been marked as rollback-only ë¼ëŠ” ì—ëŸ¬ë¥¼ ë˜ì§€ê³  í…ŒìŠ¤íŠ¸ê°€ ì¢…ë£Œë©ë‹ˆë‹¤.REQUIREDì˜ í•µì‹¬ì€ ëª¨ë“  íŠ¸ëœì­ì…˜ì´ í•˜ë‚˜ë¡œ ì—°ê²°ë˜ëŠ” ê²ƒì´ë¯€ë¡œ ëª¨ë“  ë¡œì§ì´ ì •ìƒì ìœ¼ë¡œ í†µê³¼ ë˜ë”ë¼ë„ íŠ¸ëœì­ì…˜ì´ ëë‚˜ëŠ” ì‹œì ì—ëŠ” ë¡¤ë°±ì´ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ìì„¸í•œ ì´ìœ ëŠ” ì´ í¬ìŠ¤íŠ¸ë¥¼ í†µí•´ í™•ì¸í•´ ë³´ì„¸ìš”.2. SUPPORTSë‘ë²ˆì§¸ëŠ” SUPPORTS ì „íŒŒë ˆë²¨ ì…ë‹ˆë‹¤. í™œì„±í™”ëœ íŠ¸ëœì­ì…˜ì´ ìˆë‹¤ë©´ ê·¸ê²ƒì„ ì‚¬ìš©í•˜ê³ , ë§Œì•½ ì—†ë‹¤ë©´ íŠ¸ëœì­ì…˜ ì—†ì´ ë©”ì†Œë“œê°€ ìˆ˜í–‰ë©ë‹ˆë‹¤.@Testpublic void SUPPORTS_1() { transactionService.supports_1(); var list = soccerPlayerRepository.findAll(); Assert.isTrue(list.size() == 10, \"size of soccer player list must be 2\");}@Testpublic void SUPPORTS_2() { transactionService.supports_2(); var list = soccerPlayerRepository.findAll(); Assert.isTrue(list.size() == 10, \"size of soccer player list must be 2\");}@Transactionalpublic void supports_1() { doSupportsTest();}public void supports_2() { doSupportsTest();}private void doSupportsTest() { for (int i = 0; i &lt; 10; i ++) { try { long seq = (long) i + 1; var soccerPlayer = new SoccerPlayer(); soccerPlayer.setId(seq); soccerPlayer.setName(\"ì„ ìˆ˜\" + seq); transactionChildService.insertSupports(soccerPlayer); } catch (Exception ex) { ex.printStackTrace(); } }}@Transactional(propagation = Propagation.SUPPORTS)public void insertSupports(SoccerPlayer soccerPlayer){ if (soccerPlayer.getId() &gt; 5L) { throw new RuntimeException(\"throw exception\"); } soccerPlayerRepository.save(soccerPlayer);}ì˜ˆì œ ì½”ë“œì…ë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ë¥¼ SUPPORTS_1()ê³¼ SUPPORTS_2()ë¡œ ë‚˜ëˆ´ìŠµë‹ˆë‹¤. ì²«ë²ˆì¬ í…ŒìŠ¤íŠ¸ì˜ ê²½ìš° ë¶€ëª¨ ë©”ì†Œë“œì— @Transactionalì„ ë¶™ì˜€ê³  ë‘ë²ˆì§¸ í…ŒìŠ¤íŠ¸ì˜ ë¶€ëª¨ ë©”ì†Œë“œì—ëŠ” ë¶™ì´ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.ê²°ë¡ ì ìœ¼ë¡œ ë‘ í…ŒìŠ¤íŠ¸ ëª¨ë‘ ì‹¤íŒ¨í•˜ê¸´ í•˜ì§€ë§Œ ì‹¤íŒ¨ ì‚¬ìœ ëŠ” ë‹¤ë¦…ë‹ˆë‹¤. @Transactionalì„ ë¶™ì¸ í…ŒìŠ¤íŠ¸ì˜ ê²½ìš° insert ìì²´ê°€ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë° ë°˜í•´ @Transactionì„ ë¶™ì´ì§€ ì•Šì€ í…ŒìŠ¤íŠ¸ì˜ ê²½ìš° ì¶•êµ¬ì„ ìˆ˜ listì˜ sizeê°€ 5ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.ì²«ë²ˆì§¸ í…ŒìŠ¤íŠ¸ì˜ ê²½ìš° ìì‹ ë©”ì†Œë“œê°€ ìˆ˜í–‰ë˜ëŠ” ì‹œì ì— í™œì„±í™”ëœ íŠ¸ëœì­ì…˜(ë¶€ëª¨ íŠ¸ëœì­ì…˜)ì´ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ëŠ” ì‹œì ì— ìˆ˜í–‰ëœ ëª¨ë“  ì‘ì—…ì´ ë¡¤ë°±ë˜ê²Œ ë©ë‹ˆë‹¤.ë‘ë²ˆì§¸ í…ŒìŠ¤íŠ¸ì˜ ê²½ìš° í™œì„±í™”ëœ íŠ¸ëœì­ì…˜ì´ ì—†ê¸° ë•Œë¬¸ì— non-transactional í•˜ê²Œ ë™ì‘í•˜ê²Œ ë˜ì–´ 5ê°œì˜ insertëœ ì—”í‹°í‹°ëŠ” ë¡¤ë°±ë˜ì§€ ì•Šê²Œ ë˜ëŠ” ê²ƒì´ì§€ìš”.3. MANDATORYì„¸ë²ˆì§¸ëŠ” MANDATORY ì…ë‹ˆë‹¤. í™œì„±í™”ëœ íŠ¸ëœì­ì…˜ì´ ìˆë‹¤ë©´ ê·¸ê²ƒì„ ì‚¬ìš©í•˜ê³ , í™œì„±í™”ëœ íŠ¸ëœì­ì…˜ì´ ì—†ë‹¤ë©´ Exceptionì´ ë°œìƒí•©ë‹ˆë‹¤.@Testpublic void MANDATORY() { transactionService.mandatory(); soccerPlayerRepository.findByName(\"ì†í¥ë¯¼\").orElseThrow(() -&gt; new RuntimeException(\"soccer player must not be null\"));}public void mandatory() { SoccerPlayer player1 = new SoccerPlayer(); player1.setName(\"ì†í¥ë¯¼\"); transactionChildService.insertMandatory(player1);}@Transactional(propagation = Propagation.MANDATORY)public void insertMandatory(SoccerPlayer soccerPlayer) { soccerPlayerRepository.save(soccerPlayer);}insertMandatory()ê°€ ìˆ˜í–‰ë˜ëŠ” ì‹œì ì— í™œì„±í™”ëœ ë¶€ëª¨ íŠ¸ëœì­ì…˜ì´ ì—†ê¸° ë–„ë¬¸ì— org.springframework.transaction.IllegalTransactionStateException: No existing transaction found for transaction marked with propagation 'mandatory' Exceptionì´ ë°œìƒí•˜ë©° í…ŒìŠ¤íŠ¸ê°€ ì¢…ë£Œë©ë‹ˆë‹¤.4. NEVERë„¤ë²ˆì§¸ëŠ” NEVER ì…ë‹ˆë‹¤. í™œì„±í™”ëœ íŠ¸ëœì­ì…˜ì´ ìˆë‹¤ë©´ Exceptionì´ ë°œìƒí•©ë‹ˆë‹¤.@Testpublic void NEVER() { transactionService.never(); soccerPlayerRepository.findByName(\"ì†í¥ë¯¼\").orElseThrow(() -&gt; new RuntimeException(\"soccer player must not be null\"));}@Transactionalpublic void never() { SoccerPlayer player1 = new SoccerPlayer(); player1.setName(\"ì†í¥ë¯¼\"); transactionChildService.insertNever(player1);}@Transactional(propagation = Propagation.NEVER)public void insertNever(SoccerPlayer soccerPlayer) { soccerPlayerRepository.save(soccerPlayer);}insertNever()ê°€ ìˆ˜í–‰ë˜ëŠ” ì‹œì ì— í™œì„±í™”ëœ ë¶€ëª¨ íŠ¸ëœì­ì…˜ì´ ìˆê¸° ë•Œë¬¸ì— org.springframework.transaction.IllegalTransactionStateException: Existing transaction found for transaction marked with propagation 'never' Exceptionì´ ë°œìƒí•˜ë©° í…ŒìŠ¤íŠ¸ê°€ ì¢…ë£Œë©ë‹ˆë‹¤.5. NOT_SUPPORTEDë‹¤ì„¯ë²ˆì§¸ëŠ” NOT_SUPPORTED ì…ë‹ˆë‹¤. í™œì„±í™”ëœ íŠ¸ëœì­ì…˜ ìœ ë¬´ì— ìƒê´€ì—†ì´ non-transactional í•˜ê²Œ ë™ì‘í•©ë‹ˆë‹¤. í™œì„±í™”ëœ íŠ¸ëœì­ì…˜ì´ ìˆëŠ” ê²½ìš° íŠ¸ëœì­ì…˜ì„ ì¼ì‹œì¤‘ì§€ ì‹œí‚µë‹ˆë‹¤. ì‘ì—…ì´ ëë‚˜ë©´ ìë™ìœ¼ë¡œ ì¤‘ì§€í•œ íŠ¸ëœì­ì…˜ì„ ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.6. NESTEDì—¬ì„¯ë²ˆì§¸ëŠ” NESTED ì…ë‹ˆë‹¤. NESTEDëŠ” í™œì„±í™”ëœ íŠ¸ëœì­ì…˜ì˜ ì¤‘ì²© íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì¤‘ì²© íŠ¸ëœì­ì…˜ì´ ì‹œì‘í•  ë•Œ SAVEPOINTê°€ ìƒì„±ë©ë‹ˆë‹¤. ì¤‘ì²© íŠ¸ëœì­ì…˜ì´ ì‹¤íŒ¨í•œë‹¤ë©´ ìƒì„±í•œ SAVEPOINTë¡œ ë¡¤ë°±í•©ë‹ˆë‹¤. (SAVEPOINTë¥¼ ì§€ì›í•˜ëŠ” DBë§Œ ì‚¬ìš© ê°€ëŠ¥ - PostgreSQL, Oracle, MSSQL ë“±) ì¤‘ì²© íŠ¸ëœì­ì…˜ì€ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì˜ ì¼ë¶€ì´ë¯€ë¡œ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì´ ëë‚  ë•Œë§Œ ì»¤ë°‹ë©ë‹ˆë‹¤. ì¤‘ì²© íŠ¸ëœì­ì…˜ì´ ëë‚¬ë‹¤ê³  í•˜ì—¬ ë°”ë¡œ ì»¤ë°‹ë˜ëŠ” ì¼ì€ ì—†ìŠµë‹ˆë‹¤.@Testpublic void NESTED() { transactionService.nested(); var soccerPlayerList = soccerPlayerRepository.findAll(); Assert.isTrue(soccerPlayerList.size() == 1, \"size of soccer player list must be 1\");}@Transactionalpublic void nested() { SoccerPlayer player1 = new SoccerPlayer(); player1.setName(\"ì†í¥ë¯¼\"); soccerPlayerRepository.save(player1); SoccerPlayer player2 = new SoccerPlayer(); player2.setName(\"ë°•ì§€ì„±\"); soccerPlayerRepository.save(player2); transactionChildService.insertNested(player2);}@Transactional(propagation = Propagation.NESTED)public void insertNested(SoccerPlayer soccerPlayer) { try { soccerPlayerRepository.save(soccerPlayer); throw new RuntimeException(\"throw error\"); } catch (Exception ex) { ex.printStackTrace(); }}ì˜ˆì œ ì½”ë“œì…ë‹ˆë‹¤. ë°•ì§€ì„± ì´ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ ì—”í‹°í‹°ë¥¼ ì €ì¥í•˜ëŠ” ì‹œì ì— ì˜ˆì™¸ê°€ ë°œìƒí•˜ì˜€ì§€ë§Œ SAVEPOINTê¹Œì§€ë§Œ ë¡¤ë°±ë˜ì–´ ì†í¥ë¯¼ ì´ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ ì—”í‹°í‹°ëŠ” ì •ìƒì ìœ¼ë¡œ ì €ì¥ë˜ê²Œ ë˜ì–´ í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•˜ê²Œ ë©ë‹ˆë‹¤.7. REQUIRES_NEWë§ˆì§€ë§‰ 7ë²ˆì§¸ëŠ” REQUIRES_NEW ì…ë‹ˆë‹¤. ì•„ë§ˆ ê¸°ë³¸ REQUIREDì™€ í•¨ê»˜ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ê²Œë  ì „íŒŒë ˆë²¨ì´ ë í…ë°ìš”, REQUIRES_NEWëŠ” í™œì„±í™”ëœ íŠ¸ëœì­ì…˜ì´ ìˆë‹¤ë©´ ì ì‹œ ì¤‘ì§€ì‹œí‚¤ê³  ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ìƒì„±í•˜ì—¬ ì§„í–‰í•©ë‹ˆë‹¤.@Testpublic void REQUIRES_NEW() { try { transactionService.requiresNew(); } catch (Exception ex) { ex.printStackTrace(); } var soccerPlayerList = soccerPlayerRepository.findAll(); Assert.isTrue(soccerPlayerList.size() == 1, \"size of soccer player list must be 1\");}@Transactionalpublic void requiresNew() { SoccerPlayer player1 = new SoccerPlayer(); player1.setName(\"ì†í¥ë¯¼\"); transactionChildService.insertRequiresNew(player1); SoccerPlayer player2 = new SoccerPlayer(); player2.setName(\"ë°•ì§€ì„±\"); soccerPlayerRepository.save(player2); throw new RuntimeException(\"throw error on parent\");}@Transactional(propagation = Propagation.REQUIRES_NEW)public void insertRequiresNew(SoccerPlayer soccerPlayer) { soccerPlayerRepository.save(soccerPlayer);}ì˜ˆì œ ì½”ë“œì…ë‹ˆë‹¤. ë¶€ëª¨ íŠ¸ëœì­ì…˜ì—ì„œ RuntimeExceptionì„ ë˜ì¡Œì§€ë§Œ ìì‹ íŠ¸ëœì­ì…˜ì€ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ì˜€ê¸° ë•Œë¬¸ì— ë¶€ëª¨ íŠ¸ëœì­ì…˜ì— ì˜í–¥ì„ ë°›ì§€ ì•Šì•„ ì†í¥ë¯¼ ì´ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ ì—”í‹°í‹°ëŠ” ì •ìƒì ìœ¼ë¡œ ì €ì¥ì´ ë˜ê²Œ ë˜ì–´ í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•˜ê²Œ ë©ë‹ˆë‹¤." }, { "title": "Transaction Isolation", "url": "/posts/database-transaction-isolation-level/", "categories": "Database", "tags": "Database, Transaction", "date": "2022-03-23 20:12:00 +0900", "snippet": "íŠ¸ëœì­ì…˜íŠ¸ëœì­ì…˜ ê´€ë¦¬ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì™€ í†µì‹ í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë°±ì—”ë“œ ê°œë°œìë¼ë©´ ëˆ„êµ¬ì—ê²Œë‚˜ ì¤‘ìš”í•œ í•­ëª©ì…ë‹ˆë‹¤. íŠ¸ëœì­ì…˜ì˜ ì˜µì…˜ì— ë”°ë¼ ì„±ëŠ¥ì´ í¬ê²Œ í–¥ìƒë ìˆ˜ ìˆê³  ë©”ì†Œë“œ ë‚´ë¶€ì—ì„œ ì¼ì–´ë‚˜ëŠ” ì˜ˆì™¸ ìƒí™©ì´ ë‹¬ë¼ì§ˆìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë”°ë¼ì„œ íŠ¸ëœì­ì…˜ì„ ì´í•´í•˜ê³  ì„¤ì •í•˜ëŠ” ê²ƒì´ ì •ë§ ì¤‘ìš”í•˜ë‹¤ê³  í• ìˆ˜ ìˆìŠµë‹ˆë‹¤.Isolation level optionIsolation level (ê²©ë¦¬ìˆ˜ì¤€) ì€ íŠ¸ëœì­ì…˜ì˜ ì£¼ìš” ì†ì„±(ì›ìì„±, ì¼ê´€ì„±, ê²©ë¦¬, ë‚´êµ¬ì„±) ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ë™ì‹œì— ì—¬ëŸ¬ íŠ¸ëœì­ì…˜ì´ ì²˜ë¦¬ë  ë•Œ í•œ íŠ¸ëœì­ì…˜ì´ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ë³€ê²½í•˜ê±°ë‚˜ ì¡°íšŒí•˜ëŠ” ë°ì´í„°ë¥¼ ë³¼ìˆ˜ ìˆê²Œ í—ˆìš©í• ì§€ ë§ì§€ ê²°ì •í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.ì˜ˆë¥¼ë“¤ì–´ Spring ì—ì„œëŠ” 5ê°€ì§€ Isolation level ì„ ì„¸íŒ…í• ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ê·¸ì¤‘ í•˜ë‚˜ì¸ DEFAULT ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ì‚¬ìš©í•˜ê³  ìˆëŠ” ë°ì´í„°ë² ì´ìŠ¤ì˜ ê¸°ë³¸ ì˜µì…˜ì„ ë”°ë¼ê°‘ë‹ˆë‹¤.PostgreSQL, Oracle, SQL Serverì˜ ê²½ìš° READ_COMMITTEDì„ ì‚¬ìš©í•˜ê³ , MySQLì˜ ê²½ìš° REPEATABLE_READì„ ì‚¬ìš©í•©ë‹ˆë‹¤.ê²©ë¦¬ ìˆ˜ì¤€ì´ í—ˆìš©í•˜ëŠ” ì˜µì…˜ë“¤ì— ëŒ€í•´ ë¨¼ì € ì•Œì•„ë³´ì£ .1. Dirty readì²«ë²ˆì§¸ëŠ” Dirty read(ë”í‹° ë¦¬ë“œ) ì…ë‹ˆë‹¤. ë”í‹° ë¦¬ë“œëŠ” í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì´ ì•„ì§ ì»¤ë°‹ë˜ì§€ ì•Šì€ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì˜ ë³€ê²½ì ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.íŠ¸ëœì­ì…˜Aê°€ ì‹œì‘ëœ ì´í›„ íŠ¸ëœì­ì…˜Bê°€ ì‹œì‘ë©ë‹ˆë‹¤. íŠ¸ëœì­ì…˜AëŠ” idê°€ 10ì¸ ì—”í‹°í‹°ë¥¼ insert í•©ë‹ˆë‹¤. ê·¸ í›„ ë°”ë¡œ íŠ¸ëœì­ì…˜BëŠ” idê°€ 10ì¸ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤. ê·¸ëŸ°ë° ê·¸ ì´í›„ íŠ¸ëœì­ì…˜Aê°€ ë¬¸ì œê°€ ìƒê²¨ ëª¨ë‘ ë¡¤ë°±ë˜ì–´ ë²„ë ¸ìŠµë‹ˆë‹¤. ì´ì œ íŠ¸ëœì­ì…˜B ì—ì„œ ì¡°íšŒëœ entity ê°ì²´ëŠ” ë°ì´í„° ë¬´ê²°ì„±ì„ ë³´ì¥ë°›ì§€ ëª»í•˜ëŠ” ìƒíƒœê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.2. Non-repeatable readë‘ë²ˆì§¸ëŠ” Non-repeatable read (ë°˜ë³µ ê°€ëŠ¥í•˜ì§€ ì•Šì€ ì¡°íšŒ) ì…ë‹ˆë‹¤. ë°˜ë³µ ê°€ëŠ¥í•˜ì§€ ì•Šì€ ì¡°íšŒëŠ” í•œ íŠ¸ëœì­ì…˜ì—ì„œ ë™ì¼í•œ í–‰ì„ ì½ë”ë¼ë„ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ë°œìƒí•œ update or deleteê°€ ì ìš©ë˜ê¸° ë•Œë¬¸ì— í–‰ ë‚´ì˜ ê°’ì´ ë‹¤ë¥¼ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.íŠ¸ëœì­ì…˜ Aê°€ ì‹œì‘ëœ ì´í›„ íŠ¸ëœì­ì…˜Bê°€ ì‹œì‘ë©ë‹ˆë‹¤. íŠ¸ëœì­ì…˜AëŠ” idê°€ 10ì¸ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤. ê·¸ í›„ íŠ¸ëœì­ì…˜Bê°€ idê°€ 10ì¸ ì—”í‹°í‹°ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤. ê·¸ í›„ ë‹¤ì‹œ íŠ¸ëœì­ì…˜Aê°€ idê°€ 10ì¸ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤. íŠ¸ëœì­ì…˜AëŠ” ë™ì¼í•œ í–‰ì„ ì¡°íšŒí•˜ì˜€ì§€ë§Œ ê·¸ ê°ê°ì˜ ê²°ê³¼ê°’ì€ ë‹¬ë¼ì§‘ë‹ˆë‹¤.3. Phantom readë§ˆì§€ë§‰ ì„¸ë²ˆì¨°ëŠ” Phantom read(íŒ¬í…€ ë¦¬ë“œ) ì…ë‹ˆë‹¤. íŒ¬í…€ ë¦¬ë“œëŠ” í•œ íŠ¸ëœì­ì…˜ì—ì„œ ë™ì¼í•œ ì¡°íšŒ ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•˜ë”ë¼ë„ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ë°œìƒí•œ insertê°€ ì ìš©ë˜ê¸° ë•Œë¬¸ì— í–‰ì˜ ê°¯ìˆ˜(ì—´)ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.íŠ¸ëœì­ì…˜AëŠ” entity í…Œì´ë¸”ì—ì„œ ëª¨ë“  rowë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤. ê·¸ í›„ íŠ¸ëœì­ì…˜Bì—ì„œ idê°€ 10ì¸ ì—”í‹°í‹°ë¥¼ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤. ê·¸ í›„ ë‹¤ì‹œ íŠ¸ëœì­ì…˜Aì—ì„œ entity í…Œì´ë¸”ì˜ ëª¨ë“  rowë¥¼ ì¡°íšŒí•œë‹¤ë©´ rowì˜ ê°¯ìˆ˜ê°€ í•œê°œ ëŠ˜ì–´ë‚¬ì„ ê²ƒì…ë‹ˆë‹¤.Non-repeatable read vs Phantom readë°˜ë³µ ê°€ëŠ¥í•˜ì§€ ì•Šì€ ì¡°íšŒì™€ íŒ¬í…€ ë¦¬ë“œ ê°„ì—ëŠ” ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤. ì˜ˆì œë¥¼ í†µí•´ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. íŠ¸ëœì­ì…˜ Aì‹œì‘ íŠ¸ëœì­ì…˜ Bì‹œì‘ íŠ¸ëœì­ì…˜ Aì—ì„œ X ì¿¼ë¦¬(ì¡°íšŒ) ìˆ˜í–‰ íŠ¸ëœì­ì…˜ Bì—ì„œ Y ì¿¼ë¦¬(INSERT, UPDATE) ìˆ˜í–‰ íŠ¸ëœì­ì…˜ B ì»¤ë°‹ íŠ¸ëœì­ì…˜ Aì—ì„œ X ì¿¼ë¦¬(ì¡°íšŒ) ìˆ˜í–‰ìœ„ì™€ê°™ì€ í”Œë¡œìš°ë¡œ í•œ ì‹¸ì´í´ì´ ëˆë‹¤ê³  ê°€ì •í•´ ë³´ì•˜ìŠµë‹ˆë‹¤. ë§Œì•½ Non-repeatable read ìˆ˜ì¤€ì´ë¼ë©´ íŠ¸ëœì­ì…˜ Bì—ì„œ INSERTê°€ ì¼ì–´ë‚˜ë”ë¼ë„ 3ë²ˆì˜ ê²°ê³¼ í–‰ì˜ ê°¯ìˆ˜ì™€ 6ë²ˆì˜ ê²°ê³¼ í–‰ì˜ ê°¯ìˆ˜ëŠ” ë™ì¼í•  ê²ƒì…ë‹ˆë‹¤. ë§Œì•½ UPDATEê°€ ì¼ì–´ë‚¬ë‹¤ë©´ í–‰ì˜ ê°¯ìˆ˜ëŠ” ë™ì¼í•˜ì§€ë§Œ ê°ê° í–‰ì˜ ê°’ì€ ë‹¤ë¥´ê² ì§€ìš”.ë§Œì•½ Phantom read ìˆ˜ì¤€ì´ë¼ë©´ íŠ¸ëœì­ì…˜ Bì—ì„œ INSERTê°€ ì¼ì–´ë‚˜ë©´ 3ë²ˆì˜ ê²°ê³¼ í–‰ì˜ ê°¯ìˆ˜ì™€ 6ë²ˆì˜ ê²°ê³¼ í–‰ì˜ ê°¯ìˆ˜ëŠ” ë‹¤ë¥¼ ê²ƒì…ë‹ˆë‹¤. í•˜ì§€ë§Œ UPDATEê°€ ì¼ì–´ë‚œë‹¤ë©´ ê°ê° í–‰ì˜ ê°’ì€ ë™ì¼í•˜ê² ì§€ìš”.Isolation levelì˜µì…˜ë“¤ì— ëŒ€í•´ ì•Œì•„ë´¤ìœ¼ë¯€ë¡œ ì´ì œ ê²©ë¦¬ ìˆ˜ì¤€ì˜ ì¢…ë¥˜ì— ëŒ€í•´ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤. Isolation Level Dirty Read Non-repeatable read Phantom read READ_UNCOMMITTED O O O READ_COMMITTED X O O REPEATABLE_READ X X O SERIALIZABLE X X X ê²©ë¦¬ ìˆ˜ì¤€ì„ ì •ë¦¬í•œ í‘œì…ë‹ˆë‹¤. READ_UNCOMMITTED (ë ˆë²¨ 0) ë¶€í„° SERIALIZABLE (ë ˆë²¨ 3) ê¹Œì§€ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.Isolation level ì„ íƒí•˜ê¸°ê²©ë¦¬ ìˆ˜ì¤€ì— ëŒ€í•œ ì¡°ì •ì€ ë™ì‹œì„±, ë°ì´í„° ë¬´ê²°ì„±ê³¼ ì—°ê´€ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë™ì‹œì„±ì„ ì¦ê°€ì‹œí‚¤ë©´ (ë ˆë²¨ 0) ë°ì´í„° ë¬´ê²°ì„±ì— ë¬¸ì œê°€ ë°œìƒí•˜ê³  ë°ì´í„° ë¬´ê²°ì„±ì„ ìœ ì§€í•˜ë©´ (ë ˆë²¨ 3) ë™ì‹œì„±ì´ ë–¨ì–´ì ¸ ë°œìƒí•˜ëŠ” ë¹„ìš©ì´ ì¦ê°€í•˜ê¸° ë•Œë¬¸ì— ì‹¤ì œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ì˜í–¥ì„ ë¼ì¹˜ê² ì§€ìš”.ì²˜ë¦¬í•˜ëŠ” ë¡œì§ì´ ëª¨ë‘ ë‹¤ë¥´ê¸° ë–„ë¬¸ì— íŠ¹ì •í•œ ê²©ë¦¬ ìˆ˜ì¤€ì´ ì¢‹ë‹¤ ë‚˜ì˜ë‹¤ë¥¼ ë§í•˜ê¸°ëŠ” ì–´ë µê² ì§€ìš”. ë”°ë¼ì„œ ë¡œì§ì— ë”°ë¼ ì ì ˆí•œ ìˆ˜ì¤€ì„ ì„ íƒí•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤ê³  ë³¼ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤." }, { "title": "JPA EntityListeners ì— ì˜ì¡´ì„± ì£¼ì…í•˜ê¸°", "url": "/posts/jpa-entity-listener-di/", "categories": "JPA", "tags": "JPA, Hibernate", "date": "2022-03-17 20:12:00 +0900", "snippet": "JPA EntityListenersJPAë¥¼ ì‚¬ìš©í•˜ë‹¤ë³´ë©´ ì—¬ëŸ¬ê°€ì§€ ìƒí™©(before insert, after insert, before update, after updateâ€¦)ì„ ìºì¹˜í•˜ì—¬ ì‘ì—…ì„ í•´ì•¼í•  ê²½ìš°ê°€ ìƒê¸°ê³¤ í•©ë‹ˆë‹¤. ê·¸ëŸ´ë•Œ í•˜ì´ë²„ë„¤ì´íŠ¸ ì—ì„œ ì œê³µí•˜ëŠ” EntityListenersë¥¼ ì‚¬ìš©í•˜ì—¬ ì›í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ìœ„ ìº¡ì³ ì´ë¯¸ì§€ëŠ” í•˜ì´ë²„ë„¤ì´íŠ¸ì—ì„œ ì§€ì›í•˜ëŠ” ì½œë°± ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤. í•´ë‹¹ ì½œë°± ë©”ì†Œë“œë“¤ì„ ì‚¬ìš©í•´ ê°„ë‹¨íˆ ì—”í‹°í‹° ì´ë²¤íŠ¸ë¥¼ ìºì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì§§ì€ ì½”ë“œë¡œ êµ¬í˜„í•˜ìë©´ ë‹¤ìŒê³¼ ê°™ì€ í˜•íƒœê°€ ë˜ê² ì§€ìš”.@Entity@Data@NoArgsConstructor@AllArgsConstructor@EntityListeners(value = SoccerTeamListeners.class)@Table(name = \"soccer_team\")public class SoccerTeam { @Id @GeneratedValue(strategy = GenerationType.AUTO) Long id; String name;}@Componentpublic class SoccerTeamListeners{ @Autowired SoccerTeamRepository soccerTeamRepository; @PrePersist public void prePersist(SoccerTeam soccerTeam) { System.out.println(\"size: \" + soccerTeamRepository.findAll().size()); }}JPA EntityListeners Dependency Injectionìœ„ì˜ ì˜ˆì œ ì½”ë“œëŠ” ì˜ëª»ëœ ì½”ë“œì…ë‹ˆë‹¤. EntityListenersë¡œ ì§€ì •í•œ í´ë˜ìŠ¤ì—ì„œ ì˜ì¡´ì„± ì£¼ì…ì´ í•„ìš”í•´ SoccerTeamRepositoryë¥¼ ì£¼ì…í•˜ì˜€ì§€ë§Œ, ì •ì‘ prePersist ë©”ì†Œë“œ ìˆ˜í–‰ì‹œ soccerTeamRepositoryì—ëŠ” nullì´ í• ë‹¹ë˜ì–´ìˆì„ ê²ƒì…ë‹ˆë‹¤. nullì´ í• ë‹¹ë˜ì–´ ìˆìœ¼ë‹ˆ ë‹¹ì—°íˆ ë©”ì†Œë“œ í˜¸ì¶œì‹œ NullPointerException ì´ ë°œìƒí•©ë‹ˆë‹¤.ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ì´ìœ ëŠ” EntityListenersëŠ” Spring IOC ì—ì„œ ê´€ë¦¬ë˜ëŠ” í´ë˜ìŠ¤ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì •í™•íˆëŠ” EntityListenersì— ë“±ë¡ë˜ëŠ” í´ë˜ìŠ¤ì— @Component ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì´ë©´ beanìœ¼ë¡œ ë“±ë¡ë˜ê¸´ í•˜ì§€ë§Œ JPA ê´€ë ¨ í”„ë¡œí¼í‹°ë“¤ì´ beanìœ¼ë¡œ ë“±ë¡ë˜ê³  ë‚œ í›„ì— Spring ê´€ë ¨ ë¹ˆë“¤ì´ ë“±ë¡ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.ë”°ë¼ì„œ Spring beanì´ ëª¨ë‘ ë“±ë¡ëœ í›„ EntityListenersë¡œ ì§€ì •í•œ í´ë˜ìŠ¤ë¥¼ ëª¨ë‘ ì°¾ì•„ ì˜ì¡´ì„± ì£¼ì…ì„ í•˜ë©´ ë˜ê² ë„¤ìš”. ì¸í„°ë„·ì„ ê²€ìƒ‰í•´ë³´ë©´ ë§ì€ í•´ê²°ë°©ë²•ë“¤ì´ ìˆìŠµë‹ˆë‹¤. ì €ëŠ” ì œ ë‚˜ë¦„ëŒ€ë¡œì˜ ë°©ë²•ì„ ì†Œê°œí•˜ê³ ì í•©ë‹ˆë‹¤.Example Code@Entity@Data@NoArgsConstructor@AllArgsConstructor@Builder@EntityListeners(value = SoccerPlayerListeners.class)@Table(name = \"soccer_player\")public class SoccerPlayer { @Id @GeneratedValue(strategy = GenerationType.AUTO) Long id; String name; @ManyToOne SoccerTeam soccerTeam; @Override public String toString() { return String.format(\"name = %s / soccerTeamName = %s\", name, soccerTeam != null ? soccerTeam.getName() : null); }}ì—”í‹°í‹°ì…ë‹ˆë‹¤. SoccerPlayerListeners.classë¥¼ EntityListenersë¡œ ë“±ë¡í•˜ì˜€ìŠµë‹ˆë‹¤.public interface SimpleEventListeners {}êµ¬í˜„í•  ë©”ì†Œë“œê°€ ì•„ë¬´ê²ƒë„ ì—†ëŠ” ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤. ì´ ì¸í„°í˜ì´ìŠ¤ëŠ” ì¶”í›„ ì‚¬ìš©ë  ê²ƒì…ë‹ˆë‹¤.@Componentpublic class SoccerPlayerListeners implements SimpleEventListeners { private static SoccerPlayerRepository soccerPlayerRepository; @PrePersist public void prePersist(SoccerPlayer soccerPlayer) { System.out.println(\"total soccer player count: \" + soccerPlayerRepository.findAll().size()); }}SoccerPlayerListeners í´ë˜ìŠ¤ì…ë‹ˆë‹¤. êµ¬í˜„í•  ë©”ì†Œë“œê°€ ì—†ê¸´ í•˜ì§€ë§Œ ìœ„ì—ì„œ ì •ì˜í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤ì…ë‹ˆë‹¤. ëª¨ë“  ê°ì²´ê°€ ë©”ëª¨ë¦¬ë¥¼ ê³µìœ í•˜ë„ë¡ í•˜ê¸° ìœ„í•´ static í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë³€ìˆ˜ë¥¼ ì„ ì–¸í•˜ì˜€ìŠµë‹ˆë‹¤.@PrePersist ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ ìƒˆë¡œìš´ ì—”í‹°í‹°ê°€ flushë˜ê¸° ì „ì— ì¶•êµ¬ì„ ìˆ˜ì˜ ì´ì›ì„ ì½˜ì†”ì— ì°ëŠ” ë©”ì†Œë“œë¥¼ ì„ ì–¸í•˜ì˜€ìŠµë‹ˆë‹¤.@Configurationpublic class SimpleEventListenerConfig { @Autowired private ApplicationContext applicationContext; @Autowired private List&lt;SimpleEventListeners&gt; simpleEventListenerList; @PostConstruct public void injectDependency() { simpleEventListenerList.forEach(el -&gt; { Arrays.stream(el.getClass().getDeclaredFields()) .filter(field -&gt; Modifier.isStatic(field.getModifiers())) .forEach(field -&gt; { field.setAccessible(true); try { field.set(field.getType(), applicationContext.getBean(field.getType())); } catch (Exception ex) { System.err.println(ex.getMessage()); } }); }); }}ê°€ì¥ ì¤‘ìš”í•œ config íŒŒì¼ì…ë‹ˆë‹¤. @PostConstructê°€ ì‹¤í–‰ë ë•ŒëŠ” ëª¨ë“  Spring ê´€ë ¨ beanë“¤ì´ ë“±ë¡ëœ í›„ì…ë‹ˆë‹¤.ì—¬ê¸°ì„œ SimpleEventListeners ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•œ ì´ìœ ê°€ ë‚˜ì˜µë‹ˆë‹¤. SimpleEventListenersë¥¼ êµ¬í˜„í•˜ëŠ” ëª¨ë“  í´ë˜ìŠ¤ë“¤ì„ ë³€ìˆ˜ì— í• ë‹¹í•´ì•¼í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ ë°©ì‹ì€ List&lt;SimpleEventListeners&gt; ê°ì²´ë¥¼ ë£¨í”„ ëŒë©´ì„œ static ë³€ìˆ˜ë§Œ í•„í„°ë§í•˜ê³  ë¦¬í”Œë ‰ì…˜ì„ ì´ìš©í•´ static ë³€ìˆ˜ì— ê°’ì„ í• ë‹¹í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.ê·¸ë¦¬ê³  ë‚˜ì„œ ìƒˆë¡œìš´ ì—”í‹°í‹°ê°€ flushë˜ê¸° ì „ì— ì •ì˜í•œ prePersist ë©”ì†Œë“œê°€ ìˆ˜í–‰ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•´ë³´ë©´ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ë˜ëŠ”ê²ƒì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤. (java 17ì—ì„œë„ ë¬¸ì œì—†ì´ ë™ì‘í•©ë‹ˆë‹¤.)" }, { "title": "JPA & Hibernate Flush Mode", "url": "/posts/jpa-flush/", "categories": "JPA", "tags": "JPA, Hibenate", "date": "2022-03-05 20:12:00 +0900", "snippet": "Flushí”ŒëŸ¬ì‹œëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë³€ê²½ ë‚´ìš©ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜í•˜ëŠ”ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. í”ŒëŸ¬ì‹œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê²½ìš°ì— ë°œìƒí•©ë‹ˆë‹¤. EntityManagerì˜ flush ë©”ì†Œë“œë¥¼ í˜¸ì¶œí–ˆì„ ë•Œ íŠ¸ëœì­ì…˜ ì»¤ë°‹ì‹œ JPQL ì¿¼ë¦¬ ì‹¤í–‰ì‹œì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìˆëŠ” ì—”í‹°í‹°ë¥¼ ì§€ìš°ê³  dbì— ì €ì¥í•˜ëŠ” ê°œë…ì´ ì•„ë‹ˆë¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë³€ê²½ ë‚´ìš©ì„ dbì™€ ë™ê¸°í™”í•˜ëŠ” ê²ƒì´ í”ŒëŸ¬ì‹œ ì„ì„ ìŠì§€ ë§ˆì„¸ìš”.Flush Mode in JPA &amp; HibernateJPAëŠ” AUTO, COMMIT 2ê°œì˜ í”ŒëŸ¬ì‹œ ëª¨ë“œë¥¼ ì§€ì›í•˜ê³  HibernateëŠ” AUTO, COMMIT, ALWAYS, MANUAL 4ê°œì˜ í”ŒëŸ¬ì‹œ ëª¨ë“œë¥¼ ì§€ì›í•©ë‹ˆë‹¤.AUTO (JPA &amp; Hibernate)JPA ëª…ì„¸ëŠ” FlushModeType.AUTO ë¥¼ ê¸°ë³¸ íƒ€ì…ìœ¼ë¡œ ì •ì˜í•©ë‹ˆë‹¤. AUTOëŠ” ë‹¤ìŒ 2ê°€ì§€ ìƒí™©ì—ì„œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ í”ŒëŸ¬ì‹œ í•©ë‹ˆë‹¤. íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ë˜ê¸° ì´ì „ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë³´ë¥˜ ì¤‘ì¸ ë³€ê²½ì´ í¬í•¨ëœ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ëª¨ë“  JPQL ë˜ëŠ” Criteria Queryì— ëŒ€í•´ í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” SQLë¬¸ì„ ìƒì„±í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì–´ë–¤ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì´ ì‚¬ìš©ë˜ëŠ”ì§€ ë¯¸ë¦¬ ì•Œìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” ê·¸ì •ë³´ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ëª¨ë“  ì—”í‹°í‹° ê°ì²´ì— ëŒ€í•´ ë”í‹° ì²´í¬ë¥¼ ìˆ˜í–‰í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ì¿¼ë¦¬ì— ì˜í•´ ì°¸ì¡°ë˜ëŠ” í…Œì´ë¸” ì¤‘ í•˜ë‚˜ì— ë§¤í•‘ëœ ë”í‹° ì—”í‹°í‹°ê°€ ë°œê²¬ë˜ë©´ ì¡°íšŒí•˜ê¸° ì „ì— ë³€ê²½ì‚¬í•­ì„ í”ŒëŸ¬ì‹œí•´ì•¼ í•©ë‹ˆë‹¤.@Entity@Data@NoArgsConstructor@AllArgsConstructor@Table(name = \"soccer_team\")public class SoccerTeam { @Id @GeneratedValue(strategy = GenerationType.AUTO) Long id; String name;}@Entity@Data@NoArgsConstructor@AllArgsConstructor@Table(name = \"soccer_team\")public class SoccerTeam { @Id @GeneratedValue(strategy = GenerationType.AUTO) Long id; String name;}@Testvoid flushTest() { EntityManager em = emf.createEntityManager(); em.getTransaction().begin(); var soccerPlayer = new SoccerPlayer(); soccerPlayer.setName(\"ì†í¥ë¯¼\"); em.persist(soccerPlayer); em.createQuery(\"SELECT t FROM SoccerTeam t\").getResultList(); Query q = em.createQuery(\"SELECT p FROM SoccerPlayer p WHERE p.name = :name\"); q.setParameter(\"name\", \"ì†í¥ë¯¼\"); q.getResultList(); em.getTransaction().commit(); em.close();}ì˜ˆì œ ì½”ë“œì…ë‹ˆë‹¤. SoccerTeamì€ SoccerPlayerì˜ ë¶€ëª¨ ì—”í‹°í‹° ì…ë‹ˆë‹¤. em.createQuery(\"SELECT t FROM SoccerTeam t\").getResultList(); ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•˜ì—¬ë„ SoccerTeam ì—”í‹°í‹°ëŠ” SoccerPlayer ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•˜ì§€ ì•Šê¸° ë–„ë¬¸ì— insert ì¿¼ë¦¬ê°€ ë‚ ë¼ê°€ì§€ ì•ŠìŠµë‹ˆë‹¤.ë§ˆì§€ë§‰ì—ì„œ ì„¸ë²ˆì§¸ q.getResultList(); ë¥¼ ìˆ˜í–‰í• ë•Œì•¼ ë¹„ë¡œì†Œ insert ì¿¼ë¦¬ê°€ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ë‚ ë¼ê°€ê²Œ ë©ë‹ˆë‹¤. í•˜ì´ë²„ë„¤ì´íŠ¸ê°€ insert êµ¬ë¬¸ì˜ ìˆ˜í–‰ ì‹œê°„ì„ ì§€ì—°ì‹œí‚´ìœ¼ë¡œì„œ ì„±ëŠ¥ìƒì˜ ì´ì ì„ ë§Œë“¤ìˆ˜ë„ ìˆê²Œë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.ë§Œì•½ ë„¤ì´í‹°ë¸Œ SQL ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ì¡°ê¸ˆ ë” ë³µì¡í•´ì§‘ë‹ˆë‹¤. í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” JPQLì´ ì•„ë‹Œ ë„¤ì´í‹°ë¸Œ SQL ì¿¼ë¦¬ê°€ ì‚¬ìš©í•˜ëŠ” í…Œì´ë¸”ì„ íŒë³„í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—, ê° ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ì˜ ëŒ€ìƒì„ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ í”ŒëŸ¬ì‹œí•´ì•¼ í•˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ ê²°ì •í•  ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤.COMMIT (JPA &amp; Hibernate)í”ŒëŸ¬ì‹œ íƒ€ì… COMMITì€ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ê¸° ì „ì— í”ŒëŸ¬ì‹œê°€ í•„ìš”í•˜ì§€ë§Œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì— ìˆ˜í–‰í•´ì•¼í•  ì‘ì—…ì„ ì •ì˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í•˜ì´ë²„ë„¤ì´íŠ¸ 5, 6 ì—ì„œëŠ” ì•„ë¬´ ì¿¼ë¦¬ë‚˜ ìˆ˜í–‰í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œëŠ” ë³´ë¥˜ì¤‘ì¸ ìˆ˜ì •ì‚¬í•­ì„ í”ŒëŸ¬ì‹œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê°„ë‹¨íˆ ë§í•´ flush()ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ê±°ë‚˜ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ë˜ëŠ” ê²½ìš°ì—ë§Œ í”ŒëŸ¬ì‹œ ë©ë‹ˆë‹¤.@Testvoid flushCOMMIT() { EntityManager em = emf.createEntityManager(); em.setFlushMode(FlushModeType.COMMIT); em.getTransaction().begin(); var soccerPlayer = new SoccerPlayer(); soccerPlayer.setName(\"ì†í¥ë¯¼\"); em.persist(soccerPlayer); em.createQuery(\"SELECT f FROM SoccerTeam f\").getResultList(); Query q = em.createQuery(\"SELECT p FROM SoccerPlayer p WHERE p.name = :name\"); q.setParameter(\"name\", \"ì†í¥ë¯¼\"); q.getResultList(); em.getTransaction().commit(); em.close();}ì˜ˆì œ ì½”ë“œì…ë‹ˆë‹¤. AUTO ë•Œì˜ ì˜ˆì œì½”ë“œì— em.setFlushMode(FlushModeType.COMMIT); í•œì¤„ì„ ì¶”ê°€í•˜ì—¬ í”ŒëŸ¬ì‹œ ëª¨ë“œë¥¼ COMMIT ìœ¼ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. ì˜ˆì œë¥¼ ì‹¤í–‰ì‹œì¼œë³´ë©´ ìœ„ AUTOë•Œì™€ ë‹¤ë¥´ê²Œ em.getTransaction().commit(); ì½”ë“œê°€ ì‹¤í–‰ë ë•Œ insert ì¿¼ë¦¬ê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ë‚ ë¼ê°€ê²Œ ë©ë‹ˆë‹¤.ì‹¤ì œ í”„ë¡œë•ì…˜ ë ˆë²¨ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” AUTO ë³´ë‹¤ëŠ” COMMIT ëª¨ë“œë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤. ì°¸ê³ ë¡œ AUTO, COMMIT ëª¨ë“œì˜ ê²½ìš° ìœ„ì˜ ì˜ˆì œì²˜ëŸ¼ â€˜entityManager.setFlushMode(FlushModeType.COMMIT);â€™ í˜•ì‹ìœ¼ë¡œ ëª¨ë“œë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ALWAYS (Hibernate)ALWAYS ëª¨ë“œëŠ” í•˜ì´ë²„ë„¤ì´íŠ¸ ëª…ì„¸ì—ë§Œ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ë§Œì•½ Spring Data JPAë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ì‚¬ìš©í• ìˆ˜ ì—†ëŠ” ëª¨ë“œì…ë‹ˆë‹¤. ì´ ëª¨ë“œëŠ” í•˜ì´ë²„ë„¤ì´íŠ¸ì—ê²Œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì— ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ í”ŒëŸ¬ì‹œí•˜ë¼ê³  ì§€ì‹œí•©ë‹ˆë‹¤. ì´ ëª¨ë“œë¥¼ ì‚¬ìš©í•œë‹¤ë©´, í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” í”ŒëŸ¬ì‹œê°€ í•„ìš”í•œì§€ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì§€ ì•Šê³  ëª¨ë“  ìœ í˜•ì˜ ì¿¼ë¦¬ë¥¼ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.@Testvoid flushALWAYS() { EntityManager em = emf.createEntityManager(); Session session = em.unwrap(Session.class); session.setHibernateFlushMode(FlushMode.ALWAYS); em.getTransaction().begin(); var soccerPlayer = new SoccerPlayer(); soccerPlayer.setName(\"ì†í¥ë¯¼\"); em.persist(soccerPlayer); Query q = em.createQuery(\"SELECT f FROM SoccerTeam f\"); q.getResultList(); var insertedPlayer = em.createQuery(\"SELECT p FROM SoccerPlayer p\").getResultList().stream().findFirst().orElse(null); Assert.notNull(insertedPlayer, \"One soccer player should be inquired.\"); em.getTransaction().commit(); em.close();}ì˜ˆì œ ì½”ë“œì…ë‹ˆë‹¤. SoccerTeam ì¡°íšŒ ì¿¼ë¦¬ì˜ í”ŒëŸ¬ì‹œ ëª¨ë“œë¥¼ ALWAYSë¡œ ì„¤ì •í•˜ì˜€ìŠµë‹ˆë‹¤. ì˜ˆì œë¥¼ ì‹¤í–‰ì‹œì¼œë³´ë©´ SoccerTeamì€ SoccerPlayerì˜ ì¡´ì¬ë¥¼ ëª¨ë¦„ì—ë„ ë¶ˆêµ¬í•˜ê³  í”ŒëŸ¬ì‹œ ëª¨ë“œë¥¼ ALWAYSë¡œ ì„¸íŒ…í•˜ì˜€ê¸° ë•Œë¬¸ì— select ì¿¼ë¦¬ê°€ ë‚ ë¼ê°€ê¸° ì „ì— insert ì¿¼ë¦¬ê°€ ìˆ˜í–‰ë˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ ë˜í•œ ì •ìƒì ìœ¼ë¡œ í†µê³¼ë©ë‹ˆë‹¤.MANUAL (Hibernate)ë§ˆì§€ë§‰ìœ¼ë¡œ MANUAL ëª¨ë“œì…ë‹ˆë‹¤. MANUALì€ ALWAYSì™€ ë§ˆì°¬ê°€ì§€ë¡œ í•˜ì´ë²„ë„¤ì´íŠ¸ ìŠ¤í™ì—ì„œë§Œ ì§€ì›í•˜ëŠ” ëª¨ë“œì…ë‹ˆë‹¤. ì´ ëª¨ë“œëŠ” ëª¨ë“  ìë™ í”ŒëŸ¬ì‹œê°€ ë¹„í™œì„±í™”ë˜ê³  ê°œë°œìê°€ ëª…ì‹œì ìœ¼ë¡œ í”ŒëŸ¬ì‹œ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í”ŒëŸ¬ì‹œê°€ ë™ì‘í•©ë‹ˆë‹¤.@Testvoid flushMANUAL() { EntityManager em = emf.createEntityManager(); Session session = em.unwrap(Session.class); session.setHibernateFlushMode(FlushMode.MANUAL); em.getTransaction().begin(); var soccerPlayer = new SoccerPlayer(); soccerPlayer.setName(\"ì†í¥ë¯¼\"); session.save(soccerPlayer); session.flush(); var insertedPlayer = em.createQuery(\"SELECT p FROM SoccerPlayer p\").getResultList().stream().findFirst().orElse(null); Assert.notNull(insertedPlayer, \"One soccer player should be inquired.\"); em.getTransaction().commit(); em.close();}ì˜ˆì œ ì½”ë“œì…ë‹ˆë‹¤. SoccerPlayer ì—”í‹°í‹°ë¥¼ ì €ì¥í•˜ëŠ” ì½”ë“œì¸ë°ìš”, í•œë²ˆ ì‹¤í–‰ì‹œì¼œ ë³¸ í›„ì— session.flush(); ì½”ë“œë¥¼ ì œê±°í•˜ê³  ë‹¤ì‹œ ì‹¤í–‰ì‹œì¼œ ë³´ì„¸ìš”. í”ŒëŸ¬ì‹œë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì‘ì„±í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— í”ŒëŸ¬ì‹œê°€ ì¼ì–´ë‚˜ì§€ ì•Šì•„ í…ŒìŠ¤íŠ¸ëŠ” ì‹¤íŒ¨í•˜ê²Œ ë©ë‹ˆë‹¤.ê²°ë¡ ì˜¤ëŠ˜ì€ JPA &amp; Hibernateì˜ 4ê°€ì§€ í”ŒëŸ¬ì‹œ ëª¨ë“œë¥¼ ì‚¬í´ë³´ì•˜ìŠµë‹ˆë‹¤. ê°œì¸ì ìœ¼ë¡œëŠ” Spring Data JPAê°€ MANUAL ëª¨ë“œë¥¼ ì§€ì›í•˜ì§€ ì•Šì•„ ì¡°ê¸ˆ ì•„ì‰½ìŠµë‹ˆë‹¤. Spring Data JPAê°€ ë‚˜ì˜¤ê¸° ì´ì „ Hibernate / Session ìœ¼ë¡œ ì´ë¦¬ì €ë¦¬ ë†€ì•˜ë˜ ë•Œì—ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ë”°ë¼ ì„¸ì„¸í•˜ê²Œ ì„¤ì •í• ìˆ˜ ìˆì—ˆë˜ ì ì´ ì¢‹ì•˜ë˜ê²ƒ ê°™ìŠµë‹ˆë‹¤.ê·¸ë ‡ë‹¤ê³  ì´ì œì™€ì„œ Spring Data JPAë¥¼ ì“°ì§€ ì•Šê¸°ì—” ë„ˆë¬´ í¸ë¦¬í•œê²ƒë„ ì‚¬ì‹¤ì…ë‹ˆë‹¤. ê·¸ëŸ°ë‚ ì´ ì˜¬ì§€ëŠ” ëª¨ë¥´ê² ì§€ë§Œ JPA ëª…ì„¸ì— í•˜ì´ë²„ë„¤ì´íŠ¸ì˜ ìŠ¤í™ì´ ì¶”ê°€ë˜ì—ˆìœ¼ë©´ ì¢‹ê² ë„¤ìš”." }, { "title": "í™ˆì„œë²„ êµ¬ì¶•ê¸°", "url": "/posts/home-server/", "categories": "ETC", "tags": "ETC", "date": "2022-02-19 10:12:00 +0900", "snippet": "ê°œìš”ì§‘ì—ì„œ ì‹œë†€ë¡œì§€ NASë¥¼ êµ´ë¦°ì§€ 3ë…„ì´ ë˜ì–´ê°„ë‹¤. ê·¸ë‹¹ì‹œ ê°œì¸ ì €ì¥ì†Œì— ëŒ€í•œ ë§‰ì—°í•œ í™˜ìƒì´ ìˆì–´ êµ¬ë§¤í•˜ì˜€ì§€ë§Œ ìƒê°ë³´ë‹¤ ì½”ì–´ë‹¨ì„ ê±´ë“œë¦¬ëŠ” ë¶€ë¶„ì— ìˆì–´ ì œì•½ì‚¬í•­ì´ ê½¤ ë§ì•˜ë˜ê²ƒ ê°™ë‹¤. ë­ ë„ì»¤ë¥¼ ì„¤ì¹˜í•˜ê³  ì–´ì©Œêµ¬ ì €ì©Œêµ¬ í•˜ë©´ ë˜ì§€ë§Œ ê²°êµ­ OSëŠ” DSMì´ë‹¤.ì‹¬ì§€ì–´ ì•¼ì‹¬ì°¨ê²Œ ë°–ì•„ë„£ì€ 1TB HDDëŠ” 20%ë„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ë¨¼ì§€ë§Œ ìŒ“ì—¬ê°€ê³  ìˆì—ˆë‹¤. ê·¸ë˜ì„œ ì˜¬í•´ ì¤‘ê³ ë¡œ íŒ”ì•„ë²„ë ¸ë‹¤. ì œ ê°’ì„ ëª»ë°›ì€ê²ƒ ê°™ê¸´ í•˜ì§€ë§Œ ë­ ì“¸ë°ë„ ì—†ìœ¼ë‹ˆ í›„íšŒí•˜ì§„ ì•ŠëŠ”ë‹¤.NASë¥¼ íŒ”ê¸´ í–ˆì§€ë§Œ ê°œì¸ ì„œë²„ê°€ í•„ìš”í•˜ê¸´ í–ˆë‹¤. ì¤‘ìš”í•œ ìë£Œë¥¼ ì €ì¥í•  ê³³ì´ í•„ìš”í•˜ê³  ì‹¤ì‹œê°„ìœ¼ë¡œ ìë£Œë¥¼ ì—…ë¡œë“œí•˜ê³  ë‹¤ìš´ë°›ì„ ìˆ˜ ìˆëŠ”, ê·¸ëŸ¬ë©´ì„œ ìš©ëŸ‰ì€ ê·¸ë ‡ê²Œ í¬ì§€ ì•Šì•„ë„ ë˜ëŠ” ê·¸ëŸ° ì‘ì€ ì„œë²„ ë§ì´ë‹¤.ì²˜ìŒ ìƒê°í•œê±´ AWSì˜€ë‹¤. ê·¼ë° EBSì˜ ìš©ëŸ‰ì´ ì˜¬ë¼ê°€ë©´ ì˜¬ë¼ê°ˆìˆ˜ë¡ ìš”ê¸ˆì´ ê¸°í•˜ê¸‰ìˆ˜ì ìœ¼ë¡œ ì˜¬ë¼ê°€ëŠ”ê²ƒì„ ë³´ê³  í¬ê¸°í•˜ê²Œ ë˜ì—ˆë‹¤. ë¬´ì—‡ë³´ë‹¤ ìµœê·¼ ë„ˆë¬´ ë§ì€ ì¼ë“¤(ê°œì¸, íšŒì‚¬..) ì„ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ë¡œ ì²˜ë¦¬í•˜ë‹¤ ë³´ë‹ˆ ì¡°ê¸ˆ ì§ˆë¦°(?) ë“¯ í•˜ì˜€ë‹¤.ê·¸ë˜ì„œ ê²°ë¡ ì ìœ¼ë¡œ ì„ íƒí•œê±´ ë² ì–´ë³¸ PCì´ë‹¤. ì ë‹¹íˆ ì „ë ¥ì„ ë¨¹ìœ¼ë©´ì„œ ë‚´ê°€ ì›í•˜ëŠ” ì‚¬ì–‘ìœ¼ë¡œ ë§ì¶œ ìˆ˜ ìˆì„ê²ƒ ê°™ì•˜ë‹¤. (ë¬´ì—‡ë³´ë‹¤ ì‚¬ì´ì¦ˆê°€ ì‘ê³  ì´ë»ì„œ ì¸í…Œë¦¬ì–´ì— í° ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤.)í•˜ë“œì›¨ì–´ êµ¬ì„±1. PCë‚´ê°€ ì„ íƒí•œ PCëŠ” PN41-BBC035MV ìš”ë†ˆì´ë‹¤. 2ì½”ì–´ 2ìŠ¤ë ˆë“œì˜ ì‚¬ì–‘ì„ ê°€ì§„ ì…€ëŸ¬ë¡  N4505 CPUë¥¼ íƒ‘ì¬í•˜ì˜€ê³  USB 3.0 ì§€ì›, ë¸”ë£¨íˆ¬ìŠ¤ íƒ‘ì¬, 0.7kgì˜ ë¬´ê²Œ ë“±ì˜ íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆë‹¤. ë¬´ì—‡ë³´ë‹¤ ì´ì˜ë‹¤.ëª¨ë‹ˆí„°ì•” ì•„ë˜ ë‚¨ëŠ” ê³µê°„ì— ë°°ì¹˜í•  ìˆ˜ ìˆì–´ì„œ ì¢‹ë‹¤. (ì—ë„ˆì§€ ì ˆì•½ ìŠ¤í‹°ì»¤ê°€ ìˆì–´ë„ ì´ì˜ë„¤)2. ì €ì¥ì¥ì¹˜ë² ì–´ë³¸ CPë¼ ì €ì¥ì¥ì¹˜ê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•Šë‹¤. í”„ë¡œê·¸ë¨ì„ ëŒë¦¬ëŠ” ìš©ë„ì˜ SSD 256GB ì™€ íŒŒì¼, ë°ì´í„° ì €ì¥ìš© HHD 1TBë¡œ êµ¬ì„±í–ˆë‹¤. SSDì™€ HDDëŠ” ê°ê° M.2 2280 for PCIe, 2.5ì¸ì¹˜ì˜ ê·œê²©ìœ¼ë¡œ ë§ì¶°ì•¼ í•œë‹¤.ì•ˆíƒ€ê¹ê²Œë„ ì§‘ì— êµ´ëŸ¬ë‹¤ë‹ˆëŠ” SSDì™€ HDDëŠ” ëª¨ë‘ ë°ìŠ¤í¬íƒ‘ ìš©ì´ì—ˆê¸° ë•Œë¬¸ì— ëˆˆë¬¼ì„ ë¨¸ê¸ˆê³  10ë§Œì›ì„ ì§€ì¶œí–ˆë‹¤.3. RAMë¨ë„ í¬í•¨ë˜ì–´ìˆì§€ ì•Šì§€ë§Œ ë§ˆì¹¨ 8GB ì§œë¦¬ ë¨ì´ ìˆì–´ ë¨ì€ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê¸°ë¡œ í–ˆë‹¤. ë¨ì€ ë…¸íŠ¸ë¶ìš©ì¸ SO-DIMM ê·œê²©ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.4. ê³µìœ ê¸°ê¸°ì¡´ NASë¥¼ ì‚¬ìš©í• ë•ŒëŠ” NAS ìì²´ë¥¼ ê±°ì‹¤ì— ë‘ê³  ì‚¬ìš©í–ˆê³  IPê°€ ë°”ë€Œë”ë¼ë„ ê·¸ë¥¼ íƒì§€í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ í†µí•´ ìë™ìœ¼ë¡œ ë‚´ íœ´ëŒ€í°ì—ì„œ ì ‘ê·¼í• ìˆ˜ ìˆê²Œë” ì‚¬ìš©í•´ì™”ë‹¤. í•˜ì§€ë§Œ ë‚˜ëŠ” ì´ í™ˆì„œë²„ëŠ” 24ì‹œê°„ ì¤‘ë‹¨ì—†ì´ ëŒë¦´ ìƒê°ì´ë‹¤. ì„ íƒí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€ 2ê°€ì§€ê°€ ìˆì—ˆë‹¤. ì›” ìš”ê¸ˆ ì§€ë¶ˆí›„ ê³ ì • IP ì‚¬ìš© ê³µìœ ê¸°(ipTIME)ì˜ DDNS ê¸°ëŠ¥ ì‚¬ìš©ì–´ì¨Œê±°ë‚˜ ë‚˜ëŠ” ë‚´ ë°©ì— PCë¥¼ ë‘˜ ìƒê°ì´ì—ˆê³  ë‚´ ë°©ì˜ ëœí¬íŠ¸ëŠ” í•œê°œê¸° ë•Œë¬¸ì— ê³µìœ ê¸°ê°€ í•„ìš”í–ˆë‹¤. ê³µìœ ê¸°ë¥¼ ì‚¬ëŠ” ê¹€ì— DDNS ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ ë³´ê¸°ë¡œ í–ˆë‹¤. ì„ íƒí•œ ê³µìœ ê¸°ëŠ” A2004NS-MU ì´ë‹¤. ê·¸ëƒ¥ ì¿ íŒ¡ì—ì„œ ë¡œì¼“ë°°ì†¡ ì§€ì›í•˜ê³  1ë“±ì´ê¸¸ë˜ êµ¬ë§¤í–ˆë‹¤.ì„œë²„ êµ¬ì„± ë° êµ¬ì¶•1. OSOSëŠ” Rocky Linuxë¡œ ì •í–ˆë‹¤. Rocky Linuxë„ ì–¸ì  ê°€ëŠ” CentOS ê¼´ì´ ë‚ ê²ƒì´ë¼ ìƒê°í•˜ëŠ” ì‚¬ëŒë„ ìˆê³  ë‚˜ ì—­ì‹œ ê·¸ëŸ´ ê°€ëŠ¥ì„±ì´ ìˆì–´ Ubuntuì™€ ëê¹Œì§€ ê³ ë¯¼í–ˆì§€ë§Œ, ë‚˜ëŠ” ë ˆë“œí–‡ ê³„ì—´ì˜ ë¦¬ëˆ…ìŠ¤ì— ë” ëŒë¦°ë‹¤. ì–´ì©”ìˆ˜ ì—†ë‚˜ ë³´ë‹¤.ì§‘ì—ì„œ êµ´ëŸ¬ë‹¤ë‹ˆëŠ” USBì„ ë¶€íŒ…ë””ìŠ¤í¬ë¡œ ë§Œë“¤ì–´ OSë¥¼ ì„¤ì¹˜í–ˆë‹¤.2. ì›ê²©ì ‘ì†ìµœìš°ì„ ìœ¼ë¡œ ì‘ì—…í•´ì•¼ í•˜ëŠ”ê²ƒì€ ë©”ì¸ ë°ìŠ¤í¬í†±ì„ í†µí•´ SSHë¡œ ì ‘ì† ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ê²ƒì´ë‹¤. í‚¤ë³´ë“œ, ëª¨ë‹ˆí„°ë¥¼ pcë§ˆë‹¤ ì˜®ê²¨ê°€ë©° ì„¸íŒ…í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ë‹¤ìŒ ì‚¬ì§„ê³¼ ê°™ì´ ì±…ìƒì´ ë”ëŸ¬ì›Œì§„ë‹¤.ë‹¤í–‰ì´ puttyë‚˜ xshellë“± ì›ê²©ì ‘ì† íˆ´ì„ ì‚¬ìš©í•  ì¤„ ì•„ëŠ” ì‚¬ëŒì´ë¼ë©´ ë¬¸ì œê°€ ì—†ì„ë“¯ í•˜ë‹¤. ë‘ PCì˜ ì‚¬ì„¤ IP ëŒ€ì—­ì€ ë™ì¼í•˜ê¸° ë•Œë¬¸ì´ë‹¤.ìœ„ ì´ë¯¸ì§€ì™€ ê°™ì´ iptime ìì²´ì˜ IPëŠ” 192.168.0.1, Windowsì˜ ê²½ìš° 192.168.0.2, Linuxì˜ ê²½ìš° 192.168.0.3ì„ ê°ê° í• ë‹¹ë°›ê³  ìˆë‹¤. ì´ê²ƒì´ ì˜ë¯¸í•˜ëŠ” ê²ƒì€ Windowsì˜ ì›ê²©ì ‘ì† íˆ´ì—ì„œ 192.168.0.3 / 22 ë¥¼ í˜¸ìŠ¤íŠ¸ / í¬íŠ¸ë¡œ ì„¤ì •í›„ ì ‘ì†í•˜ë©´ ëœë‹¤ëŠ” ëœ»ì´ ëœë‹¤.Rocky Linuxì˜ ê²½ìš° 22ë²ˆ í¬íŠ¸ê°€ ê¸°ë³¸ìœ¼ë¡œ ëª¨ë“  ipì—ì„œ ì ‘ê·¼ì„ í—ˆìš©í•˜ê¸° ë•Œë¬¸ì— ê·¸ëƒ¥ ì ‘ì†ë  ê²ƒì´ë‹¤. í˜¹ì‹œ ì ‘ì†ì´ ì•ˆëœë‹¤ë©´ ë¦¬ëˆ…ìŠ¤ì—ì„œ netstat -tnlp ëª…ë ¹ì–´ë¥¼ í†µí•´ 22ë²ˆ í¬íŠ¸ê°€ ì˜¤í”ˆë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì—´ìˆì§€ ì•Šë‹¤ë©´ ë°©í™”ë²½ ì„¤ì •ì„ í†µí•˜ì—¬ 22ë²ˆ í¬íŠ¸ë¥¼ ì˜¤í”ˆí•´ë³´ì.3. WOL ì„¤ì •ìì„¸í•˜ê²Œ ë‹¤ë£¨ì§€ëŠ” ì•Šê² ì§€ë§Œ PCê°€ ì•Œìˆ˜ì—†ëŠ” ì´ìœ ë¡œ êº¼ì¡Œì„ ê²½ìš°ë‚˜ ì™¸ë¶€ì—ì„œ PCë¥¼ ì¼œì•¼í•  ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬ ì›ê²© ë¶€íŒ…ì„ ì„¤ì •í–ˆë‹¤. ì´ ê¸€ì„ í†µí•´ ê³µìœ ê¸°ë¥¼ ì„¸íŒ…í•˜ì˜€ê³  ì´ ê¸€ ì„ ì°¸ì¡°í•´ Linuxì—ì„œ ì„¤ì •í•˜ì˜€ë‹¤.ì£¼ì˜í•´ì•¼ í• ì ì€ ì¼ë°˜ ì»¤ë§¨ë“œë¡œ ì„¤ì •í•œ ê²½ìš° ì‹œìŠ¤í…œì´ ì¢…ë£Œë˜ë©´ ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ê¸° ë•Œë¬¸ì— ë„¤íŠ¸ì›Œí¬ ìŠ¤í¬ë¦½íŠ¸ì— ì¶”ê°€í•´ì¤˜ì•¼ í•œë‹¤ëŠ” ì ì´ë‹¤.4. ëª¨ë‹ˆí„°ë§ íˆ´ ì„ íƒëª¨ë‹ˆí„°ë§ íˆ´ì„ ì„ ì •í•´ì•¼ í•œë‹¤. ìƒˆì‚¼ AWSì˜ Cloud Watch ê¸°ëŠ¥ì´ ê·¸ë¦¬ì›Œì¡Œì—ˆë‹¤. ëª¨ë‹ˆí„°ë§ì€ ì„œë²„ ìš´ìš©ì— ìˆì–´ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í–ˆê¸° ë•Œë¬¸ì— ëª¨ë‹ˆí„°ë§ íˆ´ì„ ì•Œì•„ë´¤ëŠ”ë° ìµœì¢…ì ìœ¼ë¡œ Zabbixì™€ Prometheusì¤‘ì— í•˜ë‚˜ ì„ íƒí•˜ê¸°ë¡œ í–ˆë‹¤.PrometheusëŠ” ì‹œê°í™” ë„êµ¬ì¸ Grafanaì™€ ì„¸íŠ¸ë¼ê³  ìƒê°í•˜ëŠ”ë°, ì´ Grafanaê°€ Zabbixë³´ë‹¤ UI / UX ë©´ì—ì„œ ì´ë»ë³´ì´ê³  í•´ì™¸ í¬ëŸ¼ë„ Prometheusì˜ ì†ì„ ë“¤ì–´ì£¼ëŠ”ê²ƒ ê°™ì•˜ê¸°ì— ê²°ë¡ ì ìœ¼ë¡œ Prometheusë¥¼ ì„ íƒí•˜ì˜€ë‹¤.ì•„ì§ êµ¬ë™ì¤‘ì¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ë‚˜ ê¸°íƒ€ DBëŠ” ì—†ê¸° ë•Œë¬¸ì— ì¼ë‹¨ Node Exporterë¥¼ í†µí•´ CPU, OS, Memory ë“±ì˜ ì‹œìŠ¤í…œ ë§¤íŠ¸ë¦­ì„ ëª¨ë‹ˆí„°ë§ë§Œ í• ìˆ˜ ìˆë„ë¡ êµ¬ì„±í•˜ì˜€ë‹¤.5. Dockerë§ˆì§€ë§‰ìœ¼ë¡œ ë„ì»¤ë¥¼ ì„¤ì¹˜í•˜ì˜€ë‹¤. ê°ê°ì˜ ì»¨í…Œì´ë„ˆëŠ” í•œê°œì”©ì¼ ê²ƒì´ê¸° ë•Œë¬¸ì— k8sëŠ” ì˜¤ë²„ìŠ¤í™ì´ë¼ê³  ìƒê°í•˜ì—¬ ì„¤ì¹˜í•˜ì§€ ì•Šì•˜ë‹¤. ëª¨ë“  ì–´í”Œë¦¬ì¼€ì´ì…˜, DB ë“±ì€ ì´ ë„ì»¤ìœ„ì˜ ì»¨í…Œì´ë„ˆë¡œ ì˜¬ë¼ê°ˆ ê²ƒì´ë‹¤.ë§ˆì¹˜ë©°ì˜¤ë¬ë™ì•ˆ í•¨ê»˜í–ˆë˜ NASë¥¼ íŒ”ì•„ë²„ë¦¬ê³  ìƒˆë¡œìš´ ë¯¸ë‹ˆ PCë¥¼ ì˜ì…í–ˆë‹¤. AWSë¡œ í¸í•˜ê²Œ ì¸ìŠ¤í„´ìŠ¤ ë„ìš°ë‹¤ ì‹¤ì œ ë¬¼ë¦¬ì ì¸ ì¥ë¹„ ìœ„ì— Linuxë¥¼ ë„ˆë¬´ ì˜¤ëœë§Œì— ê¹”ì•„ë´ì„œ ê·¸ëŸ°ì§€ ì‚½ì§ˆì„ ì¢€ í•œê²ƒ ê°™ë‹¤. ê·¸ë˜ë„ ì˜›ë‚ ì— ê°€ìƒë¨¸ì‹ ì— Linuxê¹”ì•„ì„œ í¬íŠ¸í¬ì›Œë”©ìœ¼ë¡œ í¬íŠ¸í´ë¦¬ì˜¤ ì˜¤í”ˆí•˜ê³  í–ˆë˜ ê¸°ì–µì´ ìƒˆë¡ìƒˆë¡ ë– ì˜¬ë¼ ì¬ë°Œì—ˆë‹¤.ì‹¤ì œ ì„œë¹„ìŠ¤ë¥¼ ì˜¤í”ˆí•˜ê±°ë‚˜ ì™¸ë¶€ì— ì˜¤í”ˆí•  ê²ƒë„ ì•„ë‹ˆê³  ê·¸ëƒ¥ í˜¼ì ì•„ê¸°ìê¸° í•˜ê²Œ ì“¸ ìš©ë„ë¡œ ë§Œë“  êµ¬ì¶•í•œ ì„œë²„ê¸° ë•Œë¬¸ì— ëŒë¦¬ê³  ì‹¶ì—ˆë˜ê±°ë‚˜ ë§ì´ ëŒë ¤ë´ì•¼ ê² ë‹¤. ë¬´ì—‡ë³´ë‹¤ ì „ê¸°ì„¸ê°€ NASë¥¼ ëŒë¦´ë•Œë³´ë‹¤ ì ê²Œ ë‚˜ì˜¬ê²ƒ ê°™ì•„ ì¢‹ë‹¤." }, { "title": "Hibernate Reactive", "url": "/posts/hibernate-reactive/", "categories": "Java", "tags": "Java, Hibernate, Webflux", "date": "2022-02-10 10:12:00 +0900", "snippet": "ê°œìš”Hibernate Reactiveê°€ ë“œë””ì–´ ì •ì‹ ì¶œì‹œ ë˜ì—ˆìŠµë‹ˆë‹¤. (ì‚¬ì‹¤ í˜„ì¬ê¸°ì¤€ 3ë‹¬ ì§€ë‚¬ìŠµë‹ˆë‹¤.)Webflux - R2DBCë¡œ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í• ë•Œ ORMì— ëŒ€í•œ ê°ˆë§ì„ ëŠë¼ê³¤ í–ˆì—ˆëŠ”ë°, í™•ì‹¤íˆ ê°ˆì¦ì„ í•´ì†Œí•´ì¤„ ë§Œí•œ ë¬¼ê±´ì´ ë‚˜ì˜¨ê²ƒ ê°™ìŠµë‹ˆë‹¤.í˜„ì¬ëŠ” Quarkus, Panacheì™€ ì‚¬ìš©í–ˆì„ë•Œ ë” íš¨ìœ¨ì„±ì„ ë°œíœ˜í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ê·¸ë˜ë„ ì˜ˆì „ Spring Data JPAê°€ ë‚˜ì˜¤ê¸°ì „ Hibernateë¥¼ ì‚¬ìš©í• ë•Œë¥¼ ë– ì˜¬ë¦¬ë©° ë‚´ìš©ì„ ì •ë¦¬í•´ ë³´ì•˜ìŠµë‹ˆë‹¤. ì–¸ì  ê°€ëŠ” Spring Data Familyì— í¬í•¨ë˜ì–´ Spring Data Reactive JPA(?)ê°€ ë‚˜ì˜¤ê¸¸ í¬ë§í•´ ë´…ë‹ˆë‹¤.Hibernate ReactiveWebfluxê°€ ë‚˜ì˜¨ì§€ 4ë…„ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤. Spring Data R2DBC ë¥¼ í†µí•´ non-blocking í•˜ê²Œ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆì§€ë§Œ, ì´ë ‡ë‹¤í•  ORM êµ¬í˜„ì²´ëŠ” ì—†ëŠ” ìƒí™©ì´ì—ˆìŠµë‹ˆë‹¤.Hibernate ReactiveëŠ” Hibernate ORM ì„ ìœ„í•œ ë¦¬ì•¡í‹°ë¸Œ APIë¡œ, ë°ì´í„°ë² ì´ìŠ¤ì— non-blockingí•˜ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•©ë‹ˆë‹¤. Hibernate ReactiveëŠ” ë°ì´í„°ë² ì´ìŠ¤ì™€ non-blocking ë°©ì‹ìœ¼ë¡œ í†µì‹ í•˜ë„ë¡ ì„¤ê³„ëœ ìµœì´ˆì˜ ORM êµ¬í˜„ì²´ ì…ë‹ˆë‹¤.ë˜í•œ ë§ì€ ë¶€ë¶„ì´ ê¸°ì¡´ì˜ Hibernate ORM, JPA 2.2 ê³¼ ë™ì¼í•˜ê¸° ë•Œë¬¸ì—, ë§Œì•½ JPAì— ëŒ€í•œ ì´í•´ë„ê°€ ê¹Šì€ ë¶„ì´ë¼ë©´ ì‰½ê²Œ Hibernate Reactiveì— ì ì‘í•˜ì‹¤ ê²ƒì´ë¼ ìƒê°í•©ë‹ˆë‹¤.ì†Œê°œ ë° ì˜ˆì œì´ì–´ì§ˆ ë‚´ìš© ë¶€í„°ëŠ” ê°„ë‹¨í•œ CRUD ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ë©´ì„œ Hibernate Reactiveë¥¼ ì†Œê°œí•´ ë³´ê² ìŠµë‹ˆë‹¤.1. í”„ë¡œì íŠ¸ ì„¸íŒ…Spring ì§„ì˜ì—ì„œ ì•„ì§ê¹Œì§€ëŠ” Hibernate Reactiveë¥¼ ë°›ì•„ë“¤ì´ì§€ ì•Šì€ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤ë§Œ, ë‹¤í–‰íˆë„ Springê³¼ Hibernate Reactiveë¥¼ ì¡°í•©í•˜ëŠ” ê²ƒì€ ê·¸ë¦¬ ì–´ë µì§€ ì•Šì€ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì €ëŠ” Spring Webflux ê¸°ë°˜ì˜ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤.1.1. ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ì‚¬ìš©í•  ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì„ ì •ì˜í•œ gradle íŒŒì¼ ì…ë‹ˆë‹¤.dependencies { implementation 'org.springframework.boot:spring-boot-starter-webflux' implementation 'org.hibernate.reactive:hibernate-reactive-core:1.1.2.Final' implementation 'io.vertx:vertx-pg-client:4.2.4' implementation 'com.ongres.scram:client:2.1' implementation 'io.smallrye.reactive:mutiny-reactor:1.3.1' implementation 'org.projectlombok:lombok'} ë‚˜ì¤‘ì— com.ongres.scram í´ë˜ìŠ¤ê°€ ì—†ë‹¤ëŠ” ì—ëŸ¬ê°€ ë°œìƒì‹œ íŒ¨í‚¤ì§€ì— implementation 'org.hibernate.orm:hibernate-jpamodelgen:6.0.0.CR1' ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.ì´ í”„ë¡œì íŠ¸ëŠ” PostgreSQL ì„ ê¸°ë°˜ìœ¼ë¡œ ì§„í–‰ë  ì˜ˆì • ì´ì§€ë§Œ í˜„ì¬ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ë² ì´ìŠ¤ì™€ ë“œë¼ì´ë²„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. Database Driver dependency PostgreSQL or CockroachDB io.vertx:vertx-pg-client:{vertxVersion} MySQL or MariaDB io.vertx:vertx-mysql-client:{vertxVersion} DB2 io.vertx:vertx-db2-client:{vertxVersion} SQL Server io.vertx:vertx-mssql-client:${vertxVersion} 1.2. persistence.xml ì •ì˜Hibernate ReactiveëŠ” í‘œì¤€ JPA persistence.xml ë¬¸ì„œë¥¼ í†µí•´ êµ¬ì„±ë˜ë©°, ë³´í†µ /META-INF ë””ë ‰í† ë¦¬ì— ë°°ì¹˜ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.&lt;persistence xmlns=\"http://xmlns.jcp.org/xml/ns/persistence\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd\" version=\"2.2\"&gt; &lt;persistence-unit name=\"pu\"&gt; &lt;provider&gt;org.hibernate.reactive.provider.ReactivePersistenceProvider&lt;/provider&gt; &lt;properties&gt; &lt;!-- PostgreSQL --&gt; &lt;property name=\"javax.persistence.jdbc.url\" value=\"jdbc:postgresql://localhost:5432/database\"/&gt; &lt;!-- Credentials --&gt; &lt;property name=\"javax.persistence.jdbc.user\" value=\"user\"/&gt; &lt;property name=\"javax.persistence.jdbc.password\" value=\"password\"/&gt; &lt;!-- The Vert.x SQL Client connection pool size --&gt; &lt;property name=\"hibernate.connection.pool_size\" value=\"10\"/&gt; &lt;!-- Automatic schema export --&gt; &lt;property name=\"javax.persistence.schema-generation.database.action\" value=\"update\"/&gt; &lt;!-- SQL statement logging --&gt; &lt;property name=\"hibernate.show_sql\" value=\"true\"/&gt; &lt;property name=\"hibernate.format_sql\" value=\"true\"/&gt; &lt;property name=\"hibernate.highlight_sql\" value=\"true\"/&gt; &lt;/properties&gt; &lt;/persistence-unit&gt;&lt;/persistence&gt; Hibernate Reactiveì— ìœ ì¼í•œ í•„ìˆ˜ ì¡°ê±´ì€ ìš”ì†Œì´ë©°, ì´ëŠ” ê¼­ ëª…ì‹œë˜ì–´ì•¼ í•©ë‹ˆë‹¤. êµ¬ì„± ì†ì„±ì¤‘ JDBCë¼ê³  ëª…ì‹œë˜ì–´ ìˆì§€ë§Œ Hibernate ReactiveëŠ” JDBCê°€ ì—†ìœ¼ë©° ê³¼ê±° JPA ì‚¬ì–‘ì—ì„œ ì •ì˜í•œ ë ˆê±°ì‹œ ì†ì„± ì´ë¦„ì„ ë¿ì…ë‹ˆë‹¤. íŠ¹íˆ Hibernate ReactiveëŠ” ìì²´ì ìœ¼ë¡œ JDBC URLì„ ì½ê³  í•´ì„í•©ë‹ˆë‹¤. hibernate.dialect ë¥¼ ì§€ì •í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤. Hibernate ReactiveëŠ” ìë™ìœ¼ë¡œ ì•Œë§ì€ dialectë¥¼ ê²°ì •í•©ë‹ˆë‹¤. HibernateëŠ” êµ¬ì„± ê°€ëŠ¥í•œ ë§ì€ ê²ƒë“¤ì„ ê°€ì§€ê³  ìˆì§€ë§Œ ì´ê²ƒì€ ë ˆê±°ì‹œ ì½”ë“œì™€ì˜ í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€ë˜ê³  ìˆì„ ë¿ JDBCì™€ JTAì™€ì˜ ì§ì ‘ì ì¸ ê´€ë ¨ì€ ì—†ìŠµë‹ˆë‹¤.ë‹¤ìŒì€ ìë™ ìŠ¤í‚¤ë§ˆ êµ¬ì„±ì— ëŒ€í•œ ë‚´ìš©ì…ë‹ˆë‹¤. í”„ë¡œí¼í‹°ëª… ì„¤ëª… javax.persistence.schema-generation.database.action create: ìŠ¤í‚¤ë§ˆë¥¼ ì‚­ì œí•˜ê³  í…Œì´ë¸”, ì‹œí€€ìŠ¤, ì œì•½ì¡°ê±´ì„ ìƒì„± Â  create-only: í…Œì´ë¸”, ì‹œí€€ìŠ¤, ì œì•½ì¡°ê±´ì„ ìƒì„± Â  create-drop: ìŠ¤í‚¤ë§ˆë¥¼ ì‚­ì œí•˜ê³  SessionFactoryê°€ ìƒì„±ë˜ëŠ” ì‹œì ì— ì¬ìƒì„±, ì¶”ê°€ì ìœ¼ë¡œ SessionFactoryê°€ ì†Œë©¸ë˜ë©´ ìŠ¤í‚¤ë§ˆë¥¼ ì‚­ì œ Â  drop: SessionFactoryê°€ ì†Œë©¸ë˜ëŠ” ì‹œì ì— ìŠ¤í‚¤ë§ˆë¥¼ ì‚­ì œ Â  validate: ë³€ê²½ì—†ì´ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆì™€ ì—”í‹°í‹°ê°€ ì¼ì¹˜í•˜ëŠ”ì§€ ê²€ì¦ Â  update: ì—”í‹°í‹°ì™€ ìŠ¤í‚¤ë§ˆë¥¼ ë¹„êµí•˜ì—¬ ìŠ¤í‚¤ë§ˆì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì—”í‹°í‹°(í˜¹ì€ í•„ë“œ)ê°€ ì¡´ì¬ í•œë‹¤ë©´ ìŠ¤í‚¤ë§ˆë¥¼ ì—…ë°ì´íŠ¸ javax.persistence.create-database-schemas (ì„ íƒì‚¬í•­) ë§Œì•½ true ë¼ë©´, ìŠ¤í‚¤ë§ˆì™€ ì¹´íƒˆë¡œê·¸ë¥¼ ìë™ ìƒì„± javax.persistence.schema-generation.create-source (ì„ íƒì‚¬í•­) ê°’ì´metadata-then-scriptí˜¹ì€ script-then-metadata í…Œì´ë¸”, ì‹œí€€ìŠ¤ë¥¼ ìƒì„±í•  ë•Œ ì¶”ê°€ SQL ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰ javax.persistence.schema-generation.create-script-source (ì„ íƒì‚¬í•­) ë°”ë¡œ ìœ„ì—ì„œ ì‹¤í–‰í•  SQL ìŠ¤í¬ë¦½íŠ¸ ì´ë¦„ ì£¼ì˜! Db2ì˜ ê²½ìš° validate ì™€ updateë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.1.3 SQL ë¡œê¹… í”„ë¡œí¼í‹°ëª… ì„¤ëª… hibernate.format.sql trueë¼ë©´, ë©€í‹°ë¼ì¸, ë“¤ì—¬ì“°ê¸° í˜•ì‹ìœ¼ë¡œ ë¡œê·¸ ê¸°ë¡ hibernate.highlight_sql trueë¼ë©´, ANSI ì´ìŠ¤ì¼€ì´í”„ ì½”ë“œë¥¼ í†µí•´ êµ¬ë¬¸ì„ ê°•ì¡°í•˜ëŠ” í˜•íƒœë¡œ ë¡œê·¸ ê¸°ë¡ ìœ„ ë‘ ì˜µì…˜ì´ ëª¨ë‘ trueë¼ë©´ ì•„ë˜ì™€ ê°™ì´ ë³´ì´ê²Œ ë©ë‹ˆë‹¤.2. Java code ì‘ì„±ë³¸ê²©ì ìœ¼ë¡œ ìë°” ì½”ë“œë¥¼ ì‘ì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤.@Entity@Table(name = \"post\")@Data@Builder@NoArgsConstructor@AllArgsConstructorpublic class Post { @Id @GeneratedValue(strategy = GenerationType.AUTO) Long id; private String title; private String contents; @ManyToOne(targetEntity = Author.class) private Author author;}@Entity@Table(name = \"author\")@Data@Builder@NoArgsConstructor@AllArgsConstructorpublic class Author { @Id @GeneratedValue(strategy = GenerationType.AUTO) Long id; private String name;}ì‘ì„±ìì™€ ê¸€ì„ N:1ì˜ ì—°ê´€ê´€ê³„ë¡œ í‘œí˜„í•˜ì˜€ìŠµë‹ˆë‹¤.@Beanpublic Mutiny.SessionFactory sessionFactory() { return Persistence .createEntityManagerFactory(\"pu\") .unwrap(Mutiny.SessionFactory.class);}SessionFactory ê°ì²´ë¥¼ beanìœ¼ë¡œ ë“±ë¡í•©ë‹ˆë‹¤. ì´ë•Œ createEntityManagerFactoryì— ë“¤ì–´ê°ˆ ê°’ì€ persistence.xml íŒŒì¼ì˜ persistence-unit name ì˜ ê°’ê³¼ ë™ì¼í•´ì•¼ í•©ë‹ˆë‹¤.Mutiny íƒ€ì…ê³¼ Stage íƒ€ì…ì„ ì„ íƒí•  ìˆ˜ ìˆëŠ”ë°ìš”, í° ì°¨ì´ëŠ” ì—†ê³  ê³µì‹ë¬¸ì„œì˜ ì½”ë“œëŠ” Mutinyë¥¼ ì„ íƒí•´ì˜€ê¸° ë•Œë¬¸ì— ì—¬ê¸°ì„œë„ Mutinyë¥¼ ì‚¬ìš©í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.public interface KcReactiveRepository { &lt;E&gt; Uni&lt;E&gt; save(E entity); &lt;E&gt; Uni&lt;List&lt;E&gt;&gt; listAll(Class&lt;E&gt; clazz); &lt;E&gt; Uni&lt;E&gt; findById(Class&lt;E&gt; clazz, Object id); &lt;E&gt; Uni&lt;Integer&gt; deleteById(Class&lt;E&gt; clazz, Object id); &lt;E&gt; Uni&lt;Integer&gt; deleteAll(Class&lt;E&gt; clazz);}@Componentpublic record KcReactiveRepositoryImpl(Mutiny.SessionFactory sessionFactory) implements KcReactiveRepository { @Override public &lt;E&gt; Uni&lt;E&gt; save(E entity) { Assert.notNull(entity, \"entity must not be null!\"); return sessionFactory.withSession(session -&gt; session.persist(entity).chain(session::flush).replaceWith(entity)); } @Override public &lt;E&gt; Uni&lt;List&lt;E&gt;&gt; listAll(Class&lt;E&gt; clazz) { var query = this.buildQuery(clazz); query.from(clazz); return sessionFactory.withSession(session -&gt; session.createQuery(query).getResultList()); } @Override public &lt;E&gt; Uni&lt;E&gt; findById(Class&lt;E&gt; clazz, Object id) { Assert.notNull(id, \"id must not be null!\"); return sessionFactory.withSession(session -&gt; session.find(clazz, id)); } @Override public &lt;E&gt; Uni&lt;Integer&gt; deleteById(Class&lt;E&gt; clazz, Object id) { Assert.notNull(id, \"id must not be null!\"); var criteriaBuilder = this.sessionFactory.getCriteriaBuilder(); CriteriaDelete&lt;E&gt; delete = criteriaBuilder.createCriteriaDelete(clazz); var root = delete.from(clazz); var idField = Arrays.stream(clazz.getDeclaredFields()) .filter(field -&gt; field.getAnnotation(Id.class) != null) .findFirst().orElse(null); Assert.notNull(idField, \"id field of entity must not be null!\"); delete.where(criteriaBuilder.equal(root.get(idField.getName()), id)); return sessionFactory.withTransaction((session, tx) -&gt; session.createQuery(delete).executeUpdate()); } @Override public &lt;E&gt; Uni&lt;Integer&gt; deleteAll(Class&lt;E&gt; clazz) { Assert.notNull(clazz, \"class not not be null!\"); var criteriaBuilder = this.sessionFactory.getCriteriaBuilder(); CriteriaDelete&lt;E&gt; delete = criteriaBuilder.createCriteriaDelete(clazz); delete.from(clazz); return sessionFactory.withTransaction((session, tx) -&gt; session.createQuery(delete).executeUpdate()); } private &lt;E&gt; CriteriaQuery&lt;E&gt; buildQuery(Class&lt;E&gt; clazz) { return sessionFactory.getCriteriaBuilder().createQuery(clazz); }}ëŒ€ë§ì˜ ë¦¬í¬ì§€í† ë¦¬ ì½”ë“œì…ë‹ˆë‹¤. ë¬¸ì„œë¥¼ ë³´ë©° ë§Œë“¤ë‹¤ ë³´ë‹ˆ ëª¨ë“ˆí™” í• ìˆ˜ìˆëŠ” ë¶€ë¶„ì´ ë³´ì—¬ ëª¨ë“ˆí™”í•˜ì—¬ ì½”ë“œë¥¼ ì‘ì„±í•´ ë³´ì•˜ìŠµë‹ˆë‹¤. ê°„ë‹¨í•œ CRUD ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ë¦¬í¬ì§€í† ë¦¬ ì…ë‹ˆë‹¤.ì¤‘ê°„ì— deleteByIdì˜ ê²½ìš° ê¸°ë³¸í‚¤ê°€ í•˜ë‚˜ì¼ ê²½ìš°ë§Œì„ ìƒê°í•˜ê³  ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ë³µí•©í‚¤ëŠ” ê³ ë ¤ëŒ€ìƒì´ ì•„ë‹™ë‹ˆë‹¤.SessionFactoryë¥¼ ì˜ì¡´ì„±ìœ¼ë¡œ ì£¼ì…ë°›ì•„ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì•„ë˜ beanì„ ë“±ë¡í•´ ì¤ë‹ˆë‹¤.@Beanpublic KcReactiveRepository kcReactiveRepository() { return new KcReactiveRepositoryImpl( Persistence .createEntityManagerFactory(\"pu\") .unwrap(Mutiny.SessionFactory.class) );}ë§ˆì§€ë§‰ìœ¼ë¡œ, ìœ„ì—ì„œ ì‘ì„±í•œ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì‚¬ìš©í•´ ê°ê°ì˜ ë„ë©”ì¸ì—ì„œ CRUD ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” í´ë˜ìŠ¤ë“¤ì„ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤.@Repositorypublic class PostRepository { @Autowired KcReactiveRepository kcReactiveRepository; public Uni&lt;Post&gt; save(String title, String contents, Author author) { Post entity = Post.builder() .title(title) .contents(contents) .author(author) .build(); return kcReactiveRepository.save(entity); } public Uni&lt;List&lt;Post&gt;&gt; listAll() { return kcReactiveRepository.listAll(Post.class); } public Uni&lt;Post&gt; findById(Long id) { return kcReactiveRepository.findById(Post.class, id); } public Uni&lt;Integer&gt; deleteAll() { return kcReactiveRepository.deleteAll(Post.class); } public Uni&lt;Integer&gt; deleteById(Long id) { return kcReactiveRepository.deleteById(Post.class, id); }}@Repositorypublic class AuthorRepository { @Autowired KcReactiveRepository kcReactiveRepository; public Uni&lt;Author&gt; save(String name) { Author entity = Author.builder() .name(name) .build(); return kcReactiveRepository.save(entity); } public Uni&lt;List&lt;Author&gt;&gt; listAll() { return kcReactiveRepository.listAll(Author.class); } public Uni&lt;Author&gt; findById(Long id) { return kcReactiveRepository.findById(Author.class, id); } public Uni&lt;Integer&gt; deleteAll() { return kcReactiveRepository.deleteAll(Author.class); } public Uni&lt;Integer&gt; deleteById(Long id) { return kcReactiveRepository.deleteById(Author.class, id); }}3. í…ŒìŠ¤íŠ¸ì½”ë“œ ì‘ì„±ì´ ëª¨ë‘ ëë‚¬ìŠµë‹ˆë‹¤. ê¸°ëŠ¥ì´ ì˜ ë™ì‘í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•´ ë³´ê² ìŠµë‹ˆë‹¤.@Testvoid fullTest() { var simpleAuthor = authorRepository .save(\"í™ê¸¸ë™\") .await() .indefinitely(); IntStream.range(1, 11).forEach(idx -&gt; { var uni = postRepository.save(\"title\" + idx, \"contents\"+ idx, simpleAuthor); uni.await().indefinitely(); }); //////////////////////////////////////////////////////////////////////////////////////////////// var authorList = authorRepository.listAll().await().indefinitely(); var postList = postRepository.listAll().await().indefinitely(); Assert.isTrue(authorList.size() == 1, \"size of author list must be 1\"); Assert.isTrue(postList.size() == 10, \"size of post list must be 10\"); long authorId = authorList.stream().findFirst().get().getId(); long postId = postList.stream().findAny().get().getId(); var deleteNotExistAuthor = authorRepository.deleteById(authorId + 1).await().indefinitely(); var deleteExistPost = postRepository.deleteById(postId).await().indefinitely(); Assert.isTrue(deleteNotExistAuthor == 0, \"query result of delete empty author must be 0\"); Assert.isTrue(deleteExistPost == 1, \"query result of delete post must be 1\");} authorê³¼ postë¥¼ insert í•©ë‹ˆë‹¤. ëª¨ë“  author ê³¼ postë¥¼ ë¶ˆëŸ¬ì™€ ì˜ insert ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ì‚­ì œë¥¼ í†µí•´ ì¿¼ë¦¬ ìˆ˜í–‰ ê²°ê³¼ê°€ ì˜ ë„˜ì–´ì˜¤ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.ë§Œì•½ webflux ì—ì„œ Mono, Flux ê°ì²´ë¥¼ ë¦¬í„´í•´ì•¼ í•œë‹¤ë©´return ServerResponse.ok().body(postRepository.listAll().convert().with(toMono()));ìœ„ì™€ê°™ì´ mutiny-reactor íŒ¨í‚¤ì§€ì— ìˆëŠ” toMono() ë¥¼ ì‚¬ìš©í•˜ì—¬ Unië¥¼ Mono, Fluxë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜í•˜ë©´ ë˜ê² ìŠµë‹ˆë‹¤.ë§ˆë¬´ë¦¬ê¸°ì¡´ì˜ JPAë¥¼ ê·¸ë¦¬ì›Œ í•˜ë©´ì„œ Webflux - Spring Data R2DBC ë¥¼ ì‚¬ìš©í•˜ê³  ê³„ì…¨ë˜ ë¶„ë“¤ì—ê²ŒëŠ” í¬ì†Œì‹ì´ì§€ ì•Šì„ê¹Œ ì‹¶ìŠµë‹ˆë‹¤. ë˜í•œ ê¸°ì¡´ JPA ìŠ¤í™ê³¼ í¬ê²Œ ë‹¤ë¥´ì§€ ì•Šì€ ê²ƒìœ¼ë¡œ ë³´ì•„í•˜ë‹ˆ ê¸°ì¡´ì˜ JPAì™€ non-blocking ì½”ë“œì— ìµìˆ™í•˜ì‹  ë¶„ë“¤ì´ë¼ë©´ ì‰½ê²Œ ìµíìˆ˜ ìˆì„ ê²ƒì´ë¼ ìƒê°í•©ë‹ˆë‹¤.ì €ë„ â€˜WebfluxëŠ” ì“¸ë§Œí•œ orm ë¼ì´ë¸ŒëŸ¬ë¦¬ ë‚˜ì˜¤ë©´ ì œëŒ€ë¡œ íŒŒì•¼ì§€~â€™ ë¼ê³  ìƒê°í•˜ê³¤ í–ˆì—ˆëŠ”ë° ì´ì œ ì œëŒ€ë¡œ í•œë²ˆ ê³µë¶€í•´ë´ì•¼ ê² ìŠµë‹ˆë‹¤.ì°¸ì¡° https://hibernate.org/reactive/documentation/1.1/reference/html_single/ https://itnext.io/integrating-hibernate-reactive-with-spring-5427440607fe?gif=true" }, { "title": "Githubë¡œ ìë°” ë¼ì´ë¸ŒëŸ¬ë¦¬ ë°°í¬í•˜ê¸°", "url": "/posts/github-personal-repo/", "categories": "Java", "tags": "Java, Github, Maven", "date": "2022-01-22 20:12:00 +0900", "snippet": "ê°œìš”ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë‹¤ë³´ë©´ ìµœì´ˆ ì„¸íŒ…ì‹œ ê³µí†µëœ ì½”ë“œê°€ ì‚¬ìš©ë˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ë¥¼ ëª¨ë“ˆí™”í•˜ì—¬ ê°œì¸ nexusì— ë°°í¬í•˜ìë‹ˆ ì„œë²„ êµ¬ì¶•ì´ ì–´ë µê³ , Maven Centralì— ë°°í¬í•˜ìë‹ˆ ê±°ì³ì•¼í•˜ëŠ” ë‹¨ê³„ê°€ ë§ì•„ ì–´ë ¤ì›€ì„ ê²ªì—ˆì—ˆìŠµë‹ˆë‹¤.ì´ í¬ìŠ¤íŒ… ì—ì„œëŠ” Githubë¥¼ ì´ìš©í•´ ê°œì¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë°°í¬í•˜ëŠ” ëª‡ê°€ì§€ ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤. ë¼ì´ë¸ŒëŸ¬ë¦¬ ë°°í¬ì— ìˆì–´ì„œëŠ” Mavenì´ Gradle ë³´ë‹¤ ìš©ì´í•˜ë‹¤ê³  ìƒê°ë˜ì–´ ì•„ë˜ ë‚´ìš©ì€ ëª¨ë‘ Mavenì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. (ì €ë„ ê°œì¸ì ìœ¼ë¡œëŠ” Gradleì„ ì„ í˜¸í•©ë‹ˆë‹¤â€¦)ì•„ë˜ ì˜ˆì œëŠ” ì œê°€ ì“°ë ¤ê³  ë§Œë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¥¼ ë°°í¬í•˜ëŠ” ê³¼ì •ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.1. Github Repositoryë¥¼ Maven Repository ì²˜ëŸ¼ ì‚¬ìš©í•˜ê¸°ì²«ë²ˆì§¸ ë°©ë²•ì€ Github repositoryë¥¼ maven repositoryì²˜ëŸ¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.1.1. Local &amp; Github Repository ë§Œë“¤ê¸°1.1.1. githubì— public repository ìƒì„±í•˜ê¸°ë¹ˆ repositoryë¥¼ í•˜ë‚˜ ìƒì„±í•©ë‹ˆë‹¤. ì´ë¦„ì€ ì„ì˜ë¡œ ì§€ì •í•˜ì˜€ìŠµë‹ˆë‹¤.1.1.2. ë°©ê¸ˆ ìƒì„±í•œ repositoryì˜ ì´ë¦„ìœ¼ë¡œ í´ë” ìƒì„±í•˜ê¸°mkdir maven-test-repo1.1.3. í´ë”ë¥¼ git repositoryë¡œ ë§Œë“¤ê³  githubì—ì„œ ìƒì„±í•œ repositoryì™€ ì—°ê²°cd maven-test-repogit initgit remote add origin https://github.com/keencho/maven-test-repo.git1.1.4. releases, snapshots í´ë” ìƒì„±mkdir releases, snapshots1.2. Localì— ë‚´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë°°í¬í•˜ê¸° &amp; Github Repositoryì— ë°°í¬í•˜ê¸°1.2.1. ë°°í¬í•  ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ pom.xml ìˆ˜ì •í•˜ê¸° ... &lt;groupId&gt;com.keencho.lib&lt;/groupId&gt; &lt;artifactId&gt;keencho-p6spy&lt;/artifactId&gt; &lt;version&gt;1.0.1&lt;/version&gt; ... &lt;distributionManagement&gt; &lt;repository&gt; &lt;id&gt;release&lt;/id&gt; &lt;url&gt;https://github.com/keencho/maven-test-repo/raw/master/releases&lt;/url&gt; &lt;/repository&gt; &lt;snapshotRepository&gt; &lt;id&gt;snapshot&lt;/id&gt; &lt;url&gt;https://github.com/keencho/maven-test-repo/raw/master/snapshots&lt;/url&gt; &lt;/snapshotRepository&gt; &lt;/distributionManagement&gt;ì´ë•Œ groupId, artifactId, version íƒœê·¸ëŠ” ì¶”í›„ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ì˜ì¡´ì„± ì¶”ê°€í• ë•Œ ì“°ì„ì„ ì¸ì§€í•˜ê³  ì´ë¦„ì„ ì •í•´ì£¼ì„¸ìš”.1.2.2. altDeploymentRepository ëª…ë ¹ì–´ë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œì»¬ì— ë°°í¬í•˜ê¸°altDeploymentRepository ëª…ë ¹ì–´ë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œì»¬ì— ë°°í¬í•©ë‹ˆë‹¤.mvn -D altDeploymentRepository=snapshot::default::file:../maven-test-repo/snapshots clean deployíŒŒì¼ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. â””â”€â”€ D: â””â”€â”€ workspace â”œâ”€â”€ maven-test-repo â”‚ â”œâ”€â”€ releases â”‚ â””â”€â”€ snapshots (ë°°í¬ë  ë””ë ‰í† ë¦¬) â””â”€â”€ keencho-lib-custom-p6spy (ë°°í¬í•  ë¼ì´ë¸ŒëŸ¬ë¦¬)1.2.3. ë°°í¬ í™•ì¸í›„ github ì— push í•˜ê¸°local í´ë”ì— ì •ìƒì ìœ¼ë¡œ ë°°í¬ë˜ì—ˆë‹¤ë©´ commit - pushë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.1.3. ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•  ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ì˜ì¡´ì„± ì¶”ê°€1.3.1. ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•  ì–´í”Œë¦¬ì¼€ì´ì…˜ì— repository ì—°ê²°ì •ë³´ë¥¼ ì¶”ê°€&lt;distributionManagement&gt; &lt;repository&gt; &lt;id&gt;release&lt;/id&gt; &lt;url&gt;https://github.com/keencho/maven-test-repo/raw/master/releases&lt;/url&gt; &lt;/repository&gt; &lt;snapshotRepository&gt; &lt;id&gt;snapshot&lt;/id&gt; &lt;url&gt;https://github.com/keencho/maven-test-repo/raw/master/snapshots&lt;/url&gt; &lt;/snapshotRepository&gt;&lt;/distributionManagement&gt;1.3.2. ì˜ì¡´ì„± ì¶”ê°€&lt;dependency&gt; &lt;groupId&gt;com.keencho.lib&lt;/groupId&gt; &lt;artifactId&gt;keencho-p6spy&lt;/artifactId&gt; &lt;version&gt;1.0.1&lt;/version&gt;&lt;/dependency&gt;ìœ„ì—ì„œ ì •ì˜í•œ groupId, artifactId, version ì„ ë™ì¼í•˜ê²Œ ì…ë ¥í•©ë‹ˆë‹¤.1.3.3. í™•ì¸í•˜ê¸°ëª…ë ¹ì–´ë¡œ maven install í›„ ë‚´ê°€ ë§Œë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¶”ê°€ë˜ì–´ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.mvn install2. Github Packages ì‚¬ìš©í•˜ê¸°ë‘ë²ˆì§¸ ë°©ë²•ì€ Github Packages ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. ì£¼ì˜! ì´ ë°©ë²•ì€ GITHUB_TOKEN ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. ë°°í¬í• ë•Œ ë¿ë§Œ ì•„ë‹ˆë¼ ì˜ì¡´ì„±ì„ ì¶”ê°€í• ë•Œë„ í† í°ì´ í•„ìš”í•©ë‹ˆë‹¤.ì´ì—ëŒ€í•´ github ê°œë°œìë“¤ë„ ì¸ì§€í•˜ê³  ìˆê³  21ë…„ ë§ê¹Œì§€ public accessë¥¼ í—ˆìš©í•˜ê² ë‹¤ê³  í•˜ì˜€ìœ¼ë‚˜ 22ë…„ ì´ˆ í˜„ì¬ê¹Œì§€ ì†Œì‹ì´ ì—†ìŠµë‹ˆë‹¤.2.1. Github Packages ì— ì¸ì¦í•˜ê¸°2.1.1. Personal Access Token ë°œê¸‰ë°›ê¸°ì²«ë²ˆì§¸ë¡œ github tokenì„ ë°œê¸‰ ë°›ì•„ì•¼ í•©ë‹ˆë‹¤. í† í° í† í° ë°œê¸‰ ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.github -&gt; ìš°ì¸¡ ìƒë‹¨ í”„ë¡œí•„ -&gt; Settings -&gt; ì¢Œì¸¡ ì‚¬ì´ë“œë°” ìµœí•˜ë‹¨ Developer settings -&gt; ì¢Œì¸¡ ì‚¬ì´ë“œë°” Personal access tokens -&gt; Generate new tokenì„ì˜ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ê³  ë§Œë£Œì¼ì„ ì„ íƒí•œí›„, ìŠ¤ì½”í”„ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ì›ë˜ëŒ€ë¡œë¼ë©´ ì—„ê²©í•˜ê²Œ ì§€ì •í•´ì•¼ í•˜ì§€ë§Œ í…ŒìŠ¤íŠ¸í›„ ë°”ë¡œ ì‚­ì œí•  ê²ƒì´ë¯€ë¡œ ëª¨ë“  ìŠ¤ì½”í”„ì— ì²´í¬í•œí›„ í† í°ì„ ìƒì„±í•©ë‹ˆë‹¤.2.1.2. ë°œê¸‰ë°›ì€ í† í°ìœ¼ë¡œ settings.xml ì„¸íŒ…í•˜ê¸°ë°œê¸‰ë°›ì€ í† í°ì„ ê¸°ë°˜ìœ¼ë¡œ settings.xml íŒŒì¼ì„ ì„¸íŒ…í•˜ë©´ GitHub Packages with Apache Mavenì— ì¸ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;settings xmlns=\"http://maven.apache.org/SETTINGS/1.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd\"&gt; &lt;activeProfiles&gt; &lt;activeProfile&gt;github&lt;/activeProfile&gt; &lt;/activeProfiles&gt; &lt;profiles&gt; &lt;profile&gt; &lt;id&gt;github&lt;/id&gt; &lt;repositories&gt; &lt;repository&gt; &lt;id&gt;central&lt;/id&gt; &lt;url&gt;https://repo1.maven.org/maven2&lt;/url&gt; &lt;/repository&gt; &lt;repository&gt; &lt;id&gt;github&lt;/id&gt; &lt;url&gt;https://maven.pkg.github.com/keencho/lib-custom-p6spy&lt;/url&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;/repositories&gt; &lt;/profile&gt; &lt;/profiles&gt; &lt;servers&gt; &lt;server&gt; &lt;id&gt;github&lt;/id&gt; &lt;username&gt;keencho&lt;/username&gt; &lt;password&gt;{TOKEN}&lt;/password&gt; &lt;/server&gt; &lt;/servers&gt;&lt;/settings&gt;2.2. ë¼ì´ë¸ŒëŸ¬ë¦¬ ë°°í¬í•˜ê¸°ê¸°ë³¸ì ìœ¼ë¡œ GithubëŠ” íŒ¨í‚¤ì§€ì™€ ë™ì¼í•œ ì´ë¦„ì˜ ê¸°ì¡´ ë ˆí¬ì§€í† ë¦¬ì— íŒ¨í‚¤ì§€ë¥¼ ë°°í¬í•©ë‹ˆë‹¤. ì˜ˆë¥¼ë“¤ì–´ com.example:test íŒ¨í‚¤ì§€ëŠ” OWNER/test ë¼ëŠ” ë¦¬í¬ì§€í† ë¦¬ì— ë°°í¬ë  ê²ƒì…ë‹ˆë‹¤.2.2.1. pom.xml ìˆ˜ì •í•˜ê¸°ë°°í¬í•  ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ pom.xmlì„ ìˆ˜ì •í•©ë‹ˆë‹¤. OWNER ì€ ì‚¬ìš©ì ê³„ì •ì˜ ì´ë¦„ì´ë©° REPOSITORYëŠ” ë°°í¬í•  ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ íŒ¨í‚¤ì§€ëª… ì…ë‹ˆë‹¤. (ì—¬ê¸°ì„œëŠ” artifactId)&lt;distributionManagement&gt; &lt;repository&gt; &lt;id&gt;github&lt;/id&gt; &lt;name&gt;keencho&lt;/name&gt; &lt;url&gt;https://maven.pkg.github.com/keencho/lib-custom-p6spy&lt;/url&gt; &lt;/repository&gt;&lt;/distributionManagement&gt;2.2.2. ë°°í¬í•˜ê¸°mvn deployìœ„ ëª…ë ¹ì–´ë¡œ ë°°í¬í•©ë‹ˆë‹¤.ìœ„ ìº¡ì³í™”ë©´ê³¼ ê°™ì´ github maven ì €ì¥ì†Œì— ì—…ë¡œë“œ ë˜ì—ˆë‹¤ëŠ” ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.2.2.3. Githubì—ì„œ í™•ì¸í•˜ê¸°Github UI í™”ë©´ì—ì„œë„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¦¬í¬ì§€í† ë¦¬ì˜ ìš°ì¸¡ ì‚¬ì´ë“œë°”ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.2.3. ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜í•˜ê¸°Github Packages ì— ì¸ì¦ë˜ì–´ ìˆì–´ì•¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì—¬ê¸°ê¹Œì§€ ì§„í–‰í•˜ì…¨ë‹¤ë©´ ë‹¹ì—°íˆ ì¸ì¦ë˜ì–´ ìˆê² ì§€ë§Œ í˜¹ì‹œ ì¸ì¦ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ 2.1. í•­ëª©ì˜ ê³¼ì •ë“¤ì´ ì„ í–‰ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.2.3.1. ì˜ì¡´ì„± ì¶”ê°€ í›„ ì„¤ì¹˜í•˜ê¸°ë°©ê¸ˆ ë°°í¬í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì˜ì¡´ì„±ì„ ì¶”ê°€í•©ë‹ˆë‹¤.&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.keencho.lib&lt;/groupId&gt; &lt;artifactId&gt;keencho-p6spy&lt;/artifactId&gt; &lt;version&gt;1.0.1&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt;ì˜ì¡´ì„±ì„ ì¶”ê°€í•˜ì˜€ë‹¤ë©´ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì„¤ì¹˜í•©ë‹ˆë‹¤.mvn installì„¤ì¹˜ê°€ ì™„ë£Œë˜ì—ˆë‹¤ë©´ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.3. Jitpackìœ¼ë¡œ ë°°í¬í•˜ê¸°ë§ˆì§€ë§‰ ì„¸ë²ˆì§¸ ë°©ë²•ì€ Jitpackì„ í™œìš©í•´ ë°°í¬í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. Jitpackì„ ì‚¬ìš©í•˜ë©´ ë³„ë„ ì„¤ì • ì—†ì´ (ë¬¼ë¡  Jitpack ì— ë¹Œë“œë˜ì–´ ë°°í¬ëŠ” ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.) Github ì €ì¥ì†Œì˜ ì£¼ì†Œë¥¼ ì›ê²© ì €ì¥ì†Œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.3.1. Jitpack ì‚´í´ë³´ê¸°3.1.1. ë¡œê·¸ì¸í•˜ê¸°Jitpackì— ì ‘ì†í•´ ìš°ì¸¡ ìƒë‹¨ ë²„íŠ¼ì„ í´ë¦­í•´ Githubë¡œ ë¡œê·¸ì¸í•©ë‹ˆë‹¤.3.1.2. ë¦¬í¬ì§€í† ë¦¬ë“¤ í™•ì¸í•˜ê¸°ì¢Œì¸¡ ì‚¬ì´ë“œë°”ì— ë‚´ ë¦¬í¬ì§€í† ë¦¬ë“¤ì´ ì˜ ë³´ì´ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.3.2. Github Release3.2.1 JDK ì„¸íŒ…jitpackì€ ë¹Œë“œì‹œ jdk8ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ë§Œì•½ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ íƒ€ê²Ÿ jdkê°€ 11ì´ë¼ë©´ ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œëŠ” ë¹Œë“œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.ì›í•˜ëŠ” jdkë¡œ ë¹Œë“œ ë˜ë„ë¡ í•˜ê¸° ìœ„í•´ jitpack.yml íŒŒì¼ì„ í”„ë¡œì íŠ¸ ë£¨íŠ¸í´ë”ì— ìƒì„±í•˜ê³  ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•  jdkë¥¼ ëª…ì‹œí•©ë‹ˆë‹¤.jdk: openjdk113.2.2. code pushë¦´ë¦¬ì¦ˆë¥¼ ìƒì„±í•˜ê¸° ì „ì—, ì‘ì—… ê²°ê³¼ë¬¼ì„ commit &amp; push í•©ë‹ˆë‹¤.3.2.3. releaseGithub release ê¸°ëŠ¥ì„ ì´ìš©í•˜ì—¬ ë¦´ë¦¬ì¦ˆë¥¼ ìƒì„± í•©ë‹ˆë‹¤.ìœ„ ìº¡ì³í™”ë©´ì˜ í”Œë¡œìš°ë¡œ ë¦´ë¦¬ì¦ˆ ìƒì„± í˜ì´ì§€ì— ë“¤ì–´ì™€ tagë¥¼ ì§€ì •í•˜ê³  publish relase ë²„íŠ¼ì„ ëˆŒëŸ¬ ë°°í¬í•©ë‹ˆë‹¤.ì—¬ê¸°ì„œ tagëŠ” ì¶”í›„ mavenì˜ versionì´ ë˜ê¸° ë•Œë¬¸ì— í•„ìˆ˜ì´ë©° titleê³¼ describeëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì´ ì•„ë‹™ë‹ˆë‹¤.3.2.4. release í™•ì¸ë¦´ë¦¬ì¦ˆê°€ ì™„ë£Œë˜ì—ˆìŒì„ í™•ì¸í•©ë‹ˆë‹¤.3.3. Jitpack ë°°í¬3.3.1. Look upJitpack ë°°í¬ë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ì²«ë²ˆì§¸ ë‹¨ê³„ë¡œ Look up ì„ ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤. Jitpackì— ì ‘ì†í›„ Owner/Repository ì˜ ì–‘ì‹ìœ¼ë¡œ ì¸í’‹ ë°•ìŠ¤ì— ì…ë ¥í›„ Look up ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.ê·¸ëŸ¼ ìœ„ì™€ê°™ì€ í™”ë©´ì´ ë³´ì´ì‹¤ í…ë°ìš”, ì €ëŠ” ì´ë¯¸ ë°°í¬ê°€ ì™„ë£Œëœ ìƒíƒœë¼ Get it ë²„íŠ¼ì´ ì´ˆë¡ìƒ‰ì´ì§€ë§Œ ì•„ì§ ë°°í¬ë˜ì§€ ì•Šì€ ê²½ìš° ë²„íŠ¼ì˜ ìƒ‰ìƒì´ í•˜ì–€ìƒ‰ìœ¼ë¡œ ë³´ì´ê²Œ ë©ë‹ˆë‹¤.í•˜ì–€ìƒ‰ Get it ë²„íŠ¼ì„ ëˆŒëŸ¬ ë°°í¬ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.3.3.2 Jitpack ë°°í¬ í™•ì¸Log ë²„íŠ¼ì„ ëˆŒëŸ¬ ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. í”„ë¡œì„¸ìŠ¤ê°€ ëë‚˜ì§€ ì•Šì€ ê²½ìš° íŒŒì¼ì´ ì—´ë¦¬ì§€ ì•Šìœ¼ë‹ˆ íŒŒì¼ì´ ì—´ë¦¬ì§€ ì•ŠëŠ” ê²½ìš° ì¡°ê¸ˆ ê¸°ë‹¤ë ¤ ë³´ì„¸ìš”.íŒŒì¼ì´ ì—´ë ¸ë‹¤ë©´ ìŠ¤í¬ë¡¤ì„ ìµœí•˜ë‹¨ìœ¼ë¡œ ë‚´ë ¤ ì•„ë˜ì™€ ê°™ì´ BUILD SUCCESS ë¡œê·¸ê°€ ì°í˜€ìˆëŠ”ì§€ í™•ì¸í•´ ë³´ì„¸ìš”.[INFO] ------------------------------------------------------------------------[INFO] BUILD SUCCESS[INFO] ------------------------------------------------------------------------[INFO] Total time: 6.712 s[INFO] Finished at: 2022-02-08T04:59:37Z[INFO] ------------------------------------------------------------------------Picked up JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8 -Dhttps.protocols=TLSv1.2Found module: com.keencho.lib:keencho-p6spy:1.0.2Build tool exit code: 0Looking for artifacts...Picked up JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8 -Dhttps.protocols=TLSv1.2Picked up JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8 -Dhttps.protocols=TLSv1.2Looking for pom.xml in build directory and ~/.m2Found artifact: com.keencho.lib:keencho-p6spy:1.0.2Exit code: 0âœ… Build artifacts:com.github.keencho:lib-custom-p6spy:1.0.2Files:com/github/keencho/lib-custom-p6spy/1.0.2com/github/keencho/lib-custom-p6spy/1.0.2/build.logcom/github/keencho/lib-custom-p6spy/1.0.2/lib-custom-p6spy-1.0.2-sources.jarcom/github/keencho/lib-custom-p6spy/1.0.2/lib-custom-p6spy-1.0.2.jarcom/github/keencho/lib-custom-p6spy/1.0.2/lib-custom-p6spy-1.0.2.jar.md5com/github/keencho/lib-custom-p6spy/1.0.2/lib-custom-p6spy-1.0.2.jar.sha1com/github/keencho/lib-custom-p6spy/1.0.2/lib-custom-p6spy-1.0.2.pomcom/github/keencho/lib-custom-p6spy/1.0.2/lib-custom-p6spy-1.0.2.pom.md5com/github/keencho/lib-custom-p6spy/1.0.2/lib-custom-p6spy-1.0.2.pom.sha13.4. ìµœì¢… í™•ì¸3.4.1. ì˜ì¡´ì„± ì¶”ê°€ í›„ ì„¤ì¹˜í•˜ê¸°Jitpackì— ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆë‹¤ë©´ ì´ì œ ì˜ì¡´ì„± ì¶”ê°€ í›„ ì‚¬ìš©í•˜ëŠ” ì¼ë§Œ ë‚¨ì•˜ìŠµë‹ˆë‹¤.pom.xmlì— ì•„ë˜ì™€ ê°™ì´ íƒœê·¸ë¥¼ ì¶”ê°€í•´ ì£¼ì„¸ìš”. jitpack.ioë¥¼ ë¦¬í¬ì§€í† ë¦¬ë¡œ ì‚¬ìš©í•˜ê² ë‹¤ëŠ” íƒœê·¸ë„ ì¶”ê°€í•´ ì¤˜ì•¼ í•©ë‹ˆë‹¤.&lt;repositories&gt; &lt;repository&gt; &lt;id&gt;jitpack.io&lt;/id&gt; &lt;url&gt;https://jitpack.io&lt;/url&gt; &lt;/repository&gt;&lt;/repositories&gt;...&lt;dependency&gt; &lt;groupId&gt;com.github.OWNER&lt;/groupId&gt; &lt;artifactId&gt;REPOSITORY&lt;/artifactId&gt; &lt;version&gt;TAG&lt;/version&gt;&lt;/dependency&gt;ì´ë•Œ OWNERì€ github ê³„ì • ì´ë¦„, REPOSITORYëŠ” ë¦¬í¬ì§€í† ë¦¬ëª…, TAGëŠ” github relase ìƒì„±ì‹œ ì…ë ¥í•œ tag ì…ë‹ˆë‹¤. ì €ì˜ ê²½ìš°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.&lt;dependency&gt; &lt;groupId&gt;com.github.keencho&lt;/groupId&gt; &lt;artifactId&gt;lib-custom-p6spy&lt;/artifactId&gt; &lt;version&gt;1.0.2&lt;/version&gt;&lt;/dependency&gt;ì„¸íŒ…ì´ ëª¨ë‘ ì™„ë£Œë˜ì—ˆë‹¤ë©´ mvn install ëª…ë ¹ì–´ë¥¼ í†µí•´ ì„¤ì¹˜í›„ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¶”ê°€ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ ë³´ì„¸ìš”.mvn installì°¸ì¡° https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-apache-maven-registry https://jitpack.io/docs/BUILDING/" }, { "title": "ë¦¬ì•¡íŠ¸ì—ì„œ ì•„ì„í¬íŠ¸ ì»¨íŠ¸ë¡¤í•˜ê¸°", "url": "/posts/react-iamport-component/", "categories": "React", "tags": "React", "date": "2022-01-08 20:12:00 +0900", "snippet": "ê°œìš”ì œê°€ ìš´ì˜ì¤‘ì¸ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì•„ì„í¬íŠ¸ë¥¼ ê²°ì œ ëª¨ë“ˆë¡œ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. í˜„ì¬ í™ˆí˜ì´ì§€ ë‚´ë¶€ì—ì„œ ê²°ì œí•  ìˆ˜ ìˆëŠ” í˜ì´ì§€ëŠ” 1ê°œê°€ ì•„ë‹™ë‹ˆë‹¤. ë”°ë¼ì„œ ê°ê°ì˜ ì»¨í…Œì´ë„ˆ í˜¹ì€ ì»´í¬ë„ŒíŠ¸ì—ì„œ ê·¸ë•Œê·¸ë•Œ ì•„ì„í¬íŠ¸ ëª¨ë“ˆì„ í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤.ì•„ì„í¬íŠ¸ë¥¼ ì‰½ê²Œ ì»¨íŠ¸ë¡¤í•˜ê³  ì½”ë“œ ì¬ì‚¬ìš©ì„±ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ recoilì„ ì´ìš©í•˜ì—¬ ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.recoilí˜„ì¬ í”„ë¡œì íŠ¸ì— recoil íŒ¨í‚¤ì§€ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤ëŠ” ê°€ì •í•˜ì— ì§„í–‰ë©ë‹ˆë‹¤. í˜¹ì‹œ recoilì— ëŒ€í•´ì„œ ì•Œì§€ ëª»í•˜ê±°ë‚˜ ì„¤ì¹˜ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´ ì—¬ê¸° ë¥¼ ì°¸ê³ í•˜ì—¬ recoilì„ ì„¤ì¹˜í•´ë³´ì„¸ìš”.ì½”ë“œ ì‘ì„±í•˜ê¸°IamportDataAtomì²«ë²ˆì§¸ë¡œ ì•„ì„í¬íŠ¸ì—ì„œ ì‚¬ìš©í•  Atom (ìƒíƒœì˜ ë‹¨ìœ„) ì„ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.IamportModel.tsexport default interface IamportModel { fire: boolean, data: any, method: string, callBack: any customData: any, amount: number, mobileRedirectUrl?: string notNeedBuyerInfo?: boolean}iamport.atom.tsimport {atom} from 'recoil';import IamportModel from 'models/iamport.model';const IamportDataAtom = atom&lt;IamportModel&gt;({ key: 'iamportData', default: { fire: false, data: undefined, callBack: undefined, method: 'card', customData: {}, amount: 10000, mobileRedirectUrl: undefined }});export default IamportDataAtom;ê²°ì œì— ì‚¬ìš©ë  ì •ë³´ë“¤ì„ ë‹´ì„ ì¸í„°í˜ì´ìŠ¤ì™€ ê·¸ ì¸í„°í˜ì´ìŠ¤ë¥¼ í™œìš©í•œ atom ê°ì²´ ì…ë‹ˆë‹¤. ê²°ì œëŠ” pc, mobileë¡œ ë‚˜ë‰˜ê³  ê²°ì œì ì •ë³´ê°€ í•„ìš”ì—†ëŠ” ê²½ìš°ë„ ìˆê¸° ë•Œë¬¸ì— mobileRedirectUrl ë³€ìˆ˜ì™€ notNeedBuyerInfo ë³€ìˆ˜ëŠ” ì˜µì…”ë„ë¡œ ë‘ì—ˆìŠµë‹ˆë‹¤.Iamportì•„ì„í¬íŠ¸ Elementë¥¼ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤. ì´ ElementëŠ” ìµœìƒìœ„ index.tsxì— í¬í•¨ë©ë‹ˆë‹¤.ReactDOM.render( &lt;React.StrictMode&gt; &lt;RecoilRoot&gt; &lt;App /&gt; &lt;Iamport /&gt; &lt;/RecoilRoot&gt; &lt;/React.StrictMode&gt;, document.getElementById('root'));const Iamport = (): JSX.Element =&gt; { const iamportData = useRecoilValue(IamportDataAtom); const setIamportData = useSetRecoilState(IamportDataAtom); const defaultBuyerTel = '01011112222' const defaultBuyerName = 'í™ê¸¸ë™' const defaultBuyerEmail = 'korea@korea.co.kr' const fire = async() =&gt; { setIamportData({ ...iamportData, fire: false } as IamportModel) const { IMP }: any = window; const impCode = 'xxx'; IMP.init(impCode); let data: any = { pg : 'html5_inicis', pay_method : iamportData.method.toLowerCase(), merchant_uid : 'service_' + new Date().getTime(), amount : iamportData.amount, custom_data : iamportData.customData, name : 'ê²°ì œ í…ŒìŠ¤íŠ¸', buyer_tel : '010xxxxxxxx', buyer_email : 'buyer@korea.com', buyer_name : 'ê¹€ì² ìˆ˜', } if (iamportData.mobileRedirectUrl !== undefined &amp;&amp; iamportData.mobileRedirectUrl.length !== 0) { data['m_redirect_url'] = iamportData.mobileRedirectUrl; } if (iamportData.notNeedBuyerInfo === true) { data['buyer_tel'] = defaultBuyerTel; data['buyer_email'] = ''; data['buyer_name'] = defaultBuyerName; } IMP.request_pay(data, iamportData.callBack); } useEffect(() =&gt; { const jquery = document.createElement('script'); jquery.src = 'https://code.jquery.com/jquery-1.12.4.min.js'; const iamport = document.createElement('script'); iamport.src = 'https://cdn.iamport.kr/js/iamport.payment-1.1.7.js'; document.head.appendChild(jquery); document.head.appendChild(iamport); return () =&gt; { document.head.removeChild(jquery); document.head.removeChild(iamport); } }, []) useEffect(() =&gt; { if (iamportData.fire === true) { fire(); } }, [iamportData]) return ( &lt;&gt;&lt;/&gt; )}export default Iamport ì•„ì„í¬íŠ¸ëŠ” jqueryë¥¼ í•„ìš”ë¡œ í•˜ê¸° ë•Œë¬¸ì— ë§ˆìš´íŒ…ì‹œ ì½”ë“œë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ì—¬ jqueryë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ì¶”ê°€í•©ë‹ˆë‹¤. ë°˜ëŒ€ë¡œ ì–¸ë§ˆìš´íŠ¸ì‹œì—ëŠ” ì œê±°í•©ë‹ˆë‹¤. useEffectë¥¼ í†µí•´ IamportDataAtom ìƒíƒœë¥¼ êµ¬ë…í•©ë‹ˆë‹¤. ë§Œì•½ fireì´ trueê°€ ë˜ë©´, fire() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ì•„ì„í¬íŠ¸ ê²°ì œ ëª¨ë“ˆì„ í˜¸ì¶œí•©ë‹ˆë‹¤. ë¯¸ë¦¬ ì •ì˜ëœ IamportDataAtom ê°’ì„ ë°”íƒ•ìœ¼ë¡œ ì•„ì„í¬íŠ¸ ê²°ì œ ëª¨ë“ˆì„ í˜¸ì¶œí•©ë‹ˆë‹¤.Business Logicì´ì œ ìœ„ì— ë§Œë“¤ì–´ë‘” IamportDataAtom ì— ë°ì´í„°ë¥¼ ì…ë ¥í•˜ê³  fireì„ trueë¡œ í•˜ì—¬ useSetRecoilStateë¥¼ í†µí•´ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê¸°ë§Œ í•´ì£¼ë©´ ëì…ë‹ˆë‹¤....const setIamportData = useSetRecoilState(IamportDataAtom);...const callIamport = async (params: object, method: string) =&gt; { const res: any = await OrderService.encryptAndBuildData(params); const iamportData: IamportModel = { fire: true, data: null, customData: res.data, method: method, amount: 10000, notNeedBuyerInfo: true or false callBack: async (data: any) =&gt; { if (data.success === false) { alert('ê²°ì œ ì‹¤íŒ¨'); return; } await orderPay(data.imp_uid, data.merchant_uid) } } if (isMobile) { iamportData.mobileRedirectUrl = window.location.href; } setIamportData(iamportData)}const orderPay = async(impUid: string, merchantUid: string) =&gt; { // ë°ì´í„°ë¥¼ í™œìš©í•œ ê²°ì œì²˜ë¦¬}ëª¨ë°”ì¼ì›¹ í˜¹ì€ ì•±ì—ì„œì˜ ê²°ì œëŠ” PCì™€ ë‹¬ë¦¬ ì•± ìŠ¤í‚´ì„ í†µí•´ ì‚¬ìš©ìê°€ ê²°ì œí•  ì•±ì„ ì§ì ‘ í˜¸ì¶œí•˜ì—¬ ê²°ì œí•˜ëŠ” ë°©ì‹ì´ê¸° ë•Œë¬¸ì— ì•„ì„í¬íŠ¸ëŠ” ê²°ì œê°€ ì™„ë£Œë˜ë©´ mobileRedirectUrl ì— ë¯¸ë¦¬ ì •í•´ë‘” urlì— imp_success, imp_uidë“± ê²°ì œ ì •ë³´ë¥¼ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì— ë‹´ì•„ í˜¸ì¶œí•˜ê²Œ ë©ë‹ˆë‹¤.ë”°ë¼ì„œ ìµœì´ˆ ë§ˆìš´íŠ¸ì‹œ í˜„ì¬ urlì˜ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì„ ì²´í¬í•˜ëŠ” í•¨ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.const checkMobileCallback = async() =&gt; { const getParamByName: string | undefined = (name: string) =&gt; { const params: { [p: string]: string } = Object.fromEntries(new URLSearchParams(window.location.search).entries()); return params[name]; } const impSuccess = getParamByName('imp_success'); const errorMsg = getParamByName('error_msg'); const impUid = getParamByName('imp_uid'); const merchantUid = getParamByName('merchant_uid'); if (StringUtils.hasText(impSuccess) === false || StringUtils.hasText(impUid) === false || StringUtils.hasText(merchantUid) === false) { return; } await orderPay(data.imp_uid, data.merchant_uid)}...useEffect(() =&gt; { if (isMobile) { checkMobileCallback(); }})ëª¨ë°”ì¼ ì „ìš© ì½œë°± í˜ì´ì§€ë¥¼ ë”°ë¡œ ë§Œë“¤ì–´ ëª¨ë°”ì¼ì—ì„œ í–‰í•´ì§€ëŠ” ëª¨ë“  ê²°ì œëŠ” ê·¸ê³³ì—ì„œ ì²˜ë¦¬í•  ìˆ˜ë„ ìˆì§€ë§Œ ê°ê¸° ë‹¤ë¥¸ ê²°ì œ ìƒí™©ì—ì„œ ì½œë°± í•¨ìˆ˜ì˜ ë‚´ìš©ì€ ë‹¤ë¥¼ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ëª¨ë°”ì¼ì˜ ê²½ìš° ìœ„ì™€ê°™ì´ ì²˜ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤." }, { "title": "Java 17", "url": "/posts/java-17/", "categories": "Java", "tags": "Java", "date": "2021-12-18 20:12:00 +0900", "snippet": "Java 172021ë…„ 9ì›” 14ì¼ Java LTS ì¸ JDK 17 GAê°€ ë¦´ë¦¬ì¦ˆ ë˜ì—ˆìŠµë‹ˆë‹¤. JDK 17ì€ ìµœëŒ€ 2029ë…„ 9ì›”ê¹Œì§€ ì—…ë°ì´íŠ¸ê°€ ì œê³µë  ì˜ˆì •ì¸ë°ìš”, 2018ë…„ 9ì›”ì— JDK 11ì´ ë¦´ë¦¬ì¦ˆëœ ì´í›„ 3ë…„ë§Œì— ì¶œì‹œëœ LTS ë²„ì „ì˜ JDK ì…ë‹ˆë‹¤.ì½”ë“œì˜ ë³€í™”ë¿ë§Œ ì•„ë‹ˆë¼ LTS ì¶œì‹œ ì£¼ê¸°ê°€ 3ë…„ì—ì„œ 2ë…„ìœ¼ë¡œ ë³€ê²½ë˜ëŠ” ë“± ë§ì€ ë³€í™”ê°€ ìˆì—ˆëŠ”ë°ìš”, ì´ ê¸€ì—ì„œëŠ” Java 17ì˜ ìƒˆë¡œìš´ ê¸°ëŠ¥ë“¤ì— ëŒ€í•´ ì •ë¦¬í•´ ë³´ê² ìŠµë‹ˆë‹¤.JEP List1. Restore Always-Strict Floating-Point Semantics (JEP 306)ì´ê²ƒì€ ê³¼í•™ì ì¸ ëª©ì ìœ¼ë¡œ ìˆ˜ì¹˜ì— ë¯¼ê°í•œ í”„ë¡œê·¸ë¨ì„ ìœ„í•œ JEP ì…ë‹ˆë‹¤. ì´ëŠ” ë‹¤ì‹œ ê¸°ë³¸ ë¶€ë™ ì†Œìˆ˜ì  ì—°ì‚°ì„ strict ë˜ëŠ” strictfpë¡œ ì„¤ì •í•˜ì—¬ ëª¨ë“  í”Œë«í¼ì—ì„œ ë¶€ë™ ì†Œìˆ˜ì  ê³„ì‚°ì„ í•  ê²½ìš° ë™ì¼í•œ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. (ì¼ê´€ì„± ë³´ì¥) Java 1.2 ì´ì „ì—ëŠ” ëª¨ë“  ë¶€ë™ì†Œìˆ˜ì  ê³„ì‚°ì´ strictí•˜ì—¬ x87 ê¸°ë°˜ í•˜ë“œì›¨ì–´ì— ê³¼ì—´ì„ ì¼ìœ¼ì¼°ìŠµë‹ˆë‹¤. Java 1.2 ì´í›„ì—ëŠ” ê³¼ì—´ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ë¶€ë™ ì†Œìˆ˜ì  ê³„ì‚°ì„ ìœ„í•´ strictfp í‚¤ì›Œë“œë¥¼ í•„ìš”ë¡œ í•©ë‹ˆë‹¤. ì˜¤ëŠ˜ë‚ ì—ëŠ” Intelê³¼ AMD ëª¨ë‘ ê³¼ì—´ ì—†ì´ ì—„ê²©í•œ ë¶€ë™ì†Œìˆ˜ì  ì—°ì‚°ì„ ì§€ì›í•  ìˆ˜ ìˆëŠ” SIMD Extensions 2 (Streaming SIMD Extensions 2) í™•ì¥ì„ ì§€ì›í•˜ë¯€ë¡œ, x87 ê¸°ë°˜ í•˜ë“œì›¨ì–´ì—ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ Java 17ì—ì„œëŠ” Java 1.2 ì´ì „ ë²„ì „ì˜ strict í•œ ë¶€ë™ì†Œìˆ˜ì  ì—°ì‚° ë°©ì‹ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›í•©ë‹ˆë‹¤. ì´ëŠ” strictfp í‚¤ì›Œë“œëŠ” ì„ íƒì‚¬í•­ì„ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.2. Enhanced Pseudo-Random Number Generators (JEP 356)ìœ ì‚¬ë‚œìˆ˜ ì•Œê³ ë¦¬ì¦˜ì„ êµ¬í˜„í•˜ê±°ë‚˜ ì‚¬ìš©í•˜ê¸° ì‰½ê²Œ í•˜ê¸° ìœ„í•´ RandomGenerator ë¼ ë¶ˆë¦¬ëŠ” ìƒˆë¡œìš´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.ì´ë¡œ ì¸í•´ ì„œë¡œ ë‹¤ë¥¸ ì•Œê³ ë¦¬ì¦˜ì„ ììœ ë¡­ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ìŠ¤íŠ¸ë¦¼ ê¸°ë°˜ í”„ë¡œê·¸ë˜ë°ì„ ë³´ë‹¤ íš¨ìœ¨ì ìœ¼ë¡œ ì§€ì›í•©ë‹ˆë‹¤.package java.util.random;public final class RandomGeneratorFactory&lt;T extends RandomGenerator&gt; { // ... }RandomGeneratorì„ êµ¬í˜„í•œ ëª¨ë“  ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ì—¬ 1 ~ 100 ì‚¬ì´ì˜ ì •ìˆ˜ë“¤ì˜ ì§‘í•©ì—ì„œ ëœë¤í•œ 5ê°œì˜ ìˆ«ìë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì½”ë“œì…ë‹ˆë‹¤.public class Main { public static void main(String[] args) { var randomGeneratorList = RandomGeneratorFactory.all() .map(RandomGeneratorFactory::name) .collect(Collectors.toList()); randomGeneratorList.forEach(generator -&gt; { RandomGenerator rg = RandomGeneratorFactory.of(generator).create(999); System.out.println(rg.getClass()); int counter = 0; while (counter &lt;= 5) { int result = rg.nextInt(100); System.out.println(result); counter ++; } System.out.println(\"=======================\"); }); }}ë‹¤ìŒì˜ ì½”ë“œë¥¼ í†µí•´ ëª¨ë“  ì•Œê³ ë¦¬ì¦˜ì„ í™•ì¸í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.RandomGeneratorFactory.all() .map(fac -&gt; fac.group()+ \" : \" +fac.name()) .sorted() .forEach(System.out::println);LXM : L128X1024MixRandomLXM : L128X128MixRandomLXM : L128X256MixRandomLXM : L32X64MixRandomLXM : L64X1024MixRandomLXM : L64X128MixRandomLXM : L64X128StarStarRandomLXM : L64X256MixRandomLegacy : RandomLegacy : SecureRandomLegacy : SplittableRandomXoroshiro : Xoroshiro128PlusPlusXoshiro : Xoshiro256PlusPlusjava.util.Random íŒ¨í‚¤ì§€ì— ìˆëŠ” SplitRandom í´ë˜ìŠ¤ë‚˜ SecureRandom ê°™ì€ í´ë˜ìŠ¤ê°™ì€ ë ˆê±°ì‹œ í´ë˜ìŠ¤ë“¤ì€ JDK 17ì—ì„œëŠ” RandomGenerator ì¸í„°í˜ì´ìŠ¤ë¥¼ í™•ì¥í•˜ì—¬ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.3. New macOS Rendering Pipeline (JEP 382)ì´ JEPëŠ” ì• í”Œì´ ìŠ¤ìœ™ GUI í”„ë¡œê·¸ë˜ë°ì—ì„œ ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” OpenGL APIë¥¼ deprecate ì²˜ë¦¬í•˜ì˜€ê¸° ë•Œë¬¸ì— ìƒˆë¡­ê²Œ macOSìš© ìë°” 2D ë‚´ë¶€ ë Œë”ë§ íŒŒì´í”„ë¼ì¸ì„ êµ¬í˜„í•©ë‹ˆë‹¤. ìƒˆë¡œìš´ êµ¬í˜„ì²´ëŠ” ì• í”Œ ë©”íƒˆ APIë¥¼ ì‚¬ìš©í•˜ë©° ë‚´ë¶€ ì—”ì§„ ì™¸ ê¸°ì¡´ APIì— ëŒ€í•œ ë³€ê²½ ì‚¬í•­ì€ ì—†ìŠµë‹ˆë‹¤.4. macOS/AArch64 Port (JEP 391)ì• í”Œì€ ìì‚¬ì˜ ì»´í“¨í„° ë¼ì¸ì„ x64ì—ì„œ AArch64ë¡œ ì „í™˜í•˜ëŠ” ì¥ê¸° ê³„íšì„ ë°œí‘œí•˜ì˜€ìŠµë‹ˆë‹¤. ì´ JEPëŠ” JDKê°€ macOSì˜ AArch64ì—ì„œ ì‹¤í–‰ë˜ë„ë¡ ì½”ë“œë¥¼ í¬íŒ…í•©ë‹ˆë‹¤.5. Deprecate the Applet API for Removal (JEP 398)ì´ë¯¸ ë§ì€ ì›¹ ë¸Œë¼ìš°ì €ë“¤ì´ ìë°” í”ŒëŸ¬ê·¸ì¸ì— ëŒ€í•œ ì§€ì›ì„ ì¤‘ì§€í•˜ì˜€ìŠµë‹ˆë‹¤. APIê°€ ë¬´ì˜ë¯¸í•´ì§ì— ë”°ë¼ JDK 9ë¶€í„° deprecate ì²˜ë¦¬ë˜ì—ˆê³ , Applet APIëŠ” í–¥í›„ ë¦´ë¦¬ì¦ˆ ë²„ì „ì—ì„œ ì œê±°ë  ì˜ˆì •ì…ë‹ˆë‹¤.@Deprecated(since = \"9\", forRemoval = true)@SuppressWarnings(\"removal\")public class Applet extends Panel { // ...}6. Strongly Encapsulate JDK Internals (JEP 403)ë§ì€ ì¨ë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬, í”„ë ˆì„ì›Œí¬ í˜¹ì€ ë„êµ¬ë“¤ì´ JDK ë‚´ë¶€ì˜ APIë‚˜ íŒ¨í‚¤ì§€ë¡œ ì ‘ê·¼í•˜ê³  ìˆìŠµë‹ˆë‹¤. Java 16ì€ JEP 396ë¥¼ í†µí•´ ê¸°ë³¸ì ìœ¼ë¡œ ê°•ë ¥í•œ ìº¡ìŠí™”ë¥¼ ê¸°ë³¸ì „ëµìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ë‹¨ìˆœ ìº¡ìŠí™”ë¡œì˜ ì „í™˜ì„ ì§€ì›í•˜ê¸° ìœ„í•´ --illegal-access ì˜µì…˜ì„ ì œê³µí–ˆì—ˆìŠµë‹ˆë‹¤.JEP 403ì€ --illegal-accessì˜µì…˜ì„ ì œê±°í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ì œ JDKì˜ ê°•ë ¥í•œ ë‚´ë¶€ ìº¡ìŠí™”ë¡œ í•œê±¸ìŒ ë” ë‹¤ê°€ê°”ìŠµë‹ˆë‹¤.ì¶”ê°€ë¡œ reflection ì„ í†µí•œ private field / method ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•˜ê²Œ ë©ë‹ˆë‹¤.entityField.setAccessible(true);Object object = entityField.get(this.path);7. Pattern Matching for Switch (Preview / JEP 406)ì´ JEPëŠ” switch ë¬¸ê³¼ í‘œí˜„ì‹ì„ ìœ„í•œ íŒ¨í„´ ë§¤ì¹­ì„ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤. Preview ë²„ì „ì´ê¸° ë•Œë¬¸ì— --enable-preview ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ ê¸°ëŠ¥ì„ í™œì„±í™” ì‹œì¼œì•¼ í•©ë‹ˆë‹¤.7-1. if else chainJDK 16ì—ì„œ instanceof ì— ëŒ€í•œ íŒ¨í„´ ë§¤ì¹­ì´ ì¶”ê°€ë˜ì—ˆëŠ”ë°, ì´ë¥¼ í†µí•´ instanceof ê´€ìš©êµ¬ë¥¼ ë‹¨ìˆœí™”í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.private static String stringFormatter(Object obj) { String result = null; if (obj instanceof Integer i) { result = String.format(\"int %d\", i); } else if (obj instanceof Long l) { result = String.format(\"long %d\", l); } else if (obj instanceof String s) { result = String.format(\"String %s\", s); } return result;}JDK 17ì—ì„œëŠ” ìœ„ì˜ ì½”ë“œë¥¼ switch ë¬¸ì„ ì´ìš©í•œ ì½”ë“œë¡œ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.private static String stringFormatter(Object obj) { return switch (obj) { case Integer i -&gt; String.format(\"int %d\", i); case Long l -&gt; String.format(\"long %d\", l); case String s -&gt; String.format(\"string %s\", s); default -&gt; throw new IllegalStateException(\"Unexpected value: \" + obj); };}7-2. null check in switchì´ì œ switch ë¬¸ì•ˆì—ì„œ null ì²´í¬ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”ì´ìƒ switch ì´ì „ì— null ì²´í¬ë¥¼ í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.private static void stringTester (String s) { // this is not necessary // if (s == null) { // System.out.println(\"string is null\"); // return; // } switch (s) { case null -&gt; System.out.println(\"string is null\"); case \"Java 11\", \"Java 17\" -&gt; System.out.println(\"java LTS\"); case \"Java 8\" -&gt; System.out.println(s); default -&gt; System.out.println(\"nothing matched\"); }}7-3 refined pattern in switchì•„ë˜ ì½”ë“œë¥¼ ì‚´í´ë³´ë©´, Car ê°ì²´ì˜ ë°”í€´ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ì„  switchë¬¸ ì•ˆì—ì„œ if ì¡°ê±´ì ˆì„ ì‚¬ìš©í•´ì•¼ë§Œ í–ˆìŠµë‹ˆë‹¤.abstract static class Transportation { }static class Car extends Transportation { int wheel; int countWheel() { return this.wheel; } public Car(int wheel) { this.wheel = wheel; }}private static void testTransportation (Transportation transportation) { switch (transportation) { case null: System.out.println(\"tp is null\"); break; case Car car: if (car.countWheel() == 4) { System.out.println(\"car with four wheel\"); } else { System.out.println(\"car\"); } break; default: System.out.println(\"Unknown\"); break; }}Java 17 ì€ ì†Œìœ„ redefined pattern í˜¹ì€ guarded pattern ì´ë¼ ë¶ˆë¦¬ëŠ” íŒ¨í„´ì„ í—ˆìš©í•©ë‹ˆë‹¤.private static void testTransportation (Transportation transportation) { switch (transportation) { case null -&gt; System.out.println(\"tp is null\"); case Car car &amp;&amp; car.countWheel() == 4 -&gt; System.out.println(\"car with four wheel\"); case Car car -&gt; System.out.println(\"car\"); default -&gt; System.out.println(\"Unknown\"); }}8. Remove RMI Activation (JEP 407)RMI Activationê³¼ java.rmi.activation íŒ¨í‚¤ì§€ë¥¼ ì œê±°í•˜ì˜€ìŠµë‹ˆë‹¤.9. Sealed Classes (JEP 409)Java 15 ì™€ 16 ì—ì„œ preview ê¸°ëŠ¥ìœ¼ë¡œ ì†Œê°œëœ ë´‰ì¸ í´ë˜ìŠ¤ê°€ í‘œì¤€ ê¸°ëŠ¥ìœ¼ë¡œ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤. Java 16ì—ì„œì˜ ë³€ê²½ì ì€ ì—†ìŠµë‹ˆë‹¤.ì´ ê¸°ëŠ¥ì€ ë´‰ì¸ëœ êµ¬ì„± ìš”ì†Œë¥¼ í™•ì¥í•˜ê±°ë‚˜ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” ë‹¤ë¥¸ í´ë˜ìŠ¤ í˜¹ì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œí•œí•©ë‹ˆë‹¤. JEP 406 (íŒ¨í„´ ë§¤ì¹­)ê³¼ ê²°í•©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ê¹”ë”í•˜ê²Œ íƒ€ì…, ìºìŠ¤íŠ¸ íŒ¨í„´ì„ í†µí•´ ê²€ì‚¬í• ìˆ˜ ìˆìŠµë‹ˆë‹¤.int getWheel(Transportation transportation) { return switch (transportation) { case Car c -&gt; c.countWheel(); case MotorCycle m -&gt; m.countWheel(); case Subway s -&gt; s.countWheel(); case Airplane a -&gt; a.countWheel(); };}ì°¸ì¡°10. Remove the Experimental AOT and JIT Compiler (JEP 410)AOTì™€ JITëŠ” JDK 9 ì™€ JDK 10 ì— ê°ê° ë„ì…ëœ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ì´ë“¤ì€ ìœ ì§€ ë³´ìˆ˜ ë¹„ìš©ì´ ë§ì´ ë“œëŠ” ê¸°ëŠ¥ì´ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ê·¸ë¦¬ ë§ì´ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ì´ê¸° ë•Œë¬¸ì— JEPëŠ” ì´ ê¸°ëŠ¥ë“¤ì„ ì‚­ì œí•˜ê¸°ë¡œ í•˜ì˜€ìŠµë‹ˆë‹¤.ê·¸ì™€ ë³„ê°œë¡œ ê°œë°œìëŠ” ì—¬ì „íˆ GraalVMì„ ì‚¬ìš©í•˜ì—¬ ì´ ê¸°ëŠ¥ë“¤ì„ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.11. Deprecate the Security Manager for Removal (JEP 411)Security Managerì€ Java 1.0 ì—ì„œ í´ë¼ì´ì–¸íŠ¸ì¸¡ Java ì½”ë“œë¥¼ ë³´í˜¸í•˜ê¸° ìœ„í•´ ì†Œê°œëœ ê¸°ëŠ¥ì…ë‹ˆë‹¤ë§Œ ë”ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¶”í›„ ë¦´ë¦¬ì¦ˆ ë²„ì „ì—ì„œ ì œê±°í•˜ê¸° ìœ„í•´ deprecate ì²˜ë¦¬í•©ë‹ˆë‹¤.@Deprecated(since=\"17\", forRemoval=true)public class SecurityManager { // ...}12. Foreign Function and Memory API (Incubator) (JEP 412)ìë°” ê°œë°œìë“¤ì€ ì™¸ë¶€ í•¨ìˆ˜ ë° ë©”ëª¨ë¦¬ APIë¥¼ í†µí•´ JVM ì™¸ë¶€ì—ì„œ ì½”ë“œì— ì ‘ê·¼í•˜ê³  í™ ì™¸ë¶€ì˜ ë©”ëª¨ë¦¬ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ APIì˜ ëª©í‘œëŠ” JNI APIë¥¼ ëŒ€ì²´í•˜ê³  ë³´ì•ˆê³¼ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ëŠ” ê²ƒì…ë‹ˆë‹¤.13. Vector API (Second Incubator) (JEP 414)Java 16ì—ì„œ JEP 414ëŠ” ìƒˆë¡œìš´ Vector APIë¥¼ Incubating APIë¡œ ì†Œê°œí•˜ì˜€ìŠµë‹ˆë‹¤.ì´ JEPëŠ” Vector API ì˜ ì„±ëŠ¥ ë° ë¬¸ì ì§€ì› ì‘ì—… ë“±ì˜ í–¥ìƒëœ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.14. Context-Specific Deserialization Filters (JEP 415)Java 9ì— ì²˜ìŒ ë„ì…ëœ JEP 290 ê¸°ëŠ¥ì€ ë§ì€ ë³´ì•ˆ ë¬¸ì œì˜ ê³µí†µ ì›ì¸ì€ ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ì½”ë“œì—ì„œ ë“¤ì–´ì˜¤ëŠ” ì§ë ¬ ë°ì´í„°ë¥¼ ê²€ì¦í•  ìˆ˜ ìˆê²Œ í•´ì£¼ì—ˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ê²€ì¦ì€ JVM ë ˆë²¨ì—ì„œ ìˆ˜í–‰ë˜ê¸° ë•Œë¬¸ì— ë” ë†’ì€ ë³´ì•ˆì„±ê³¼ ê²¬ê³ ì„±ì´ ìš”êµ¬ë©ë‹ˆë‹¤.JEP 415ë¥¼ ì‚¬ìš©í•˜ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ JVM ìˆ˜ì¤€ì—ì„œ ì •ì˜ëœ ì»¨í…ìŠ¤íŠ¸ë³„ ë° ë™ì ìœ¼ë¡œ ì„ íƒëœ ì—­ì§ë ¬í™” í•„í„°ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê° ì—­ì§ë ¬í™” ì‘ì—…ì€ ì´ëŸ¬í•œ í•„í„°ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤." }, { "title": "OSIV(Open-Session-In-View)", "url": "/posts/osiv/", "categories": "JPA", "tags": "Spring, JPA", "date": "2021-12-04 17:12:00 +0900", "snippet": "OSIVOSIV(Open-Session-In-View)ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë·° ì˜ì—­ê¹Œì§€ ì—´ì–´ë‘ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ ë·° ì˜ì—­ì€ Controller í˜¹ì€ í…œí”Œë¦¿ ë Œë”ë§ ì˜ì—­ê¹Œì§€ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.ë·° ì˜ì—­ê¹Œì§€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì‚´ì•„ìˆë‹¤ë©´ ë·° ì˜ì—­ì—ì„œë„ ì§€ì—° ë¡œë”© (Lazy Loading) ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³„ë‹¤ë¥¸ ì„¤ì • ì—†ì´ë„ ì§€ê¸ˆê¹Œì§€ ë·° ì˜ì—­ì—ì„œ ì§€ì—° ë¡œë”©ì„ ì‚¬ìš©í•˜ê³  ê³„ì‹œëŠ” ë¶„ë“¤ë„ ê³„ì‹¤í…ë°ìš”. ì´ìœ ëŠ” Spring Boot 2.0 ë¶€í„°ëŠ” í•´ë‹¹ ì˜µì…˜ì´ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ë˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.WARN 6052 --- [ main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warningì•„ë¬´ ì„¤ì •ë„ í•˜ì§€ ì•Šê³  ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰ì‹œí‚¤ë©´ ìœ„ì™€ ê°™ì€ ê²½ê³  ë©”ì‹œì§€ë¥¼ ë³¼ ìˆ˜ ìˆëŠ”ë°ìš”, ì´ëŠ” OSIVê°€ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ë˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.OSIV Flow DiagramOSIVê°€ ì‚¬ìš©ë˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©° Post ë¼ëŠ” ì—”í‹°í‹°ê°€ ìˆë‹¤ê³  ê°€ì •í•´ ë³´ê² ìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” Postì—”í‹°í‹°ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ì²˜ë¦¬ ê³¼ì •ê³¼ ì´ë¥¼ ë„ì‹í™”í•œ ë‹¤ì´ì–´ê·¸ë¨ ì…ë‹ˆë‹¤. OpenSessionInViewFilterëŠ” SessionFactoryì˜ openSessionë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ìƒˆ ì„¸ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤. Sessionì€ TransactionSynchronizationManagerì— ë°”ì¸ë”© ë©ë‹ˆë‹¤. OpenSessionInViewFilterëŠ” javax.servlet.FilterChainì˜ doFilterë¥¼ í˜¸ì¶œí•˜ê³  ìš”ì²­ì´ ì¶”ê°€ë©ë‹ˆë‹¤. DispatcherServletì— ì˜í•´ ìš”ì²­ì€ Controllerë¡œ ì „ë‹¬ë©ë‹ˆë‹¤. ControllerëŠ” Post ì—”í‹°í‹°ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ Serviceì˜ getPosts() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ServiceëŠ” ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ì—´ê³ , HibernateTransactionManagerëŠ” OpenSessionInViewFilterì— ì˜í•´ ì‹œì‘ëœ Session ê°ì²´ë¥¼ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤. Repositoryì—ì„œëŠ” ì§€ì—° ë¡œë”© ì—†ì´ Post ì—”í‹°í‹°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. ServiceëŠ” íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ì§€ë§Œ, Session ê°ì²´ëŠ” ì™¸ë¶€ì—ì„œ ì´ˆê¸°í™”ë˜ì—ˆê¸° ë•Œë¬¸ì— ë‹«íˆì§€ ì•ŠìŠµë‹ˆë‹¤. DispatcherServletì— ì˜í•´ ë·° UIê°€ ë Œë”ë§ë˜ê¸° ì‹œì‘í•˜ë©´ ì§€ì—° ë¡œë”©ë  ê°ì²´ë¥¼ íƒìƒ‰í•˜ê³  ì´ˆê¸°í™”í•©ë‹ˆë‹¤. ë·° ë Œë”ë§ê¹Œì§€ ëª¨ë‘ ëë‚¬ìŠµë‹ˆë‹¤. ì´ì œ OpenSessionViewFilterëŠ” Sessionì„ ë‹«ì„ ìˆ˜ ìˆê³ , ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ ë˜í•œ ë°˜í™˜ë©ë‹ˆë‹¤.ì‹¤ì œë¡œ OSIVê°€ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ ìœ„ì™€ ê°™ì€ íë¦„ìœ¼ë¡œ ë·° ì˜ì—­ê¹Œì§€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì‚´ì•„ìˆê²Œ ë©ë‹ˆë‹¤.ì¥ì  ë·° ì˜ì—­ê¹Œì§€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ìœ ì§€ë©ë‹ˆë‹¤. (DB ì»¤ë„¥ì…˜ì´ ìœ ì§€ë¨ì„ ì˜ë¯¸í•˜ê¸°ë„ í•©ë‹ˆë‹¤.) ì§€ì—° ë¡œë”©(Lazy Loading)ì„ ì ê·¹ì ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë‹¨ì ì–¸ëœ» ë³´ê¸°ì—ëŠ” ì¢‹ì€ ê¸°ëŠ¥ì´ë¼ê³  ìƒê°ë ìˆ˜ë„ ìˆê² ì§€ë§Œ, ë°ì´í„°ë² ì´ìŠ¤ ê´€ì ì—ì„œ ë³´ë©´ ì ˆëŒ€ ì¢‹ì€ ê¸°ëŠ¥ì´ë¼ê³  í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.ì„œë¹„ìŠ¤ ë ˆì´ì–´ì—ì„œ íŠ¸ëœì­ì…˜ì„ ì—´ê³  ë‹«ì§€ë§Œ ì´í›„ì—(ë·° ë Œë”ë§ì‹œ)ëŠ” íŠ¸ëœì­ì…˜ì´ ì—´ë ¤ìˆì§€ ì•Šì€ ìƒíƒœì…ë‹ˆë‹¤. ë”°ë¼ì„œ ë·° ì˜ì—­ì—ì„œ ìƒì„±ëœ ëª¨ë“  ì¿¼ë¦¬ë¬¸ì€ auto-commit ëª¨ë“œë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤. ì´ëŠ” Nê°œì˜ ì¿¼ë¦¬ë¬¸ì€ Në²ˆ ë””ìŠ¤í¬ë¡œ íŠ¸ëœì­ì…˜ ë¡œê·¸ì„ í”ŒëŸ¬ì‰¬ í•´ì•¼í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì˜ ì…ì¥ì—ì„œëŠ” ë§ì€ I/O íŠ¸ë˜í”½ì„ ë°œìƒì‹œí‚¤ê²Œ ë©ë‹ˆë‹¤.ë˜í•œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì€ ë·° ì˜ì—­ê¹Œì§€ ìœ ì§€ë˜ë¯€ë¡œ ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€ì˜ í•œê³„ê¹Œì§€ ë„ë‹¬í•˜ë©´ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ê°€ ì œí•œë©ë‹ˆë‹¤. ì—°ê²°ì´ ë§ì´, ê¸¸ê²Œ ìœ ì§€ëœë‹¤ëŠ” ê²ƒì€ ë‹¤ìŒ ìš”ì²­ì´ ë°›ì•„ ë¨¹ì–´ì•¼ í•  ì»¤ë„¥ì…˜ í’€ì˜ ìˆ˜ê°€ ì¤„ì–´ë“ ë‹¤ëŠ” ê²ƒì€ ìš”ì²­ - ì‘ë‹µê¹Œì§€ì˜ ì‹œê°„ì´ ì§€ì—°ë¨ì„ ì˜ë¯¸í•˜ë¯€ë¡œ íŠ¸ë˜í”½ìœ¼ë¡œ ë§ì•„ì§ˆìˆ˜ë¡ ì„±ëŠ¥ì´ í•˜ë½í•©ë‹ˆë‹¤.ê²°ë¡ ê°œì¸ì ìœ¼ë¡œ ì¥ì ë³´ë‹¤ ë‹¨ì ì´ ë” í¬ê²Œ ë‹¤ê°€ì˜¤ëŠ” ê¸°ëŠ¥ì¸ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì €ë„ ëª°ëì„ë•ŒëŠ” ì•„ë¬´ê²ƒë„ ê±´ë“œë¦¬ì§€ ì•Šê³  ê·¸ëƒ¥ ì‚¬ìš©í–ˆì—ˆì§€ë§Œ OSIV ë¥¼ ì•Œê³ ë‚œ í›„ì—ëŠ” ê¼­ ì˜µì…˜ì„ ë„ê³  ê°œë°œí•˜ëŠ” í¸ì…ë‹ˆë‹¤.ë¬¼ë¡  íŠ¸ë˜í”½ì´ ë§ì§€ ì•Šì„ê²ƒì´ë¼ ì˜ˆìƒë˜ëŠ”ê³³ (ì‚¬ë‚´ ì–´í”Œë¦¬ì¼€ì´ì…˜, ê´€ë¦¬ì ë“±..) ì—ëŠ” ê·¸ëƒ¥ ì¼œê³  ì‚¬ìš©í•©ë‹ˆë‹¤.ë¯¸ìë§‰ìœ¼ë¡œ spring boot 2.0 ë¶€í„°ëŠ” í•´ë‹¹ ì˜µì…˜ì´ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì˜µì…˜ì„ ë„ì‹œë ¤ë©´ ì„¤ì • íŒŒì¼ì— ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•˜ì‹œë©´ ë©ë‹ˆë‹¤.spring.jpa.open-in-view=false" }, { "title": "JPA ìºì‹œ", "url": "/posts/JPA-cache/", "categories": "JPA", "tags": "Spring, JPA", "date": "2021-11-27 17:12:00 +0900", "snippet": "JPA ìºì‹œë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ë¹„ìš©ì€ ë§¤ìš° ë¹„ìŒ‰ë‹ˆë‹¤. ì‹¤ì œ ìš´ì˜í•˜ëŠ” ì„œë¹„ìŠ¤ë¼ë©´ DBê°€ ê°™ì€ ì‹œìŠ¤í…œ ì•ˆì— ì¡´ì¬í•˜ëŠ” ì¼ì´ ì—†ê¸° ë•Œë¬¸ì— ë„¤íŠ¸ì›Œí¬ ë¹„ìš©ê¹Œì§€ ë°œìƒí•©ë‹ˆë‹¤. ê²°ê³¼ê°’ì„ ë»”íˆ ì•Œ ìˆ˜ ìˆëŠ” ì¿¼ë¦¬ì— ëŒ€í•´ ì´ëŸ° ê°’ë¹„ì‹¼ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤ë©´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„±ëŠ¥ì€ ë‚®ì•„ì§ˆ ê²ƒì…ë‹ˆë‹¤.í•˜ì´ë²„ë„¤ì´íŠ¸ë¥¼ í¬í•¨í•œ JPA êµ¬í˜„ì²´ë“¤ì€ ìºì‹œë¥¼ ì§€ì›í•©ë‹ˆë‹¤. í•˜ì´ë²„ë„¤ì´íŠ¸ì˜ ìºì‹œëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ê³¼ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ì´ì— ì¤‘ê°„ë‹¤ë¦¬ ê³„ì¸µ ì—­í• ì„ í•˜ë©°, ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ëŒ€ì‹  ì„œë²„ ë©”ëª¨ë¦¬ì—ì„œ ê²°ê³¼ê°’ì„ ë°˜í™˜í•˜ë¯€ë¡œ ë°ì´í„°ë¥¼ ì–»ëŠ”ë° ê±¸ë¦¬ëŠ” ì‹œê°„ì„ ì¤„ì—¬ì¤„ë¿ ì•„ë‹ˆë¼ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„±ëŠ¥ê¹Œì§€ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.1ì°¨ ìºì‹œ1ì°¨ìºì‹œë¶€í„° ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. 1ì°¨ìºì‹œëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë‚´ë¶€ì— ì—”í‹°í‹°ë¥¼ ë³´ê´€í•˜ëŠ” ì¥ì†Œë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. 1ì°¨ìºì‹œëŠ” í•˜ì´ë²„ë„¤ì´íŠ¸ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ë˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤. 1ì°¨ìºì‹œëŠ” íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³  ì¢…ë£Œí•  ë•Œê¹Œì§€ë§Œ ì¡´ì¬í•©ë‹ˆë‹¤.í”Œë¡œìš°ë¥¼ ê°„ë‹¨íˆ ë„ì‹í™”í•´ë³´ë©´ ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤. ìš”ì²­ì´ ì˜¤ë©´ 1ì°¨ ìºì‹œì—ì„œ ìš”ì²­ê³¼ ì¼ì¹˜í•˜ëŠ” ì—”í‹°í‹°ê°€ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ë§Œì•½ ìˆë‹¤ë©´ ê·¸ëŒ€ë¡œ í•´ë‹¹ ì—”í‹°í‹°ë¥¼ ë°˜í™˜í•˜ê³  ì—†ë‹¤ë©´ dbì—ì„œ ì‹¤ì œë¡œ ì¡°íšŒ í›„ì— 1ì°¨ ìºì‹œì— ì €ì¥ í›„ í•´ë‹¹ ê²°ê³¼ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.ì˜ˆì œê°„ë‹¨í•œ ì˜ˆì œë¥¼ í†µí•´ 1ì°¨ ìºì‹œê°€ ì˜ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.í…ŒìŠ¤íŠ¸ì— í™œìš©ëœ ì„¤ì • ì •ë³´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.build.gradledependencies { implementation 'org.springframework.boot:spring-boot-starter-data-jpa' implementation 'org.springframework.boot:spring-boot-starter-web' implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.7.1' compileOnly 'org.projectlombok:lombok' runtimeOnly 'com.h2database:h2' annotationProcessor 'org.projectlombok:lombok' testImplementation 'org.springframework.boot:spring-boot-starter-test'}application.ymlspring: datasource: driver-class-name: org.h2.Driver url: jdbc:h2:../test username: sa password: jpa: database-platform: org.hibernate.dialect.H2Dialect hibernate: ddl-auto: create-dropì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.TestModel.java@Entity@Data@NoArgsConstructor@Table(name = \"test_model\")public class TestModel { @Id @GeneratedValue(strategy = GenerationType.AUTO) Long id; String keyword;}TestService.java@Servicepublic class TestService { @Autowired TestRepository testRepository; @Transactional public void insertDummyData() { var r = Arrays.asList(\"banana\", \"monkey\", \"apple\", \"bear\"); Random rand = new Random(); for (var a = 0; a &lt; 10; a ++) { TestModel testModel = new TestModel(); testModel.setKeyword(r.get(rand.nextInt(r.size()))); testRepository.save(testModel); } }}Test.java@Test@Transactionalvoid test() { testService.insertDummyData(); var listAll = testRepo.findAll(); Assert.notNull(listAll, \"ENTITY LIST SHOULD NOT BE NULL\"); for (var i = 1L; i &lt;= 10L; i ++) { var entity = testRepo.findById(i).orElse(null); Assert.notNull(entity, \"ENTITY SHOULD NOT BE NULL\"); } var entity = testRepo.findById(12L).orElse(null); Assert.isNull(entity, \"ENTITY SHOULD BE NULL\");}10ê°œì˜ ì—”í‹°í‹°ë¥¼ ì €ì¥í•˜ê³  testRepo.findAll() ë¡œ ëª¨ë“  ì—”í‹°í‹°ë¥¼ ë¶ˆëŸ¬ì™€ 1ì°¨ìºì‹œì— ì €ì¥í•˜ì˜€ìŠµë‹ˆë‹¤. ë§Œì•½ 1ì°¨ ìºì‹œê°€ ì—†ë‹¤ë©´ ë°˜ë³µë¬¸ ë¶€ë¶„ì—ì„œ 1Lë¶€í„° 10Lê¹Œì§€ 10ë²ˆ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ê°€ ë‚ ë¼ê°ˆ ê²ƒì…ë‹ˆë‹¤.í•˜ì§€ë§Œ ìœ„ì™€ ê°™ì´ select * from test_modelì ˆ ì´í›„ì— ë°˜ë³µë¬¸ ë‚´ë¶€ì˜ findById() ë¡œ ìƒì„±ë˜ê³  ì‹¤í–‰ë˜ì–´ì•¼ í•  ì¿¼ë¦¬ëŠ” ìƒì„±ë˜ì§€ ì•Šê³  ë°”ë¡œ testRepo.findById(12L).orElse(null)ì˜ ì¿¼ë¦¬ì¸ select * from test_model where id=12ì ˆì´ ì‹¤í–‰ëœê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì´ë¡œì¨ findAll() ë¡œ ì¡°íšŒëœ id 1~10ê¹Œì§€ì˜ ì—”í‹°í‹°ëŠ” 1ì°¨ìºì‹œì—ì„œ ë°”ë¡œ ë°˜í™˜ë˜ì—ˆê³  1ì°¨ìºì‹œì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ” id 12ì˜ ê²½ìš° ì¿¼ë¦¬ê°€ ìƒì„±ë˜ì–´ ì‹¤ì œ dbì—ì„œ ì¡°íšŒí•˜ì—¬ ê²°ê³¼ê°’ì„ ë°˜í™˜í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.2ì°¨ ìºì‹œ1ì°¨ ìºì‹œê°€ íŠ¸ëœì­ì…˜ ë‹¨ìœ„ì˜ ìºì‹œë¼ë©´ 2ì°¨ ìºì‹œëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ ë‹¨ìœ„ì˜ ìºì‹œì…ë‹ˆë‹¤. ë”°ë¼ì„œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹œì‘í•˜ê³  ì¢…ë£Œí•  ë•Œê¹Œì§€ ìºì‹œê°€ ìœ ì§€ë©ë‹ˆë‹¤. 2ì°¨ ìºì‹œëŠ” ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ë™ì‹œì„±ì„ ê·¹ëŒ€í™”í•˜ê¸° ìœ„í•´ ì—”í‹°í‹°ë¥¼ ì§ì ‘ ë°˜í™˜í•˜ì§€ ì•Šê³  ë³µì‚¬ë³¸(dto)ì„ ë§Œë“¤ì–´ ë°˜í™˜í•œë‹¤. 2ì°¨ ìºì‹œëŠ” ì˜ì†ì„± ìœ ë‹› ë²”ìœ„ì˜ ìºì‹œë‹¤. 2ì°¨ ìºì‹œëŠ” ë°ì´í„°ë² ì´ìŠ¤ì˜ ê¸°ë³¸í‚¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìºì‹±í•˜ì§€ë§Œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ë‹¤ë¥´ë©´ ê°ì²´ ë™ì¼ì„± (a == b)ë¥¼ ë³´ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤.2ì°¨ ìºì‹œì˜ í”Œë¡œìš°ë¥¼ ë„ì‹í™” í•˜ì˜€ìŠµë‹ˆë‹¤. 1ì°¨ ìºì‹œì™€ DB ì‚¬ì´ì— 2ì°¨ ìºì‹œ ë ˆì´ì–´ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. 1ì°¨, 2ì°¨ ìºì‹œì— ëª¨ë‘ ì›í•˜ëŠ” ìš”ì²­ê°’ì´ ì—†ëŠ” ê²½ìš° DBì—ì„œ ì¡°íšŒí›„ 2ì°¨ìºì‹œ, 1ì°¨ìºì‹œì— ìˆœì°¨ì ìœ¼ë¡œ ì €ì¥ í›„ ê²°ê³¼ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.Region Factoryí•˜ì´ë²„ë„¤ì´íŠ¸ 2ì°¨ ìºì‹œëŠ” ì‹¤ì œë¡œ ì–´ë–¤ ìºì‹œ í”„ë¡œë°”ì´ë”ê°€ ì‚¬ìš©ë˜ëŠ”ì§€ ì•Œ ìˆ˜ ì—†ê²Œ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” org.hibernate.cache.spi.RegionFactory ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ êµ¬í˜„ì²´ë§Œì„ í•„ìš”ë¡œ í•©ë‹ˆë‹¤.ìœ„ ì¸í„°í˜ì´ìŠ¤ëŠ” ì‹¤ì œ ìºì‹œ í”„ë¡œë°”ì´ë”ì™€ ê´€ë ¨ëœ ëª¨ë“  ì •ë³´ë¥¼ ìº¡ìŠí™”í•©ë‹ˆë‹¤. ë˜í•œ ê¸°ë³¸ì ìœ¼ë¡œ í•˜ì´ë²„ë„¤ì´íŠ¸ì™€ ìºì‹œ í”„ë¡œë°”ì´ë” ì‚¬ì´ì˜ ë¸Œë¦¿ì§€ ì—­í• ì„ í•©ë‹ˆë‹¤.ì•„ë˜ ì˜ˆì œì—ì„œëŠ” Ehcacheë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. RegionFactory ì¸í„°í˜ì´ìŠ¤ê°€ êµ¬í˜„ë˜ì–´ìˆëŠ” ì–´ë–¤ êµ¬í˜„ì²´ë¥¼ ì‚¬ìš©í•´ë„ ë¬¸ì œ ì—†ìŠµë‹ˆë‹¤.ì˜ˆì œ2ì°¨ ìºì‹œë¥¼ ì‹¤ì œë¡œ ì ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.ì¼ë‹¨ gradle ë””íœë˜ì‹œì— ehcacheë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.implementation 'org.hibernate:hibernate-ehcache:5.6.3.Final'ê·¸ í›„ application.yml íŒŒì¼ì— í”„ë¡œí¼í‹°ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.spring: jpa: properties: javax: persistence: sharedCache: mode: ALL hibernate: cache: use_second_level_cache: true region: factory_class: org.hibernate.cache.ehcache.EhCacheRegionFactoryuse_second_level_cache í”„ë¡œí¼í‹°ë¥¼ í†µí•´ 2ì°¨ìºì‹œë¥¼ í™œì„±í™”í•˜ê³  factory_class í”„ë¡œí¼í‹°ë¥¼ í†µí•´ EhCacheRegionFactoryë¥¼ 2ì°¨ ìºì‹œ í”„ë¡œë°”ì´ë”ë¡œ ì„ íƒí•©ë‹ˆë‹¤. sharedCache.mode í”„ë¡œí¼í‹°ë¥¼ í†µí•´ ìºì‹±í•  ì—”í‹°í‹°ì˜ ë²”ìœ„ë¥¼ ì§€ì •í•  ìˆ˜ ìˆëŠ”ë° ì„ íƒ ê°€ëŠ¥í•œ ëª¨ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ALL: ëª¨ë“  ì—”í‹°í‹° ë° ì—”í‹°í‹° ê´€ë ¨ ìƒíƒœì™€ ë°ì´í„°ê°€ ìºì‹œë©ë‹ˆë‹¤.DISABLE_SELECTIVE: @Cacheable ì–´ë…¸í…Œì´ì…˜ì— false ë¼ê³  ëª…ì‹œëœ ì—”í‹°í‹°ë¥¼ ì œì™¸í•œ ëª¨ë“  ì—”í‹°í‹°ì— ëŒ€í•´ ìºì‹±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ENABLE_SELECTIVE: @Cacheable ì–´ë…¸í…Œì´ì…˜ì— true ë¼ê³  ëª…ì‹œëœ ëª¨ë“  ì—”í‹°í‹°ì— ëŒ€í•´ ìºì‹±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.NONE: ì˜ì†ì„± ìœ ë‹›ì—ì„œ ìºì‹±ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.UNSPECIFIED: ìºì‹± ë™ì‘ì´ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í”„ë¡œë°”ì´ë”ë³„ ê¸°ë³¸ê°’ì´ ì ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë” ìì„¸í•œ ì •ë³´ëŠ” ì´ê³³ì„ ì°¸ì¡°í•˜ì„¸ìš”.ë‹¤ìŒìœ¼ë¡œ ìºì‹±í•  ì—”í‹°í‹°ì— ìºì‹œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê² ë‹¤ê³  ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.@Entity@Data@NoArgsConstructor@Table(name = \"test_model\")@Cacheable@org.hibernate.annotations.Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE)public class TestModel { @Id @GeneratedValue(strategy = GenerationType.AUTO) Long id; String keyword;}@Cacheable ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì´ ì—”í‹°í‹°ê°€ ìºì‹±ë ìˆ˜ ìˆìŒì„ ëª…ì‹œí•˜ì˜€ìŠµë‹ˆë‹¤. @Cache ì–´ë…¸í…Œì´ì…˜ì™€ usage() ì†ì„±ì„ í†µí•´ ìºì‹œ ì „ëµì„ ëª…ì‹œí•˜ì˜€ìŠµë‹ˆë‹¤. ì‚¬ìš©í• ìˆ˜ ìˆëŠ” ì „ëµì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. NONE: ì „ëµì´ ì—†ìŠµë‹ˆë‹¤.READ_ONLY: ì½ê¸° ì „ìš©ì…ë‹ˆë‹¤. ë¶ˆë³€ê°’ì— ì í•©í•©ë‹ˆë‹¤. NONSTRICT_READ_WRITE: ì—„ê²©í•˜ì§€ ì•Šì€ ì½ê¸°/ì“°ê¸° ì „ëµì…ë‹ˆë‹¤. ë™ì‹œì„± ì ‘ê·¼ì„ ê³ ë ¤í•˜ì§€ ì•Šê³  ìºì‹±í•©ë‹ˆë‹¤. ìˆ˜ì •ì´ ìì£¼ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ” ì—”í‹°í‹°ì— ì í•©í•©ë‹ˆë‹¤.READ_WRITE: ì—„ê²©í•œ ì½ê¸°/ì“°ê¸° ì „ëµì…ë‹ˆë‹¤. ë™ì‹œ ì ‘ê·¼ì„ ê³ ë ¤í•˜ê³  ê°œë°œí•´ì•¼ í•©ë‹ˆë‹¤.TRANSACTIONAL: JTA í™˜ê²½ì—ì„œ ì‚¬ìš©ë˜ë©° hibernate.transaction.manager_lookup_class í”„ë¡œí¼í‹°ë¥¼ ëª…ì‹œí•´ì•¼ í•©ë‹ˆë‹¤.ì´ê³³ ì—ì„œ ë” ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.ì„¤ì •ì´ ëª¨ë‘ ëë‚¬ìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©ë  ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.@RestControllerpublic class CacheTestController { @Autowired TestRepository testRepository; @Autowired TestService testService; @Autowired SessionFactory sessionFactory; @GetMapping(\"/insert\") public ResponseEntity&lt;?&gt; insert() { var r = Arrays.asList(\"banana\", \"monkey\", \"apple\", \"bear\"); Random rand = new Random(); for (var a = 0; a &lt; 10; a ++) { TestModel testModel = new TestModel(); testModel.setKeyword(r.get(rand.nextInt(r.size()))); testRepository.save(testModel); } return ResponseEntity.ok(\"SUCCESS\"); } @GetMapping(\"/getById\") public ResponseEntity&lt;?&gt; getById(@RequestParam Long id) { sessionFactory.getStatistics().setStatisticsEnabled(true); System.out.println(\"=========================\"); System.out.println(\"find entity start\"); var e = testRepository.findById(id).orElse(null); System.out.println(\"second level cache hit count: \" + sessionFactory.getStatistics().getSecondLevelCacheHitCount()); System.out.println(\"second level cache miss count: \" + sessionFactory.getStatistics().getSecondLevelCacheMissCount()); System.out.println(\"second level cache put count: \" + sessionFactory.getStatistics().getSecondLevelCachePutCount()); System.out.println(\"find entity end\"); return ResponseEntity.ok(e); }}í¸ì˜ë¥¼ ìœ„í•´ h2 ë©”ëª¨ë¦¬ dbë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰í›„ insert() ë©”ì†Œë“œë¥¼ í†µí•´ 10ê°œì˜ ì—”í‹°í‹°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤. ê·¸ í›„ getById(id) ë©”ì†Œë“œë¥¼ í†µí•´ idê°€ 1ì¸ ì—”í‹°í‹°ë¥¼ ë‘ë²ˆ ì¡°íšŒí›„ idê°€ 2ì¸ ì—”í‹°í‹°ë¥¼ ë‘ë²ˆ ì¡°íšŒí•´ ë³´ê² ìŠµë‹ˆë‹¤.10:11:42.982 [INFO ][p6spy.logSQL:line60] - =========================find entity start10:12:03.542 [INFO ][p6spy.logSQL:line60] - select testmodel0_.id as id1_0_0_, testmodel0_.keyword as keyword2_0_0_ from test_model testmodel0_ where testmodel0_.id=1\tConnection ID: 4\tExecution Time: 0 ms\tCall Stack (number 1 is entry point): \t\t1. sycho.spring.controller.CacheTestController.getById(CacheTestController.java:50)----------------------------------------------------------------------------------------------------10:12:03.560 [INFO ][p6spy.logSQL:line60] - second level cache hit count: 0second level cache miss count: 1second level cache put count: 1find entity end=========================find entity start10:12:05.356 [INFO ][p6spy.logSQL:line60] - second level cache hit count: 1second level cache miss count: 1second level cache put count: 1find entity end=========================find entity start10:12:06.855 [INFO ][p6spy.logSQL:line60] - select testmodel0_.id as id1_0_0_, testmodel0_.keyword as keyword2_0_0_ from test_model testmodel0_ where testmodel0_.id=2\tConnection ID: 6\tExecution Time: 0 ms\tCall Stack (number 1 is entry point): \t\t1. sycho.spring.controller.CacheTestController.getById(CacheTestController.java:50)----------------------------------------------------------------------------------------------------10:12:06.858 [INFO ][p6spy.logSQL:line60] - second level cache hit count: 1second level cache miss count: 2second level cache put count: 2find entity end=========================find entity start10:12:07.940 [INFO ][p6spy.logSQL:line60] - second level cache hit count: 2second level cache miss count: 2second level cache put count: 2find entity endí…ŒìŠ¤íŠ¸ ê²°ê³¼ëŠ” ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤. ìµœì´ˆ idê°€ 1ì¸ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí• ë•ŒëŠ” 2ì°¨ ìºì‹œì— ë°ì´í„°ê°€ ì¡´ì¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì‹¤ì œ ì¿¼ë¦¬ê°€ ë‚ ë¼ê°€ê³  miss countì™€ put count ê°€ 1ì´ ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ í›„ ë‹¤ì‹œí•œë²ˆ idê°€ 1ì¸ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•ŒëŠ” 2ì°¨ ìºì‹œì— ì—”í‹°í‹°ê°€ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ì¿¼ë¦¬ê°€ ë‚ ë¼ê°€ì§€ ì•Šê³  hit countê°€ 1ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.idë¥¼ 2ë¡œí•˜ì—¬ ì¡°íšŒí•´ë´ë„ 1ë¡œ ì¡°íšŒí• ë•Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ ìµœì´ˆ ì¡°íšŒë•ŒëŠ” ì‹¤ì œ ì¿¼ë¦¬ê°€ ë‚ ë¼ê°€ê³  2ë²ˆì§¸ ì¡°íšŒë•ŒëŠ” ìºì‹œëœ ì—”í‹°í‹°ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë¶„ì‚°í™˜ê²½ì—ì„œì˜ 2ì°¨ ìºì‹œí•˜ì§€ë§Œ ìš”ì¦˜ì—ëŠ” ë‹¨ì¼í™˜ê²½ì—ì„œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì˜ ìš´ì˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. AWSë¥¼ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •í•˜ë©´ ì˜¤í†  ìŠ¤ì¼€ì¼ë§ ê·¸ë£¹ì˜ EC2ì— ë™ì¼í•œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ë™í•˜ì—¬ ë¶„ì‚°í™˜ê²½ì—ì„œ ììœ ë¡­ê²Œ ìŠ¤ì¼€ì¼ë§ in / out í•  ìˆ˜ ìˆëŠ” í˜•íƒœë¡œ ì„œë²„ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.ë©”ëª¨ë¦¬ dbê°€ ì–´í”Œë¦¬ì¼€ì´ì…˜ ë‹¨ìœ„ë¡œ ë™ì‘í•˜ëŠ” ê²½ìš° ìµœì¢… dbì— ì»¤ë°‹ì‹œì— ë¬¸ì œê°€ ìƒê¸¸ìˆ˜ ìˆìŠµë‹ˆë‹¤. db lock ì— ì˜í•´ ë¬¸ì œê°€ ìƒê¸°ì§€ ì•Šì„ ìˆ˜ ìˆì§€ë§Œ ë’¤ì— ì²˜ë¦¬í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ë³„ë„ì˜ ì„œë²„ì— ë©”ëª¨ë¦¬ db ì„ êµ¬ì¶•í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¬¼ë¡  ì´ë•Œë„ ì˜¬ë°”ë¥¸ ìºì‹œ ì „ëµì„ ì§€ì •í•˜ëŠ”ê²ƒì€ ì¤‘ìš”í•©ë‹ˆë‹¤.ë‹¨ì¼ ë…¸ë“œ í™˜ê²½ì—ì„œëŠ” READ_WRITE, TRANSACTIONL ì „ëµì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë¶„ì‚° ë…¸ë“œ í™˜ê²½ì—ì„œëŠ” db lock ì— ì˜ì¡´í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ NONSTRICT_READ_WRITE ì „ëµì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. ì–´ë–¤ ê³³ì—ì„œëŠ” ì¼ê´€ì„±ì„ ìœ„í•´ (quorum ì•Œê³ ë¦¬ì¦˜)[https://en.wikipedia.org/wiki/Quorum_(distributed_computing)] ì„ ì‚¬ìš©í•˜ëŠ” ë©”ëª¨ë¦¬ db ì—ì„œëŠ” READ_WRITE ì„ ì‚¬ìš©í•´ë„ ëœë‹¤ê³  í•˜ë„¤ìš”.ê°œì¸ì ìœ¼ë¡œ ì™¸ë¶€ë¡œ ë©”ëª¨ë¦¬ dbë¥¼ ë¹¼ê³  _WRITE ì „ëµì„ ì‚¬ìš©í•˜ëŠ”ê²ƒì€ ì„¸ì„¸í•œ ì„¤ì •ì´ í•„ìš”í•˜ê³  ìœ ì§€ë³´ìˆ˜ì— ë” í° ë¦¬ì†ŒìŠ¤ê°€ ë“¤ì–´ê°ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì„ í˜¸í•˜ì§€ ì•ŠëŠ” í¸ì…ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ í•˜ë”ë¼ë„ 2ì°¨ìºì‹œ ìì²´ëŠ” ì¶©ë¶„íˆ ë§¤ë ¥ì ì¸ ê¸°ëŠ¥ì´ë¼ ìƒê°í•©ë‹ˆë‹¤." }, { "title": "AWS ALBì— ëŒë‹¤ ì—†ì´ ê³ ì • IPë¡œ ì ‘ê·¼í•˜ê¸°", "url": "/posts/aws-alb-static-ip/", "categories": "AWS", "tags": "AWS", "date": "2021-10-07 20:12:00 +0900", "snippet": "ALBì— ê³ ì • IPë¡œ ì ‘ê·¼í•˜ê¸°AWS ALB(Application Load Balancer)ëŠ” NLB(Network Load Balancer)ì— ë¹„í•´ ê°€ì§€ëŠ” ì´ì ë“¤ì´ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ALBëŠ” ì„œë¸Œë„ë©”ì¸ì´ë‚˜ path â€˜/app/**â€™ ê°™ì€ ê²½ë¡œë¡œ íƒ€ê²Ÿ ê·¸ë£¹ì— ìš”ì²­ì„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë‹¨ì  í•˜ë‚˜ê°€ ìˆëŠ”ë°ìš”, ë°”ë¡œ ê³ ì • IPë¥¼ ë¶€ì—¬í•˜ì§€ ëª»í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì„œë¹„ìŠ¤ë¥¼ ìš´ì˜í•˜ë‹¤ ë³´ë©´ ê³ ê°ì‚¬ê°€ ë‚´ë¶€ ë§ì„ ì‚¬ìš©í•˜ì—¬ ê·¸ë“¤ì˜ ë°©í™”ë²½ì— ê³ ì • IPë¥¼ ë“±ë¡í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ê³ ì • IPë¥¼ ìš”êµ¬í•˜ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.ê¸°ì¡´ì—ëŠ” ëŒë‹¤, AWS GA ë“±ì„ ì‚¬ìš©í•˜ì—¬ ALBì— ê³ ì • IPë¡œ ì ‘ê·¼í•˜ê³¤ í•˜ì˜€ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ 2021ë…„ 9ì›” AWSì—ì„œ NLB ALB ë¡œì˜ ì§ì ‘ íŠ¸ë˜í”½ ì „ë‹¬ì„ ì§€ì›í•˜ê²Œ ë¨ìœ¼ë¡œì¨ ë” ì‰½ê²Œ ê³ ì •IPë¥¼ ë¶€ì—¬í• ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ í¬ìŠ¤íŒ…ì—ì„œëŠ” ìƒˆë¡œìš´ ë°©ë²•ì„ ì†Œê°œí•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.ê¸°ì¡´ ë°©ë²•ê¸°ì¡´ì— ALBì— ê³ ì • IPë¥¼ ë¶€ì—¬í•˜ëŠ” ë°©ë²•ìœ¼ë¡œëŠ” ëŒë‹¤, AWS Global Accelerator, Proxy EC2 Server í¬ê²Œ 3ê°€ì§€ê°€ ìˆëŠ”ê²ƒ ê°™ìŠµë‹ˆë‹¤. ê·¸ì¤‘ì—ì„œ ì œê°€ ë§¡ê³ ìˆëŠ” ì„œë¹„ìŠ¤ì—ëŠ” EC2ì— nginx ë§Œ ì„¤ì¹˜í•´ Proxy Server ì²˜ëŸ¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì„ ì ìš©í•˜ì˜€ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ê·¸ ì„œë²„ì—ëŠ” ì•„ë˜ì™€ ê°™ì€ nginx config íŒŒì¼ì„ ì‘ì„± í•˜ì˜€ìŠµë‹ˆë‹¤.server { listen 443 ssl; server_name server_name; ssl_certificate /etc/nginx/ssl/ssl.crt; ssl_certificate_key /etc/nginx/ssl/ssl.key; ssl_protocols SSLv2 SSLv3 TLSv1 TLSv1.1 TLSv1.2; ssl_prefer_server_ciphers on; location / { access_log /var/log/nginx/proxy.log timed_combined; error_log /var/log/nginx/proxy-error.log; resolver 172.31.0.2 valid=10s; set $proxy \"DNS NAME\"; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-FORWARDED-FOR $remote_addr; proxy_redirect off; proxy_read_timeout 120s; proxy_pass https://$proxy; }}ì•„ì‹œë‹¤ì‹œí”¼ ALBëŠ” ë™ì  IPì´ê¸° ë•Œë¬¸ì— ë„ë©”ì¸ì„ ì£¼ë©´ ì•ˆë˜ê³  DNS ì£¼ì†Œ ìì²´ë¥¼ proxy_pass ê°€ ë°”ë¼ë³¼ìˆ˜ ìˆë„ë¡ ì„¸íŒ…í•´ì•¼ í•©ë‹ˆë‹¤. ë§Œì•½ www.xxx.com í˜•íƒœì˜ ë„ë©”ì¸ì„ proxy_passê°€ ë°”ë¼ë³´ê²Œ ì„¤ì •í•œë‹¤ë©´ ALBì˜ ë™ì IPê°€ ë°”ë€ŒëŠ” ê²½ìš° nginx ìºì‹œì— ì˜í•´ ì˜¬ë°”ë¥¸ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì°¾ì•„ ë“¤ì–´ê°€ì§€ ëª»í•´ í´ë¼ì´ì–¸íŠ¸ëŠ” 504 ì—ëŸ¬ì½”ë“œë¥¼ ìˆ˜ì‹ í•˜ê²Œ ë˜ëŠ” ì¥ì•  ìƒí™©ì´ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.ì´ê²ƒë¿ë§Œì´ ì•„ë‹ˆê³  ì´ Proxy Server ì—ì„œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ë°›ëŠ” ì›¹ì„œë²„ ì…ì¥ì—ì„œëŠ” ê²€ì¦ë˜ì§€ ì•Šì€ ìš”ì²­ì´ê¸° ë•Œë¬¸ì— ë°›ëŠ” ì›¹ì„œë²„ nginxì˜ server ë¸”ë¡ê³¼ location ë¸”ë¡ì— ì•„ë˜ì™€ ê°™ì€ ì„¤ì •ì„ ì¶”ê°€í•˜ê¸°ë„ í–ˆìŠµë‹ˆë‹¤.add_header 'Access-Control-Allow-Origin' 'domain';add_header 'Access-Control-Allow-Credentials' 'true';add_header 'Access-Control-Allow-Headers' 'Authorization,Accept,Origin,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Content-Range,Range';add_header 'Access-Control-Allow-Methods' 'GET,POST,OPTIONS,PUT,DELETE,PATCH';...if ($request_method = 'OPTIONS') { add_header 'Access-Control-Allow-Origin' 'domain'; add_header 'Access-Control-Allow-Credentials' 'true'; add_header 'Access-Control-Allow-Headers' 'Authorization,Accept,Origin,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Content-Range,Range'; add_header 'Access-Control-Allow-Methods' 'GET,POST,OPTIONS,PUT,DELETE,PATCH'; add_header 'Access-Control-Max-Age' 1728000; add_header 'Content-Type' 'text/plain charset=UTF-8'; add_header 'Content-Length' 0; return 204;}ì´ë ‡ë“¯ ê³ ì • IP ì„¤ì •ì„ ìœ„í•´ ì˜ˆì™¸ì²˜ë¦¬í•˜ëŠ” ì„¤ì •ì´ ë§ì•˜ê³ , í•œë²ˆì— ê´€ë¦¬í•˜ê¸° í˜ë“  ë¬¸ì œ, SSL ë³€ê²½ì‹œ ê°ê¸° ì ìš© ë¬¸ì œë“± ë§ì€ ë¬¸ì œê°€ ìˆì—ˆì§€ë§Œ ë³„ë‹¤ë¥¸ ë°©ë²•ì´ ì—†ì—ˆê¸° ë•Œë¬¸ì— ëˆˆë¬¼ì„ ë¨¸ê¸ˆê³  ì´ ìƒíƒœë¡œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ê³  ìˆëŠ” ìƒíƒœì˜€ìŠµë‹ˆë‹¤.NLB ì—ì„œ ALB ë°”ë¡œ ë°”ë¼ë³´ê²Œ í•˜ê¸° (ìƒˆë¡œìš´ ë°©ë²•)ê·¸ëŸ¬ë˜ ì™€ì¤‘ì— 2021ë…„ 9ì›” 27ì¼ì— AWS ì‚¬ì´íŠ¸ì— NLBì—ì„œ ALBë¡œì˜ ì§ì ‘ íŠ¸ë˜í”½ ì „ë‹¬ì„ ì§€ì›í•œë‹¤ëŠ” ê¸€ì´ ì˜¬ë¼ì™”ìŠµë‹ˆë‹¤. (ë§í¬) ì„¤ì •í•˜ê¸°ê°€ ì‰½ê³  ì—¬ëŸ¬ê°€ì§€ ì´ì ì´ ìˆê¸° ë•Œë¬¸ì— ë•Œë¬¸ì— Proxy Serverë¥¼ ì—†ì• ê³  NLBê°€ ALBë¥¼ ë°”ë¼ë³¼ìˆ˜ ìˆê²Œë” ì¸í”„ë¼ êµ¬ì„±ì„ ë³€ê²½í•˜ê¸°ë¡œ ê²°ì •í•˜ì˜€ìŠµë‹ˆë‹¤.ë¡œë“œë°¸ëŸ°ì„œë¡œ ALBë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤ëŠ” ì „ì œí•˜ì— ìƒˆë¡œìš´ ë°©ì‹ì„ ì†Œê°œí•´ ë“œë¦¬ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ë§Œì•½ ì‚¬ìš©í•˜ê³  ê³„ì‹œì§€ ì•Šë‹¤ë©´ ì—¬ê¸°ë¥¼ ì°¸ê³ í•˜ì…”ì„œ ALBë¥¼ ë§Œë“¤ì–´ ë³´ì„¸ìš”.íƒ€ê²Ÿê·¸ë£¹ ìƒì„±í•˜ê¸°ì²«ë²ˆì§¸ë¡œ íƒ€ê²Ÿê·¸ë£¹ì„ ìƒì„±í•˜ê² ìŠµë‹ˆë‹¤. AWS ì½˜ì†”ì— ì ‘ì†í•˜ì…”ì„œ Create target groupì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.íƒ€ê²Ÿê·¸ë£¹ ìƒì„±í™”ë©´ì— ë“¤ì–´ì™”ë‹¤ë©´ íƒ€ê²Ÿ íƒ€ì…ì€ Application Load Balancer ë¥¼ ì„ íƒí•˜ê³  ë‚˜ë¨¸ì§€ ì •ë³´ë¥¼ ì±„ì›Œì£¼ì„¸ìš”. Health check ì˜ ê²½ìš° ê¸°ì¡´ ALBê°€ ë°”ë¼ë³´ê³  ìˆëŠ” ëŒ€ìƒ ê·¸ë£¹ì˜ health check ê²½ë¡œë¥¼ ì ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.ë‹¤ìŒë‹¨ê³„ë¡œ ë„˜ì–´ê°„ë‹¤ìŒ ê¸°ì¡´ ALBë¥¼ ì„ íƒí•˜ê³  Create target group ë²„íŠ¼ì„ í´ë¦­í•œë‹¤ë©´ íƒ€ê²Ÿê·¸ë£¹ ìƒì„±ì€ ëì…ë‹ˆë‹¤. Network Load Balancer ìƒì„±í•˜ê¸°ë‹¤ìŒì€ NLBë¥¼ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤. EC2 ì½˜ì†”ì„ í†µí•´ ë¡œë“œë°¸ëŸ°ì„œ í˜ì´ì§€ì— ë“¤ì–´ì˜¤ì‹ í›„ Load Balancer ìƒì„± ë²„íŠ¼ê³¼ Network Load Balancer ë²„íŠ¼ì„ ì„ íƒí•´ ìƒì„±í™”ë©´ê¹Œì§€ ë“¤ì–´ì™€ ì£¼ì„¸ìš”.ì´ë¦„ì„ ì…ë ¥í•˜ê³  vpcë¥¼ ì„ íƒí•œ í›„ ê°€ìš©ì˜ì—­ì„ ì„ íƒí•©ë‹ˆë‹¤. ì´ë•Œ AWSê°€ ìë™ìœ¼ë¡œ í• ë‹¹í•˜ëŠ” IPê°€ ì•„ë‹Œ íƒ„ë ¥ì  IP(Elastic IP)ë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´ íƒ„ë ¥ì  IPë¥¼ ë¨¼ì € í• ë‹¹ ë°›ê³  NLBë¥¼ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.ê·¸ í›„ ì•„ê¹Œ ë§Œë“  íƒ€ê²Ÿ ê·¸ë£¹ì„ Foward to ì—ì„œ ì„ íƒí•˜ê³  í•˜ë‹¨ì˜ Create load balancerë¥¼ ëˆŒëŸ¬ NLBë¥¼ ìƒì„±í•©ë‹ˆë‹¤.443 í¬íŠ¸ ì„¤ì •SSLì„ ì ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ìœ„ ë‚´ìš©ê¹Œì§€ ì„¤ì •í•˜ê³  IPì— ë„ë©”ì¸ì„ ì—°ê²°í•˜ë©´ ëì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ìš”ì¦˜ì—ëŠ” SSLì„ ì ìš©í•˜ì§€ ì•Šì€ ì›¹ì‚¬ì´íŠ¸ëŠ” ë³´ê¸° ì–´ë µì£ . ë‹¤í–‰íˆ ì„¤ì •ìì²´ëŠ” ì–´ë µì§€ ì•ŠìŠµë‹ˆë‹¤. ì•„ë˜ ì´ì–´ì§ˆ ë‚´ìš©ì—ëŠ” ALB ì— SSL ì¸ì¦ì„œê°€ ì ìš©ë˜ì–´ ìˆë‹¤ëŠ” ê°€ì •ì´ ë“¤ì–´ê°€ ìˆìŠµë‹ˆë‹¤.íƒ€ê²Ÿê·¸ë£¹ì„ í•˜ë‚˜ë” ë§Œë“¤ê² ìŠµë‹ˆë‹¤. íƒ€ê²Ÿê·¸ë£¹ì€ ì•„ì‰½ê²Œë„ í¬íŠ¸ ìˆ˜ì •ì„ ì§€ì›í•˜ì§€ ì•Šì•„ ìƒˆë¡­ê²Œ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. ì´ë¦„ì€ ì ì ˆí•œ ì´ë¦„ìœ¼ë¡œ ì§€ì–´ì£¼ì‹œê³  ì•„ê¹Œ 80í¬íŠ¸ë¥¼ ì…ë ¥í•œ ëŒ€ì‹  ì´ë²ˆì—ëŠ” 443 í¬íŠ¸ë¥¼ ì…ë ¥í•´ ìƒì„±í•©ë‹ˆë‹¤.ê·¸ í›„ ë¡œë“œë°¸ëŸ°ì„œ ì„¤ì • í™”ë©´ìœ¼ë¡œ ëŒì•„ì™€ ë°©ê¸ˆ ë§Œë“  ë¡œë“œë°¸ëŸ°ì„œë¥¼ ì„ íƒí•˜ê³  ë¦¬ìŠ¤ë„ˆ í•­ëª©ì„ ì„ íƒí•©ë‹ˆë‹¤. ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ë¥¼ ëˆ„ë¥´ê³  í”„ë¡œí† ì½œ / í¬íŠ¸ëŠ” TCP / 443 ì„ ì§€ì •í•˜ê³  ì „ë‹¬ ëŒ€ìƒì€ ë°”ë¡œ ìœ„ì—ì„œ ì ì ˆí•œ ì´ë¦„ìœ¼ë¡œ ë§Œë“  íƒ€ê²Ÿê·¸ë£¹ì„ ì„ íƒí•˜ê³  ë¦¬ìŠ¤ë„ˆë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.ì´ì œ ëª¨ë‘ ëì…ë‹ˆë‹¤. ë¡œë“œë°¸ëŸ°ì„œê°€ ìƒˆë¡œìš´ ì„¤ì •ì„ ë°˜ì˜í•  ì ì‹œì˜ ì‹œê°„ì´ íë¥´ê³  ë„ë©”ì¸ìœ¼ë¡œ ì ‘ì†í•´ë³´ë©´ https í”„ë¡œí† ì½œì„ í†µí•´ ì—°ê²°ë˜ê³  SSL ì¸ì¦ì„œë„ ì˜¬ë°”ë¥¸ ì¸ì¦ì„œì„ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.443 í¬íŠ¸ ì„¤ì •ì‹œ ì£¼ì˜ì‚¬í•­NLB ëŠ” ALB ì™€ ë‹¤ë¥´ê²Œ 4ê³„ì¸µì—ì„œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— httpë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì„ httpsë¡œ redirect ì²˜ë¦¬í• ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ë§Œì•½ 443 í¬íŠ¸ë¡œ í†µì‹ í•˜ê²Œ ë§Œë“  ëŒ€ìƒê·¸ë£¹ì„ NLBì˜ 80í¬íŠ¸ì— ë§¤í•‘í•˜ê²Œ ëœë‹¤ë©´, ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì„ ë³´ê²Œ ë ê²ë‹ˆë‹¤.ë”°ë¼ì„œ ë‚´ë¶€ ì›¹ì„œë²„ë‚˜ ë‚´ë¶€ ë¡œë“œë°¸ëŸ°ì„œê°€ ì˜êµ¬ ì´ë™ë°©ì‹ìœ¼ë¡œ redirect ì²˜ë¦¬í•˜ê²Œ ë˜ë”ë¼ë„ ìµœì´ˆ ì§„ì… ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸ëŠ” ë‚´ë¶€ê¹Œì§€ ìš”ì²­ì„ ì „ë‹¬í• ìˆ˜ ìˆê²Œë” ì„¤ì •í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. í˜„ì¬(2021-10-07) ê¸°ì¤€ìœ¼ë¡œëŠ” ë‹¤ë¥¸ ë°©ë²•ì´ ì—†ì–´ ì–´ì©”ìˆ˜ ì—†ì´ íƒ€ê²Ÿê·¸ë£¹ì„ 2ê°œ ë§Œë“¤ì–´ ê°ê° 80, 443 í¬íŠ¸ë¡œ í†µì‹ í•˜ê²Œ ë§Œë“¤ê³  NLBì˜ ë¦¬ìŠ¤ë„ˆëŠ” ê°ê° ë‹¤ë¥¸ ëŒ€ìƒê·¸ë£¹ì„ ë°”ë¼ë³´ê²Œ í•´ì•¼ í•©ë‹ˆë‹¤.ì´ ê¸°ëŠ¥ìì²´ê°€ ë‚˜ì˜¨ì§€ ì–¼ë§ˆë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ìœ„ì™€ ê°™ì€ ë¬¸ì œë¥¼ í•´ê²°í•  ìƒˆë¡œìš´ ë°©ë²•ì„ ì œì‹œí•´ ì¤„ì§€ëŠ” ì§€ì¼œë´ì•¼ í• ê²ƒ ê°™ìŠµë‹ˆë‹¤.ê²°ë¡ ê°œì¸ì ìœ¼ë¡œ ì´ ê¸°ëŠ¥ì€ ëŒë‹¤, GA, í”„ë¡ì‹œ ì„œë²„ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ê¹”ë”í•œ(?) ë°©ì‹ìœ¼ë¡œ ALB ì— ê³ ì • IPë¥¼ ë¶€ì—¬í• ìˆ˜ ìˆëŠ” ë°©ë²•ì¸ê²ƒ ê°™ìŠµë‹ˆë‹¤. SSL ì„¤ì •ë„ ê¸°ì¡´ì˜ ALBë¥¼ ë”°ë¼ê°€ê²Œ ë˜êµ¬ìš”. ê²½ìš°ì— ë”°ë¼ ë¶€ê³¼ë˜ëŠ” ìš”ê¸ˆì´ ì¡°ê¸ˆë” ë¹„ìŒ€ìˆ˜ëŠ” ìˆê² ì§€ë§Œ ì „ì²´ì ì¸ ê´€ë¦¬ì˜ í¸ì˜ì„±ì„ ë´¤ì„ë•Œ ì•ìœ¼ë¡œ ì´ ë°©ë²•ì„ ê³„ì† ì‚¬ìš©í• ê²ƒ ê°™ìŠµë‹ˆë‹¤.ì°¸ì¡°https://aws.amazon.com/ko/about-aws/whats-new/2021/09/application-load-balancer-aws-privatelink-static-ip-addresses-network-load-balancer" }, { "title": "íŒ©í† ë¦¬ ë©”ì†Œë“œ íŒ¨í„´ (Factory Method Pattern)", "url": "/posts/factory-method-pattern/", "categories": "Design Pattern", "tags": "Design Pattern, Java", "date": "2021-09-25 20:12:00 +0900", "snippet": "íŒ©í† ë¦¬ ë©”ì†Œë“œ íŒ¨í„´íŒ©í† ë¦¬ ë©”ì†Œë“œ íŒ¨í„´ì€ ë¶€ëª¨ í´ë˜ìŠ¤ì— ì•Œë ¤ì§€ì§€ ì•Šì€ êµ¬ì²´ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” íŒ¨í„´ì´ë©°, ìì‹ í´ë˜ìŠ¤ê°€ ì–´ë–¤ ê°ì²´ë¥¼ ìƒì„±í• ì§€ ê²°ì •í•˜ë„ë¡ í•˜ëŠ” ìƒì„±íŒ¨í„´ ì…ë‹ˆë‹¤. ê°„ë‹¨íˆ ìš”ì•½í•˜ìë©´ ë¶€ëª¨ í´ë˜ìŠ¤ ëŒ€ì‹  ìì‹ í´ë˜ìŠ¤ì—ì„œ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” íŒ¨í„´ì´ë¼ê³  ìƒê°í•˜ì‹œë©´ ë©ë‹ˆë‹¤.êµ¬ì¡° ìƒì„±ìì™€ ê·¸ í•˜ìœ„í´ë˜ìŠ¤ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ”ë° ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©ë ìˆ˜ ìˆëŠ” Product ì¸í„°í˜ì´ìŠ¤ë¥¼ ì„ ì–¸í•©ë‹ˆë‹¤. Concreate ProductsëŠ” Product ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ ì…ë‹ˆë‹¤. Creator í´ë˜ìŠ¤ëŠ” ìƒˆë¡œìš´ product ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” íŒ©í† ë¦¬ ë©”ì†Œë“œë¥¼ ì„ ì–¸í•©ë‹ˆë‹¤. ì¤‘ìš”í•œ ì ì€ ì´ ë©”ì†Œë“œì˜ ë¦¬í„´ íƒ€ì…ì´ product ì¸í„°í˜ì´ìŠ¤ì™€ ì¼ì¹˜í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. Concreate CreatorsëŠ” ë‹¤ë¥¸ íƒ€ì…ì˜ productë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆë„ë¡ ê¸°ë³¸ íŒ©í† ë¦¬ ë©”ì†Œë“œë¥¼ ì¬ì •ì˜ í•©ë‹ˆë‹¤.ì ìš© ê°€ëŠ¥í•œ ê²½ìš° ì½”ë“œê°€ ë™ì‘í•´ì•¼ í•˜ëŠ” ê°ì²´ì˜ ìœ í˜•ê³¼ ì¢…ì†ì„±ì„ ë¯¸ë¦¬ ì•Œìˆ˜ ì—†ëŠ” ê²½ìš° ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜¹ì€ í”„ë ˆì„ì›Œí¬ ì‚¬ìš©ìì—ê²Œ êµ¬ì„± ìš”ì†Œë¥¼ í™•ì¥í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•˜ë ¤ëŠ” ê²½ìš° ê¸°ì¡´ ê°ì²´ë¥¼ ì¬êµ¬ì„±í•˜ëŠ” ëŒ€ì‹  ê¸°ì¡´ ê°ì²´ë¥¼ ì¬ì‚¬ìš©í•˜ì—¬ ë¦¬ì†ŒìŠ¤ë¥¼ ì ˆì•½í•˜ê³ ì í•˜ëŠ” ê²½ìš°ì¥ë‹¨ì ì¥ì  ìƒì„±ìì™€ êµ¬í˜„ í´ë˜ìŠ¤ì˜ ê²°í•©ì„ í”¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°ì²´ ìƒì„± ì½”ë“œë¥¼ í•œ ê³³ (íŒ¨í‚¤ì§€, í´ë˜ìŠ¤ ë“±)ìœ¼ë¡œ ì´ë™í•˜ì—¬ ì½”ë“œë¥¼ ìœ ì§€ë³´ìˆ˜í•˜ê¸° ì‰½ê²Œ í• ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ë§Œì¡±í•©ë‹ˆë‹¤. ê¸°ì¡´ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë¥¼ ê±´ë“œë¦¬ì§€ ì•Šê³  ìƒˆë¡œìš´ íƒ€ì…ì˜ ê°ì²´ë¥¼ ìƒì„±í• ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ê°œë°©/íì‡„ ì›ì¹™ì„ ë§Œì¡±í•©ë‹ˆë‹¤.ë‹¨ì  íŒ¨í„´ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ ë§ì€ ì„œë¸Œ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ êµ¬í˜„í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì½”ë“œì˜ ë³µì¡ì„±ì´ ì¦ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì˜ˆì œëª¨í˜•ì˜ íƒ€ì…ì— ë”°ë¼ ì–´ë–¤ ëª¨í˜•ì„ ìƒì„±í• ì§€ íŒ©í† ë¦¬ í´ë˜ìŠ¤ì—ì„œ ì •í• ìˆ˜ ìˆê²Œ ë˜ëŠ” ê°„ë‹¨í•œ ì˜ˆì œë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤.ì¼ë‹¨ ëª¨ì–‘ ì¸í„°í˜ì´ìŠ¤ì™€ ê·¸ êµ¬í˜„ì²´ë“¤ ì…ë‹ˆë‹¤.public interface Shape { void draw();}public class Square implements Shape{ @Override public void draw() { System.out.println(\"draw square\"); }}public class Rectangle implements Shape{ @Override public void draw() { System.out.println(\"draw rectangle\"); }}ë‹¤ìŒì€ íŒ©í† ë¦¬ ë©”ì†Œë“œ íŒ¨í„´ì˜ ê½ƒ íŒ©í† ë¦¬ í´ë˜ìŠ¤ ì…ë‹ˆë‹¤. getShape() ë©”ì†Œë“œëŠ” ëª¨í˜•ì˜ íƒ€ì…ì— ë”°ë¼ square í˜¹ì€ rectangle ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.public class ShapeFactory { public Shape getShape(String type) { if (\"SQUARE\".equalsIgnoreCase(type)) { return new Square(); } if (\"RECTANGLE\".equalsIgnoreCase(type)) { return new Rectangle(); } return null; }}ë§ˆì§€ë§‰ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ ì…ë‹ˆë‹¤. íŒ©í† ë¦¬ í´ë˜ìŠ¤ì— ì˜í•´ ì¡°ê±´ì— ë§ëŠ” ëª¨í˜• ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  draw() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.public class FactoryMethodClient { public static void main(String[] args) { ShapeFactory shapeFactory = new ShapeFactory(); Shape s1 = shapeFactory.getShape(\"SQUARE\"); s1.draw(); Shape s2 = shapeFactory.getShape(\"RECTANGLE\"); s2.draw(); }}ìƒˆë¡œìš´ ëª¨í˜•ì´ ìƒê¸´ë‹¤ í•˜ë”ë¼ë„ shape ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†í•˜ëŠ” ìƒˆë¡œìš´ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê³  íŒ©í† ë¦¬ í´ë˜ìŠ¤ì˜ getShape() ë©”ì†Œë“œë§Œ ìˆ˜ì •í•´ì£¼ë©´ ë˜ê¸° ë•Œë¬¸ì— ë‹¨ì¼ ì±…ì„ ì›ì¹™, ê°œë°©/íì‡„ ì›ì¹™ì„ ë§Œì¡±í•˜ê²Œ ë©ë‹ˆë‹¤.ê²°ë¡ íŒ©í† ë¦¬ ë©”ì†Œë“œ íŒ¨í„´ì„ ì‚¬ìš©í•˜ëŠ” ê¶ê·¹ì ì¸ ì´ìœ ëŠ” í´ë˜ìŠ¤ê°„ì˜ ê²°í•©ë„ë¥¼ ëŠìŠ¨í•˜ê²Œ ê°€ì ¸ê°€ê²Œ í•˜ê¸° ìœ„í•¨ ì…ë‹ˆë‹¤. íŒ©í† ë¦¬ í´ë˜ìŠ¤ë¥¼ í†µí•´ ê°ì²´ ìƒì„± ì½”ë“œë¥¼ í•œê³³ì— ëª¨ì´ê²Œ í•¨ìœ¼ë¡œì¨ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì§ì ‘ ê°ì²´ë¥¼ ìƒì„±í•˜ì§€ ì•Šì•„ë„ ë˜ë¯€ë¡œ ì½”ë“œë¥¼ ë³´ë‹¤ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.í•˜ì§€ë§Œ ì„¤ê³„ì— ë”°ë¼ ì„œë¸Œ í´ë˜ìŠ¤ê°€ ë§ì´ ìƒì„±ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì½”ë“œ ë³µì¡ë„ëŠ” ì˜¬ë¼ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë‹¤ë¥¸ íŒ¨í„´ë“¤ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì˜¬ë°”ë¥¸ ì„¤ê³„ê°€ í•„ìš”í•©ë‹ˆë‹¤.ì°¸ì¡° https://refactoring.guru/design-patterns/factory-method" }, { "title": "ì „ëµ íŒ¨í„´ (Strategy Pattern)", "url": "/posts/strategy-pattern/", "categories": "Design Pattern", "tags": "Design Pattern, Java", "date": "2021-09-18 20:12:00 +0900", "snippet": "ì „ëµ íŒ¨í„´ì „ëµ íŒ¨í„´ì€ ì‹¤í–‰ ì¤‘ì— ì•Œê³ ë¦¬ì¦˜ì„ ì„ íƒí•  ìˆ˜ ìˆê²Œ í•˜ëŠ” í–‰ìœ„ ë””ìì¸ íŒ¨í„´ ì…ë‹ˆë‹¤. ì¦‰, ê°ê°ì˜ ê°ì²´ë“¤ì´ í•  ìˆ˜ ìˆëŠ” ë™ì‘ë“¤ì¼ ë¯¸ë¦¬ ì „ëµìœ¼ë¡œ ë§Œë“¤ì–´ ë†“ê³  ë™ì‘ì„ ë™ì ìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•œë‹¤ë©´ í•´ë‹¹ ì „ëµë§Œ ë³€ê²½í•˜ì—¬ ê°ì²´ì˜ ë™ì‘ì´ ë°”ë€Œë„ë¡ í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.êµ¬ì¡° ì»¨í…ìŠ¤íŠ¸ëŠ” ì „ëµ êµ¬í˜„ì²´ì¤‘ í•˜ë‚˜ì™€ ì°¸ì¡°ë¥¼ ìœ ì§€í•˜ê³  ì „ëµ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ì„œë§Œ ê°ì²´ì™€ í†µì‹ í•©ë‹ˆë‹¤. ì „ëµ ì¸í„°í˜ì´ìŠ¤ëŠ” ëª¨ë“  ì „ëµ êµ¬í˜„ì²´ì— ëŒ€í•œ ê³µìš© ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤. ì»¨í…ìŠ¤íŠ¸ê°€ ì „ëµì„ ì‹¤í–‰í•˜ëŠ”ë° ì‚¬ìš©í•˜ëŠ” ë©”ì†Œë“œë¥¼ ì„ ì–¸í•©ë‹ˆë‹¤. ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ëŠ” ì»¨í…ìŠ¤íŠ¸ê°€ ì‚¬ìš©í•˜ëŠ” ì•Œê³ ë¦¬ì¦˜ì˜ ë‹¤ë¥¸ ë²„ì „ì„ êµ¬í˜„í•©ë‹ˆë‹¤. ì»¨í…ìŠ¤íŠ¸ëŠ” ì•Œê³ ë¦¬ì¦˜ì„ ì‹¤í–‰í•´ì•¼ í•  ë•Œë§ˆë‹¤ í•´ë‹¹ ì•Œê³ ë¦¬ì¦˜ê³¼ ì—°ê²°ëœ ì „ëµ ê°ì²´ì˜ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ì»¨í…ìŠ¤íŠ¸ëŠ” ì–´ë–¤ ì „ëµì´ ë™ì‘í•˜ëŠ”ì§€, í˜¹ì€ ì–´ë–¤ ì•Œê³ ë¦¬ì¦˜ì´ ì‹¤í–‰ë˜ëŠ”ì§€ ì•Œ í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” íŠ¹ì • ì „ëµ ê°ì²´ë¥¼ ë§Œë“¤ì–´ ì»¨í…ìŠ¤íŠ¸ì— ì „ë‹¬í•©ë‹ˆë‹¤.ì ìš© ê°€ëŠ¥í•œ ê²½ìš° ê°ì²´ ë‚´ì—ì„œ ì„œë¡œ ë‹¤ë¥¸ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ê³  ëŸ°íƒ€ì„ì‹œ ë‹¤ë¥¸ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ì „í™˜í•˜ê³ ì í•˜ëŠ” ê²½ìš° ì¼ë¶€ í–‰ìœ„ë¥¼ ë™ì‘í•˜ëŠ” ë°©ë²•ë§Œ ë‹¤ë¥¸ ë¹„ìŠ·í•œ í´ë˜ìŠ¤ê°€ ë§ì€ ê²½ìš° ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì•Œê³ ë¦¬ì¦˜ì˜ ì„¸ë¶€ ë‚´ìš©ì—ì„œ ë¶„ë¦¬í•˜ê³ ì í•˜ëŠ” ê²½ìš°ì¥ë‹¨ì ì¥ì  ëŸ°íƒ€ì„ì— ê°ì²´ ë‚´ë¶€ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì•Œê³ ë¦¬ì¦˜ì„ ë°”ê¿€ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ëŠ” ì½”ë“œì—ì„œ ì´ë¥¼ êµ¬í˜„í•˜ëŠ” ì„¸ë¶€ ì •ë³´ë¥¼ ë¶„ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒì†ì„ êµ¬ì„±ìœ¼ë¡œ ëŒ€ì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ì¡´ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³  ìƒˆë¡œìš´ ì „ëµì„ ë„ì…í•¨ìœ¼ë¡œì¨ ê°œë°©/íì‡„ ì›ì¹™ì„ ë§Œì¡±í•©ë‹ˆë‹¤.ë‹¨ì  ì•Œê³ ë¦¬ì¦˜ì´ ë§ì§€ ì•Šê³  ìì£¼ ë³€ê²½ë˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ìƒˆë¡œìš´ í´ë˜ìŠ¤ì™€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ì–´ í”„ë¡œê·¸ë¨ì„ ë³µì¡í•˜ê²Œ ë§Œë“¤ ì´ìœ ê°€ ì—†ìŠµë‹ˆë‹¤. ê°œë°œìëŠ” ì ì ˆí•œ ì „ëµì„ ì„ íƒí•˜ê¸° ìœ„í•´ ì „ëµ ê°„ì˜ ì°¨ì´ì ì„ ì•Œê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ìµœì‹  í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì—ëŠ” í´ë˜ìŠ¤ ë° ì¸í„°í˜ì´ìŠ¤ë¥¼ ì¶”ê°€í•˜ì§€ ì•Šì•„ë„ ì „ëµ ê°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ë™ì¼í•œ íš¨ê³¼ë¥¼ ë‚¼ ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.ì˜ˆì œê²°ì œë¥¼ í• ìˆ˜ ìˆëŠ” í™˜ê²½ì´ PC / Mobile ë¡œ ë‚˜ë‰˜ì–´ì ¸ ìˆê³  ê°ê°ì˜ í™˜ê²½ì€ í•˜ë‚˜ì˜ ê²°ì œ ë°©ì‹ì„ ì„ íƒí• ìˆ˜ ìˆìœ¼ë©° ì´ë¥¼ ë°”ê¿€ìˆ˜ ìˆëŠ” ì˜ˆì œë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤.ì•„ë˜ ì½”ë“œëŠ” ê²°ì œ ì „ëµê³¼ ì´ë¥¼ êµ¬í˜„í•œ ì„¸ê°€ì§€ì˜ ê²°ì œ ë°©ì‹(í˜ì´) í´ë˜ìŠ¤ ì…ë‹ˆë‹¤.public interface PayStrategy { void pay(int amount);}public class NaverPay implements PayStrategy{ @Override public void pay(int amount) { System.out.println(\"ë„¤ì´ë²„ í˜ì´ë¡œ ê²°ì œ - ê¸ˆì•¡ : \" + amount); }}public class KakaoPay implements PayStrategy{ @Override public void pay(int amount) { System.out.println(\"ì¹´ì¹´ì˜¤ í˜ì´ë¡œ ê²°ì œ - ê¸ˆì•¡ : \" + amount); }}public class TossPay implements PayStrategy{ @Override public void pay(int amount) { System.out.println(\"í† ìŠ¤ í˜ì´ë¡œ ê²°ì œ - ê¸ˆì•¡ : \" + amount); }}ì•„ë˜ ì½”ë“œëŠ” ê²°ì œ ì „ëµì„ ë³€ìˆ˜ë¡œ ê°–ê³  setter() ë©”ì†Œë“œë¥¼ í†µí•´ ê²°ì œ ì „ëµì„ ì£¼ì…í•  ìˆ˜ ìˆëŠ” í´ë˜ìŠ¤ ì…ë‹ˆë‹¤. í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ í†µí•´ ê²°ì œ í™˜ê²½ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.public class PayEnvironment { private PayStrategy payStrategy; public void setPayStrategy(PayStrategy payStrategy) { this.payStrategy = payStrategy; } public void pay(int amount) { if (payStrategy != null) { payStrategy.pay(amount); } }}public class PC extends PayEnvironment {}public class Mobile extends PayEnvironment {}ë§ˆì§€ë§‰ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ ì…ë‹ˆë‹¤. ê²°ì œ í™˜ê²½ì— ë”°ë¼ ê²°ì œ ì „ëµì„ ì„ íƒí•  ìˆ˜ ìˆê³  íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ ê²°ì œ ì „ëµì„ ë³€ê²½í•©ë‹ˆë‹¤.public static void main(String[] args) { PayEnvironment pc = new PC(); PayEnvironment mobile = new Mobile(); pc.setPayStrategy(new KakaoPay()); mobile.setPayStrategy(new NaverPay()); pc.pay(10); mobile.pay(30); // ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ ê²°ì œ ì „ëµì„ ë³€ê²½í•œë‹¤. if (condition()) { mobile.setPayStrategy(new TossPay()); } mobile.pay(50);}public static boolean condition() { return true;}ê²°ë¡ ì „ëµ íŒ¨í„´ì€ í˜„ì—…ì—ì„œ ì•Œê²Œ ëª¨ë¥´ê²Œ ë§ì´ ì‚¬ìš©í•˜ê³  ìˆëŠ”ê²ƒ ê°™ìŠµë‹ˆë‹¤. ìš”ì¦˜ ìƒˆë¡œìš´ ì–¸ì–´ì—ì„œëŠ” ê¸°ë³¸ ê¸°ëŠ¥ìœ¼ë¡œë„ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìœ¼ë‹ˆ í•œë²ˆ ì°¾ì•„ ë³´ì‹œê¸¸ ì¶”ì²œ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.ì°¸ì¡° https://refactoring.guru/design-patterns/strategy" }, { "title": "ë¹Œë” íŒ¨í„´ (Builder Pattern)", "url": "/posts/builder-pattern/", "categories": "Design Pattern", "tags": "Design Pattern, Java", "date": "2021-09-04 20:12:00 +0900", "snippet": "ë¹Œë” íŒ¨í„´ë¹Œë” íŒ¨í„´ì€ ë³µí•© ê°ì²´ì˜ ìƒì„± ê³¼ì •ê³¼ í‘œí˜„ ë°©ë²•ì„ ë¶„ë¦¬í•˜ì—¬ ë™ì¼í•œ ìƒì„± ì ˆì°¨ì—ì„œ ì„œë¡œ ë‹¤ë¥¸ í‘œí˜„ ê²°ê³¼ë¥¼ ë§Œë“¤ìˆ˜ ìˆê²Œ í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤. ê°ì²´ë¥¼ ìƒì„±í• ë•Œ í”í•˜ê²Œ ì‚¬ìš©ë©ë‹ˆë‹¤.êµ¬ì¡° ë¹Œë” ì¸í„°í˜ì´ìŠ¤ëŠ” ëª¨ë“  ìœ í˜•ì˜ ë¹Œë”ì— ì‚¬ìš©ë˜ëŠ” ê³µí†µì ì¸ ë‹¨ê³„ë¥¼ ì„ ì–¸í•©ë‹ˆë‹¤. ë¹Œë” êµ¬í˜„ì²´ëŠ” ìƒì„± ë‹¨ê³„ì—ì„œ ì„œë¡œ ë‹¤ë¥¸ êµ¬í˜„ì²´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ êµ¬í˜„ì²´ëŠ” ê³µí†µ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë”°ë¥´ì§€ ì•ŠëŠ” ë‹¤ë¥¸ ë¹Œë”ë¥¼ ë§Œë“¤ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. Product1, Product2ëŠ” ê²°ê³¼ ê°ì²´ì…ë‹ˆë‹¤. ì´ë“¤ì€ ë™ì¼í•œ í´ë˜ìŠ¤ ê³„ì¸µ êµ¬ì¡°ë‚˜ ì¸í„°í˜ì´ìŠ¤ì— ì†í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. Director í´ë˜ìŠ¤ëŠ” ê°œë°œìê°€ íŠ¹ì • Productì˜ êµ¬ì„±ì„ ìƒì„±í•˜ê³  ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ìƒì„± ë‹¨ê³„ë¥¼ í˜¸ì¶œí•˜ëŠ” ìˆœì„œë¥¼ ì§€ì •í•©ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ í´ë˜ìŠ¤ëŠ” Director í´ë˜ìŠ¤ì™€ í•¨ê»˜ ë¹Œë” ê°ì²´ì¤‘ í•˜ë‚˜ì™€ ì—°ê²°ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.ì ìš© ê°€ëŠ¥í•œ ê²½ìš° ì ì¸µì  ìƒì„±ì ë¥¼ ì œê±°í•˜ê³ ì í•˜ëŠ” ê²½ìš° ë¹Œë” íŒ¨í„´ì„ ì‚¬ìš©í•˜ì„¸ìš”. ì ì¸µì  ìƒì„±ìë€ ì•„ë˜ ì˜ˆì œ ì½”ë“œì™€ ê°™ì´ ë¹„í•„ìˆ˜ ë§¤ê°œë³€ìˆ˜ê°€ ì—†ëŠ” ìƒì„±ìë¶€í„° í•„ìˆ˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ì „ë¶€ ë°›ëŠ” ìƒì„±ìê¹Œì§€ ìƒì„±ìì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ì ì¸µì ìœ¼ë¡œ ëŠ˜ë ¤ê°€ëŠ” íŒ¨í„´ì„ ëœ»í•©ë‹ˆë‹¤.ë¶ˆí•„ìš”í•œ ë°°ê°œë³€ìˆ˜ê¹Œì§€ ê°’ì„ ì§€ì •í•´ì•¼ í•˜ë©° ìƒì„±ì ìˆ˜ê°€ ë§ì•„ì§ˆìˆ˜ ìˆë‹¤ëŠ” ë‹¨ì ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.public class TelescopingConstructor { private String name; private String age; private String gender; private String job; private String birthday; private String address; public TelescopingConstructor(String name, String age) { this(name, age, \"unknown\"); } public TelescopingConstructor(String name, String age, String gender) { this(name, age, gender, \"unknown\"); } public TelescopingConstructor(String name, String age, String gender, String job) { this(name, age, gender, job, \"unknown\"); } public TelescopingConstructor(String name, String age, String gender, String job, String birthday) { this(name, age, gender, job, birthday, \"unknown\"); } public TelescopingConstructor(String name, String age, String gender, String job, String birthday, String address) { this.name = name; this.age = age; this.gender = gender; this.job = job; this.birthday = birthday; this.address = address; }}2. ë‹¹ì‹ ì˜ ì½”ë“œë¥¼ í†µí•´ ìƒí’ˆì„ ë‹¤ë¥¸ í‘œí˜„ ë°©ì‹ìœ¼ë¡œ ë§Œë“¤ê³  ì‹¶ì„ë•Œ ë¹Œë” íŒ¨í„´ì„ ì‚¬ìš©í•´ë³´ì„¸ìš”.3. ë³µì¡í•œ í´ë˜ìŠ¤ë‚˜ ì„œë¡œë‹¤ë¥¸ íŠ¸ë¦¬ë“¤ì„ ê²°í•©í•˜ì—¬ ê°ì²´ë¥¼ ìƒì„±í•˜ê³ ì í• ë•Œ ë¹Œë” íŒ¨í„´ì„ ì‚¬ìš©í•´ë³´ì„¸ìš”.ì¥ë‹¨ì ì¥ì  ê°ì²´ë¥¼ ë‹¨ê³„ë³„ë¡œ êµ¬ì„±í•˜ê±°ë‚˜ êµ¬ì„± ë‹¨ê³„ë¥¼ ì§€ì—°í•˜ê±°ë‚˜ ì¬ê·€ì ìœ¼ë¡œ ìƒì„±í• ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì œí’ˆì„ ë‹¤ì–‘í•œ ë°©ì‹ìœ¼ë¡œ í‘œí˜„í• ë•Œ ë™ì¼í•œ ìƒì„± ì½”ë“œë¥¼ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³µì¡í•œ êµ¬ì„±ì˜ ì½”ë“œë¥¼ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ìœ¼ë¡œ ë¶„ë¦¬í• ìˆ˜ ìˆìŒìœ¼ë¡œì¨ ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ë§Œì¡±í•©ë‹ˆë‹¤.ë‹¨ì  íŒ¨í„´ì„ ì ìš©ì‹œí‚¤ê³ ì í• ë•Œ Nê°œì˜ ìƒˆë¡œìš´ í´ë˜ìŠ¤ë¥´ ë§Œë“¤ì–´ì•¼ í•˜ë¯€ë¡œ ì½”ë“œì˜ ë³µì¡ì„±ì´ ì¦ê°€í•©ë‹ˆë‹¤. ìƒì„±ë¹„ìš© ìì²´ëŠ” í¬ì§€ ì•Šì§€ë§Œ ì„±ëŠ¥ì´ ì¤‘ìš”ì‹œë˜ëŠ” ìƒí™©ì´ ì˜¤ë©´ ë¬¸ì œê°€ ë ìˆ˜ ìˆìŠµë‹ˆë‹¤.vs Java Beans Patternë¹ˆ ê°ì²´ ìƒì„±í›„ setter ë©”ì†Œë“œë¥¼ ì´ìš©í•œ ê°’ì˜ ì£¼ì…ì„ ìë°” ë¹ˆ íŒ¨í„´ì´ë¼ê³  í•©ë‹ˆë‹¤. ì´ëŠ” ì‹¤ë¬´ì—ì„œë„ ìì£¼ ë³¼ìˆ˜ìˆëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.í•˜ì§€ë§Œ ê°ì²´ ìƒì„± ì‹œì ì— ëª¨ë“  ê°’ë“¤ì„ ì£¼ì…í•˜ì§€ ì•Šì•„ ì–´ëŠ ì‹œì ì— ê°ì²´ì˜ ê°’ì´ ë³€ê²½ë ì§€ ì•Œìˆ˜ ì—†ì–´ ìœ ì§€ë³´ìˆ˜ì‹œ ì¥ì• ë¬¼ì´ ë ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜ ì¼ì¼íˆ setter ë©”ì†Œë“œë¥¼ ì •ì˜í•´ì¤˜ì•¼ í•œë‹¤ëŠ” ë‹¨ì ë„ ìˆìŠµë‹ˆë‹¤. (ë¡¬ë³µì´ë¼ëŠ” í›Œë¥­í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìˆê¸´ í•˜ì§€ìš”â€¦)ì´ëŸ° ì €ëŸ° ì´ìœ ë¡œ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ì‹œì ì— ëª¨ë“  ê°’ì„ ì£¼ì…í•˜ì—¬ ë¶ˆë³€ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ë¹Œë” íŒ¨í„´ì´ ë” ê°ì²´ì§€í–¥ì ì¸ íŒ¨í„´ì´ë¼ê³  í• ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤.ì˜ˆì œì‚¬ëŒì„ ë¹Œë” íŒ¨í„´ì„ ì´ìš©í•´ ë§Œë“œëŠ” ì˜ˆì œì…ë‹ˆë‹¤. í•„ìˆ˜ ì •ë³´ëŠ” Builder() ìƒì„±ìì— í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.public class Person { private String name; private String age; private String gender; private String job; private String birthday; private String address; public static class Builder { // í•„ìˆ˜ private String name; private String age; // ë¹„í•„ìˆ˜ìˆ˜ private String gender; private String job; private String birthday; private String address; public Builder(String name, String age) { this.name = name; this.age = age; } public Builder gender(String gender) { this.gender = gender; return this; } public Builder job(String job) { this.job = job; return this; } public Builder birthday(String birthday) { this.birthday = birthday; return this; } public Builder address(String address) { this.address = address; return this; } public Person build() { return new Person(this); } } public Person(Builder builder) { this.name = builder.name; this.age = builder.age; this.gender = builder.gender; this.job = builder.gender; this.birthday = builder.birthday; this.address = builder.address; } @Override public String toString() { return \"Person{\" + \"name='\" + name + '\\'' + \", age='\" + age + '\\'' + \", gender='\" + gender + '\\'' + \", job='\" + job + '\\'' + \", birthday='\" + birthday + '\\'' + \", address='\" + address + '\\'' + '}'; }}í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì™€ ê²°ê³¼ì…ë‹ˆë‹¤. ê°’ì„ ì§€ì •í•˜ì§€ ì•Šì€ í•„ë“œëŠ” null ë¡œ ì¶œë ¥ë˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.public class BuilderClient { public static void main(String[] args) { Person person = new Person .Builder(\"keencho\", \"20\") .gender(\"man\") .job(\"developer\") .build(); System.out.println(person.toString()); }}Person{name='keencho', age='20', gender='man', job='man', birthday='null', address='null'}ê°„ë‹¨í•œ ë¹Œë” íŒ¨í„´ ì˜ˆì œì…ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ë©”ì†Œë“œë¥¼ í•˜ë‚˜í•˜ë‚˜ ë§Œë“¤ì—ˆì§€ë§Œ ì €ëŠ” ì£¼ë¡œ ë¡¬ë³µ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ @Builder ì–´ë…¸í…Œì´ì…˜ì„ ë§ì´ ì‚¬ìš©í•˜ëŠ” í¸ì…ë‹ˆë‹¤.ê²°ë¡ ë¹Œë” íŒ¨í„´ì€ ìƒì„± íŒ¨í„´ì¤‘ì˜ í•˜ë‚˜ë¡œ ìë°”ë¹ˆ íŒ¨í„´ì˜ ë‹¨ì ì„ ë³´ì™„í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤. ë§ì´ ì‚¬ìš©ë˜ëŠ” íŒ¨í„´ì¤‘ í•˜ë‚˜ì´ì§€ë§Œ ì„±ëŠ¥ì— ë¯¼ê°í•œ ìƒí™©ì´ ë˜ë©´ ë¬¸ì œê°€ ë ìˆ˜ ìˆê³  í´ë˜ìŠ¤ëŠ” ì‹œê°„ì´ ê°ˆìˆ˜ë¡ ì»¤ì§€ëŠ” ê²½í–¥ì´ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜í•˜ì—¬ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.ì°¸ì¡° https://refactoring.guru/design-patterns/builder" }, { "title": "ë¦¬ì•¡íŠ¸ì—ì„œ í´ë” êµ¬ì¡°ëŒ€ë¡œ ë¼ìš°íŒ…í•˜ê¸° (feat. Vite)", "url": "/posts/react-vite-routing/", "categories": "React", "tags": "React, Vite", "date": "2021-08-28 20:12:00 +0900", "snippet": "Next js ì²˜ëŸ¼ ë¼ìš°íŒ…í•˜ê¸°Next jsëŠ” ë¦¬ì•¡íŠ¸ì—ì„œ SSRì„ ì‰½ê²Œ êµ¬í˜„í• ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì…ë‹ˆë‹¤. Nextì˜ íŒŒì¼ ì‹œìŠ¤í…œì„ ê¸°ë°˜ìœ¼ë¡œí•œ ë¼ìš°íŒ… ì„ ê¸°ë³¸ìœ¼ë¡œ í•˜ê³  ìˆìŠµë‹ˆë‹¤. (ì°¸ì¡°)ì˜¤ëŠ˜ì€ Next ì—†ì´ Nextì™€ ê°™ì€ ë¼ìš°íŒ…ì„ êµ¬í˜„í•´ë³´ê³ ì í•©ë‹ˆë‹¤.CSRë¡œ êµ¬í˜„í•˜ê¸°?ë¦¬ì•¡íŠ¸ëŠ” lazy ì™€ Suspense APIë¡œ ë™ì  ë¡œë”©ì„ ì§€ì›í•˜ê³  ìˆê¸°ëŠ” í•©ë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•´ ì‰½ê²Œ êµ¬í˜„í• ìˆ˜ë„ ìˆì§€ìš”. ë˜ ì´ëŸ° ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ ìˆìŠµë‹ˆë‹¤.í•˜ì§€ë§Œ ê²°êµ­ ì´ëŠ” í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ì•±ì´ ì‹œì‘ë ë•Œ ë¼ìš°íŒ… ê·œì¹™ì´ ìƒì„±ë˜ê¸° ë•Œë¬¸ì— ë­”ê°€ ì œ ë§ˆìŒì— ì© ë“¤ì§€ëŠ” ì•Šì•˜ìŠµë‹ˆë‹¤.Viteì‚¬ì‹¤ ì´ í¬ìŠ¤íŒ…ì˜ ëª©ì ì€ í´ë” êµ¬ì¡°ëŒ€ë¡œ ë¼ìš°íŒ…ì´ ì•„ë‹Œ ìµœê·¼ì— ê´€ì‹¬ìˆê²Œ ì§€ì¼œë³´ê³  ìˆëŠ” Vite ë¼ëŠ” ë¹Œë“œ íˆ´ì— ëŒ€í•´ ì •ë¦¬í•˜ê³ ì í•˜ëŠ”ê²ƒì´ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ Viteì˜ docsë¥¼ ì½ì–´ë³´ëŠ” ë„ì¤‘ í´ë” êµ¬ì¡°ëŒ€ë¡œ ë¼ìš°íŒ…í•˜ëŠ” ë°©ë²•ì„ ì°¾ì•˜ê³ , í¬ìŠ¤íŒ…ì˜ ëª©ì ì„ ë°”ê¾¸ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.Viteë€?ì¼ë‹¨ Viteì— ëŒ€í•´ ì¡°ê¸ˆë§Œ ì•Œì•„ë³´ê³  ë„˜ì–´ê°€ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ViteëŠ” Vue jsì˜ ê°œë°œìì¸ Evan Youê°€ ê°œë°œí•œ ë¹Œë“œ íˆ´ì…ë‹ˆë‹¤. Webpack ì´ë‚˜ Snowpackê°™ì€ íˆ´ì´ì§€ìš”. (Snowpackì— ë” ê°€ê¹ê¸´ í•©ë‹ˆë‹¤.) 2021ë…„ 8ì›” ê¸°ì¤€ ê¹ƒí—™ ìŠ¤íƒ€ë„ 31.3k ì •ë„ë¡œ í•«í•œ ë¹Œë“œíˆ´ì…ë‹ˆë‹¤.ViteëŠ” ëª¨ë˜ ë¸Œë¼ìš°ì €ì—ì„œ ì§€ì›í•˜ëŠ” &lt;script module&gt; ì„ ì´ìš©í•´ ê°œë°œí™˜ê²½ êµ¬ë™ì‹œ í•„ìš”í•œ ëª¨ë“ˆë§Œ ë¶ˆëŸ¬ì™€ì„œ ì‹¤í–‰í•˜ê³  ì‹¤ì œ ì„œë¹„ìŠ¤ ë¹Œë“œì‹œì—ëŠ” Rollupìœ¼ë¡œ ë²ˆë“¤ë§í•´ì£¼ëŠ” íˆ´ì…ë‹ˆë‹¤. ì§ì ‘ ì ìš©í•´ì„œ ì‹œì‘í•´ë³´ë©´ ì‹œì‘ì†ë„ê°€ êµ‰ì¥íˆ ë¹ ë¥¸ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë¿ë§Œ ì•„ë‹ˆë¼ ìˆ˜ì •ì‹œ ìˆ˜ì •í•œê³³ë§Œ ë‹¤ì‹œ ë¦¬ë¡œë“œí•´ì„œ ë³´ì—¬ì£¼ë¯€ë¡œ ë¦¬ë¡œë”© ì†ë„ë„ êµ‰ì¥íˆ ë¹ ë¥¸í¸ì…ë‹ˆë‹¤. ë˜í•œ SSRë„ ì§€ì›í•©ë‹ˆë‹¤.Webpackì„ ëŒ€ì²´í• ìˆ˜ ìˆì–´? ë¼ê³  ë¬¼ìœ¼ì‹ ë‹¤ë©´ ì´ë¯¸ Webpackì„ ê¸°ë°˜ìœ¼ë¡œí•œ ì—¬ëŸ¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì´ ë§ê³  ViteëŠ” IE11ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë“± ì—¬ëŸ¬ ë¬¸ì œê°€ ìˆì–´ ì•„ì§ì€ ì‹œê¸°ìƒì¡°ë¼ê³  ìƒê°ë˜ë‚˜ ì¶”í›„ ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë” ê°œë°œëœë‹¤ë©´ì¶©ë¶„íˆ ëŒ€ì²´í• ìˆ˜ ìˆë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.íŒŒì¼ ì‹œìŠ¤í…œ ê¸°ë°˜ ë¼ìš°íŒ…Viteì— ëŒ€í•´ ëŒ€ì¶© í›‘ì–´ë´¤ìœ¼ë‹ˆ ì‹¤ì œë¡œ Viteë¥¼ ì´ìš¯ì•  ë¦¬ì•¡íŠ¸ì•±ì„ ë§Œë“¤ê³  íŒŒì¼ ì‹œìŠ¤í…œ ê¸°ë°˜ ë¼ìš°íŒ…ì„ ì ìš©í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ìµœì¢…ì ì¸ ë¼ìš°íŒ… ëª©í‘œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ì¸ë±ìŠ¤ ë¼ìš°íŒ… src/pages/index.tsx -&gt; â€˜â€™, â€˜/â€™ src/pages/user/index.tsx -&gt; â€˜/userâ€™ ì¤‘ì²© ë¼ìš°íŒ… src/pages/user/list.tsx -&gt; â€˜user/listâ€™ ë™ì  ë¼ìš°íŒ… src/pages/user/[id].tsx -&gt; â€˜/user/12â€™, â€˜user/34â€™ ì‹œì‘í•˜ê¸°ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ Viteë¥¼ ì´ìš©í•´ ë¦¬ì•¡íŠ¸ - íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì•±ì„ ìƒì„±í•©ë‹ˆë‹¤.npm init vite@latest react-app --template react-tsê·¸ë¦¬ê³  react-router-domì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.npm install react-router-dom @types/react-router-domë¼ìš°íŒ… ê·œì¹™ ì •ì˜í•˜ê¸°Viteì˜ glob import APIë¥¼ ì‚¬ìš©í•˜ì—¬ glob íŒ¨í„´ìœ¼ë¡œ ë¼ìš°íŒ… ê·œì¹™ì„ ì •ì˜í•´ë³´ê² ìŠµë‹ˆë‹¤. Viteì˜ globì€ fast-glob ê³¼ ì¼ì¹˜í•˜ë©°globì—ì„œ ì§€ì›í•˜ëŠ” ê·œì¹™ì„ ì•Œê³  ì‹¶ìœ¼ì‹œë©´ ì—¬ê¸° ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.import.meta.globEager ë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ê¸°ë°©ì‹ìœ¼ë¡œ src/pages í´ë” ë‚´ë¶€ì— ìˆê³  í™•ì¥ìê°€ .tsxì¸ ì»´í¬ë„ŒíŠ¸ë“¤ì„ ê°€ì ¸ì™€ ë³€ìˆ˜ì— ì €ì¥í•˜ê² ìŠµë‹ˆë‹¤.const COMPONENTS = import.meta.globEager('/src/pages/**/[a-z[]*.tsx')ìœ„ íŒ¨í„´ì€ íŒŒì¼ ì´ë¦„ì´ ì†Œë¬¸ì a-z ë¡œ ì‹œì‘í•˜ê±°ë‚˜ ì¤‘ê´„í˜¸ [ ë¡œ ì‹œì‘í•˜ë©° í™•ì¥ìëŠ” tsxì¸ íŒŒì¼ë“¤ì„ ëª¨ë‘ ì°¾ì•„ì˜µë‹ˆë‹¤..map ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´ COMPONENTSë¥¼ ìˆœíšŒí•˜ë©° ê²½ë¡œ(path) ì™€ ì»´í¬ë„ŒíŠ¸ë¥¼ ê°’ìœ¼ë¡œ ê°€ì§€ëŠ” componentsë³€ìˆ˜ë¥¼ ì •ì˜í•˜ê² ìŠµë‹ˆë‹¤.const components = Object.keys(COMPONENTS).map((component) =&gt; { const path = component .replace(/\\/src\\/pages|index|\\.tsx$/g, '') .replace(/\\[\\.{3}.+\\]/, '*') .replace(/\\[(.+)\\]/, ':$1') return { path, component: COMPONENTS[component].default }})ìœ„ ê·œì¹™ìœ¼ë¡œ ì •ì˜í•œ components ë³€ìˆ˜ì˜ ê°’ì€ ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.components = [ { path: \"/\", component: f App() }, { path: \"/user\", component: f UserList() }, { path: \"/user/:id }, component: f UserDetail() }]ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ components ë³€ìˆ˜ë¥¼ ìˆœíšŒí•˜ë©° ë¦¬ì•¡í„° ë¼ìš°íŠ¸ë¥¼ ì •ì˜í•˜ì—¬ ë¦¬í„´í•˜ëŠ” Routes() ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.export const Routes = () =&gt; { return ( &lt;App&gt; &lt;Switch&gt; {components.map(({ path, component: Component = Fragment }) =&gt; ( &lt;Route key={path} path={path} component={Component} exact={true} /&gt; ))} &lt;/Switch&gt; &lt;/App&gt; )}404 ì •ì˜í•˜ê¸°ì¶”ê°€ì ìœ¼ë¡œ ë¼ìš°í„°ì— ë“±ë¡ëœ ì»´í¬ë„ŒíŠ¸ê°€ ì•„ë‹ ê²½ìš° 404 í˜ì´ì§€ë¥¼ ë¦¬í„´í•˜ë„ë¡ í•´ë³´ê² ìŠµë‹ˆë‹¤. ìœ„ components ë³€ìˆ˜ì™€ ê°™ì´ _app.tsxì™€ 404.tsxì˜ ê²½ë¡œë¥¼ ì €ì¥í•˜ëŠ” ë³€ìˆ˜ë¥¼ ì •ì˜í•˜ê² ìŠµë‹ˆë‹¤.const BASIC = import.meta.globEager('/src/pages/(_app|404).tsx')_app.tsxì™€ 404.tsxì˜ ì»´í¬ë„ŒíŠ¸ë¥¼ ì €ì¥í•˜ëŠ” basics ë³€ìˆ˜ë¥¼ ì •ì˜í•˜ê² ìŠµë‹ˆë‹¤.const basics = Object.keys(BASIC).reduce((basic, file) =&gt; { const key = file.replace(/\\/src\\/pages\\/|\\.tsx$/g, '') return { ...basic, [key]: BASIC[file].default }}, {})ì, ì´ì œ ìœ„ì—ì„œë§Œë“  Routes() ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚´ì§ ë³€ê²½í•˜ê² ìŠµë‹ˆë‹¤.export const Routes = () =&gt; { const App = basics?.['_app'] || Fragment const NotFound = basics?.['404'] || Fragment return ( &lt;App&gt; &lt;Switch&gt; {components.map(({ path, component: Component = Fragment }) =&gt; ( &lt;Route key={path} path={path} component={Component} exact={true} /&gt; ))} &lt;Route path=\"*\" component={NotFound} /&gt; &lt;/Switch&gt; &lt;/App&gt; )}ë§Œì•½ basics ë³€ìˆ˜ì— í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ê°€ ì—†ë‹¤ë©´ ë¦¬ì•¡íŠ¸ì˜ Fragmentê°€ ì“°ì´ê²Œ ë©ë‹ˆë‹¤.ìµœì¢… ì½”ë“œëª¨ë‘ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ìµœì¢… ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.// src/routes.tsximport React, { Fragment } from 'react'import { Switch, Route } from 'react-router-dom'const BASIC: Record&lt;string, { [key: string]: any }&gt; = import.meta.globEager('/src/pages/(_app|404).tsx')const COMPONENTS: Record&lt;string, { [key: string]: any }&gt; = import.meta.globEager('/src/pages/**/[a-z[]*.tsx')const basics = Object.keys(BASIC).reduce((basic, file) =&gt; { const key = file.replace(/\\/src\\/pages\\/|\\.tsx$/g, '') return { ...basic, [key]: BASIC[file].default }}, {})const components = Object.keys(COMPONENTS).map((component) =&gt; { const path = component .replace(/\\/src\\/pages|index|\\.tsx$/g, '') .replace(/\\[\\.{3}.+\\]/, '*') .replace(/\\[(.+)\\]/, ':$1') return { path, component: COMPONENTS[component].default }})export const Routes = () =&gt; { const App = basics?.['_app'] || Fragment const NotFound = basics?.['404'] || Fragment return ( &lt;App&gt; &lt;Switch&gt; {components.map(({ path, component: Component = Fragment }) =&gt; ( &lt;Route key={path} path={path} component={Component} exact={true} /&gt; ))} &lt;Route path=\"*\" component={NotFound} /&gt; &lt;/Switch&gt; &lt;/App&gt; )}// main.tsximport React, { StrictMode } from 'react'import ReactDOM from 'react-dom'import { BrowserRouter } from 'react-router-dom'import { Routes } from './routes'ReactDOM.render( &lt;StrictMode&gt; &lt;BrowserRouter basename='/finance'&gt; &lt;Routes /&gt; &lt;/BrowserRouter&gt; &lt;/StrictMode&gt;, document.getElementById('root'))íŒŒì¼ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.â”œâ”€â”€ index.htmlâ”œâ”€â”€ index.cssâ”œâ”€â”€ package.jsonâ”œâ”€â”€ package-lock.jsonâ”œâ”€â”€ tsconfig.jsonâ””â”€â”€ src â”œâ”€â”€ pages â”‚ â”œâ”€â”€ 404.tsx â”‚ â”œâ”€â”€ _app.tsx â”‚ â””â”€â”€ user â”‚ â”œâ”€â”€ index.tsx â”‚ â””â”€â”€ [id].tsx â”œâ”€â”€ main.tsx â”œâ”€â”€ routes.tsx â””â”€â”€ vite-env.d.tsxê²°ë¡ Vite ì™€ globEager ë¥¼ ì‚¬ìš©í•´ íŒŒì¼ ì‹œìŠ¤í…œì„ ê¸°ë°˜ìœ¼ë¡œí•œ ë¼ìš°íŒ…ì„ ì ìš©í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ì ìš©í•˜ê³  ë‚˜ë‹ˆ ì°¸ í¸ë¦¬í•œê²ƒ ê°™ìŠµë‹ˆë‹¤. ì´ê³³ì—ì„œ Viteì— ëŒ€í•´ ìì„¸íˆ ë‹¤ë£¨ì§€ëŠ” ì•Šì•˜ì§€ë§Œê°œì¸ì ìœ¼ë¡œ ì•ìœ¼ë¡œì˜ í† ì´ í”„ë¡œì íŠ¸ì—ëŠ” Viteë¥¼ ì£¼ë¡œ ì‚¬ìš©í• ê²ƒ ê°™ìŠµë‹ˆë‹¤. í† ì´ í”„ë¡œì íŠ¸ë¥¼ Reactë‚˜ Vue (AngularëŠ” ì•„ì§ì…ë‹ˆë‹¤â€¦) ë¡œ êµ¬ì„±í•  ê³„íšì´ ìˆìœ¼ì‹  ë¶„ë“¤ì´ë©´ í•œë²ˆ ì‚¬ìš©í•´ ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤." }, { "title": "ì–´ëŒ‘í„° íŒ¨í„´ (Adapter Pattern)", "url": "/posts/adapter-pattern/", "categories": "Design Pattern", "tags": "Design Pattern, Java", "date": "2021-08-21 20:12:00 +0900", "snippet": "ì–´ëŒ‘í„° íŒ¨í„´ì–´ëŒ‘í„° íŒ¨í„´ì€ í´ë˜ìŠ¤ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©ìê°€ ê¸°ëŒ€í•˜ëŠ” ë‹¤ë¥¸ ì¸í„°í˜ì´ìŠ¤ë¡œ ë³€í™˜í•˜ëŠ” íŒ¨í„´ìœ¼ë¡œ, í˜¸í™˜ì„±ì´ ì—†ëŠ” ì¸í„°í˜ì´ìŠ¤ ë•Œë¬¸ì— í•¨ê»˜ ë™ì‘í•  ìˆ˜ ì—†ëŠ” í´ë˜ìŠ¤ë“¤ì´ í•¨ê»˜ ë™ì‘í•˜ë„ë¡ í•´ì£¼ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.êµ¬ì¡°ê°ì²´ ì–´ëŒ‘í„° í´ë¼ì´ì–¸íŠ¸ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í¬í•¨í•˜ê³  ìˆëŠ” í´ë˜ìŠ¤ì…ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ ì¸í„°í˜ì´ìŠ¤ëŠ” ë‹¤ë¥¸ í´ë˜ìŠ¤ê°€ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì™€ í˜‘ë ¥í•  ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•´ ë”°ë¼ì•¼ í•˜ëŠ” í”„ë¡œí† ì½œì„ ì„¤ëª…í•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ëŠ” ìœ ìš©í•œ í´ë˜ìŠ¤(ëŒ€ì²´ì ìœ¼ë¡œ ì¨ë“œíŒŒí‹° í˜¹ì€ ë ˆê±°ì‹œ ì½”ë“œ) ì…ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” í˜¸í™˜ë˜ì§€ ì•ŠëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì— ì´ í´ë˜ìŠ¤ë¥¼ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì–´ëŒ‘íŠ¸ëŠ” í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë¹„ìŠ¤ ëª¨ë‘ì—ì„œ ì‘ë™í•  ìˆ˜ ìˆëŠ” í´ë˜ìŠ¤ì…ë‹ˆë‹¤. ì´ í´ë˜ìŠ¤ëŠ” ì„œë¹„ìŠ¤ ê°ì²´ë¥¼ ê°ì‹¸ëŠ” ë™ì•ˆ í´ë¼ì´ì–¸íŠ¸ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ ì½”ë“œëŠ” í´ë¼ì´ì–¸íŠ¸ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì–´ëŒ‘í„°ì™€ ì‘ë™í•˜ê¸° ë•Œë¬¸ì— ì–´ëŒ‘í„° í´ë˜ìŠ¤ì™€ ê²°í•©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.í´ë˜ìŠ¤ ì–´ëŒ‘í„° í´ë˜ìŠ¤ ì–´ëŒ‘í„°ëŠ” í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë¹„ìŠ¤ì˜ ë™ì‘ì„ ì§ì ‘ ìƒì†í•˜ë¯€ë¡œ ê°ì²´ë¥¼ ê°ìŒ€ í•„ìš”í•™ ì—†ìŠµë‹ˆë‹¤.ì ìš© ê°€ëŠ¥í•œ ê²½ìš° ë ˆê±°ì‹œ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ì§€ë§Œ ìƒˆë¡œìš´ ì¸í„°í˜ì´ìŠ¤ê°€ ë ˆê±°ì‹œ ì½”ë“œì™€ í˜¸í™˜ë˜ì§€ ì•Šì„ ë•Œ ì–´ëŒ‘í„° í´ë˜ìŠ¤ë¥¼ ê³ ë ¤í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìŠˆí¼í´ë˜ìŠ¤ì— ì¶”ê°€í•  ìˆ˜ ì—†ëŠ” ì¼ë¶€ ê³µí†µ ê¸°ëŠ¥ì´ ì—†ëŠ” ê¸°ì¡´ ì„œë¸Œ í´ë˜ìŠ¤ë¥¼ ì¬ì‚¬ìš©í•˜ë ¤ë©´ ì´ íŒ¨í„´ì„ ì‚¬ìš©í•´ë³´ì„¸ìš”.ì¥ë‹¨ì ì¥ì  ì¸í„°í˜ì´ìŠ¤ ë˜ëŠ” ë°ì´í„° ë³€í™˜ ì½”ë“œë¥¼ í”„ë¡œê·¸ë¨ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë¶„ë¦¬í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ë§Œì¡±í•©ë‹ˆë‹¤. ê¸°ì¡´ í´ë¼ì´ì–¸íŠ¸ì˜ ì½”ë“œë¥¼ ê±´ë“¤ì§€ ì•Šê³  í´ë¼ì´ì–¸íŠ¸ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì–´ëŒ‘í„°ì™€ ì‘ë™í•˜ê¸° ë•Œë¬¸ì— ê³„ë°©/íì‡„ ì›ì¹™ì„ ë§Œì¡±í•©ë‹ˆë‹¤.ë‹¨ì  ìƒˆë¡œìš´ ì¸í„°í˜ì´ìŠ¤ì™€ í´ë˜ìŠ¤ ì„¸íŠ¸ë¥¼ êµ¬í˜„í•´ì•¼ í•˜ê¸° ë•œëˆ„ì— ì½”ë“œì˜ ë³µì¡ì„±ì´ ì¦ê°€í•©ë‹ˆë‹¤. ë‚˜ë¨¸ì§€ ì½”ë“œì™€ ì˜ ì‘ë™í•˜ë„ë¡ ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ë¥¼ ì§ì ‘ ë³€ê²½í•˜ëŠ” ê²ƒì´ ì˜¤íˆë ¤ ë” ê°„ë‹¨í• ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì˜ˆì œëª¨ë‹ˆí„°ì™€ TVë¥¼ ì»¨íŠ¸ë¡¤í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤. ëª¨ë‹ˆí„°ëŠ” on, offì˜ ê¸°ëŠ¥ì„ ê°€ì§€ê³ ìˆê³  TVëŠ” on, off, ë³¼ë¥¨ ì—…, ë³¼ë¥¨ ë‹¤ìš´ì˜ ê¸°ëŠ¥ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.public interface Monitor { void on(); void off();}public class LEDMonitor implements Monitor{ @Override public void on() { System.out.println(\"LED Monitor ON\"); } @Override public void off() { System.out.println(\"LED Monitor OFF\"); }}public class LCDMonitor implements Monitor{ @Override public void on() { System.out.println(\"LCD Monitor ON\"); } @Override public void off() { System.out.println(\"LCD Monitor OFF\"); }}public interface TV { void on(); void off(); void volumeUp(); void volumeDown();}public class LEDTV implements TV{ @Override public void on() { System.out.println(\"LED TV ON\"); } @Override public void off() { System.out.println(\"LED TV OFF\"); } @Override public void volumeUp() { System.out.println(\"LED TV VOLUME UP\"); } @Override public void volumeDown() { System.out.println(\"LED TV VOLUME DOWN\"); }}ê°„ë‹¨í•œ ì½”ë“œë¡œ ëª¨ë‹ˆí„°ì™€ TVë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ê·¼ë° ëª¨ë‹ˆí„°ë¡œ TVë¥¼ ë³¼ìˆ˜ ìˆë„ë¡ í•´ë‹¬ë¼ëŠ” ìš”ì²­ì‚¬í•­ì´ ìƒê²¼ìŠµë‹ˆë‹¤. ì–´ëŒ‘í„° í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë‹ˆí„°ì—ì„œ TVì˜ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ í•´ë³´ê² ìŠµë‹ˆë‹¤.public class MonitorAdapter implements TV{ Monitor monitor; public MonitorAdapter(Monitor monitor) { this.monitor = monitor; } @Override public void on() { monitor.on(); } @Override public void off() { monitor.off(); } @Override public void volumeUp() { throw new RuntimeException(\"ì§€ì›í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.\"); } @Override public void volumeDown() { throw new RuntimeException(\"ì§€ì›í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.\"); }}ëª¨ë‹ˆí„°ë¡œ TVì˜ on, off ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ì˜€ìœ¼ë‚˜, ë³¼ë¥¨ ì¡°ì ˆ ê´€ë ¨ ë¶€ë¶„ì€ ëª¨ë‹ˆí„° í•˜ë“œì›¨ì–´ ìƒìœ¼ë¡œ ì§€ì›í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì˜ˆì™¸ë¥¼ ë˜ì§ìœ¼ë¡œì¨ í•´ë‹¹ ë©”ì†Œë“œì˜ ê¸°ëŠ¥ì„ ì œí•œí•˜ì˜€ìŠµë‹ˆë‹¤.public class AdaptorClient { public static void main(String[] args) { LCDMonitor lcdMonitor = new LCDMonitor(); LEDMonitor ledMonitor = new LEDMonitor(); System.out.println(\"===========================\"); lcdMonitor.on(); lcdMonitor.off(); System.out.println(\"===========================\"); ledMonitor.on(); ledMonitor.off(); System.out.println(\"===========================\"); TV monitorTV = new MonitorAdapter(ledMonitor); ledMonitorTV.on(); ledMonitorTV.off(); ledMonitorTV.volumeUp(); ledMonitorTV.volumeDown(); System.out.println(\"===========================\"); }}===========================LCD Monitor ONLCD Monitor OFF===========================LED Monitor ONLED Monitor OFF===========================LED Monitor ONLED Monitor OFFException in thread \"main\" java.lang.RuntimeException: ì§€ì›í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.\tat sycho.java.pattern.adapter.MonitorAdapter.volumeUp(MonitorAdapter.java:23)\tat sycho.java.pattern.adapter.AdaptorClient.main(AdaptorClient.java:23)í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì…ë‹ˆë‹¤. ëª¨ë‹ˆí„° ì–´ëŒ‘í„° í´ë˜ìŠ¤ë¡œ TV ê¸°ëŠ¥ì„ í•˜ëŠ” ëª¨ë‹ˆí„°ë¥¼ ë§Œë“¤ì—ˆê³ , ë³¼ë¥¨ ì—… ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì ì§€ì›í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ì´ë¼ë©° ì—ëŸ¬ë¥¼ ë±‰ëŠ” ëª¨ìŠµê¹Œì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ê²°ë¡ ì–´ëŒ‘í„° íŒ¨í„´ì€ ë ˆê±°ì‹œ ì½”ë“œì—ì„œ ì‹ ê·œ ì½”ë“œë¡œì˜ ë³€í™˜ì„ ë„ëª¨í• ë•Œ ë„ì›€ì´ ë˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤. ë‹¤ë§Œ ì–´ëŒ‘í„° í´ë˜ìŠ¤ì˜ ìˆ˜ë§Œí¼ ì½”ë“œ ë³µì¡ì„±ì´ ì¦ê°€í•˜ê²Œ ë˜ëŠ” ê¼´ì´ë¯€ë¡œ ì—­ì‹œ ì˜¬ë°”ë¥¸ ì„¤ê³„ê°€ í•„ìš”í•©ë‹ˆë‹¤.ì°¸ì¡° https://refactoring.guru/design-patterns/adapterhttps://www.geeksforgeeks.org/adapter-pattern/" }, { "title": "í”„ë¡œí† íƒ€ì… íŒ¨í„´ (Prototype Pattern)", "url": "/posts/prototype-pattern/", "categories": "Design Pattern", "tags": "Design Pattern, Java", "date": "2021-08-05 20:12:00 +0900", "snippet": "í”„ë¡œí† íƒ€ì… íŒ¨í„´í”„ë¡œí† íƒ€ì… íŒ¨í„´ì€ ì›í˜•ì´ ë˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•´ ìƒˆë¡­ê²Œ ìƒì„±í•  ê°ì²´ì˜ ì¢…ë¥˜ë¥¼ ëª…ì‹œí•˜ì—¬ ìƒˆë¡œìš´ ê°ì²´ê°€ ìƒì„±ë  ì‹œì ì— ì¸ìŠ¤í„´ìŠ¤ì˜ íƒ€ì…ì´ ê²°ì •ë˜ë„ë¡ í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.êµ¬ì¡° ì„ì˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë³µì œí•˜ëŠ” ë©”ì†Œë“œë¥¼ ê°€ì§„ ì¸í„°í˜ì´ìŠ¤ì¸ Prototype ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ëŒ€ë‘ë¶„ì˜ ê²½ìš° ì´ ì¸í„°í˜ì´ìŠ¤ì—ëŠ” clone() ë©”ì†Œë“œ í•˜ë‚˜ë§Œ ì„ ì–¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤. Prototype ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ í´ë˜ìŠ¤ëŠ” ì›ë³¸ ê°ì²´ì˜ ë°ì´í„°ë¥¼ ë³µì‚¬í•˜ëŠ”ê²ƒ ë§ê³ ë„ ì—°ê²°ëœ ê°ì²´ì˜ ë³µì‚¬ì™€ ê´€ë ¨ëœ ì‘ì—…ì´ë‚˜ ì „ì˜ ì˜ì¡´ì„±ì—ì„œ ë²—ì–´ë‚˜ê²Œ í•˜ëŠ” ì‘ì—… ë“±ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” Prototype ì¸í„°í˜ì´ìŠ¤ë¥¼ ë”°ë¥´ëŠ” ëª¨ë“  ê°ì²´ë¥¼ ë³µì‚¬í•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì ìš© ê°€ëŠ¥í•œ ê²½ìš° ì½”ë“œê°€ ë³µì‚¬í•´ì•¼ í•˜ëŠ” êµ¬í˜„ í´ë˜ìŠ¤ì— ì˜ì¡´í•˜ì§€ ì•Šì•„ì•¼ í•˜ëŠ” ê²½ìš° í”„ë¡œí† íƒ€ì… íŒ¨í„´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš°ëŠ” ì½”ë“œê°€ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì¨ë“œíŒŒí‹° ì½”ë“œì™€ í•¨ê»˜ ì‘ë™í•  ê²½ìš° ë§ì´ ë°œìƒí•©ë‹ˆë‹¤. ê°ì²´ë¥¼ ì´ˆê¸°í™” í•˜ëŠ” ë°©ì‹ë§Œ ë‹¤ë¥¼ë¿ ì„œë¸Œí´ë˜ìŠ¤ì˜ ìˆ˜ë¥¼ ì¤„ì´ë ¤ëŠ” ê²½ìš° í”„ë¡œí† íƒ€ì… íŒ¨ë„¡ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì¥ë‹¨ì ì¥ì  êµ¬í˜„ í´ë˜ìŠ¤ì— ì§ì ‘ ì—°ê²°í•˜ì§€ ì•Šê³  ê°ì²´ë¥¼ ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”„ë¡œí† íƒ€ì…ì´ ë¯¸ë¦¬ ì •ì˜ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ì¤‘ë³µë˜ëŠ” ì´ˆê¸°í™” ì½”ë“œë¥¼ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³µì¡í•œ ì˜¤ë¸Œì íŠ¸ë¥¼ ë³´ë‹¤ í¸ë¦¬í•˜ê²Œ ë§Œë“¤ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë‹¨ì  ìˆœí™˜ ì°¸ì¡°ê°€ ìˆëŠ” ë³µì¡í•œ ê°ì²´ë¥¼ ë³µì œí•˜ëŠ” ê²ƒì€ ë§¤ìš° ê¹Œë‹¤ë¡œìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì˜ˆì œdbì—ì„œ ëª¨ë“  ìë™ì°¨ì˜ ì¢…ë¥˜ë¥¼ ê°€ì ¸ì™€ í´ë¼ì´ì–¸íŠ¸ì— ë³´ì—¬ì¤˜ì•¼í•˜ëŠ” í”„ë¡œê·¸ë¨ì´ ìˆë‹¤ê³  ê°€ì •í•´ ë³´ê² ìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” ê°„ë‹¨í•œ Car í´ë˜ìŠ¤ ì…ë‹ˆë‹¤.public class Car implements Cloneable { private List&lt;String&gt; carList; public Car() { this.carList = new ArrayList&lt;&gt;(); } public Car(List&lt;String&gt; carList) { this.carList = carList; } public List&lt;String&gt; getCarList() { return carList; } public void listAll() { // dbì—ì„œ ìë™ì°¨ì˜ ì¢…ë¥˜ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì½”ë“œ this.carList.add(\"truck\"); this.carList.add(\"suv\"); this.carList.add(\"sedan\"); this.carList.add(\"sports car\"); } @Override protected Object clone() throws CloneNotSupportedException { return new Car(new ArrayList&lt;&gt;(this.carList)); }}Cloneable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ì—¬ Car í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ì˜€ê³  clone() ë©”ì†Œë“œë¥¼ í†µí•´ ê¹Šì€ ë³µì‚¬ ë°©ì‹ìœ¼ë¡œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë³µì œí•˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.public class CarClient { public static void main(String[] args) throws CloneNotSupportedException { Car car = new Car(); car.listAll(); Car car2 = (Car) car.clone(); Car car3 = (Car) car.clone(); List&lt;String&gt; car2List = car2.getCarList(); List&lt;String&gt; car3List = car3.getCarList(); car2List.add(\"mini car\"); car3List.remove(\"truck\"); System.out.println(car.getCarList()); System.out.println(car2List); System.out.println(car3List); }}[truck, suv, sedan, sports car][truck, suv, sedan, sports car, mini car][suv, sedan, sports car]ìœ„ ì½”ë“œëŠ” ìë™ì°¨ í´ë¼ì´ì–¸íŠ¸ì™€ í´ë¼ì´ì–¸íŠ¸ì˜ ì‹¤í–‰ ê²°ê³¼ ì…ë‹ˆë‹¤. ê¹Šì€ ë³µì‚¬ ë°©ì‹ì„ ì‚¬ìš©í–ˆìœ¼ë¯€ë¡œ ê°ê°ì˜ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ê°€ ëª¨ë‘ ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ë„ì¶œí•´ ë‚´ëŠ” ê²ƒì„ í™•ì¸í• ìˆ˜ ìˆìŠµë‹ˆë‹¤.ê²°ë¡ í”„ë¡œí† íƒ€ì… íŒ¨í„´ì€ dbì—ì„œ ë¹ˆë²ˆí•˜ê²Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ë•Œ, ê·¸ ë°ì´í„°ê°€ í•­ìƒ ë˜‘ê°™ì€ ê°’ì„ ë°˜í™˜í•˜ëŠ” ê²½ìš° ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.dbì—ì„œ ê·¸ë•Œê·¸ë•Œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ì¢‹ì€ê²ƒ ì•„ë‹ˆì•¼? ë¼ê³  ìƒê°í•˜ì‹¤ìˆ˜ ìˆê² ì§€ë§Œ dbì— ì ‘ê·¼í•˜ëŠ”ë° ì‚¬ìš©í•˜ëŠ” ìì›, ë¹„ìš©ì´ ê°ì²´ë¥¼ ë³µì‚¬í•˜ëŠ” ë¹„ìš©ë³´ë‹¤ í›¨ì”¬ í¬ë‹¤ëŠ”ê²ƒì„ ì—¼ë‘í•´ ë‘ì…”ì•¼ í•©ë‹ˆë‹¤.ì°¸ì¡° https://refactoring.guru/design-patterns/prototype" }, { "title": "Transaction silently rolled back because it has been marked as rollback-only", "url": "/posts/transaction-rollback/", "categories": "Spring", "tags": "Spring, Transaction", "date": "2021-07-28 20:12:00 +0900", "snippet": "ì´ê²Œ ì™œ ì €ì¥ì´ ì•ˆë ê¹Œ?ì„œë¹„ìŠ¤ë¥¼ ìš´ì˜í•˜ë‹¤ê°€ ì´ í¬ìŠ¤íŒ…ì˜ ì œëª©ê³¼ ê°™ì´ Transaction silently rolled back because it has been marked as rollback-only ë¼ëŠ” ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë°›ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.í•´ë‹¹ ì—ëŸ¬ì˜ ì›ì¸ì€ ê¸ˆë°© ì°¾ì•˜ìœ¼ë‚˜, í•œ ì„œë¹„ìŠ¤ê°€ ë‚´ë¶€ ì„œë¹„ìŠ¤ì˜ ë©”ì†Œë“œë¥¼ try-catch ë¸”ë¡ìœ¼ë¡œ ê°ì‹¸ í˜¸ì¶œí•˜ëŠ” í˜•íƒœë¡œ ì½”ë“œë¥¼ ì‘ì„±í–ˆê¸° ë•Œë¬¸ì— ì˜ˆì™¸ê°€ ë°œìƒí•˜ë”ë¼ë„ commitì€ ì •ìƒì ìœ¼ë¡œ ì´ë£¨ì–´ì§ˆ ê²ƒìœ¼ë¡œ ì˜ˆìƒí–ˆìŠµë‹ˆë‹¤.ê·¸ëŸ¬ë‚˜ ì œ ë§ˆìŒì²˜ëŸ¼ ë˜ì§€ ì•Šì•˜ê³  ì˜ˆì™¸ ë°œìƒì „ ì‘ì„±í•œ ì €ì¥ / ìˆ˜ì • ì½”ë“œê°€ ë¡¤ë°± ë˜ì–´ ìœ„ì˜ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë°›ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ì™œ ì´ëŸ°ì¼ì´ ë°œìƒí•œ ê²ƒì¸ì§€, í•´ê²° ë°©ë²•ì€ ìˆëŠ” ê²ƒì¸ì§€ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.ìƒí™© ì¬í˜„í•˜ê¸°ìƒìš© ì„œë¹„ìŠ¤ì™€ ë¹„ìŠ·í•œ í™˜ê²½ì„ ë§Œë“¤ì–´ ìƒí™©ì„ ì¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤. í˜„ì¬ ì„œë¹„ìŠ¤ëŠ” spring-boot 2.4.2, postgresql, spring data jpa ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.@Service@Transactional@Slf4jpublic class AccountParentService { @Autowired AccountChildService accountChildService; public void saveAccountWithException() { try { accountChildService.saveAccountAndThrowException(); } catch (Exception ex) { log.error(\"ë‚´ë¶€ ì„œë¹„ìŠ¤ì—ì„œ ê³„ì • ìƒì„±ì¤‘ ì—ëŸ¬ ë°œìƒ - \" + ex.getMessage()); } log.info(\"ê³„ì • ìƒì„± ì™„ë£Œ\"); }}@Service@Transactionalpublic class AccountChildService { @Autowired AccountRepository accountRepository; public void saveAccountAndThrowException() { accountRepository.save( Account.builder() .name(\"ì´ë¦„\") .loginId(\"ë¡œê·¸ì¸ ID\") .age(30) .password(UUID.randomUUID().toString()) .build() ); throw new RuntimeException(\"ì˜ˆì™¸ ë˜ì§€ê¸°\"); }}ì•ì„œ ë§ì”€ë“œë ¸ë‹¤ì‹œí”¼ ì™¸ë¶€ íŠ¸ë™ì­ì…˜ í´ë˜ìŠ¤ì˜ ë©”ì†Œë“œê°€ try-catch ë¸”ë¡ìœ¼ë¡œ ë‚´ë¶€ íŠ¸ëœì­ì…˜ í´ë˜ìŠ¤ì˜ ë©”ì†Œë“œë¥¼ ê°ì‹¼ ì±„ë¡œ í˜¸ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤. ì‹¤ì œ throw new RuntimeException()ë¥¼ ë˜ì¡Œë‹¤ í•˜ë”ë¼ë„ accountRepository.save() ì´í›„ì´ê³ ì™¸ë¶€ ë©”ì†Œë“œì—ì„œëŠ” ì˜ˆì™¸ì²˜ë¦¬ê°€ ë˜ì–´ìˆê¸° ë•Œë¬¸ì— ê³„ì •ì´ ìƒì„±ëœë‹¤ê³  ìƒê°í•  ìˆ˜ ìˆì§€ë§Œ ì‹¤ì œë¡œëŠ” â€˜ê³„ì • ìƒì„± ì™„ë£Œâ€™ ë¡œê·¸ ì´í›„ì— ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ë©”ì‹œì§€ê°€ ì¶œë ¥ë˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.2021-08-24 10:49:31.131 ERROR 16632 --- [nio-9999-exec-2] s.s.basic.service.AccountParentService : ë‚´ë¶€ ì„œë¹„ìŠ¤ì—ì„œ ê³„ì • ìƒì„±ì¤‘ ì—ëŸ¬ ë°œìƒ - ì˜ˆì™¸ ë˜ì§€ê¸°2021-08-24 10:49:31.131 INFO 16632 --- [nio-9999-exec-2] s.s.basic.service.AccountParentService : ê³„ì • ìƒì„± ì™„ë£Œ2021-08-24 10:49:31.148 ERROR 16632 --- [nio-9999-exec-2] o.a.c.c.C.[.[.[/].[dispatcherServlet] : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is org.springframework.transaction.UnexpectedRollbackException: Transaction silently rolled back because it has been marked as rollback-only] with root causeorg.springframework.transaction.UnexpectedRollbackException: Transaction silently rolled back because it has been marked as rollback-only\tat org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:752) ~[spring-tx-5.3.9.jar:5.3.9]\tat org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:711) ~[spring-tx-5.3.9.jar:5.3.9]\tat org.springframework.transaction.interceptor.TransactionAspectSupport.commitTransactionAfterReturning(TransactionAspectSupport.java:654) ~[spring-tx-5.3.9.jar:5.3.9]\tat org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:407) ~[spring-tx-5.3.9.jar:5.3.9]\tat org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-5.3.9.jar:5.3.9]\tat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) ~[spring-aop-5.3.9.jar:5.3.9]\tat org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:750) ~[spring-aop-5.3.9.jar:5.3.9]\tat org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:692) ~[spring-aop-5.3.9.jar:5.3.9]\tat sycho.spring.basic.service.AccountParentService$$EnhancerBySpringCGLIB$$b70115de.saveAccountWithException(&lt;generated&gt;) ~[main/:na]...&lt;ìƒëµ&gt;ì›ì¸ íŒŒì•…í•˜ê¸°ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ì—¬ ë¡¤ë°±ì´ ì§„í–‰ë˜ëŠ” ë©”ì†Œë“œë¥¼ ì°¾ì•„ë³´ë‹ˆ TransactionAspectSupport í´ë˜ìŠ¤ì˜ completeTransactionAfterThrowing ë©”ì†Œë“œë¥¼ ì°¾ì„ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.protected void completeTransactionAfterThrowing(@Nullable TransactionInfo txInfo, Throwable ex) { if (txInfo != null &amp;&amp; txInfo.getTransactionStatus() != null) { if (logger.isTraceEnabled()) { logger.trace(\"Completing transaction for [\" + txInfo.getJoinpointIdentification() + \"] after exception: \" + ex); } if (txInfo.transactionAttribute != null &amp;&amp; txInfo.transactionAttribute.rollbackOn(ex)) { try { txInfo.getTransactionManager().rollback(txInfo.getTransactionStatus()); } catch (TransactionSystemException ex2) { logger.error(\"Application exception overridden by rollback exception\", ex); ex2.initApplicationException(ex); throw ex2; } catch (RuntimeException | Error ex2) { logger.error(\"Application exception overridden by rollback exception\", ex); throw ex2; } }...&lt;ìƒëµ&gt;ë‹¤ì‹œ txtInfo.transactionAttriute.rollbackOn(ex) ë©”ì†Œë“œë¥¼ ì°¾ì•„ ë“¤ì–´ê°€ ë³´ë©´ DefaultTransactionAttribute í´ë˜ìŠ¤ì˜ rollBackOn() ë©”ì†Œë“œë¥¼ ë§Œë‚ ìˆ˜ ìˆìŠµë‹ˆë‹¤.@Overridepublic boolean rollbackOn(Throwable ex) { return (ex instanceof RuntimeException || ex instanceof Error);}ì•„ê¹Œ ë˜ì§„ ì˜ˆì™¸ëŠ” RuntimeException ì´ê¸° ë•Œë¬¸ì— ë¡¤ë°±ì´ ë°œìƒí•˜ê²Œ ë˜ëŠ”êµ°ìš”. ë‹¤ì‹œ ë¡¤ë°± í”„ë¡œì„¸ìŠ¤ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.if (status.hasTransaction()) { if (status.isLocalRollbackOnly() || isGlobalRollbackOnParticipationFailure()) { if (status.isDebug()) { logger.debug(\"Participating transaction failed - marking existing transaction as rollback-only\"); } doSetRollbackOnly(status); } else { if (status.isDebug()) { logger.debug(\"Participating transaction failed - letting transaction originator decide on rollback\"); } }}processRollback() ë©”ì†Œë“œë¥¼ ì‚´í´ë³´ë©´ status.isLocalRollbackOnly() || isGlobalRollbackOnParticipationFailure() ì„ ë§Œì¡±í•˜ë©´ rollbackOnly ë¥¼ ì„¸íŒ…í•˜ê²Œ ë˜ì–´ ìˆìŠµë‹ˆë‹¤.ì—¬ì°¨ì €ì°¨ í”„ë¡œì„¸ìŠ¤ë¥¼ ë”°ë¼ê°€ë³´ë©´ TransactionDriverControlImpl ì˜ rollbackOnly í•„ë“œë¥¼ trueë¡œ ë³€ê²½í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ê·¼ë° ì´ íŠ¸ëœì­ì…˜ ì—ì„œëŠ” rollbackOnly í•„ë“œë§Œ ë³€ê²½í•  ë¿ ë‚´ë¶€ í´ë˜ìŠ¤ì˜ íŠ¸ëœì­ì…˜ì—ì„œëŠ” UnexpectedRollbackException ë¥¼ ë°”ë¡œ ë˜ì§€ì§€ëŠ” ì•Šë„¤ìš”.AbstractPlatformTransactionManager.processRollback()if (unexpectedRollback) { // false throw new UnexpectedRollbackException( \"Transaction rolled back because it has been marked as rollback-only\");}ë‚´ë¶€ í´ë˜ìŠ¤ì˜ íŠ¸ëœì­ì…˜ì´ ì™„ë£Œë˜ë©´ ìµœì´ˆ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ê°€ ì‹œì‘ë©ë‹ˆë‹¤. ì´ë²ˆì—ëŠ” status.isNewTransaction() ì¡°ê±´ì„ ë§Œì¡±í•˜ê³  íŠ¸ë™ì­ì…˜ì˜ ìƒíƒœê°€ MARKED_ROLLBACK ìœ¼ë¡œ ë§ˆí¬ë˜ì–´ìˆê¸° ë•Œë¬¸ì— status.isGlobalRollbackOnly() ê°€ trueë¥¼ return í•¨ì— ë”°ë¼ unexpectedRollback í•„ë“œê°€ trueê°€ ë©ë‹ˆë‹¤.else if (status.isNewTransaction()) { if (status.isDebug()) { logger.debug(\"Initiating transaction commit\"); } unexpectedRollback = status.isGlobalRollbackOnly(); doCommit(status);}ê·¸ë ‡ë‹¤ë©´ ìµœì¢…ì ìœ¼ë¡œ ì•„ë˜ ì½”ë“œì— ì˜í•´ UnexpectedRollbackExceptionì´ ë°œìƒí•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.// Throw UnexpectedRollbackException if we have a global rollback-only// marker but still didn't get a corresponding exception from commit.if (unexpectedRollback) { throw new UnexpectedRollbackException( \"Transaction silently rolled back because it has been marked as rollback-only\");}ê·¸ëŸ¼ ì™œ?ê²°ë¡ ì ìœ¼ë¡œ ë³´ë©´ status.isLocalRollbackOnly() || isGlobalRollbackOnParticipationFailure() ì¡°ê±´ì¤‘ isGlobalRollbackOnParticipationFailure() ì´ true ì´ë©´ ì „ì²´ ë¡¤ë°±ì´ ë˜ë„ë¡ ë˜ì–´ìˆëŠ”ê²ƒ ê°™ë„¤ìš”.í•´ë‹¹ ë©”ì†Œë“œì— ë“¤ì–´ê°€ì„œ ì´ê²ƒì €ê²ƒ ì‚´í´ë³´ê³  ìˆëŠ”ë° ë§ˆì¹¨ ìœ„ì— setGlobalRollbackOnParticipationFailure() ë©”ì†Œë“œì˜ ì£¼ì„ì— ë”± ì œê°€ ì›í•˜ëŠ” ë‚´ìš©ì´ ìˆì—ˆìŠµë‹ˆë‹¤./** * Set whether to globally mark an existing transaction as rollback-only * after a participating transaction failed. * &lt;p&gt;Default is \"true\": If a participating transaction (e.g. with * PROPAGATION_REQUIRED or PROPAGATION_SUPPORTS encountering an existing * transaction) fails, the transaction will be globally marked as rollback-only. * The only possible outcome of such a transaction is a rollback: The * transaction originator &lt;i&gt;cannot&lt;/i&gt; make the transaction commit anymore. * &lt;p&gt;Switch this to \"false\" to let the transaction originator make the rollback * decision. If a participating transaction fails with an exception, the caller * can still decide to continue with a different path within the transaction. * However, note that this will only work as long as all participating resources * are capable of continuing towards a transaction commit even after a data access * failure: This is generally not the case for a Hibernate Session, for example; * neither is it for a sequence of JDBC insert/update/delete operations. * &lt;p&gt;&lt;b&gt;Note:&lt;/b&gt;This flag only applies to an explicit rollback attempt for a * subtransaction, typically caused by an exception thrown by a data access operation * (where TransactionInterceptor will trigger a {@code PlatformTransactionManager.rollback()} * call according to a rollback rule). If the flag is off, the caller can handle the exception * and decide on a rollback, independent of the rollback rules of the subtransaction. * This flag does, however, &lt;i&gt;not&lt;/i&gt; apply to explicit {@code setRollbackOnly} * calls on a {@code TransactionStatus}, which will always cause an eventual * global rollback (as it might not throw an exception after the rollback-only call). * &lt;p&gt;The recommended solution for handling failure of a subtransaction * is a \"nested transaction\", where the global transaction can be rolled * back to a savepoint taken at the beginning of the subtransaction. * PROPAGATION_NESTED provides exactly those semantics; however, it will * only work when nested transaction support is available. This is the case * with DataSourceTransactionManager, but not with JtaTransactionManager. * @see #setNestedTransactionAllowed * @see org.springframework.transaction.jta.JtaTransactionManager */ë²ˆì—­ê¸°ì˜ í˜ì„ ë¹Œë ¤ ëŒ€ì¶© ë²ˆì—­í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì€ ì •ë³´ë¥¼ ì–»ì„ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ê¸°ë³¸ íŠ¸ëœì­ì…˜ì„ rollback-only ë¡œ ë§ˆí‚¹í•˜ëŠ” ê²ƒì„ ì „ì—­ì ìœ¼ë¡œ ì ìš©í• ì§€ ë§ì§€ ì„¸íŒ… ê¸°ë³¸ê°’ì€ true ë§Œì•½ ì°¸ì—¬ì¤‘ì¸ íŠ¸ëœì­ì…˜ì˜ íƒ€ì…ì´ PROPAGATION_REQUIRED ê±°ë‚˜ PROPAGATION_SUPPORTS ì´ê³  ì‹¤íŒ¨í•˜ë©´ íŠ¸ëœì­ì…˜ì€ ì „ì—­ì ìœ¼ë¡œ rollback-onlyë¡œ ë§ˆí‚¹ëœë‹¤. rollback-onlyë¡œ ë§ˆí‚¹ëœ íŠ¸ëœì­ì…˜ì€ ê²°êµ­ ë¡¤ë°±ë˜ê²Œ ëœë‹¤.ì‚¬ì‹¤ ì™œ ì´ë ‡ê²Œ ì„¸íŒ…ë˜ì–´ ìˆëŠ”ì§€ëŠ” ì •í™•íˆëŠ” ì˜ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤ë§Œ, ì €ëŠ” ë¡¤ë°± ì¡°ê±´ì¤‘ excpetion instanceof RuntimeException ì´ë¼ëŠ” ì¡°ê±´ì´ ìˆëŠ”ê²ƒìœ¼ë¡œ ë³´ì•˜ì„ë•Œ ëŸ°íƒ€ì„ ì‹œì ì— Unchecked Exception ì´ ë°œìƒí•˜ë©´ê·¸ê²ƒì„ ê°ì‹¸ê³  ìˆëŠ” ì™¸ë¶€ì˜ ì˜ˆì™¸ì²˜ë¦¬ ë¸”ë¡ì´ ìˆë”ë¼ë„ ë‚´ë¶€ ë©”ì†Œë“œëŠ” ë¡¤ë°±ì„ ì›í•˜ê¸° ë•Œë¬¸ì— ì»¤ë°‹ì„ ì›í•˜ëŠ” ì™¸ë¶€ ë©”ì†Œë“œì™€ ì¶©ëŒ(ëª¨ìˆœ?) ì´ ì¼ì–´ë‚˜ ê²°ë¡ ì ìœ¼ë¡œëŠ” ëª¨ë‘ ë¡¤ë°±ëœë‹¤. ë¼ê³  ë§ˆìŒì†ìœ¼ë¡œ ê²°ë¡ ì„ ë‚´ë¦¬ê² ìŠµë‹ˆë‹¤.í•´ê²° ë°©ë²•ì´ ê¸€ì„ ì‘ì„±í•˜ë©´ì„œ ë“œëŠ” ìƒê°ì…ë‹ˆë‹¤ë§Œ, í¸í•˜ë‹¤ê³  í•´ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ë¬´í„±ëŒ€ê³  ì˜ˆì™¸ë¥¼ ë˜ì§€ëŠ” í–‰ìœ„ëŠ” ë˜ë‹¤ë¥¸ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¬ìˆ˜ ìˆì„ê²ƒ ê°™ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤. ì˜ˆì™¸ ê°ì²´ë¥¼ ë§Œë“œëŠ”ê²ƒ ìì²´ê°€ ë‹¤ë¥¸ ê°ì²´ë¥¼ ë§Œë“œëŠ” ë¹„ìš©ì— ë¹„í•´ ë¹„ì‹¸ê¸°ë„ í•˜ì§€ìš”.ë¬¼ë¡  í•´ê²°ë°©ë²•ì€ ìˆìŠµë‹ˆë‹¤. ìƒí™©ì— ì•Œë§ì€ ë°©ë²•ìœ¼ë¡œ ë¬¸ì œë¥¼ í•´ê²°í•´ ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤.1. Checked ExceptionRuntimeExceptionì´ ì•„ë‹Œ Exception ì„ ìƒì†ë°›ì•„ CustomExceptionì„ ë§Œë“¤ê³  ì˜ˆì™¸ë¥¼ ë˜ì ¸ì•¼ í•  ë•Œ ì´ CustomExceptionì„ ë˜ì§€ë©´ ë¡¤ë°±ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.public class CustomException extends Exception { public CustomException(String msg) { super(msg); }}public void saveAccountAndThrowException() throws CustomException { accountRepository.save( Account.builder() .name(\"ì´ë¦„\") .loginId(\"ë¡œê·¸ì¸ ID\") .age(30) .password(UUID.randomUUID().toString()) .build() ); throw new CustomException(\"ì˜ˆì™¸ ë˜ì§€ê¸°\");}ì´ìœ ëŠ” Exceptionì„ ìƒì†ë°›ì•„ ë§Œë“  Exceptionì€ Checked Exception ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ê°„ë‹¨í•˜ê²Œ Exceptionì„ ìƒì†ë°›ì•„ ë§Œë“  Exceptionì€ Checked Exception ì´ê³  RuntimeExceptionì„ ìƒì†ë°›ì•„ ë§Œë“ Exceptionì€ Unchecked Exception ì´ë¼ê³  ìƒê°í•˜ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.ìœ„ì—ì„œ ì‚´í´ë´¤ë‹¤ì‹œí”¼ ë¡¤ë°± ì¡°ê±´ì¤‘ excpetion instanceof RuntimeException ì¡°ê±´ì´ ìˆì—ˆìŠµë‹ˆë‹¤. ë°˜ëŒ€ë¡œ ë§í•˜ë©´ â€˜Checked Exceptionì€ ë°œìƒí•˜ë”ë¼ë„ ë¡¤ë°±ë˜ì§€ ì•ŠëŠ”ë‹¤.â€™ ê°€ ë©ë‹ˆë‹¤.Checked Exceptionì€ ë³µêµ¬ê°€ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì „ì œì¡°ê±´ì„ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì— ì˜ˆì™¸ê°€ ë°œìƒí•˜ë”ë¼ë„ ë³µêµ¬ê°€ ê°€ëŠ¥í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì‹¤ì§ˆì ìœ¼ë¡œ ëª¨ë“  ê²½ìš°ì— ëŒ€í•˜ì—¬ ë³µêµ¬ ì „ëµì„ ì„¸ìš°ê¸° ì–´ë µê¸° ë•Œë¬¸ì—ì •ë§ í™•ì‹¤í•œ ê²½ìš°ì—ë§Œ ì‚¬ìš©í•˜ëŠ” í¸ì´ ì¢‹ê² ì§€ìš”.2. noRollbackFor ì†ì„± ì‚¬ìš©@Transactional ë©”ì†Œë“œì—ëŠ” noRollbackFor ì†ì„±ì´ ìˆìŠµë‹ˆë‹¤. (javax íŒ¨í‚¤ì§€ì˜ @Transactional ì—ëŠ” dontRollbackOn ì†ì„±ì´ ìˆìŠµë‹ˆë‹¤.) ì´ ì†ì„±ì„ ì´ìš©í•˜ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ ë¡¤ë°±í•˜ì§€ ì•Šì„ ì˜ˆì™¸ í´ë˜ìŠ¤ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë‹¨, ì´ ì†ì„±ì— ë“¤ì–´ê°ˆ í´ë˜ìŠ¤ëŠ” Throwable ì˜ ì„œë¸Œí´ë˜ìŠ¤ì—¬ì•¼ í•©ë‹ˆë‹¤.@org.springframework.transaction.annotation.Transactional(noRollbackFor = RuntimeException.class)@javax.transaction.Transactional(dontRollbackOn = RuntimeException.class)public void saveAccountAndThrowException() { accountRepository.save( Account.builder() .name(\"ì´ë¦„\") .loginId(\"ë¡œê·¸ì¸ ID\") .age(30) .password(UUID.randomUUID().toString()) .build() ); throw new RuntimeException(\"ì˜ˆì™¸ ë˜ì§€ê¸°\");}3. Propagation.REQUIRES_NEWì¼ë‹¨ ì¬í˜„ ì½”ë“œë¥¼ ë°”ê¿”ë³´ê² ìŠµë‹ˆë‹¤.@Service@Slf4jpublic class AccountParentService { @Autowired AccountRepository accountRepository; @Autowired AccountChildService accountChildService; @Transactional public void saveAccountWithException() { try { accountChildService.saveAccountAndThrowException(); } catch (Exception ex) { log.error(\"ë‚´ë¶€ ì„œë¹„ìŠ¤ì—ì„œ ê³„ì • ìƒì„±ì¤‘ ì—ëŸ¬ ë°œìƒ - \" + ex.getMessage()); } accountRepository.save( Account.builder() .name(\"í…ŒìŠ¤íŠ¸ ì´ë¦„\") .loginId(\"í…ŒìŠ¤íŠ¸ ID\") .age(20) .password(UUID.randomUUID().toString()) .build() ); log.info(\"ê³„ì • ìƒì„± ì™„ë£Œ\"); }}@Servicepublic class AccountChildService { @Autowired AccountRepository accountRepository; @Transactional public void saveAccountAndThrowException() { accountRepository.save( Account.builder() .name(\"ì´ë¦„\") .loginId(\"ë¡œê·¸ì¸ ID\") .age(30) .password(UUID.randomUUID().toString()) .build() ); throw new RuntimeException(\"ì˜ˆì™¸ ë˜ì§€ê¸°\"); }}ë‚´ë¶€ ë©”ì†Œë“œì—ì„œ ê³„ì • ìƒì„± ì´í›„ ì™¸ë¶€ ë©”ì†Œë“œë¡œ ë‹¤ì‹œ ëŒì•„ì™€ ë˜ ë‹¤ë¥¸ ê³„ì •ì„ ìƒì„±í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ë‹¹ì—°íˆ í˜„ì¬ëŠ” ë‚´ë¶€ íŠ¸ëœì­ì…˜ì´ ì „íŒŒë˜ê¸° ë•Œë¬¸ì— ì „ì—­ ë¡¤ë°±ì´ ë°œìƒí•©ë‹ˆë‹¤.ê·¸ë ‡ë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë‚´ë¶€ ë©”ì†Œë“œì˜ @Transactional ì „íŒŒì˜µì…˜ì„ REQUIRES_NEW ë¡œ ë³€ê²½í•´ ë³´ê² ìŠµë‹ˆë‹¤.@Transactional(propagation = Propagation.REQUIRES_NEW)public void saveAccountAndThrowException() {...&lt;ìƒëµ&gt;ë‹¤ì‹œ ì‘ì—…ì„ ìˆ˜í–‰í•´ ë³´ë‹ˆ ë‚´ë¶€ ë©”ì†Œë“œì˜ ì‘ì—…ì€ ë¡¤ë°±ë˜ì—ˆì§€ë§Œ ì™¸ë¶€ ë©”ì†Œë“œì˜ ì‘ì—…ì€ ì •ìƒì ìœ¼ë¡œ ì§„í–‰ë˜ì–´ ê³„ì • í•œê°œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.ì´ ê¸€ì—ì„œ ìì„¸íˆ ë‹¤ë£¨ì§€ëŠ” ì•Šì„ ê²ƒì´ì§€ë§Œ ë‚´ë¶€ ë©”ì†Œë“œì— ì§„ì…ì‹œ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ì—¬ ì™¸ë¶€ íŠ¸ëœì­ì…˜ê³¼ ë‹¤ë¥¸ ë…ë¦½ì ì¸ íŠ¸ë™ì­ì…˜ìœ¼ë¡œ ì‘ë™í•˜ê¸° ë•Œë¬¸ì— ë‚´ë¶€ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ ì™¸ë¶€ë¡œëŠ” ë¡¤ë°±ì´ ì „íŒŒë˜ì§€ ì•ŠëŠ”ë‹¤. ë¼ê³  ì´í•´í•˜ì‹œë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.ë‹¨, ì´ ì „ëµì€ ê°œë°œìê°€ ì›ì¹˜ì•Šì€ ë˜ë‹¤ë¥¸ ë”ì°í•œ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— íŠ¸ëœì­ì…˜ì˜ ë™ì‘ ì›ë¦¬ / ë°©ì‹ì— ëŒ€í•œ ëª…í™•í•œ ì´í•´ê°€ í•„ìš”í•©ë‹ˆë‹¤.ê²°ë¡ ì˜ë„ì¹˜ ì•Šì€ ë¡¤ë°± ìƒí™©ì´ ì¼ì–´ë‚˜ëŠ” ì´ìœ ì™€ í•´ê²°ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤.ë§‰ìƒ ì¼ì´ ì¼ì–´ë‚¬ì„ë•ŒëŠ” ì¡°ê¸ˆ ë‹¹í™©í–ˆì§€ë§Œ ì´ìœ ë¥¼ ì•Œê³ ë³´ë‹ˆ ì •ë§ ë©‹ì§€ê³  ì•ˆì „í•œ ì „ëµì´ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.ìŠ¤í”„ë§ì˜ ë™ì‘ë°©ì‹ì— ëŒ€í•´ í•˜ë‚˜ë‘˜ ì•Œì•„ê°€ë©´ ê°ˆìˆ˜ë¡ ì°¸ ì¬ë°ŒëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë™ì‹œì— ì¢Œì ˆê°ì„ ì£¼ê¸°ë„ í•˜ì§€ìš”..í•´ê²° ë°©ë²•ì— ëŒ€í•´ì„œëŠ” ëª‡ê°€ì§€ ì ê¸´ í–ˆì§€ë§Œ ì €ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì˜ˆì™¸ë¥¼ ë°œìƒì‹œì¼œì•¼ í•˜ëŠ” ê²½ìš° í•´ë‹¹ ì˜ˆì™¸ë¥¼ Exceptionì„ ìƒì†ë°›ì€ Checked Exceptionìœ¼ë¡œ ë§Œë“¤ê³ ,í™•ì‹¤í•œ ë³µêµ¬ ì „ëµì„ ì„¸ì›Œ ëª…í™•í•œ ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•˜ëŠ” ë°©ë²•ì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤." }, { "title": "ì»¤ë§¨ë“œ íŒ¨í„´ (Command Pattern)", "url": "/posts/command-pattern/", "categories": "Design Pattern", "tags": "Design Pattern, Java", "date": "2021-07-24 20:12:00 +0900", "snippet": "ì»¤ë§¨ë“œ íŒ¨í„´ì»¤ë§¨ë“œ íŒ¨í„´ì€ ì‹¤í–‰ë  ê¸°ëŠ¥ì„ ê°ì²´ì˜ í˜•íƒœë¡œ ìº¡ìŠí™” í•¨ìœ¼ë¡œì¨ ì—¬ëŸ¬ ê¸°ëŠ¥ì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì¬ì‚¬ìš©ì„±ì´ ë†’ì€ í´ë˜ìŠ¤ë¥¼ ì„¤ê³„í•˜ëŠ” íŒ¨í„´ ì…ë‹ˆë‹¤. ì´ íŒ¨í„´ì€ ì–´ë–¤ ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ ë•Œ ì‹¤í–‰ë  ê¸°ëŠ¥ì´ ë‹¤ì–‘í•˜ë©´ì„œ ì—¬ëŸ¬ê°€ì§€ ë³€ê²½ì´ í•„ìš”í•œ ê²½ìš°ì—ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¤ëŠ” í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³  ì¬ì‚¬ìš© í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.êµ¬ì¡° í˜¸ì¶œìëŠ” ìš”ì²­ì„ ì‹œì‘í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. ì´ í´ë˜ìŠ¤ì—ëŠ” ëª…ë ¹ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ëŠ” í•„ë“œê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. í˜¸ì¶œìëŠ” ìš”ì²­ì„ ìˆ˜ì‹ ìì—ê²Œ ì§ì ‘ ë³´ë‚´ëŠ” ëŒ€ì‹  í•´ë‹¹ ëª…ë ¹ì„ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤. ì»¤ë§¨ë“œ ì¸í„°í˜ì´ìŠ¤ëŠ” ëŒ€ì²´ë¡œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ë‹¨ì¼ ë©”ì†Œë“œë§Œ ì„ ì–¸í•©ë‹ˆë‹¤. ì»¤ë§¨ë“œ í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ í´ë˜ìŠ¤ëŠ” ë‹¤ì–‘í•œ ì¢…ë¥˜ì˜ ìš”ì²­ë“¤ì„ ìƒì†í•©ë‹ˆë‹¤. êµ¬í˜„ í´ë˜ìŠ¤ëŠ” ìì²´ì ìœ¼ë¡œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê°ì²´ì¤‘ í•˜ë‚˜ë¡œ ì´ëŸ¬í•œ ëª…ë ¹ì„ ì „ë‹¬í•´ì•¼ í•©ë‹ˆë‹¤. ëª…ë ¹ì„ ì „ë‹¬ë°›ëŠ” ìˆ˜ì‹  í´ë˜ìŠ¤ì—ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê±°ì˜ ëª¨ë“  ê°ì²´ê°€ ìˆ˜ì‹ ìì²˜ëŸ¼ ë™ì‘ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ ì½”ë“œëŠ” êµ¬ì²´ì ì¸ ëª…ë ¹ ê°ì²´ë¥¼ ë§Œë“¤ê³  êµ¬ì„±í•©ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” ì»¤ë§¨ë“œ ì¸í„°í˜ì´ìŠ¤ì˜ ìƒì„±ìì— ìˆ˜ì‹  í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í¬í•¨í•œ ëª¨ë“  ìš”ì²­ íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬í•´ì•¼ í•©ë‹ˆë‹¤.ì ìš© ê°€ëŠ¥í•œ ê²½ìš° ì–´ë–¤ ì‘ì—…ê³¼ í•¨ê»˜ ê°ì²´ë¥¼ íŒŒë¼ë¯¸í„°í™” í•˜ë ¤ëŠ” ê²½ìš° ì»¤ë§¨ë“œ íŒ¨í„´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì»¤ë§¨ë“œ íŒ¨í„´ì€ íŠ¹ì • ë©”ì†Œë“œ í˜¸ì¶œì„ ë…ë¦½ ì‹¤í–‰í˜• ê°ì²´ë¡œ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íì— ì‘ì—…ì„ ë„£ê±°ë‚˜ ì‘ì—…ì„ ìŠ¤ì¼€ì¥´ë§, í˜¹ì€ ì‘ì—…ì„ ì›ê²©ìœ¼ë¡œ ì‹¤í–‰í•˜ê³ ì í•œ ê²½ìš° ì»¤ë§¨ë“œ íŒ¨í„´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¡¤ë°± ê°€ëŠ¥í•œ ì‘ì—…ì„ êµ¬í˜„í•˜ê³ ì í•˜ëŠ” ê²½ìš° ì»¤ë§¨íŠ¸ íŒ¨í„´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì¥ë‹¨ì ì¥ì  ì–´ë–¤ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” í´ë˜ìŠ¤ì—ì„œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë¶€ë¶„ë§Œ ë¶„ë¦¬í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ë§Œì¡±í•©ë‹ˆë‹¤. ê¸°ì¡´ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë¥¼ ê±´ë“œì§€ ì•Šê³  ìƒˆë¡œìš´ ëª…ë ¹ì„ êµ¬í˜„í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ê°œë°©/íì‡„ ì›ì¹™ì„ ë§Œì¡±í•©ë‹ˆë‹¤. ì·¨ì†Œ / ë‹¤ì‹œ ì‹¤í–‰ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì§€ì—°ëœ ì‘ì—…ì„ ì‹¤í–‰ ì‹œí‚¬ ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°„ë‹¨í•œ Nê°œì˜ ëª…ë ¹ ì„¸íŠ¸ë¥¼ ë³µì¡í•œ ëª…ë ¹ìœ¼ë¡œ ì¡°í•©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë‹¨ì  ë°œì‹ í•˜ëŠ” ì½”ë“œì™€ ìˆ˜ì‹ í•˜ëŠ” ì½”ë“œ ì‚¬ì´ì— ì™„ì „íˆ ìƒˆë¡œìš´ ê³„ì¸µì„ ë„ì…í•˜ê¸° ë•Œë¬¸ì— ì „ì²´ì ì¸ ì½”ë“œê°€ ë” ë³µì¡í•´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì˜ˆì œí˜„ì¬ 4ê°€ì§€ì˜ ê¸°ëŠ¥ì„ í•˜ëŠ” ë¦¬ëª¨ì½˜ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.Button.javapublic enum Button { UP, DOWN, LEFT, RIGHT;}RemoteControl.javapublic class RemoteControl { List&lt;Integer&gt; channelList = new ArrayList&lt;&gt;(Arrays.asList(1, 2, 7, 9, 11, 16, 20, 23, 27, 30)); int channel = 1; int volume = 5; public void volumeUp() { if (volume &lt; 10) { System.out.println(\"í˜„ì¬ ë³¼ë¥¨ì€ \" + ++volume + \"ì…ë‹ˆë‹¤.\"); } else { System.out.println(\"ë³¼ë¥¨ì„ ë”ì´ìƒ ë†’ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\"); } } public void volumeDown() { if (volume &gt; 0) { System.out.println(\"í˜„ì¬ ë³¼ë¥¨ì€ \" + --volume + \"ì…ë‹ˆë‹¤.\"); } else { System.out.println(\"ë³¼ë¥¨ì„ ë”ì´ìƒ ë‚®ì¶œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\"); } } public void channelUp() { int currentChannelIndex = channelList.indexOf(channel); if (currentChannelIndex == channelList.size() - 1) { channel = channelList.get(0); } else { channel = channelList.get(currentChannelIndex + 1); } System.out.println(\"í˜„ì¬ ì±„ë„ì€ \" + channel + \"ë²ˆ ì…ë‹ˆë‹¤.\"); } public void channelDown() { int currentChannelIndex = channelList.indexOf(channel); if (currentChannelIndex == 0) { channel = channelList.get(channelList.size() - 1); } else { channel = channelList.get(currentChannelIndex - 1); } System.out.println(\"í˜„ì¬ ì±„ë„ì€ \" + channel + \"ë²ˆ ì…ë‹ˆë‹¤.\"); }}RemoteControlCommander.javapublic class RemoteControlCommander { private RemoteControl remoteControl = new RemoteControl(); public void press(Button button) { if (button == Button.UP) { remoteControl.volumeUp(); } else if (button == Button.DOWN) { remoteControl.volumeDown(); } else if (button == Button.LEFT) { remoteControl.channelDown(); } else if (button == Button.RIGHT) { remoteControl.channelUp(); } }}Client.javapublic class Client { public static void main(String[] args) { RemoteControlCommander remoteControlCommander = new RemoteControlCommander(); remoteControlCommander.press(Button.UP); remoteControlCommander.press(Button.DOWN); remoteControlCommander.press(Button.LEFT); remoteControlCommander.press(Button.RIGHT); }}ë¦¬ëª¨ì½˜ì˜ ìœ„ ì•„ë˜ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë³¼ë¥¨ì„ ì»¨íŠ¸ë¡¤í•˜ê³ , ì¢Œ ìš° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì±„ë„ì„ ì»¨íŠ¸ë¡¤í•˜ëŠ” ê°„ë‹¨í•œ ë¦¬ëª¨ì½˜ì…ë‹ˆë‹¤.ì§€ê¸ˆê¹Œì§€ëŠ” ë¬¸ì œê°€ ì—†ì—ˆìœ¼ë‚˜ ìƒˆë¡œìš´ ë²„íŠ¼ì„ 20ê°œ ì •ë„ ì¶”ê°€í•˜ë¼ëŠ” ì§€ì‹œë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ìš°ë¦¬ëŠ” RemoteControlCommanderí´ë˜ìŠ¤ì˜ press() ë©”ì†Œë“œì— ë‹¤ë¥¸ Buttonì´ ë“¤ì–´ì˜¬ ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬ 20 ê°œì˜ if-else ë¬¸ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤. (í˜¹ì€ switch-caseë¬¸)ë˜í•œ RemoteControlí´ë˜ìŠ¤ì— 20ê°œì˜ ë©”ì†Œë“œë¥¼ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” ê°œë°©/íì‡„ ì›ì¹™ê³¼ ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ì¶©ì¡±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì»¤ë§¨ë“œ íŒ¨í„´ì„ ì‚¬ìš©í•´ ì½”ë“œë¥¼ ë¦¬íŒ©í† ë§ í•˜ê¸°ë¡œ ê²°ì •í•˜ì˜€ìŠµë‹ˆë‹¤.ì¼ë‹¨ Command ì¸í„°í˜ì´ìŠ¤ ë¶€í„° ìƒì„±í•˜ê² ìŠµë‹ˆë‹¤. ì¸í„°í˜ì´ìŠ¤, ì¶”ìƒ í´ë˜ìŠ¤ ë‘˜ì¤‘ ë³¸ì¸ì˜ ìŠ¤íƒ€ì¼ëŒ€ë¡œ ìƒì„±í•˜ë©´ ë©ë‹ˆë‹¤. ì¸í„°í˜ì´ìŠ¤ëŠ” Command ì˜ êµ¬í˜„ì²´ì—ì„œ RemoteControlì„ ì£¼ì…í•´ì•¼ í•©ë‹ˆë‹¤.ì¶”ìƒ í´ë˜ìŠ¤ëŠ” Command ìì²´ì—ì„œ RemoteControlì„ ì£¼ì…í•´ì•¼ í•©ë‹ˆë‹¤.Command.javapublic interface Command { void execute();}ë‹¤ìŒì€ ê¸°ì¡´ì˜ RemoteControl í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•˜ê² ìŠµë‹ˆë‹¤. ì´ í´ë˜ìŠ¤ëŠ” ì´ì œ ì–´ë–¤ í–‰ìœ„ë¥¼ í•˜ëŠ” ë©”ì†Œë“œëŠ” ì—†ê³  í•„ë“œë¥¼ ì»¨íŠ¸ë¡¤ í•  ìˆ˜ ìˆëŠ” getter / setter ë©”ì†Œë“œë§Œ ì¡´ì¬í•  ê²ƒì…ë‹ˆë‹¤.public class RemoteControl { private List&lt;Integer&gt; channelList = new ArrayList&lt;&gt;(Arrays.asList(1, 2, 7, 9, 11, 16, 20, 23, 27, 30)); private int channel = 1; private int volume = 5; public List&lt;Integer&gt; getChannelList() { return channelList; } public int getChannel() { return channel; } public void setChannel(int channel) { this.channel = channel; } public int getVolume() { return volume; } public void setVolume(int volume) { this.volume = volume; }}ë‹¤ìŒì€ ì»¤ë§¨ë“œ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” êµ¬í˜„ì²´ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.VolumeUpCommand.javapublic class VolumeUpCommand implements Command{ private RemoteControl remoteControl; public VolumeUpCommand(RemoteControl remoteControl) { this.remoteControl = remoteControl; } @Override public void execute() { if (remoteControl.getVolume() &lt; 10) { remoteControl.setVolume(remoteControl.getVolume() + 1); System.out.println(\"í˜„ì¬ ë³¼ë¥¨ì€ \" + remoteControl.getVolume() + \"ì…ë‹ˆë‹¤.\"); } else { System.out.println(\"ë³¼ë¥¨ì„ ë”ì´ìƒ ë†’ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\"); } }}VolumeDownCommand.javapublic class VolumeDownCommand implements Command{ private RemoteControl remoteControl; public VolumeDownCommand(RemoteControl remoteControl) { this.remoteControl = remoteControl; } @Override public void execute() { if (remoteControl.getVolume() &gt; 0) { remoteControl.setVolume(remoteControl.getVolume() - 1); System.out.println(\"í˜„ì¬ ë³¼ë¥¨ì€ \" + remoteControl.getVolume() + \"ì…ë‹ˆë‹¤.\"); } else { System.out.println(\"ë³¼ë¥¨ì„ ë”ì´ìƒ ë‚®ì¶œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\"); } }}ChannelUpCommand.javapublic class ChannelUpCommand implements Command{ private RemoteControl remoteControl; public ChannelUpCommand(RemoteControl remoteControl) { this.remoteControl = remoteControl; } @Override public void execute() { int currentChannelIndex = remoteControl.getChannelList().indexOf(remoteControl.getChannel()); if (currentChannelIndex == remoteControl.getChannelList().size() - 1) { remoteControl.setChannel(remoteControl.getChannelList().get(0)); } else { remoteControl.setChannel(remoteControl.getChannelList().get(currentChannelIndex + 1)); } System.out.println(\"í˜„ì¬ ì±„ë„ì€ \" + remoteControl.getChannel() + \"ë²ˆ ì…ë‹ˆë‹¤.\"); }}ChannelDownCommand.javapublic class ChannelDownCommand implements Command{ private RemoteControl remoteControl; public ChannelDownCommand(RemoteControl remoteControl) { this.remoteControl = remoteControl; } @Override public void execute() { int currentChannelIndex = remoteControl.getChannelList().indexOf(remoteControl.getChannel()); if (currentChannelIndex == 0) { remoteControl.setChannel(remoteControl.getChannelList().get(remoteControl.getChannelList().size() - 1)); } else { remoteControl.setChannel(remoteControl.getChannelList().get(currentChannelIndex - 1)); } System.out.println(\"í˜„ì¬ ì±„ë„ì€ \" + remoteControl.getChannel() + \"ë²ˆ ì…ë‹ˆë‹¤.\"); }}ì»¤ë§¨ë“œ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ëª¨ë‘ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ ê¸°ì¡´ RemoteControlCommander í´ë˜ìŠ¤ë¥¼ ì‚­ì œí•˜ê³  í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë¥¼ ë³€ê²½í•˜ê² ìŠµë‹ˆë‹¤.Client.javapublic class Client { public static void main(String[] args) { RemoteControl remoteControl = new RemoteControl(); VolumeUpCommand volumeUpCommand = new VolumeUpCommand(remoteControl); VolumeDownCommand volumeDownCommand = new VolumeDownCommand(remoteControl); ChannelUpCommand channelUpCommand = new ChannelUpCommand(remoteControl); ChannelDownCommand channelDownCommand = new ChannelDownCommand(remoteControl); volumeUpCommand.execute(); volumeDownCommand.execute(); channelUpCommand.execute(); channelDownCommand.execute(); }}ì»¤ë§¨ë“œ íŒ¨í„´ì„ ì ìš©í•œ ì½”ë“œ ë¦¬íŒ©í† ë§ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ìƒˆë¡œìš´ ë²„íŠ¼ì´ ìƒê¸°ë”ë¼ë„ ì»¤ë§¨ë“œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†í•œ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ìƒˆë¡­ê²Œ ë§Œë“¤ê³  í´ë¼ì´ì–¸íŠ¸ë§Œ ìˆ˜ì •í•˜ë©´ ë©ë‹ˆë‹¤.ì¦‰, ë‹¤ë¥¸ ì½”ë“œë¥¼ ê±´ë“¤ì§€ ì•Šì•„ë„ ë˜ë¯€ë¡œ ê³„ë°© íì‡„ ì›ì¹™ì„ ë§Œì¡±í•©ë‹ˆë‹¤. ë¬¼ë¡  RemoteControl í´ë˜ìŠ¤ì—ëŠ” í•„ìš”í•œ í•„ë“œë“¤ì´ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ex. ì™¸ë¶€ì…ë ¥ í¬íŠ¸) ê·¸ë ‡ë‹¤ í•˜ë”ë¼ë„ê¸°ì¡´ì˜ í•œ í´ë˜ìŠ¤ì— ëª¨ë“  ë©”ì†Œë“œë¥¼ ë„£ì€ ë°©ì‹ì— ë¹„í•´ í´ë˜ìŠ¤ê°€ í•„ìˆ˜ì ìœ¼ë¡œ ê°€ì§€ê³  ìˆì–´ì•¼ í•˜ëŠ” í•„ë“œ, ë©”ì†Œë“œë“¤ë§Œ ê°€ì§€ê³  ìˆê²Œ ë³€ê²½ë˜ì—ˆìœ¼ë¯€ë¡œ ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ë§Œì¡±í•˜ê²Œ ë©ë‹ˆë‹¤.ê²°ë¡ ì»¤ë§¨ë“œ íŒ¨í„´ì€ ì£¼ë¡œ GUI í”„ë¡œê·¸ë˜ë°ì—ì„œ ë§ì´ ì“°ì´ê³¤ í•©ë‹ˆë‹¤. ì–´ë–¤ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ í•´ë‹¹ ë²„íŠ¼ì´ ì‹¤í–‰í•  ë™ì‘ì„ êµ¬í˜„í•˜ê³ ì í• ë•Œ ì£¼ë¡œ ì‚¬ìš©í•˜ì§€ìš”.ë˜í•œ ìë°” í”„ë¡œê·¸ë˜ë°ì„ í•˜ë©° ì‰½ê²Œ ì ‘í•  ìˆ˜ ìˆëŠ” Runnable ì¸í„°í˜ì´ìŠ¤ì˜ ëª¨ë“  êµ¬í˜„ì²´ë„ ì»¤ë§¨ë“œ íŒ¨í„´ì´ ì ìš©ëœ ëŒ€í‘œì ì¸ ì‚¬ë¡€ì…ë‹ˆë‹¤.ì´ë ‡ë“¯ ë§ì€ ê³³ì—ì„œ ì‚¬ìš©ë˜ì§€ë§Œ ëª¨ë“  íŒ¨í„´ë“¤ì´ ê·¸ë ‡ë“¯ ì»¤ë§¨ë“œ íŒ¨í„´ ë˜í•œ ì˜ëª»ëœ ì„¤ê³„ë¡œ ê°œë°œì´ ì§„í–‰ë˜ì—ˆì„ ë•Œ ì˜¤íˆë ¤ ì½”ë“œê°€ ë” ë³µì¡í•´ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.ì°¸ì¡° https://refactoring.guru/design-patterns/commandhttps://sourcemaking.com/design_patterns/command/java/1" }, { "title": "ë°˜ë³µì íŒ¨í„´ (Iterator Pattern)", "url": "/posts/iterator-pattern/", "categories": "Design Pattern", "tags": "Design Pattern, Java", "date": "2021-07-17 20:12:00 +0900", "snippet": "ë°˜ë³µì íŒ¨í„´ë°˜ë³µì íŒ¨í„´ì€ ê°ì²´ì§€í–¥ í”„ë¡œê·¸ë˜ë°ì—ì„œ ë°˜ë³µìë¥¼ ì‚¬ìš©í•˜ì—¬ ì»¨í…Œì´ë„ˆë¥¼ ê°€ë¡œì§€ë¥´ë©° ì»¨í…Œì´ë„ˆì˜ ìš”ì†Œë“¤ì— ì ‘ê·¼í•˜ëŠ” ë””ìì¸ íŒ¨í„´ì…ë‹ˆë‹¤â€¦ ë¼ê³  ìœ„í‚¤ì—ëŠ” ë‚˜ì™€ ìˆìŠµë‹ˆë‹¤ë§Œ í•œë²ˆì— ì´í•´ë˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.String[] stringArray = {\"ì›”\", \"í™”\", \"ìˆ˜\", \"ëª©\", \"ê¸ˆ\", \"í† \", \"ì¼\"};for (int i = 0; i &lt; stringArray.length; i++) { System.out.println(stringArray[i]);}ìœ„ì™€ê°™ì€ ì½”ë“œê°€ ìˆì„ ë•Œ ì»¨í…Œì´ë„ˆëŠ” stringArray ë°°ì—´ì„ ì§€ì¹­í•˜ê³  ë°˜ë³µìëŠ” ë³€ìˆ˜ ië¥¼ ì§€ì¹­í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ ì¤‘ìš”í•œê²ƒì€ ë³€ìˆ˜ i ì¸ë°ìš”, iëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ í•©ë‹ˆë‹¤. í˜„ì¬ ê°€ë¡œì§€ë¥´ê³  ìˆëŠ” ë°°ì—´ì˜ ìœ„ì¹˜ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. ê°’ì„ ì¦ê°€ì‹œì¼œ ì»¨í…Œì´ë„ˆì˜ ëª¨ë“  ìš”ì†Œë“¤ì— ì ‘ê·¼í• ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤. ìœ„ ì½”ë“œì—ì„œ iê°€ í•˜ê³  ìˆëŠ” ê¸°ëŠ¥ì„ ì¶”ìƒí™” í•˜ì—¬ ì¼ë°˜í™” í•œ ê²ƒì„ ë°˜ë³µì íŒ¨í„´ì´ë¼ê³  í•©ë‹ˆë‹¤.ë” ì‰½ê²Œ í’€ì–´ì“°ìë©´ ê°ê¸° ë‹¤ë¥¸ ìë£Œêµ¬ì¡°(ì»¬ë ‰ì…˜)ê°€ ìˆë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ ì´ ê°ê°ì˜ ìë£Œêµ¬ì¡°ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ëª¨ë‘ ì•Œ í•„ìš” ì—†ì´ ë°˜ë³µê¸°ëŠ¥ë§Œ í†µì¼í•˜ì—¬ ì¼ë°˜í™” í•œ íŒ¨í„´ ì •ë„ë¡œ ì´í•´í•˜ì‹œë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.ë°˜ë³µì íŒ¨í„´ì—ì„œ ì¤‘ìš”í•˜ê²Œ ì—¬ê²¨ì§€ëŠ” ì›ì¹™ì€ SRP(ë‹¨ì¼ ì±…ì„ ì›ì¹™) ì…ë‹ˆë‹¤. ë‹¨ì¼ ì±…ì„ ì›ì¹™ì´ë€í´ë˜ìŠ¤ëŠ” í•˜ë‚˜ì˜ ì±…ì„ë§Œ ê°€ì ¸ì•¼ í•˜ë©°, í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•˜ëŠ” ì´ìœ ë„ í•œê°œì—¬ì•¼ í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.êµ¬ì¡° ë°˜ë³µì ì¸í„°í˜ì´ìŠ¤ëŠ” ì»¬ë ‰ì…˜ ìˆœíšŒì— í•„ìš”í•œ ì ì—…(ë‹¤ìŒ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°, í˜„ì¬ ìœ„ì¹˜ ê²€ìƒ‰, ë°˜ë³µ ì¬ì‹œì‘ ë“±) ì„ ì„ ì–¸í•©ë‹ˆë‹¤. ë°˜ë³µì ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ëŠ” ì»¬ë ‰ì…˜ ìˆœíšŒë¥¼ ìœ„í•œ ì•Œê³ ë¦¬ì¦˜ì„ êµ¬í˜„í•©ë‹ˆë‹¤. ë°˜ë³µì ê°ì²´ëŠ” ìì²´ì ìœ¼ë¡œ ì§„í–‰ì¤‘ì¸ ìˆœíšŒë¥¼ ì¶”ì í•´ì•¼ í•©ë‹ˆë‹¤. ì»¬ë ‰ì…˜ ì¸í„°í˜ì´ìŠ¤ëŠ” ì»¬ë ‰ì…˜ê³¼ í˜¸í™˜ë˜ëŠ” ë°˜ë³µìë¥¼ ì–»ê¸° ìœ„í•´ í•˜ë‚˜ ì´ìƒì˜ ë©”ì†Œë“œë¥¼ ì„ ì–¸í•©ë‹ˆë‹¤. ì»¬ë ‰ì…˜ ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­í•  ë•Œë§ˆë‹¤ íŠ¹ì • êµ¬í˜„ì²´ í´ë˜ìŠ¤ì˜ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ë°˜ë³µì, ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ í´ë¼ì´ì–¸íŠ¸ê°€ êµ¬í˜„ í´ë˜ìŠ¤ì™€ ê²°í•©ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë™ì¼í•œ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë¡œ ë‹¤ì–‘í•œ ë°˜ë³µìì™€ ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì ìš© ê°€ëŠ¥í•œ ê²½ìš° ì»¬ë ‰ì…˜ì´ ë‚´ë¶€ì ìœ¼ë¡œ ë³µì¡í•œ ë°ì´í„° ê°€ì§€ê³  ìˆì§€ë§Œ ê·¸ ë³µì¡ì„±ì„ í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ìˆ¨ê¸°ê³  ì‹¶ì„ ë•Œ ë°˜ë³µì íŒ¨í„´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ë°˜ë³µìëŠ” ë³µì¡í•œ ë°ì´í„° ì‘ì—…ì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ë¥¼ ìº¡ìŠí™”í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì— ì»¬ë ‰ì…˜ ìš”ì†Œì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ëª‡ ê°€ì§€ ê°„ë‹¨í•œ ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ëŠ” ì»¬ë ‰ì…˜ì˜ ë³µì¡ì„±ì„ ì•Œ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ë¶€ì£¼ì˜í•˜ê±°ë‚˜ ì•…ì˜ì‘ì¸ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì•± ì „ì²´ì—ì„œ ìˆœíšŒ ì½”ë“œì˜ ì¤‘ë³µì„ ì¤„ì´ê³ ì í•  ë•Œ ë°˜ë³µì íŒ¨í„´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ ì½”ë“œê°€ ë‹¤ë¥¸ ë°ì´í„° êµ¬ì¡°ë¥¼ ìˆœíšŒí•˜ê¸°ë¥¼ ì›í•˜ê±°ë‚˜ ì´ëŸ¬í•œ êµ¬ì¡°ì˜ ìœ í˜•ì„ ë¯¸ë¦¬ ì•Œ ìˆ˜ ì—†ëŠ” ê²½ìš° ë°˜ë³µì íŒ¨í„´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.ì¥ë‹¨ì ì¥ì  í¬ê¸°ê°€ í° ìˆœíšŒ ì•Œê³ ë¦¬ì¦˜ì„ ë³„ë„ì˜ í´ë˜ìŠ¤ë¡œ ì¶”ì¶œí•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì™€ ì»¬ë ‰ì…˜ì„ ì •ë¦¬í•¨ìœ¼ë¡œ ì¸í•´ ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ë§Œì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ìœ í˜•ì˜ ì»¬ë ‰ì…˜ ë° ë°˜ë³µìë¥¼ êµ¬í˜„í•˜ê³  ê¸°ì¡´ì˜ ì½”ë“œëŠ” ìˆ˜ì •í•˜ì§€ ì•ŠìŒìœ¼ë¡œì¨ ê°œë°©/íì‡„ ì›ì¹™ì„ ë§Œì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°ê°ì˜ ë°˜ë³µì ê°ì²´ëŠ” ê·¸ë“¤ë§Œì˜ ê³ ìœ í•œ ë°˜ë³µ ìƒíƒœê°€ í¬í•¨ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ë™ì¼í•œ ì»¬ë ‰ì…˜ì„ ë³‘ë ¬ë¡œ ë°˜ë³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ„ì™€ ê°™ì€ ì´ìœ ë¡œ ë°˜ë³µì„ ì§€ì—°ì‹œí‚¬ ìˆ˜ ìˆê³  í•„ìš”í•  ë•Œ ê³„ì†í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë‹¨ì  ì•±ì´ ê°„ë‹¨í•œ ì»¬ë ‰ì…˜ ë§Œìœ¼ë¡œë„ ë™ì‘í•˜ëŠ” ê²½ìš° íŒ¨í„´ì„ ì ìš©í•˜ëŠ” ê²ƒì´ ì˜¤íˆë ¤ ì§€ë‚˜ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°˜ë³µìë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ì¼ë¶€ íŠ¹ìˆ˜ ì»¬ë ‰ì…˜ì˜ ìš”ì†Œë¥¼ ì§ì ‘ íƒìƒ‰í•˜ëŠ” ê²ƒ ë³´ë‹¤ ëœ íš¨ìœ¨ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì˜ˆì œì‚¬ìš©ì ì»¬ë ‰ì…˜ì˜ ì •ë³´ë¥¼ ëª¨ë‘ ê°€ì ¸ì™€ ì½˜ì†”ì°½ì— ë³´ì—¬ì£¼ëŠ” í”„ë¡œê·¸ë¨ì„ í•˜ë‚˜ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤.ìš°ë¦¬ê°€ í™•ì¸í•  ìœ ì € ê°ì²´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.public class User { private String name; private int age; private String loginId; public User(String name, int age, String loginId) { this.name = name; this.age = age; this.loginId = loginId; } public String getName() { return name; } public int getAge() { return age; } public String getLoginId() { return loginId; }}ê·¸ í›„ ë‘ê°œì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.public interface Iterator { boolean hasNext(); Object next();}public interface Container { Iterator getIterator();}ë‹¤ìŒì€ ê°ê°ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” êµ¬í˜„ì²´ë¥¼ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.public class UserIterator implements Iterator { private List&lt;User&gt; userList; int currentPosition = 0; public UserIterator(List&lt;User&gt; userList) { this.userList = userList; } @Override public boolean hasNext() { return currentPosition &lt; userList.size(); } @Override public Object next() { if (hasNext()) { return userList.get(currentPosition ++); } return null; }}public class UserRepository implements Container { private List&lt;User&gt; userList; public UserRepository(List&lt;User&gt; userList) { this.userList = userList; } @Override public Iterator getIterator() { return new UserIterator(this.userList); }}ë§ˆì§€ë§‰ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì…ë‹ˆë‹¤. ì´ ì½”ë“œëŠ” ëª¨ë“  ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.public class Client { public static void main(String[] args) { UserRepository userRepository = new UserRepository(getTestUserList()); for (Iterator it = userRepository.getIterator(); it.hasNext();) { System.out.println(\"===========================================\"); User user = (User) it.next(); System.out.println(user.getName()); System.out.println(user.getAge()); System.out.println(user.getLoginId()); System.out.println(\"===========================================\"); } } private static List&lt;User&gt; getTestUserList() { return new ArrayList&lt;&gt;( Arrays.asList( new User(\"í™ê¸¸ë™\", 20, \"gildong\"), new User(\"ì´ìˆœì‹ \", 50, \"sunshin\"), new User(\"ê¹€ì²¨ì§€\", 43, \"chumji\"), new User(\"ì‹ ì‚¬ì„ë‹¹\", 20, \"imgentleman\") ) ); }}ëª¨ë“  ì‚¬ìš©ìì˜ ì •ë³´ê°€ ì½˜ì†”ì— ì¶œë ¥ë˜ë©´ ì„±ê³µì…ë‹ˆë‹¤.ì¼ë°˜ì ì¸ ë°˜ë³µë¬¸ê³¼ì˜ ì°¨ì´ë§Œì•½ ìœ„ ì˜ˆì œë¥¼ Iteratorë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  foreach loopë¥¼ ì‚¬ìš©í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”? public static void main(String[] args) { List&lt;User&gt; userList = getTestUserList(); for (User user : userList) { System.out.println(\"===========================================\"); System.out.println(user.getName()); System.out.println(user.getAge()); System.out.println(user.getLoginId()); System.out.println(\"===========================================\"); } }ë™ì‘ ìì²´ëŠ” Iteratorë¥¼ ì‚¬ìš©í•˜ì˜€ì„ ë•Œì™€ ë™ì¼í•  ê²ƒì´ê³  ì½”ë“œ ì–‘ë„ ì¤„ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ IteratorëŠ” foreach loopê°€ í•  ìˆ˜ ì—†ëŠ” ì¼ë“¤ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì˜ˆë¥¼ë“¤ì–´ ìš”ì†Œ ì œê±° ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ì¸ foreach ë¬¸ìœ¼ë¡œ ìš”ì†Œë¥¼ ì œê±°í•  ê²½ìš° ConcurrentModificationException ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ë° ë°˜í•´, Iteratorë¥¼ ì´ìš©í•˜ì—¬ ìš”ì†Œë¥¼ ì œê±°í•  ê²½ìš° ì•ˆì „í•˜ê²Œ ìš”ì†Œë¥¼ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ìë°” 8 ì´ìƒì˜ ë²„ì „ì„ ì‚¬ìš©í•œë‹¤ë©´ ìƒˆë¡œìš´ ë©”ì†Œë“œ(removeIf), Stream API(filter) ë¥¼ ì‚¬ìš©í•´ë„ ì•ˆì „í•˜ê²Œ ìš”ì†Œë¥¼ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì¼ì´ ë°œìƒí•˜ëŠ” ì´ìœ ëŠ” ì¼ë°˜ for, foreach ë¬¸ì˜ ê²½ìš° ë°˜ë³µìê°€ hasNext(), next() ì— ëŒ€í•´ ë°˜í™˜í•  ë‚´ìš©ì„ ëª¨ë¥´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.List&lt;User&gt; userList = getTestUserList();// OKfor (Iterator&lt;User&gt; iterator = userList.iterator(); iterator.hasNext();) { User user = iterator.next(); if (\"gildong\".equals(user.getLoginId())) { iterator.remove(); }}// ConcurrentModificationException Errorfor (User user : userList) { if (\"gildong\".equals(user.getLoginId())) { userList.remove(user); }}// OKuserList.removeIf(user -&gt; \"gildong\".equals(user.getLoginId()));ê²°ë¡ ë°˜ë³µì íŒ¨í„´ì„ ì‚¬ìš©í•˜ë©´ êµ¬í˜„ í´ë˜ìŠ¤ ë‚´ë¶€ì—ì„œ ì–´ë–¤ ì‹ìœ¼ë¡œ ì¼ì´ ì²˜ë¦¬ë˜ëŠ”ì§€ ì•Œ í•„ìš” ì—†ì´(ìë£Œêµ¬ì¡°ì™€ ê´€ê³„ì—†ì´) ì»¬ë ‰ì…˜ ë‚´ë¶€ì˜ ëª¨ë“  í•­ëª©ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ Iteratorë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° for loopë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ ë³´ë‹¤ ì„±ëŠ¥ì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.ì°¸ì¡° https://refactoring.guru/design-patterns/iteratorhttps://stackoverflow.com/a/22268270/13160032" }, { "title": "ì˜µì €ë²„ íŒ¨í„´ (Observer Pattern)", "url": "/posts/observer-pattern/", "categories": "Design Pattern", "tags": "Design Pattern, Java", "date": "2021-07-09 20:12:00 +0900", "snippet": "ì˜µì €ë²„ íŒ¨í„´ì˜µì €ë²„ íŒ¨í„´ì€ ê°ì²´ì˜ ìƒíƒœ ë³€í™”ë¥¼ ê´€ì°°í•˜ëŠ” ê´€ì°°ìë“¤, ì¦‰ ì˜µì €ë²„ì˜ ëª©ë¡ì„ ê°ì²´ì— ë“±ë¡í•˜ì—¬ ìƒíƒœ ë³€í™”ê°€ ìˆì„ ë•Œë§ˆë‹¤ ë©”ìŠ¤ë“œ ë“±ì„ í†µí•´ ê°ì²´ê°€ ì§ì ‘ ëª©ë¡ì˜ ê° ì˜µì €ë²„ì—ê²Œ í†µì§€í•˜ë„ë¡ í•˜ëŠ” ë””ìì¸ íŒ¨í„´ì…ë‹ˆë‹¤.êµ¬ì¡° ê²Œì‹œìëŠ” ë‹¤ë¥¸ ê°ì²´ë“¤ì—ê²Œ ê´€ì‹¬ ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•©ë‹ˆë‹¤. ì´ ì´ë²¤íŠ¸ë‚œ ê²Œì‹œìê°€ ìƒíƒœë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ì–´ë–¤ ë™ì‘ì„ ì‹¤í–‰í•  ë•Œ ë°œìƒí•©ë‹ˆë‹¤.ê²Œì‹œìì—ëŠ” ìƒˆ êµ¬ë…ìê°€ ê°€ì…í•˜ê³  í˜„ì¬ êµ¬ë…ìê°€ ëª©ë¡ì—ì„œ ë‚˜ê°ˆ ìˆ˜ ìˆë„ë¡ í•˜ëŠ” êµ¬ë… ì¸í”„ë¼ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ìƒˆ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ê²Œì‹œìëŠ” êµ¬ë… ëª©ë¡ì„ ì‚´í´ë³´ê³  ê° êµ¬ë…ì°¨ ê°ì²´ì˜ ì¸í„°í˜ì´ìŠ¤ì— ì„ ì–¸ëœ ì•Œë¦¼ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. êµ¬ë…ìëŠ” êµ¬ë… ì¸í„°í˜ì´ìŠ¤ë¥¼ ì„ ì–¸í•©ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ë‹¨ì¼ update ë°©ë²•ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ë©”ì†Œë“œì—ëŠ” ê²Œì‹œìê°€ ì—…ë°ì´íŠ¸ì™€ í•¨ê»˜ ì¼ë¶€ ì´ë²¤íŠ¸ ì„¸ë¶€ ì •ë³´ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë§¤ê°œ ë³€ìˆ˜ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. êµ¬ë…ìëŠ” ê²Œì‹œìê°€ ë°œí–‰í•œ ì•Œë¦¼ì— ëŒ€í•´ ì—¬ëŸ¬ê°€ì§€ ì‘ì—…ì„ ìˆ˜ì•»í•©ë‹ˆë‹¤. ê²Œì‹œìê°€ êµ¬í˜„í´ë˜ìŠ¤ì™€ ê²°í•©ë˜ì§€ ì•Šë„ë¡ ëª¨ë“  í´ë˜ìŠ¤ëŠ” ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤ë¡œ êµ¬í˜„ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ê²½ìš° êµ¬ë…ìëŠ” ì—…ë°ì´íŠ¸ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì „í›„ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì´ìœ ë¡œ ê²Œì‹œìëŠ” ì•Œë¦¼ ë©”ì†Œë“œì˜ ì¸ìˆ˜ë¡œ ì „í›„ ì •ë³´ë¥¼ ì „ë‹¬í•˜ê³¤ í•©ë‹ˆë‹¤.ê²Œì‹œìëŠ” ìê¸° ìì‹ ì„ ì¸ìë¡œ ì „ë‹¬í•˜ì—¬ êµ¬ë…ìê°€ í•„ìš”í•œ ë°ì´í„°ë¥¼ ì§ì ‘ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” ê²Œì‹œì ë° êµ¬ë…ì ê°ì²´ë¥¼ ë³„ë„ë¡œ ë§Œë“  í›„ ê²Œì‹œì ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ êµ¬ë…ìë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.ì ìš© ê°€ëŠ¥í•œ ê²½ìš° í•œ ê°ì²´ì˜ ìƒíƒœë¥¼ ë³€ê²½í•˜ê¸° ìœ„í•´ ë‹¤ë¥¸ ê°ì²´ë¥¼ ë³€ê²½í•´ì•¼í•  ê²½ìš° í˜¹ì€ ì‹¤ì œ ê°ì²´ ì§‘í•©ì„ ë¯¸ë¦¬ ì•Œ ìˆ˜ ì—†ê±°ë‚˜ ë™ì ìœ¼ë¡œ ë³€ê²½ë˜ëŠ” ê²½ìš° ì˜µì €ë²„ íŒ¨í„´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì•±ì´ í•œì •ëœ ì‹œê°„, íŠ¹ì •í•œ ì¼€ì´ìŠ¤ì—ë§Œ ë‹¤ë¥¸ ê°ì²´ë¥¼ ê´€ì°°í•´ì•¼ í•˜ëŠ” ê²½ìš° ì˜µì €ë²„ íŒ¨í„´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.ì¥ë‹¨ì ì¥ì  ê²Œì‹œìì˜ ì½”ë“œë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³  ìƒˆë¡œìš´ êµ¬ë…ì í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì‘ì—…í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê°œë°©/íì‡„ ì›ì¹™ì„ ë§Œì¡±í•©ë‹ˆë‹¤. ëŸ°íƒ€ì„ ì‹œì ì— ê°ì²´ì™€ ê´€ê³„ë¥¼ ë§ºì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë‹¨ì  êµ¬ë…ìëŠ” ëœë¤ìœ¼ë¡œ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤. ìš°ì„ ìˆœìœ„ë¥¼ ì§€ì •í•˜ëŠ” ì½”ë“œë¥¼ ì‚½ì…í•˜ì—¬ ìˆœìœ„ë¥¼ ì§€ì •í• ìˆ˜ë„ ìˆê² ì§€ë§Œ, ë³µì¡ì„±ê³¼ ê²°í•©ì„±ë§Œ ë†’ì•„ì§€ê¸° ë•Œë¬¸ì— ì¶”ì²œí•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤. ì˜ˆì œê¸°ë³¸ì ì¸ í˜•íƒœì˜ ê²Œì‹œìë¶€í„° ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤.public class EventManager { Map&lt;String, List&lt;EventListener&gt;&gt; listeners = new HashMap&lt;&gt;(); public EventManager(String... operations) { for (String operation : operations) { this.listeners.put(operation, new ArrayList&lt;&gt;()); } } public void subscribe(String eventType, EventListener listener) { List&lt;EventListener&gt; users = listeners.get(eventType); users.add(listener); } public void unsubscribe(String eventType, EventListener listener) { List&lt;EventListener&gt; users = listeners.get(eventType); users.remove(listener); } public void notify(String eventType, File file) { List&lt;EventListener&gt; users = listeners.get(eventType); for (EventListener listener : users) { listener.doAction(eventType, file); } }}ìœ„ ì½”ë“œëŠ” ê²Œì‹œìì…ë‹ˆë‹¤. êµ¬ë…ìë¥¼ listners ë³€ìˆ˜ë¡œ ë°›ê³  êµ¬ë…, êµ¬ë…í•´ì§€, ì•Œë¦¼ì˜ ê¸°ëŠ¥ì„ ë©”ì†Œë“œë¡œ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.public class Editor { public EventManager events; private File file; public Editor() { this.events = new EventManager(\"open\", \"save\"); } public void openFile(String filePath) { this.file = new File(filePath); events.notify(\"open\", file); } public void saveFile() throws Exception { if (this.file != null) { events.notify(\"save\", file); } else { throw new Exception(\"íŒŒì¼ì„ ë¨¼ì € ì—´ì–´ì£¼ì„¸ìš”.\"); } }}ìœ„ ì½”ë“œëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì‚¬ìš©í•  ë©”ì†Œë“œë¥¼ ëª¨ì•„ë†“ì€ ê²Œì‹œì í´ë˜ìŠ¤ì…ë‹ˆë‹¤. íŒŒì¼ì„ ì—´ê³  ì €ì¥í•˜ëŠ” ê¸°ëŠ¥ì„ ë‚´í¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.public interface EventListener { void update(String eventType, File file);}public class LogOpenListener implements EventListener { private File log; public LogOpenListener(String fileName) { this.log = new File(fileName); } @Override public void update(String eventType, File file) { System.out.println(log + \" íŒŒì¼ì„ ì—´ì—ˆê³  ë¡œê·¸ì— ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.\"); }}public class EmailNotificationListener implements EventListener { private String email; public EmailNotificationListener(String email) { this.email = email; } @Override public void update(String eventType, File file) { System.out.println(eventType + \" ìœ¼ë¡œ ì¸í•´ \" + email + \" ë¡œ ì´ë©”ì¼ì„ ì „ì†¡í•˜ì˜€ìŠµë‹ˆë‹¤.\"); }}ìœ„ ì½”ë“œëŠ” êµ¬ë…ì ì½”ë“œë“¤ì…ë‹ˆë‹¤. ì˜µì €ë²„ ì¸í„°í˜ì´ìŠ¤ê°€ ìˆê³  ì˜µì €ë²„ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤ 2ê°œê°€ ìˆìŠµë‹ˆë‹¤.public class Client { public static void main(String[] args) { Editor editor = new Editor(); editor.events.subscribe(\"open\", new LogOpenListener(\"D:\\\\file.txt\")); editor.events.subscribe(\"save\", new EmailNotificationListener(\"admin@example.com\")); try { editor.openFile(\"test.txt\"); editor.saveFile(); } catch (Exception e) { e.printStackTrace(); } }}ë§ˆì§€ë§‰ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì…ë‹ˆë‹¤. ì—ë””í„°ë¥¼ ìƒì„±í•˜ê³  íŒŒì¼ì„ open í•  ê²½ìš° LogOpenListenerì„ í†µí•´ í•´ë‹¹ íŒŒì¼ì´ ì—´ë ¸ë‹¤ëŠ” ì •ë³´ë¥¼ ë¡œê·¸ì— ì €ì¥í•©ë‹ˆë‹¤.íŒŒì¼ì„ saveí•  ê²½ìš° íŒŒì¼ì´ ì €ì¥ë˜ì—ˆë‹¤ëŠ” ì •ë³´ë¥¼ ë¯¸ë¦¬ ì§€ì •í•´ë‘” ì´ë©”ì¼(admin@example.com) ì— ì „ì†¡í•©ë‹ˆë‹¤.ê²°ë¡ ì˜µì €ë²„ íŒ¨í„´ì€ ì£¼ë¡œ gui í”„ë¡œê·¸ë¨ì—ì„œ ì‚¬ìš©ë˜ê³¤ í•©ë‹ˆë‹¤. ì¤‘ìš”í•œì ì€ í•œ ê°ì²´ê°€ ë³€ê²½ë˜ì—ˆìŒì„ ë‹¤ë¥¸ ê°ì²´ì— ì•Œë ¤ì•¼ í•˜ëŠ” ê²½ìš° ê²Œì‹œì(Publisher), êµ¬ë…ì(Observer), ì•Œë¦¼(Notify)ì˜ í˜•íƒœë¡œ êµ¬í˜„í•œë‹¤ëŠ” ì ì…ë‹ˆë‹¤.ì°¸ì¡° https://refactoring.guru/design-patterns/observerhttps://refactoring.guru/design-patterns/observer/java/example" }, { "title": "ì‹±ê¸€í„´ íŒ¨í„´ (Singleton Pattern)", "url": "/posts/singleton-pattern/", "categories": "Design Pattern", "tags": "Design Pattern, Java", "date": "2021-07-06 20:12:00 +0900", "snippet": "ì‹±ê¸€í„´ íŒ¨í„´ì‹±ê¸€í„´ íŒ¨í„´ì€ ìƒì„±ìê°€ ì—¬ëŸ¬ ì°¨ë¡€ í˜¸ì¶œë˜ë”ë¼ë„ ì‹¤ì œë¡œ ìƒì„±ë˜ëŠ” ê°ì²´ëŠ” í•˜ë‚˜ì´ê³  ìµœì´ˆ ìƒì„± ì´í›„ í˜¸ì¶œëœ ìƒì„±ìëŠ”ìµœì´ˆì˜ ìƒì„±ìê°€ ìƒì„±í•œ ê°ì²´ë¥¼ ë¦¬í„´í•˜ëŠ” ë””ìì¸ ìœ í˜•ì…ë‹ˆë‹¤.êµ¬ì¡° ì‹±ê¸€í„´ í´ë˜ìŠ¤ëŠ” ìì²´ í´ë˜ìŠ¤ì˜ ë™ì¼í•œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ” getInstance() ë¼ëŠ” ì •ì  ë©”ì†Œë“œë¥¼ ì„ ì–¸í–ˆìŠµë‹ˆë‹¤. ì‹±ê¸€í„´ì˜ ìƒì„±ìëŠ” í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì—ì„œëŠ” í™•ì¸í•  ìˆ˜ ì—†ë„ë¡ ìˆ¨ê²¨ì•¼ í•©ë‹ˆë‹¤. getInstance() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒ ë§Œì´ ì‹±ê¸€í„´ ê°ì²´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ìœ ì¼í•œ ë°©ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤. ì ìš© ê°€ëŠ¥í•œ ê²½ìš° í”„ë¡œê·¸ë¨ í´ë˜ìŠ¤ì— ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ê°€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í•œê°œì˜ ì¸ìŠ¤í„´ìŠ¤ë§Œ ì¡´ì¬í•´ì•¼ í•˜ëŠ” ê²½ìš° ì‹±ê¸€í„´ íŒ¨í„´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì˜ˆë¥¼ë“¤ì–´ ìœ„ì— ì–¸ê¸‰í–ˆë“¯ì´ DBCPê°€ ìˆìŠµë‹ˆë‹¤. ì‹±ê¸€í„´ íŒ¨í„´ì€ íŠ¹ë³„í•œ ë°©ë²•ì„ ì œì™¸í•˜ê³  í´ë˜ìŠ¤ì˜ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ë‹¤ë¥¸ ëª¨ë“  ìˆ˜ë‹¨ì„ ì°¨ë‹¨í•©ë‹ˆë‹¤. ì´ ë©”ì†Œë“œëŠ” ì´ë¯¸ ìƒì„±ëœ ê°ì²´ê°€ ìˆëŠ” ê²½ìš° ê¸°ì¡´ ê°ì²´ë¥¼ ë°˜í™˜í•˜ê³  ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ìƒˆ ê²ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì „ì—­ ë³€ìˆ˜ë¥¼ ë” ì—„ê²©í•˜ê²Œ ì»¨íŠ¸ë¡¤í•´ì•¼ í•˜ëŠ” ê²½ìš° ì‹±ê¸€í„´ íŒ¨í„´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì „ì—­ ë³€ìˆ˜ì™€ ë‹¬ë¦¬ ì‹±ê¸€í„´ íŒ¨í„´ì€ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ í•˜ë‚˜ë§Œ ìˆìŒì„ ë³´ì¥í•©ë‹ˆë‹¤. ì‹±ê¸€í„´ í´ë˜ìŠ¤ ìì²´ë¥¼ ì œì™¸í•˜ê³  ì´ë¯¸ ìºì‹œëœ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ëŒ€ì²´í•  ìˆ˜ ìˆëŠ” ê²ƒì€ ì—†ìŠµë‹ˆë‹¤. ì¥ë‹¨ì ì¥ì  í´ë˜ìŠ¤ì— í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë§Œ ì¡´ì¬í•¨ì„ í™•ì‹¤ì‹œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•œ ì „ì—­ ì—‘ì„¸ìŠ¤ í¬ì¸íŠ¸ë¥¼ ì–»ìŠµë‹ˆë‹¤. ì‹±ê¸€í„´ ê°ì²´ëŠ” ì²« ìš”ì²­ì‹œì—ë§Œ ì´ˆê¸°í™” ë©ë‹ˆë‹¤.ë‹¨ì  ì „ì—­ ì—‘ì„¸ìŠ¤ í¬ì¸íŠ¸ë¥¼ ì–»ê¸° ë•Œë¬¸ì— ë‹¨ì¼ ì±…ì„ ì›ì¹™ (Single Responsibility Principle)ì„ ìœ„ë°˜í•©ë‹ˆë‹¤. ë„ˆë¬´ ë§ì€ ê³³ì—ì„œ ì‚¬ìš©í•  ê²½ìš° ì˜ëª»ëœ ë””ìì¸ í˜•íƒœê°€ ë  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ íŠ¹ë³„í•œ ì²˜ë¦¬ê°€ í•„ìš”í•˜ë¯€ë¡œ ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ì‹±ê¸€í„´ ê°ì²´ë¥¼ ì—¬ëŸ¬ë²ˆ ìƒì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë§ì€ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ê°€ Mock ê°ì²´ë¥¼ ìƒì„±í•  ë•Œ ìƒì†ì— ì˜ì¡´í•˜ê¸° ë•Œë¬¸ì— ì‹±ê¸€í„´ì˜ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.ì˜ˆì œê°„ë‹¨í•œ ì‹±ê¸€í„´ì„ êµ¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤. ë‹¨ì§€ í•  ì¼ì€ ìƒì„±ìë¥¼ ìˆ¨ê¸°ê³  ì •ì ìœ¼ë¡œ ìƒì„±í•  ë©”ì†Œë“œë¥¼ êµ¬í˜„í•˜ë©´ ë©ë‹ˆë‹¤.Singleton.java: ì‹±ê¸€í„´ ê°ì²´public class Singleton { private static Singleton instance; public String value; private Singleton(String value) { try { Thread.sleep(1000); } catch (InterruptedException ex) { ex.printStackTrace(); } this.value = value; } public static Singleton getInstance(String value) { if (instance == null) { instance = new Singleton(value); } return instance; }}SingleThreadSingleton.java: í´ë¼ì´ì–¸íŠ¸ ì½”ë“œpublic class SingleThread { public static void main(String[] args) { System.out.println(\"ê°™ì€ ê°’ì„ ë³´ê²Œ ëœë‹¤ë©´ ì‹±ê¸€í„´ ê°ì²´ê°€ ì¬ì‚¬ìš©ëœ ê²ƒì…ë‹ˆë‹¤..!!\" + \"\\n\" + \"ë‹¤ë¥¸ ê°’ì„ ë³´ê²Œ ëœë‹¤ë©´ ë‘ê°œì˜ ì‹±ê¸€í„´ ê°ì²´ê°€ ìƒì„±ëœ ê²ƒì…ë‹ˆë‹¤..!!\"); Singleton singleton = Singleton.getInstance(\"x\"); Singleton anotherSingleton = Singleton.getInstance(\"y\"); System.out.println(singleton.value); System.out.println(anotherSingleton.value); }}ìœ„ ì½”ë“œë¥¼ ì‹¤í–‰í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.ê°™ì€ ê°’ì„ ë³´ê²Œ ëœë‹¤ë©´ ì‹±ê¸€í„´ ê°ì²´ê°€ ì¬ì‚¬ìš©ëœ ê²ƒì…ë‹ˆë‹¤..!!ë‹¤ë¥¸ ê°’ì„ ë³´ê²Œ ëœë‹¤ë©´ ë‘ê°œì˜ ì‹±ê¸€í„´ ê°ì²´ê°€ ìƒì„±ëœ ê²ƒì…ë‹ˆë‹¤..!!xxê²°ê³¼ê°’ì´ ê°™ì€ ê²ƒìœ¼ë¡œ ë³´ì•„ ì‹±ê¸€í„´ ê°ì²´ê°€ ì¬ì‚¬ìš©ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ìœ„ ì²«ë²ˆì§¸ ì˜ˆì œëŠ” ì‹±ê¸€ ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ì‹±ê¸€í„´ íŒ¨í„´ì„ ì‚¬ìš©í•œ ê²½ìš°ì…ë‹ˆë‹¤. ë§Œì•½ ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ì‹±ê¸€í„´ íŒ¨í„´ì„ êµ¬í˜„í•˜ê³ ì í•œë‹¤ë©´, ë‘ê°œ ì´ìƒì˜ ìŠ¤ë ˆë“œê°€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ íšë“í•˜ê¸° ìœ„í•´ getInstance() ë©”ì†Œë“œì— ì§„ì…í•˜ì—¬ ê²½ìŸí•˜ëŠ” ê³¼ì •ì— ë‘ê°œì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ëŠ”ì¼ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ê·¸ë ‡ë‹¤ë©´ ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ì‹±ê¸€í„´ íŒ¨í„´ì„ ì‚¬ìš©í•˜ê³ ì í•  ë•Œ ì–´ë–¤ì‹ìœ¼ë¡œ êµ¬í˜„í•´ì•¼ í• ê¹Œìš”? ì˜ˆì œë¥¼ í†µí•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.ì²«ë²ˆì§¸ ë°©ë²•ì€ DCL(Double Checked Locking) ì…ë‹ˆë‹¤. ì‚¬ì‹¤ ê·¸ë‹¤ì§€ ê¶Œê³ ë˜ì§€ ì•ŠëŠ” ë°©ë²•ì…ë‹ˆë‹¤.public static Singleton getInstance(String value) { if (instance == null) { synchronized(Singleton.class) { Singleton inst = instance; if (inst == null) { synchronized(Singleton.class) { instance = new Singleton(value); } } } } return instance;}ì¸ìŠ¤í„´ìŠ¤ê°€ null ì¼ ê²½ìš° ë™ê¸°í™” ë¸”ëŸ­ì— ì§„ì…í•´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì–¸ëœ»ë³´ê¸° ë¬¸ì œì—†ì–´ ë³´ì´ëŠ” ì½”ë“œì´ì§€ë§Œ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìŠ¤ë ˆë“œ a, ìŠ¤ë ˆë“œ b ê°€ ì¡´ì¬í•œë‹¤. ìŠ¤ë ˆë“œ aê°€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê¸° ì „ì— ë©”ëª¨ë¦¬ ê³µê°„ì— í• ë‹¹ì´ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— ìŠ¤ë ˆë“œ bê°€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ì§„ì…í•œë‹¤. ìŠ¤ë ˆë“œ aëŠ” ìŠ¤ë ˆë“œ bê°€ í• ë‹¹ëœ ê²ƒì„ ë³´ê³  ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë ¤ê³  í•˜ë‚˜ ìŠ¤ë ˆë“œ bì˜ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±ê³¼ì •ì´ ëë‚œ ìƒíƒœê°€ ì•„ë‹ìˆ˜ ìˆê¸° ë–„ë¬¸ì— ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤. ìœ„ì™€ ê°™ì€ ë¬¸ì œê°€ ìˆì–´ ë™ê¸°í™” ë¸”ë¡ì˜ ì‚¬ìš©ì„ ì¶”ì²œí•˜ì§€ëŠ” ì•Šê³  LazyHolderê¸°ë²• ì‚¬ìš©ì„ ì¶”ì²œí•©ë‹ˆë‹¤.public class Singleton { private static class LazyHolder { private static final Singleton INSTANCE = new Singleton(); } private Singleton() { } public static Singleton getInstance() { return LazyHolder.INSTANCE; }}ìœ„ ì˜ˆì œëŠ” getInstance() ê°€ í˜¸ì¶œë ë•Œë§Œ ì‹±ê¸€í„´ í´ë˜ìŠ¤ë¥¼ ì´ˆê¸°í™”í•˜ê³  100% Thread-safe í•©ë‹ˆë‹¤. ì‹¬ì§€ì–´ í´ë˜ì‹í•œ ë°©ë²•ì´ì–´ì„œ ìë°” ë²„ì „ì— êµ¬ì• ë°›ì§€ ì•Šê³  ì„±ëŠ¥ë„ ê½¤ ë†’ìŠµë‹ˆë‹¤.ìœ„ ì½”ë“œê°€ ë™ì‘í•˜ëŠ” ì´ìœ ëŠ” í´ë˜ìŠ¤ ë¡œë”ê°€ í´ë˜ìŠ¤ì˜ ì •ì  ì´ˆê¸°í™”ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ìì²´ ë™ê¸°í™” ì½”ë“œë¥¼ ê°–ê³  ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. í´ë˜ìŠ¤ê°€ ì‚¬ìš©ë˜ê¸° ì „ì— ì •ì  ì´ˆê¸°í™”ê°€ ì™„ë£Œë˜ì—ˆìŒì„ ë³´ì¥ë°›ì„ ìˆ˜ ìˆìœ¼ë©° ìœ„ ì½”ë“œì—ì„œ í´ë˜ìŠ¤ëŠ” getInstance() ë©”ì†Œë“œì—ì„œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.ì´ëŠ” getInstance() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•  ë•Œ í´ë˜ìŠ¤ê°€ ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ ë¡œë“œí•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.ê²°ë¡ ì‹±ê¸€í„´ íŒ¨í„´ì€ ì¸ìŠ¤í„´ìŠ¤ê°€ í•œê°œë§Œ ìƒì„±ë˜ì–´ì•¼ í•˜ëŠ” ê²½ìš°ì— ì í•©í•œ íŒ¨í„´ì…ë‹ˆë‹¤. ë‹¤ë§Œ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì—ì„œ ì „ì—­ ì—‘ì„¸ìŠ¤ í¬ì¸íŠ¸ë¥¼ ì–»ì–´ ë„ˆë¬´ ë§ì€ ê³³ì—ì„œ ì‚¬ìš©í•˜ë©´ í´ë˜ìŠ¤ê°„ì˜ ê²°í•©ë„ê°€ ë†’ì•„ì ¸ ì˜¤íˆë ¤ íŒ¨í„´ì„ ì‚¬ìš© ì•ˆí•˜ëŠë‹ˆë§Œ ëª»í•˜ê²Œ ë  ìˆ˜ë„ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.ì°¸ì¡° https://refactoring.guru/design-patterns/singletonhttps://stackoverflow.com/a/11072311/13160032" }, { "title": "í”„ë¡ì‹œ íŒ¨í„´ (Proxy Pattern)", "url": "/posts/proxy-pattern/", "categories": "Design Pattern", "tags": "Design Pattern, Java", "date": "2021-07-03 20:12:00 +0900", "snippet": "í”„ë¡ì‹œ íŒ¨í„´í”„ë¡ì‹œ(Proxy) ëŠ” ëŒ€ë¦¬ì ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤. ì‹¤ìƒí™œì„œì˜ ì˜ë¯¸ì²˜ëŸ¼ í”„ë¡œê·¸ë¨ì—ì„œì˜ í”„ë¡ì‹œë„ ëˆ„êµ°ê°€ì—ê²Œ ì–´ë–¤ ì¼ì„ ëŒ€ì‹  ì‹œí‚¤ëŠ” ê²ƒ ì´ë€ ì˜ë¯¸ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.ë•Œë•Œë¡œ ìš°ë¦¬ëŠ” ê°ì²´ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ì œì–´í•˜ëŠ” ê¸°ëŠ¥ì„ í•„ìš”í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë¬´ê²ê³  ë§ì€ ìì›ì„ í•„ìš”ë¡œ í•˜ëŠ” í´ë˜ìŠ¤ì˜ í•œë‘ê°€ì§€ ë©”ì†Œë“œë§Œ ì‚¬ìš©í•´ì•¼ í•˜ë”ë¼ë„ ìƒì„±ìë¡œ ì „ì²´ í´ë˜ìŠ¤ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™” í•©ë‹ˆë‹¤.ì´ ì‹œì ì— í”„ë¡ì‹œ íŒ¨í„´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¬´ê±°ìš´ ê°ì²´ê°€ ìƒì†í•˜ê³  ìˆëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†í•˜ëŠ” ê°€ë²¼ìš´ ê°ì²´ë¥¼ í•˜ë‚˜ ë§Œë“œëŠ” ë°©ì‹ì…ë‹ˆë‹¤.ì´ë•Œ ê°€ë²¼ìš´ ê°ì²´ë¥¼ í”„ë¡ì‹œ ë¼ê³  í•˜ë©° ìš°ë¦¬ëŠ” ì´ ê°€ë²¼ìš´ ê°ì²´ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™”í•˜ì—¬ ì‚¬ìš©í•˜ê³  ì‹¤ì œ ë¬´ê±°ìš´ í–‰ìœ„ë¥¼ í•˜ëŠ” ë©”ì†Œë“œëŠ” ì •ë§ ê·¸ ë©”ì†Œë“œê°€ í•„ìš”í•œ ì‹œì ì— í˜¸ì¶œí•  ê²ƒì…ë‹ˆë‹¤.ì ìš© ê°€ëŠ¥í•œ ê²½ìš° ì§€ì—° ì´ˆê¸°í™”(ê°€ìƒ í”„ë¡ì‹œ) - ê°€ë” í•„ìš”í•˜ì§€ë§Œ í•­ìƒ ë©”ëª¨ë¦¬ì— ì ì¬ë˜ì–´ ìˆëŠ” ë¬´ê±°ìš´ ì„œë¹„ìŠ¤ ê°ì²´ê°€ ìˆëŠ” ê²½ìš° ì„œë¹„ìŠ¤ê°€ ì‹œì‘ë  ë•Œ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ëŒ€ì‹ ì— ê°ì²´ ì´ˆê¸°í™”ê°€ ì‹¤ì œë¡œ í•„ìš”í•œ ì‹œì ì— ì´ˆê¸°í™”ë ìˆ˜ ìˆë„ë¡ ì§€ì—°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•¡ì„¸ìŠ¤ ì œì–´(ë³´í˜¸ í”„ë¡ì‹œ) - íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ë§Œ ì„œë¹„ìŠ¤ ê°ì²´ì— ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ í•˜ë ¤ëŠ” ê²½ìš° í”„ë¡ì‹œ ê°ì²´ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì˜ ìê²© ì¦ëª…ì´ ê¸°ì¤€ê³¼ ì¼ì¹˜í•˜ëŠ” ê²½ìš°ì—ë§Œ ì„œë¹„ìŠ¤ ê°ì²´ì— ìš”ì²­ì„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì›ê²© ì„œë¹„ìŠ¤ì˜ ë¡œì»¬ ì‹¤í–‰(ë¦¬ëª¨íŠ¸ í”„ë¡ì‹œ) - ì„œë¹„ìŠ¤ ê°ì²´ê°€ ì›ê²© ì„œë²„ì— ìœ„ì¹˜í•´ ìˆëŠ” ê²½ìš° í”„ë¡ì‹œ ê°ì²´ëŠ” ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ì „ë‹¬í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ì™€ ê´€ë ¨ëœ ë¶ˆí•„ìš”í•œ ì‘ì—…ë“¤ì„ ì²˜ë¦¬í•˜ê³  ê²°ê³¼ê°’ë§Œ ë°˜í™˜í•©ë‹ˆë‹¤. ë¡œê¹… ìš”ì²­(ë¡œê¹… í”„ë¡ì‹œ) - ì„œë¹„ìŠ¤ ê°ì²´ì— ëŒ€í•œ ê¸°ë¡ì„ ìœ ì§€í•˜ë ¤ëŠ” ê²½ìš° í”„ë¡ì‹œ ê°ì²´ëŠ” ì„œë¹„ìŠ¤ ê°ì²´ì— ìš”ì²­ì„ ì „ë‹¬í•˜ê¸° ìš”ì²­ì„ ê¸°ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìºì‹± ìš”ì²­ ê²°ê³¼(ìºì‹± í”„ë¡ì‹œ) - ì„œë¹„ìŠ¤ ê°ì²´ì˜ ê²°ê³¼ê°’ì´ í° ê²½ìš° í”„ë¡ì‹œëŠ” í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì˜ ê²°ê³¼ë¥¼ ìºì‹±í•˜ê³  ì´ ìºì‹œì˜ ìˆ˜ëª… ì£¼ê¸°ë¥¼ ê´€ë¦¬í•´ì•¼ í•˜ëŠ” ê²½ìš° í”„ë¡ì‹œëŠ” í•­ìƒ ë™ì¼í•œ ê²°ê³¼ë¥¼ ìƒì„±í•˜ëŠ” ë°˜ë³µ ìš”ì²­ì— ëŒ€í•´ ìºì‹±ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ìºì‹œ í‚¤ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìŠ¤ë§ˆíŠ¸ ì°¸ì¡° - ë¬´ê±°ìš´ ê°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì—†ì„ ë•Œ ë©”ëª¨ë¦¬ì—ì„œ í•´ì œí•´ì•¼ í•˜ëŠ” ê²½ìš° í”„ë¡ì‹œëŠ” ì„œë¹„ìŠ¤ ê°ì²´ì˜ ê²°ê³¼ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ì–»ì€ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì¶”ì €í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë•Œë•Œë¡œ í”„ë¡ì‹œëŠ” í´ë¼ì´ì–¸íŠ¸ë¡œ ë„˜ì–´ì™€ ì•„ì§ í´ë¼ì´ì–¸íŠ¸ê°€ í™œì„± ìƒíƒœì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.ë§Œì•½ í´ë¼ì´ì–¸íŠ¸ì˜ ë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆì„ ê²½ìš° í”„ë¡ì‹œëŠ” ì„œë¹„ìŠ¤ ê°ì²´ë¥¼ ì¢…ë£Œí•˜ê³  ë¶ˆí•„ìš”í•œ ì‹œìŠ¤í…œ ìì›ì„ ë©”ëª¨ë¦¬ì—ì„œ í•´ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¥ë‹¨ì ì¥ì  í´ë¼ì´ì–¸íŠ¸ê°€ ì•Œì§€ ëª»í•˜ëŠ” ìƒíƒœì—ì„œ ì„œë¹„ìŠ¤ ê°ì²´ë¥¼ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ê°€ ì‹ ê²½ì“°ì§€ ì•Šì„ ë•Œ ì„œë¹„ìŠ¤ ê°ì±„ì˜ ìƒëª… ì£¼ê¸°ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”„ë¡ì‹œëŠ” ì„œë¹„ìŠ¤ ê°ì²´ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ì‚¬ìš©í•  ìˆ˜ ì—†ì„ë•Œë„ ì‘ë™í•©ë‹ˆë‹¤. OCP(ê°œë°©-íì‡„ ì›ì¹™)ì— ë”°ë¼ ì„œë¹„ìŠ¤ë‚˜ í´ë¼ì´ì–¸íŠ¸ë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³  ìƒˆ í”„ë¡ì‹œë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë‹¨ì  ë§ì€ í”„ë¡ì‹œ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•´ì•¼ í•˜ë¯€ë¡œ ì½”ë“œê°€ ë” ë³µì¡í•´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”„ë¡ì‹œ í´ë˜ìŠ¤ ìì²´ì— ë“¤ì–´ê°€ëŠ” ìì›ì´ ë§ë‹¤ë©´ ì„œë¹„ìŠ¤ë¡œë¶€í„°ì˜ ì‘ë‹µì´ ì˜¤íˆë ¤ ëŠ¦ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì˜ˆì œì´ë¯¸ì§€ ë·°ì–´ í”„ë¡œê·¸ë¨ì„ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ ë·°ì–´ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë™ì‘ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì´ë¯¸ì§€ ë·°ì–´ëŠ” ê³ í•´ìƒë„ì˜ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì™€ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤˜ì•¼ í•©ë‹ˆë‹¤.ì‚¬ìš©ìê°€ ëª©ë¡ì—ì„œ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ê¸° ì „ê¹Œì§€ ì‹¤ì œ ì´ë¯¸ì§€ë¥¼ í‘œì‹œí•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.ë‹¤ìŒ ì½”ë“œëŠ” ì´ë¯¸ì§€ ì¸í„°í˜ì´ìŠ¤ ì…ë‹ˆë‹¤. ì´ë¯¸ì§€ë¥¼ ë Œë”ë§í•˜ê¸° ìœ„í•´ êµ¬í˜„ì²´ê°€ êµ¬í˜„í•´ì•¼ í•˜ëŠ” ì¶”ìƒë©”ì†Œë“œ showImage()ê°€ ìˆìŠµë‹ˆë‹¤.public interface Image { void showImage();}ë‹¤ìŒ ì½”ë“œëŠ” ìš°ë¦¬ê°€ í˜„ì¬ ì‚¬ìš©í•˜ê³  ìˆëŠ” ì´ë¯¸ì§€ ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ì…ë‹ˆë‹¤. ë””ìŠ¤í¬ì—ì„œ ê³ í•´ìƒë„ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì™€ ë©”ëª¨ë¦¬ì— ì ì¬í•˜ê³  showImage()ê°€ í˜¸ì¶œë˜ë©´ í™”ë©´ì— ë Œë”ë§ í•©ë‹ˆë‹¤.public class HighResolutionImage implements Image { public HighResolutionImage(String path) { loadImage(path); } private void loadImage(String path) { // ì´ë¯¸ì§€ë¥¼ ë””ìŠ¤í¬ì—ì„œ ë¶ˆëŸ¬ì™€ ë©”ëª¨ë¦¬ì— ì ì¬ // ì‘ì—… ìì²´ê°€ ë¬´ê²ê³  ë§ì€ ìì›ì„ í•„ìš”ë¡œí•¨ } @Override public void showImage() { // ì´ë¯¸ì§€ë¥¼ í™”ë©´ì— ë Œë”ë§ }}ë‹¤ìŒ ì½”ë“œëŠ” ì´ë¯¸ì§€ ë·°ì–´ ë©”ì¸ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.public class ImageViewer { public static void main(String[] args) { Image highResolutionImage1 = new HighResolutionImage(\"highResolutionImage1\"); Image highResolutionImage2 = new HighResolutionImage(\"highResolutionImage2\"); Image highResolutionImage3 = new HighResolutionImage(\"highResolutionImage3\"); highResolutionImage2.showImage(); }}ì‚¬ìš©ìê°€ 3ê°œì˜ ì´ë¯¸ì§€ê°€ ìˆëŠ” í´ë”ë¥¼ ì„ íƒí•˜ì˜€ìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì–´ë–¤ ì´ë¯¸ì§€ë¥¼ ì„ íƒí• ì§€ ëª°ë¼ ëª¨ë“  ì´ë¯¸ì§€ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™” í•˜ì˜€ìŠµë‹ˆë‹¤. ì‹¤ì œë¡œëŠ” highResolutionImage2 ë§Œ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤˜ì•¼ í•¨ì—ë„ ë¶ˆêµ¬í•˜ê³  HighResolutionImage í´ë˜ìŠ¤ì˜ ìƒì„±ìì— ì˜í•´ ëª¨ë“  ì´ë¯¸ì§€ëŠ” loadImage() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ê²Œ ë©ë‹ˆë‹¤.ì´ ì‹œì ì—ì„œ ë¶ˆí•„ìš”í•œ ìì›ë‚­ë¹„ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.ì, ì´ì œ ì´ë¯¸ì§€ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” ê°€ë²¼ìš´ í”„ë¡ì‹œ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.public class ImageProxy implements Image { private String path; private Image proxyImage; public ImageProxy(String path) { this.path = path; } @Override public void showImage() { proxyImage = new HighResolutionImage(path); proxyImage.showImage(); }}ì´ í´ë˜ìŠ¤ëŠ” showImage() ë©”ì†Œë“œê°€ í˜¸ì¶œë˜ëŠ” ì‹œì ì— HighResolutionImage í´ë˜ìŠ¤ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™” í•©ë‹ˆë‹¤.ì´ë¯¸ì§€ ë·°ì–´ ë©”ì¸ í´ë˜ìŠ¤ì˜ ì½”ë“œë¥¼ ë³€ê²½í•˜ê² ìŠµë‹ˆë‹¤.public class ImageViewer { public static void main(String[] args) { Image proxyHighResolutionImage1 = new ImageProxy(\"highResolutionImage1\"); Image proxyHighResolutionImage2 = new ImageProxy(\"highResolutionImage2\"); Image proxyHighResolutionImage3 = new ImageProxy(\"highResolutionImage3\"); proxyHighResolutionImage1.showImage(); }}ê°ì²´ì˜ íƒ€ì…ì€ Image ë¡œ ë™ì¼í•˜ì§€ë§Œ HighResolutionImage í´ë˜ìŠ¤ ëŒ€ì‹  ImageProxy ê°ì²´ë¡œ ì¸ìŠ¤í„´ìŠ¤í™” í•˜ì˜€ìŠµë‹ˆë‹¤.ì²«ë²ˆì§¸ ë©”ì¸ í´ë˜ìŠ¤ì˜ ê²½ìš°ì™€ëŠ” ë‹¤ë¥´ê²Œ ê°ì²´ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™” í•˜ëŠ” ì‹œì ì— HighResolutionImage í´ë˜ìŠ¤ì˜ loadImage() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.proxyHighResolutionImage1.showImage()ë¥¼ í˜¸ì¶œí•˜ëŠ” ì‹œì ì— loadImage() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ê²Œ ë©ë‹ˆë‹¤. ì‹¤ì œ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ì‹œì ì— ë©”ëª¨ë¦¬ ì ì¬ê°€ ì´ë£¨ì–´ì§€ê¸° ë•Œë¬¸ì— ë¶ˆí•„ìš”í•œ ìì›ë‚­ë¹„ê°€ ë°œìƒí•˜ì§€ ì•Šê²Œ ë©ë‹ˆë‹¤.ê²°ë¡ í”„ë¡ì‹œ íŒ¨í„´ì€ ë§ì€ ê³³ì—ì„œ ì“°ì´ê³  ìˆìŠµë‹ˆë‹¤. í•µì‹¬ì€ í´ë¼ì´ì–¸íŠ¸ -&gt; í”„ë¡ì‹œ -&gt; ì‹¤ì œ ê°ì²´ ë¡œ êµ¬ì„±ëœ êµ¬ì¡°ë¼ëŠ” ì ì…ë‹ˆë‹¤. ë§¤ìš° ê°„ë‹¨í•œ íŒ¨í„´ì´ì§€ë§Œ ìì¹« ì˜ëª»í•˜ë©´ ë¶ˆí•„ìš”í•œ ì½”ë“œë¡œ ì˜¤íˆë ¤ ë³µì¡í•´ ì§ˆìˆ˜ ìˆìœ¼ë‹ˆ ì ì¬ì ì†Œì— í™œìš©í•˜ëŠ” í¸ì¼ ì¢‹ì„ê²ƒ ê°™ìŠµë‹ˆë‹¤.ì°¸ì¡° https://refactoring.guru/design-patterns/proxyhttps://www.oodesign.com/proxy-pattern.html" }, { "title": "AWSë¥¼ ì‚¬ìš©í•´ ë¬´ì¤‘ë‹¨ ë°°í¬ ìë™í™” í™˜ê²½ êµ¬ì¶•í•˜ê¸° - 4. ì–´í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¶• ë° ë¡œë“œë°¸ëŸ°ì„œ ì ìš©", "url": "/posts/aws-cicd-4/", "categories": "AWS", "tags": "AWS, DevOps", "date": "2021-06-27 20:12:00 +0900", "snippet": "AWSë¥¼ ì‚¬ìš©í•´ ë¬´ì¤‘ë‹¨ ë°°í¬ ìë™í™” í™˜ê²½ êµ¬ì¶•í•˜ê¸° ì‹œë¦¬ì¦ˆ ê°œìš” VPCì™€ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ VPCì™€ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ ìƒì„±í•˜ê¸° ì–´í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¶• ë° ë¡œë“œë°¸ëŸ°ì„œ ì ìš© AWS ë¦¬ì†ŒìŠ¤ ì„¸íŒ… CodeDeploy ì—°ë™ / ë§ˆë¬´ë¦¬ì–´í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¶• ë° ë¡œë“œë°¸ëŸ°ì„œ ì ìš©ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ê°„ë‹¨í•œ Spring Boot ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ì–´ ec2 ì¸ìŠ¤í„´ìŠ¤ì— ë°°í¬í•˜ê³  ë¡œë“œë°¸ëŸ°ì„œë¥¼ ì ìš©í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ì´ ì‹œë¦¬ì¦ˆì˜ ì„œë²„ êµ¬ì„±ì€ 3-tier ê°€ ì•„ë‹Œ presentation, logic í‹°ì–´ê°€ í•œ í‹°ì–´ì— ì¡´ì¬í•˜ëŠ” ì¼ì¢…ì˜ 2-tier êµ¬ì„± ì…ë‹ˆë‹¤.3-tier ì™€ì˜ ì°¨ì´ì ì€ ì›¹(nginx, apache ë“±)ê³¼ ì–´í”Œë¦¬ì¼€ì´ì…˜(react, spring boot ë“±)ì´ í”„ë¡ì‹œ ì„¤ì •ì„ ì ìš©í•œ í•œê°œì˜ ì¸ìŠ¤í„´ìŠ¤ì— ì¡´ì¬í•œë‹¤ëŠ” ì ì…ë‹ˆë‹¤.3-tier ë¡œ êµ¬ì„±í•˜ë ¤ë©´ presentation(web), logic(was) í‹°ì–´ ê°„ì˜ í†µì‹ ì— NLB(Network Load Balancer)ë¥¼ ì‚¬ìš©í•˜ë©´ ë˜ë©° ì´ ì‹œë¦¬ì¦ˆë¥¼ ì˜ ì´í•´í•˜ì‹ ë‹¤ë©´ ì‰½ê²Œ ì ìš©í•˜ì‹¤ ìˆ˜ ìˆì„ ê²ƒì´ë¼ ìƒê°ë©ë‹ˆë‹¤.Spring Boot ì–´í”Œë¦¬ì¼€ì´ì…˜ ë§Œë“¤ê¸°í˜„ì¬ í˜¸ìŠ¤íŠ¸ipì™€ ì ‘ê·¼ipë¥¼ ë¦¬í„´í•˜ëŠ” ë©”ì†Œë“œ í•œê°œë¥¼ ê°€ì§„ ê°„ë‹¨í•œ Spring Boot ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.@RestController@SpringBootApplicationpublic class TestApplication { public static void main(String[] args) { SpringApplication.run(TestApplication.class, args); } @GetMapping(\"/ip\") public Map&lt;String, String&gt; ip(HttpServletRequest request) throws UnknownHostException { return new HashMap&lt;&gt;() {{ put(\"hostIp\", InetAddress.getLocalHost().getHostAddress()); put(\"accessIp\", request.getHeader(\"x-forwarded-for\")); }}; }}ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ì—ˆë‹¤ë©´ jar íŒŒì¼(í˜¹ì€ war íŒŒì¼) ë¡œ ë¹Œë“œ í›„ í”„ë¼ì´ë¹— ì„œë¸Œë„· ë‚´ë¶€ ì¸ìŠ¤í„´ìŠ¤ì— ì˜®ê²¨ë‘¬ì•¼ í•©ë‹ˆë‹¤. í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ë‹¤ì´ë ‰íŠ¸ë¡œ ì ‘ê·¼í•˜ëŠ” ë°©ë²•(SSH Tunneling ë“±)ì— ëŒ€í•´ ëª¨ë¥´ê³  ê³„ì‹ ë‹¤ë©´ ì–´ì©” ìˆ˜ ì—†ì´Bastion Hostì— í•œë²ˆ ì˜®ê¸°ê³  ê°ê°ì˜ ì¸ìŠ¤í„´ìŠ¤ì— ë‹¤ì‹œ íŒŒì¼ì„ ì „ì†¡í•´ì•¼ í•©ë‹ˆë‹¤. ì €ëŠ” scp ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ì„ ì „ì†¡í•˜ì˜€ìŠµë‹ˆë‹¤.scp -i key.pem test.jar -r private.ip:/home/ec2-userí˜„ì¬ í”„ë¼ì´ë¹— ì„œë¸Œë„· ë‚´ë¶€ ì¸ìŠ¤í„´ìŠ¤ì—ëŠ” ì•„ë¬´ íŒ¨í‚¤ì§€ë„ ì„¤ì¹˜ë˜ì§€ ì•Šì€ ìƒíƒœì…ë‹ˆë‹¤. ë”°ë¼ì„œ íƒ€ì„ì¡´ì„ ì„¸íŒ…í•˜ê³  í•„ìš” íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. (Amazon Linux 2 ê¸°ì¤€)# íƒ€ì„ì¡´ ì„¸íŒ…rm /etc/localtimeln -s /usr/share/zoneinfo/Asia/Seoul /etc/localtime# nginx ì„¤ì¹˜amazon-linux-extras install nginx1 -ysystemctl enable nginxsystemctl start nginx# open jdk 11 ì„¤ì¹˜amazon-linux-extras install java-openjdk11 -yíƒ€ì„ì¡´ì„ ì„¸íŒ…í•˜ê³  nginx, javaë¥¼ ì„¤ì¹˜í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ì œ ì˜®ê¸´ jar íŒŒì¼ì„ ì‹¤í–‰í•˜ê² ìŠµë‹ˆë‹¤.nohup java -jar -Dserver.port=8080 /home/ec2-user/test.jar 1&gt; /dev/null 2&gt;&amp;1 &amp;jar íŒŒì¼ì´ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ì•„ê¹Œ ë§Œë“  ë©”ì†Œë“œë¥¼ curl ëª…ë ¹ì–´ë¥¼ ì´ìš©í•´ í˜¸ì¶œí•´ë³´ê² ìŠµë‹ˆë‹¤.curl -l localhost:8080/ip{\"accessIp\":\"127.0.0.1\",\"hostIp\":\"192.168.2.118\"}í˜„ì¬ ì¸ìŠ¤í„´ìŠ¤ì˜ í”„ë¼ì´ë¹— IPv4 ì£¼ì†Œê°€ hostIpì— ì°í˜€ìˆë‹¤ë©´ ì„±ê³µì…ë‹ˆë‹¤.Application Load Balancer ìƒì„± / ì ìš©í•˜ê¸°í”„ë¼ì´ë¹— ì¸ìŠ¤í„´ìŠ¤ì— ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í–ˆì§€ë§Œ ì™¸ë¶€ì—ì„œì˜ ì ‘ê·¼ì€ ë¶ˆê°€ëŠ¥í•œ ìƒíƒœì…ë‹ˆë‹¤. ì´ì œ ë¡œë“œë°¸ëŸ°ì„œë¥¼ ìƒì„±í•˜ê³  http í”„ë¡œí† ì½œë¡œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ í•´ë³´ê² ìŠµë‹ˆë‹¤.ëŒ€ìƒê·¸ë£¹ ìƒì„±í•˜ê¸°ë¡œë“œë°¸ëŸ°ì„œë¥¼ ìƒì„±í•˜ê¸° ì „ì— ë¡œë“œë°¸ëŸ°ì„œê°€ íƒ€ê²Ÿìœ¼ë¡œ ì‚¼ì„ ëŒ€ìƒ ê·¸ë£¹ì„ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. aws ì½˜ì†”ì—ì„œ ëŒ€ìƒê·¸ë£¹ì„ ê²€ìƒ‰í•˜ì—¬ ë¡œë“œë°¸ëŸ°ì„œ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™í•˜ê² ìŠµë‹ˆë‹¤. ì´ë™í•˜ì˜€ë‹¤ë©´ ìš°ì¸¡ ìƒë‹¨ì˜ Create target group ì„ í´ë¦­í•©ë‹ˆë‹¤.ê·¸ í›„ ì•„ë˜ ì„¤ì •ì²˜ëŸ¼ ì„¤ì • í•œ í›„ ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤. Health check path ì— /health ë¼ê³  ì…ë ¥í•´ë‘”ê²ƒì„ ì˜ ê¸°ì–µí•´ë‘ì„¸ìš”.íƒ€ê²Ÿì—ëŠ” í”„ë¼ì´ë¹— ì„œë¸Œë„· ë‚´ë¶€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì„ íƒí•˜ê³  ì¶”ê°€í•œ í›„, Create target group ì„ í´ë¦­í•˜ì—¬ íƒ€ê²Ÿ ê·¸ë£¹ì„ ìƒì„±í•©ë‹ˆë‹¤.ë¡œë“œë°¸ëŸ°ì„œ ìƒì„±í•˜ê¸°aws ì½˜ì†”ì—ì„œ ë¡œë“œë°¸ëŸ°ì„œë¥¼ ê²€ìƒ‰í•˜ì—¬ ë¡œë“œë°¸ëŸ°ì„œ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™í•˜ê² ìŠµë‹ˆë‹¤. ì´ë™í•˜ì˜€ë‹¤ë©´ ì¢Œì¸¡ ìƒë‹¨ì˜ Load Balancer ìƒì„± ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.ì²«ë²ˆì§¸ Application Load Balancerì˜ ìƒì„± ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤. ë¦¬ìŠ¤ë„ˆê°€ 80í¬íŠ¸ì— ì—°ê²°ë˜ì–´ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ê°€ìš©ì˜ì—­ì„ ì§€ì •(2a, 2c)í•œ í›„ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.ë‘ë²ˆì§¸ ë³´ì•ˆ ì„¤ì • êµ¬ì„± ë‹¨ê³„ëŠ” í˜„ì¬ https í”„ë¡œí† ì½œì„ ì ìš©í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ë„˜ì–´ê°‘ë‹ˆë‹¤. (ì‹¤ì œ ë°°í¬ë  í”„ë¡œë•ì…˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.)ì„¸ë²ˆì§¸ ë³´ì•ˆ ê·¸ë£¹ êµ¬ì„±ì—ëŠ” 80í¬íŠ¸ë§Œ ì˜¤í”ˆí•œ ë³´ì•ˆê·¸ë£¹ì„ í•˜ë‚˜ ë§Œë“¤ê³  ì ìš©í•©ë‹ˆë‹¤.ë„¤ë²ˆì§¸ ë¼ìš°íŒ… êµ¬ì„±ì—ì„œëŠ” ë°©ê¸ˆ ë§Œë“  ëŒ€ìƒê·¸ë£¹ì„ ì„ íƒí•˜ê³  ë„˜ì–´ê°‘ë‹ˆë‹¤.êµ¬ì„±ì„ ì™„ë£Œí•˜ì˜€ë‹¤ë©´ ë¡œë“œë°¸ëŸ°ì„œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.ì‹¤ì œ ì ‘ê·¼í•˜ê¸°DNS ì´ë¦„ì„ ë³µì‚¬í•˜ê³  ë¸Œë¼ìš°ì € ì£¼ì†Œì°½ì— ë¶™ì—¬ë„£ì€í›„ ì ‘ê·¼í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ì™¸ë¶€ ë„ë©”ì¸ ë“±ë¡ ì—…ì²´ë¥¼ ì´ìš©í•˜ëŠ” ê²½ìš° ì´ DNSë¥¼ í•´ë‹¹ ë„ë©”ì¸ì— ì—°ê²°í•˜ë©´ ë©ë‹ˆë‹¤.ê´€ë ¨í•´ì„œëŠ” ì—…ì²´ë§ˆë‹¤ ì„¤ì •ë°©ë²•ì´ ë‹¤ë¥´ë‹ˆ ì´ìš©í•˜ê³  ìˆëŠ” ì—…ì²´ì— ë¬¸ì˜í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.ì ‘ê·¼ì´ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë¡œë“œë°¸ëŸ°ì„œë¥¼ ìƒì„±í•˜ê³  ì ìš©í–ˆì§€ë§Œ ì•„ì§ ëª‡ê°€ì§€ í™•ì¸í•´ì•¼ í• ê²ƒì´ ë‚¨ì•„ìˆìŠµë‹ˆë‹¤. ëŒ€ìƒê·¸ë£¹ì— ì—°ê²°ëœ íƒ€ê²Ÿë“¤ì´ ëª¨ë‘ healthy ìƒíƒœì¸ê°€? ë¡œë“œë°¸ëŸ°ì„œê°€ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í”„ë¼ì´ë¹— ì„œë¸Œë„· ë‚´ë¶€ ì¸ìŠ¤í„´ìŠ¤ì˜ ë³´ì•ˆê·¸ë£¹ì„ ìˆ˜ì •í•˜ì˜€ëŠ”ê°€? ì›¹ì„œë²„ì™€ wasê°€ í”„ë¡ì‹œ ì„¤ì •ì„ í†µí•´ ì—°ê²°ë˜ì—ˆëŠ”ê°€?1ë²ˆ í•­ëª©ë¶€í„° ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. ëŒ€ìƒ ê·¸ë£¹ì€ ë§Œë“¤ë•Œ ì„¤ì •í•œ Health check path ë¥¼ í†µí•´ í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ê°€ ìœ íš¨í•œ ìƒíƒœì¸ì§€ íŒë‹¨í•©ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ìœ„ì—ì„œ /health ë¼ê³  ì„¤ì •í•˜ì˜€ê¸° ë•Œë¬¸ì— ì¸ìŠ¤í„´ìŠ¤ì˜ nginx ì„¤ì •ì„ ë°”ê¿”ì£¼ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤./etc/nginx/conf.d/test.confserver { listen 80; location /health { return 200; }}config íŒŒì¼ì„ í•˜ë‚˜ ë§Œë“¤ê³  /health ê²½ë¡œì— ëŒ€í•´ 200 ìƒíƒœê°’ì„ ë°˜í™˜í•˜ë„ë¡ ì„¤ì •í•˜ì˜€ìŠµë‹ˆë‹¤. ì €ì¥í›„ nginxë¥¼ ì¬ì‹œì‘í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ìŠì§€ ë§ˆì„¸ìš”.ë‹¤ì‹œ ëŒ€ìƒê·¸ë£¹ ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ì™€ ë°©ê¸ˆ ë§Œë“  ëŒ€ìƒê·¸ë£¹ì„ ì„ íƒí•˜ê³  ë“±ë¡í•œ íƒ€ê²Ÿì˜ Health statusê°€ healthy ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤. (ê°€ìš©ì¡´ë³„ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì˜€ë‹¤ë©´ ë“±ë¡í•œ íƒ€ê²Ÿì€ Nê°œì—¬ì•¼ í•©ë‹ˆë‹¤.)ë‹¤ìŒì€ ë³´ì•ˆê·¸ë£¹ì…ë‹ˆë‹¤. í”„ë¼ì´ë¹— ì„œë¸Œë„· ë‚´ë¶€ ì¸ìŠ¤í„´ìŠ¤ì— ì ìš©ë˜ì–´ìˆëŠ” ë³´ì•ˆê·¸ë£¹ì„ ìˆ˜ì •í•˜ì—¬ ë¡œë“œë°¸ëŸ°ì„œê°€ 80í¬íŠ¸ë¥¼ í†µí•´ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.ë§ˆì§€ë§‰ìœ¼ë¡œ í”„ë¡ì‹œ ì„¤ì •ì…ë‹ˆë‹¤. ì•„ê¹Œ ìƒì„±í•œ test.conf íŒŒì¼ì„ ìˆ˜ì •í•˜ì—¬ 80í¬íŠ¸ë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ 8080í¬íŠ¸ë¡œ ë³´ë‚´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.server { listen 80; location /health { return 200; } location / { proxy_pass http://127.0.0.1:8080; }}ëª¨ë“  ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆë‹¤ë©´ nginx ì¬ì‹œì‘ í›„ DNSë¡œ ì ‘ì†í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ìš°ë¦¬ëŠ” https ì„¤ì •ì„ í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— http í”„ë¡œí† ì½œë¡œ ì ‘ì†í•´ì•¼ í•¨ì„ ìŠì§€ ë§ˆì„¸ìš”.DNS ì£¼ì†Œ/ip ë¡œ ì ‘ê·¼í–ˆì„ë•Œ ìœ„ì™€ê°™ì´ accessIpì—ëŠ” ë‚´ ipê°€, hostIpì—ëŠ” í”„ë¼ì´ë¹— ì¸ìŠ¤í„´ìŠ¤ì˜ IPv4 ì£¼ì†Œê°€ ì°í˜€ ë‚˜ì˜¨ë‹¤ë©´ ì„±ê³µì…ë‹ˆë‹¤. ë§Œì•½ ê°€ìš©ì¡´ë³„ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì„ êµ¬ì„±í•˜ì˜€ë‹¤ë©´ ìƒˆë¡œê³ ì¹¨ì„ ëˆŒë €ì„ë•Œ hostIPê°€ ê³„ì† ë°”ë€ŒëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”.ë§ˆì¹˜ë©°ì´ë²ˆ í¬ìŠ¤íŒ…ê¹Œì§€ ê¸°ë³¸ì ì¸ ì„œë²„ êµ¬ì¶•ì€ ëì´ ë‚¬ìŠµë‹ˆë‹¤. ì—¬ê¸°ê¹Œì§€ê°€ awsë¥¼ í™œìš©í•´ ì„¤ê³„í•  ìˆ˜ ìˆëŠ” ê°€ì¥ ê¸°ë³¸ì ì¸ í˜•íƒœì˜ ì•„í‚¤í…ì²˜ë¼ê³  ìƒê°ë˜ëŠ”ë°ìš”, ë‹¤ìŒ í¬ìŠ¤íŒ…ë¶€í„°ëŠ” Jenkinsì™€ Codedeployë¥¼ í™œìš©í•˜ì—¬ ë°°í¬ê¹Œì§€ ìë™í™” í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤." }, { "title": "AWSë¥¼ ì‚¬ìš©í•´ ë¬´ì¤‘ë‹¨ ë°°í¬ ìë™í™” í™˜ê²½ êµ¬ì¶•í•˜ê¸° - 3. VPCì™€ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ ìƒì„±í•˜ê¸°", "url": "/posts/aws-cicd-3/", "categories": "AWS", "tags": "AWS, DevOps", "date": "2021-06-26 10:28:00 +0900", "snippet": "AWSë¥¼ ì‚¬ìš©í•´ ë¬´ì¤‘ë‹¨ ë°°í¬ ìë™í™” í™˜ê²½ êµ¬ì¶•í•˜ê¸° ì‹œë¦¬ì¦ˆ ê°œìš” VPCì™€ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ VPCì™€ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ ìƒì„±í•˜ê¸° ì–´í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¶• ë° ë¡œë“œë°¸ëŸ°ì„œ ì ìš© AWS ë¦¬ì†ŒìŠ¤ ì„¸íŒ… CodeDeploy ì—°ë™ / ë§ˆë¬´ë¦¬VPCì™€ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ ìƒì„±í•˜ê¸°AWS ì½˜ì†”ì„ ì‚¬ìš©í•´ ì§ì ‘ VPCì™€ í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë“¤ì„ ìƒì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤.VPC ìƒì„±í•˜ê¸°ì²«ë²ˆì§¸ë¡œ VPCë¥¼ ìƒì„±í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.ì¼ë‹¨ AWS ì½˜ì†”ì— ì ‘ì†í•œ í›„ì—, ê²€ìƒ‰ì°½ì— VPCë¥¼ ê²€ìƒ‰í•´ VPC ëŒ€ì‹œë³´ë“œë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.ê·¸ í›„ ì˜¤ë¥¸ìª½ ìƒë‹¨ì˜ VPC ìƒì„±ì„ ëˆŒëŸ¬ VPC ìƒì„± í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.ì• í¬ìŠ¤íŒ…ì—ì„œ ë§ì”€ë“œë ¸ë“¯ì´ CIDR ë¸”ë¡ì—ëŠ” ì‚¬ì„¤ë§ ëŒ€ì—­ì„ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¼ë°˜ì ì¸ë°ìš”, ì €ëŠ” 3ê°€ì§€ì¤‘ 192.168.0.0/16 ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.IPv6 CIDR ë¸”ë¡ë„ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ ì—¬ê¸°ì„œëŠ” IPv4 CIDR ë¸”ë¡ì—ë§Œ ì´ˆì ì„ ë§ì¶”ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.VPC ê°€ ìƒì„± ë˜ì—ˆìŠµë‹ˆë‹¤.ì—¬ê¸°ê¹Œì§€ì˜ êµ¬ì„±ë„ì…ë‹ˆë‹¤.ì„œë¸Œë„· ìƒì„±í•˜ê¸°AWS ì½˜ì†” ê²€ìƒ‰ì°½ì— ì„œë¸Œë„·ì„ ê²€ìƒ‰í•˜ì—¬ ì„œë¸Œë„· ëŒ€ì‹œë³´ë“œë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤. ê·¸ í›„ ì˜¤ë¥¸ìª½ ìƒë‹¨ì˜ ì„œë¸Œë„· ìƒì„±ì„ ëˆŒëŸ¬ ì„œë¸Œë„· ìƒì„± í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.ë¨¼ì € ë°©ê¸ˆì „ ë§Œë“  VPCë¥¼ ì„ íƒí•´ì¤ë‹ˆë‹¤. ì„œë¸Œë„·ì€ ì´ 4ê°œë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. ê°€ìš©ì¡´ ap-northeast-2a, ap-northeast-2c ì— ê°ê° ì„œë¸Œë„· 2ê°œì”© ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.ê°€ìš©ì¡´ í•˜ë‚˜ì— ë§Œë“¤ì–´ë„ ë˜ì§€ë§Œ ì¥ì•  ëŒ€ì‘ ì¸¡ë©´ì—ì„œ ê°€ìš©ì¡´ì„ ë‚˜ëˆ„ì–´ ë§Œë“¤ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. (ë¬¼ë¡  ë” ë§ì€ ê°€ìš©ì¡´ì— ë§Œë“¤ì–´ë„ ë¬´ë°©í•©ë‹ˆë‹¤.)ìš°ë¦¬ê°€ ë§Œë“  VPCì˜ IP ë²”ìœ„ëŠ” 192.168.0.0 ~ 192.168.255.255 ì´ê¸° ë•Œë¬¸ì—, í•˜ë‚˜ì˜ ì„œë¸Œë„·ë‹¹ IPì˜ ë²”ìœ„ë¥¼ 192.168.X.X ë§Œí¼ ì„¤ì •í•´ ì£¼ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.ì„œë¸Œë„· 4ê°œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.ì—¬ê¸°ê¹Œì§€ì˜ êµ¬ì„±ë„ì…ë‹ˆë‹¤.ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ ìƒì„±í•˜ê¸°ì•ì„œ ë§Œë“  VPCëŠ” ì¸í„°ë„·ê³¼ ì—°ê²°ëœ í†µë¡œê°€ ì—†ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì´ ìƒíƒœì—ì„œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ë„ ì ‘ì†í•  ìˆ˜ ì—†ëŠ”ë°ìš”. ì•„ë§ˆì¡´ì—ì„œëŠ” ì¸í„°ë„· ì•¡ì„¸ìŠ¤ë¥¼ í™œì„±í™”í•˜ë ¤ë©´ ë‹¤ìŒì„ ìˆ˜í–‰í•´ì•¼ í•œë‹¤ê³  ì„¤ëª…í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ë¥¼ ìƒì„±í•˜ì—¬ VPCì— ì—°ê²°í•©ë‹ˆë‹¤. ì¸í„°ë„· ë°”ì¸ë”©ëœ íŠ¸ë˜í”½ì„ ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ë¡œ ì „ë‹¬í•˜ëŠ” ë¼ìš°íŒ…ì„ ì„œë¸Œë„·ì˜ ë¼ìš°íŒ… í…Œì´ë¸”ì— ì¶”ê°€í•©ë‹ˆë‹¤. ì„œë¸Œë„·ì˜ ì¸ìŠ¤í„´ìŠ¤ì— ì „ì—­ì ìœ¼ë¡œ ê³ ìœ í•œ IP ì£¼ì†Œ(í¼ë¸”ë¦­ IPv4 ì£¼ì†Œ, íƒ„ë ¥ì  IP ì£¼ì†Œ ë˜ëŠ” IPv6 ì£¼ì†Œ)ê°€ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì•¡ì„¸ìŠ¤ ì œì–´ ëª©ë¡ ë° ë³´ì•ˆ ê·¸ë£¹ ê·œì¹™ì—ì„œ ê´€ë ¨ íŠ¸ë˜í”½ì´ ì¸ìŠ¤í„´ìŠ¤ë¡œ, ê·¸ë¦¬ê³  ì¸ìŠ¤í„´ìŠ¤ì—ì„œ íë¥´ë„ë¡ í—ˆìš©ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. AWS ì½˜ì†” ê²€ìƒ‰ì°½ì— ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ë¥¼ ê²€ìƒ‰í•˜ì—¬ ëŒ€ì‹œë³´ë“œë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤. ê·¸ í›„ ì˜¤ë¥¸ìª½ ìƒë‹¨ì˜ ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ ìƒì„±ì„ ëˆŒëŸ¬ ìƒì„± í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ê³  ì´ë¦„ì„ ì…ë ¥í•˜ì—¬ ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ëŠ” ìƒì„±í›„ì— VPCì™€ ì—°ê²°í•´ ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. ì˜¤ë¥¸ìª½ ìƒë‹¨ì˜ ì‘ì—… íƒ­ì„ ì„ íƒí›„ VPCì— ì—°ê²°ì„ ì„ íƒí•˜ì—¬ VPC ì—°ê²° í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤. ê·¸í›„ ì²˜ìŒì— ë§Œë“  VPCë¥¼ ì„ íƒí•˜ê³  ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ ì—°ê²°ì„ ëˆŒëŸ¬ VPCì™€ ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ë¥¼ ì—°ê²°í•´ì¤ë‹ˆë‹¤.ì—¬ê¸°ê¹Œì§€ì˜ êµ¬ì„±ë„ì…ë‹ˆë‹¤.ë¼ìš°íŒ… í…Œì´ë¸” ìƒì„±í•˜ê¸°ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ë¥¼ ìƒì„±í•˜ì—¬ VPCì™€ ì—°ê²°í–ˆì§€ë§Œ ì•„ì§ ì¸ìŠ¤í„´ìŠ¤ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì•„ë§ˆì¡´ì—ì„œ ì„¤ëª…í•œëŒ€ë¡œ ì„œë¸Œë„·ì˜ ë¼ìš°íŒ… í…Œì´ë¸”ì´ ë°©ê¸ˆ ë§Œë“  ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ë¥¼ í–¥í•˜ê²Œ í•´ì•¼í•˜ëŠ”ë°ìš”. ì¼ë‹¨ ë¼ìš°íŒ… í…Œì´ë¸”ì„ ê²€ìƒ‰í•˜ì—¬ ë¼ìš°íŒ… í…Œì´ë¸” ëŒ€ì‹œë³´ë“œë¡œ ì§„ì…í•©ë‹ˆë‹¤.ê·¸ëŸ¬ë©´ ê¸°ë³¸ìœ¼ë¡œ ìƒì„±ëœ ë¼ìš°íŒ… í…Œì´ë¸” í•œê°œë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‰½ê²Œ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ì¼ë‹¨ ì´ë¦„ì„ rtb-publicìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤. ê·¸ í›„ í•˜ë‹¨ì˜ ë¼ìš°íŒ…ì„ ëˆŒëŸ¬ë³´ë©´ VPC ë‚´ë¶€ì—°ê²°ì„ ìœ„í•œ ê·œì¹™ë§Œ ì¡´ì¬í•˜ëŠ”ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¼ìš°íŒ… íƒ­ì˜ ë¼ìš°íŒ… í¸ì§‘ ì„ ëˆŒëŸ¬ ë¼ìš°íŒ…ì„ ì¶”ê°€í•´ë´…ì‹œë‹¤.ë¼ìš°í„°(ëª©ì ì§€)ëŠ” 0.0.0.0/0 ì„ ì§€ì •í•˜ê³  ë°©ê¸ˆ ë§Œë“  ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ë¥¼ íƒ€ê²Ÿê³¼ ì—°ê²°í•©ë‹ˆë‹¤.ë¼ìš°íŒ… í…Œì´ë¸”ì˜ ë¼ìš°íŒ…(ëª©ì ì§€)ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.ì´ì œ ë¼ìš°íŒ… í…Œì´ë¸”ê³¼ ì„œë¸Œë„·ì„ ì—°ê²°í•´ì•¼ í•©ë‹ˆë‹¤. ì„œë¸Œë„· ì—°ê²° íƒ­ì„ ëˆŒëŸ¬ë³´ë©´ ëª…ì‹œì  ì—°ê²°ì´ ì—†ëŠ” ì„œë¸Œë„· ì´ ë³´ì´ëŠ”ë°ìš”, ì´ì¤‘ subnet-public-1 ê³¼ subnet-public-2 ì„œë¸Œë„·ì„ ì—°ê²°í•˜ì—¬ ì´ë¦„ë¿ì´ ì•„ë‹Œ ì§„ì§œ í¼ë¸”ë¦­ ì„œë¸Œë„·ìœ¼ë¡œ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤.ì„œë¸Œë„· ì—°ê²° íƒ­ì˜ ëª…ì‹œì  ì—°ê²°ì´ ì—†ëŠ” ì„œë¸Œë„· ë°•ìŠ¤ì—ì„œ ì„œë¸Œë„· ì—°ê²° í¸ì§‘ ì„ ëˆŒëŸ¬ ì„œë¸Œë„· ì—°ê²°ì„ í¸ì§‘ í™”ë©´ì— ì§„ì…í•©ë‹ˆë‹¤.subnet-public-1 ê³¼ subnet-public-2 ì„ ì„ íƒí•˜ê³  í•˜ë‹¨ì˜ ì—°ê²° ì €ì¥ ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.ì´ì œ ìœ„ì—ì„œ ë§Œë“  4ê°œì˜ ì„œë¸Œë„·ì¤‘ 2ê°œì˜ ì„œë¸Œë„·ì´ í¼ë¸”ë¦­ ì„œë¸Œë„·ì´ ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹¤ì œë¡œ ì—°ê²°ë˜ëŠ”ì§€ í•œë²ˆ í™•ì¸í•´ë´…ì‹œë‹¤.ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ì¸ìŠ¤í„´ìŠ¤ ëŒ€ì‹œë³´ë“œë¡œ ë“¤ì–´ê°€ ì˜¤ë¥¸ìª½ ìƒë‹¨ì˜ ì¸ìŠ¤í„´ìŠ¤ ì‹œì‘ì„ ëˆŒëŸ¬ ì¸ìŠ¤í„´ìŠ¤ ë§ˆë²•ì‚¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. ì¸ìŠ¤í„´ìŠ¤ ë§ˆë²•ì‚¬ ì„¤ì •ì„ ê°„ë‹¨í•˜ê²Œ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤. AMI ì„ íƒ - ì—¬ê¸°ì„œëŠ” Amazon Linux 2 AMIë¥¼ ì„ íƒí•˜ê² ìŠµë‹ˆë‹¤. ì¸ìŠ¤í„´ìŠ¤ ìœ í˜• ì„ íƒ - ìê¸ˆì˜ ì••ë°•ì´ ìˆê¸° ë•Œë¬¸ì— í”„ë¦¬í‹°ì–´ ì‚¬ìš© ê°€ëŠ¥ ìœ í˜•ì¸ t2.microë¥¼ ì„ íƒí•˜ê² ìŠµë‹ˆë‹¤. ì¸ìŠ¤í„´ìŠ¤ ì„¸ë¶€ ì •ë³´ êµ¬ì„± - ì´ê³³ì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ëŠ” ìš°ë¦¬ê°€ ë§Œë“  VPCë¥¼ ì„ íƒí•´ì£¼ê³  ì„œë¸Œë„·ì€ subnet-public-1ì„ ì„ íƒí•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ìŠ¤í† ë¦¬ì§€ëŠ” ê¸°ë³¸ 8GB ìŠ¤í† ë¦¬ì§€ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤ íƒœê·¸ëŠ” ê±´ë„ˆ ë›°ê² ìŠµë‹ˆë‹¤. ë³´ì•ˆê·¸ë£¹ë„ ìƒˆë¡œ ìƒì„±ë˜ëŠ” ë³´ì•ˆê·¸ë£¹ì„ ì„ íƒí•˜ê² ìŠµë‹ˆë‹¤. ê¸°ë³¸ì€ 0.0.0.0/0 ì— ëŒ€í•´ 22ë²ˆ í¬íŠ¸ê°€ ì—´ë ¤ìˆëŠ” í˜•íƒœì…ë‹ˆë‹¤. ì¸ìŠ¤í„´ìŠ¤ ì‹œì‘ì„ í´ë¦­í•©ë‹ˆë‹¤. ê·¸ í›„ ìƒˆ í‚¤ í˜ì–´ ìƒì„±ì„ ì„ íƒí•˜ê³  í‚¤ í˜ì–´ë¥¼ ë‹¤ìš´ë°›ì•„ ì˜ ì €ì¥í•´ ë‘¡ë‹ˆë‹¤. (ì£¼ì˜! ë‹¤ì‹œ ë‹¤ìš´ë¡œë“œ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.)ìƒì„±í•œ ì¸ìŠ¤í„´ìŠ¤ì˜ ì •ë³´ì…ë‹ˆë‹¤. VPC ì™€ í¼ë¸”ë¦­ ì„œë¸Œë„·ì´ ì˜¬ë°”ë¥´ê²Œ ë§¤í•‘ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.ê·¸ í›„ íƒ„ë ¥ì  IPë¥¼ í•œê°œ ë°œê¸‰ë°›ì•„ ì¸ìŠ¤í„´ìŠ¤ì™€ ì—°ê²°í•˜ê³ , SSH Clientë¥¼ ì‚¬ìš©í•´ ì›ê²© ì ‘ì†ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. íƒ„ë ¥ì  IPëŠ” ëŒ€ì‹œë³´ë“œ ì¢Œì¸¡ì˜ ë„¤íŠ¸ì›Œí¬ ë° ë³´ì•ˆ - íƒ„ë ¥ì  IP íƒ­ì—ì„œ í• ë‹¹ë°›ê³  ì—°ê²°ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.SSH Clientì˜ ì‚¬ìš©ë²•ì„ ëª¨ë¥´ì‹ ë‹¤ë©´ ì´ê³³ ì—ì„œ í™•ì¸í•´ë³´ì„¸ìš”.í¼ë¸”ë¦­ ì„œë¸Œë„·ìœ¼ë¡œì˜ ì „í™˜ê¹Œì§€ ì™„ë£Œí•œ êµ¬ì„±ë„ì…ë‹ˆë‹¤.ì• í¬ìŠ¤íŒ…ì—ì„œ ì„¤ëª…ë“œë ¸ë“¯ì´ ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ë¡œ í–¥í•˜ëŠ” ë¼ìš°íŒ…ì´ ì—†ëŠ” ë¼ìš°íŒ… í…Œì´ë¸”ê³¼ ì—°ê²°ëœ ì„œë¸Œë„·ì„ í”„ë¼ì´ë¹— ì„œë¸Œë„· ì´ë¼ í•©ë‹ˆë‹¤.í”„ë¼ì´ë¹— ì„œë¸Œë„·ì„ ë§Œë“¤ê¸° ìœ„í•´ rtb-private ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ ë¼ìš°íŒ… í…Œì´ë¸”ì„ ë§Œë“¤ê³  subnet-private-1 ê³¼ subnet-private-2 ì„œë¸Œë„·ì„ ì—°ê²°í•´ ë‘ê² ìŠµë‹ˆë‹¤.ì—¬ê¸°ê¹Œì§€ ë¼ìš°íŒ… í…Œì´ë¸”ì„ ë§Œë“¤ê³  í¼ë¸”ë¦­ ì„œë¸Œë„·, í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ì—°ê²°í•˜ì—¬ êµ¬ì„± ì™„ë£Œí•œ êµ¬ì„±ë„ì…ë‹ˆë‹¤.Bastion Host ìƒì„±í•˜ê¸°í¼ë¸”ë¦­ ì„œë¸Œë„·ì— í”„ë¡ íŠ¸ &amp; ë°±ì—”ë“œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì˜¬ë¦¬ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤. (ë¬¼ë¡  ê°€ëŠ¥ì€ í•©ë‹ˆë‹¤.) ë³´í†µ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì˜¬ë¦¬ê³  ì™¸ë¶€ì—ì„œì˜ ì ‘ê·¼ì€ ë¡œë“œë°¸ëŸ°ì„œë¥¼ í†µí•´ 80, 443 í¬íŠ¸ë§Œ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•˜ì§€ìš”.ê·¸ë ‡ë‹¤ë©´ í”„ë¼ì´ë¹— ì„œë¸Œë„· ë‚´ë¶€ ì¸ìŠ¤í„´ìŠ¤ì— ë¬¸ì œê°€ ìƒê²¨ ë‚´ PC ì—ì„œ ì§ì ‘ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”? ì •ë‹µì€ Bastion Host ì…ë‹ˆë‹¤. í¼ë¸”ë¦­ ì„œë¸Œë„·ì— ì•ˆìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ìƒì„±í•œ ì¸ìŠ¤í„´ìŠ¤ì—ì„œí”„ë¼ì´ë¹— IPv4 ì£¼ì†Œë¥¼ í†µí•´ ì¬ì ‘ì†í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ì¼ì¢…ì˜ í”„ë¡ì‹œ ì„œë²„ì´ì£ .ì‹œì‘í•˜ê¸° ì „ì— í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ì¸ìŠ¤í„´ìŠ¤ í•œê°œë¥¼ ë§Œë“¤ì–´ ë‘ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ì•„ê¹Œ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ê³¼ì •ì˜ 3. ì¸ìŠ¤í„´ìŠ¤ ì„¸ë¶€ ì •ë³´ êµ¬ì„± ì—ì„œ ì„œë¸Œë„·ë§Œ subnet-private-1 ìœ¼ë¡œ ë°”ê¾¸ê³  ë‹¤ë¥¸ ì˜µì…˜ì€ ìœ ì§€í•œì±„ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.í¼ë¸”ë¦­ IPv4 ì£¼ì†Œê°€ ì—†ê³  ì„œë¸Œë„· IDê°€ subnet-private-1 ì¸ ì¸ìŠ¤í„´ìŠ¤ í•œê°œë¥¼ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ì‚¬ì„¤ IP ëŒ€ì—­ì´ê¸° ë•Œë¬¸ì— ë‹¹ì—°íˆ í˜„ì¬ PC ì—ì„œ ì´ ì¸ìŠ¤í„´ìŠ¤ë¡œ ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.ì´ì œ í¼ë¸”ë¦­ ì„œë¸Œë„·ì— Bastion Host ìš©ë„ì˜ ì¸ìŠ¤í„´ìŠ¤ í•œê°œë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤. Bastion HostëŠ” ë³´í†µ Linuxë¡œ êµ¬ì„±í•©ë‹ˆë‹¤.í•˜ì§€ë§Œ ìì‹ ì´ í„°ë¯¸ë„ í™˜ê²½ì˜ ìš´ì˜ì²´ì œì— ìµìˆ™í•˜ì§€ ì•Šê±°ë‚˜ í„°ë¯¸ë„ í™˜ê²½ì˜ DB ì¡°ì‘ì— ìµìˆ™í•˜ì§€ ì•Šë‹¤ë©´ Windows í™˜ê²½ìœ¼ë¡œ êµ¬ì„±í•˜ëŠ”ê²ƒë„ ë¬´ë°©í•©ë‹ˆë‹¤.Windows í™˜ê²½ìœ¼ë¡œ êµ¬ì¶•í•˜ì˜€ì„ ê²½ìš° ì›ê²© ë°ìŠ¤í¬í†±ìœ¼ë¡œ í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼í•´ì•¼ í•˜ëŠ”ë°ìš”, ê´€ë ¨í•´ì„œëŠ” ë§ì€ ê¸€ê³¼ ì˜ˆì œê°€ ìˆìœ¼ë‹ˆ ê²€ìƒ‰í•´ ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤.í¼ë¸”ë¦­ ì„œë¸Œë„·ì— ì¸ìŠ¤í„´ìŠ¤ í•œê°œë¥¼ ìƒì„±í•˜ê³  íƒ„ë ¥ì  IPë¥¼ ì—°ê²°í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ ì¸ìŠ¤í„´ìŠ¤ê°€ Bastion Host ìš©ë„ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.ì´ì œ SSH Clientë¥¼ ì´ìš©í•´ ë°©ê¸ˆ ë§Œë“  Bastion Hostì— ì ‘ì†í•´ ë³´ê² ìŠµë‹ˆë‹¤.ifconfig ëª…ë ¹ì–´ë¥¼ í†µí•´ í˜„ì¬ ipë¥¼ í™•ì¸í•´ ë³´ë‹ˆ 192.168.0.247ë¡œ subnet-public-1ì— ìˆëŠ” ì»´í“¨í„°ì¸ê²ƒì„ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.ê·¸ í›„ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ìˆëŠ” ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í• ë•Œ ë§Œë“  .pem íŒŒì¼ì„ Bastion Hostë¡œ ì˜®ê¹ë‹ˆë‹¤. ì˜®ê¸´ í›„ì— ssh -i key.pem ec2-user:192.168.X.X ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼í•´ ë³´ê² ìŠµë‹ˆë‹¤.ìŒ? ì ‘ì†ì´ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì–´ë–»ê²Œ ëœ ì¼ì¼ê¹Œìš”?ì •ë‹µì€ ë³´ì•ˆê·¸ë£¹ì…ë‹ˆë‹¤. í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì‹¤ë•Œ ë³´ì•ˆê·¸ë£¹ì„ ì˜ í™•ì¸í•˜ì§€ ì•Šê³  ê·¸ëƒ¥ ê¸°ë³¸ ìƒì„±ë˜ëŠ” ë³´ì•ˆê·¸ë£¹ì„ ì ìš©í•˜ì…¨ë‹¤ë©´ ë¬¸ì œì—†ì´ ì ‘ê·¼í•˜ì…¨ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.ê·¸ëŸ¬ë‚˜ 22ë²ˆ í¬íŠ¸ì— ëŒ€í•´ ì¸ë°”ìš´ë“œ ê·œì¹™ì„ ì—†ì• ë²„ë¦¬ì…¨ë‹¤ë©´ ì ‘ê·¼ í•  ìˆ˜ ì—†ëŠ”ê²ƒì´ ë‹¹ì—°í•©ë‹ˆë‹¤.ë³´ì•ˆê·¸ë£¹ íƒ­ì— ë“¤ì–´ê°€ í˜„ì¬ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ì ìš©ë˜ì–´ ìˆëŠ” ë³´ì•ˆê·¸ë£¹ì„ ë³€ê²½í•˜ê² ìŠµë‹ˆë‹¤. ìœ í˜•ì— SSHë¥¼ ì„ íƒí•˜ì‹œê³  ì†ŒìŠ¤ì—ëŠ” Bastion Hostì˜ EIP CIDR ë¸”ë¡ì„ ì§ì ‘ ì…ë ¥í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ Bastion Hostì— ì ìš©ë˜ì–´ ìˆëŠ” ë³´ì•ˆê·¸ë£¹ì„ ì„ íƒí•´ì£¼ì„¸ìš”. (ì—¬ê¸°ì„œëŠ” í¸ì˜ìƒ public, private sg ë¼ ì§€ì¹­í•´ ë‘ì—ˆìŠµë‹ˆë‹¤.)ë³´ì•ˆê·¸ë£¹ì´ ì ìš©ë˜ì—ˆë‹¤ë©´ ë‹¤ì‹œí•œë²ˆ Bastion Hostì— ì ‘ì†í•´ì„œ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†í•´ ë³´ê² ìŠµë‹ˆë‹¤.í”„ë¼ì´ë¹— ì„œë¸Œë„· ë‚´ë¶€ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì† ì„±ê³µí•˜ì˜€ê³  ifconfig ëª…ë ¹ì–´ë¥¼ í†µí•´ subnet-private-1ì— ìˆëŠ” ì»´í“¨í„°ì¸ê²ƒì„ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.í˜¹ì‹œ ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë³´ê²Œ ëœë‹¤ë©´ ì „ì†¡í•œ key.pem íŒŒì¼ì˜ ê¶Œí•œì„ chmod 600 key.pem ëª…ë ¹ì–´ë¥¼ í†µí•´ ë°”ê¿”ì£¼ì„¸ìš”.Bastion Host ìƒì„±ì„ ì™„ë£Œí•˜ì˜€ê³  ì—¬ê¸°ê¹Œì§€ì˜ êµ¬ì„±ë„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ê·€ì°®ê²Œ ë­í•˜ëŸ¬ í•œë‹¨ê³„ ê±°ì³ì„œ ì ‘ê·¼í•´? ë‚´ ì»´í“¨í„°ì—ì„œ ë°”ë¡œ ì ‘ê·¼í•˜ëŠ” ë°©ë²•ì€ ì—†ì–´?ë¼ê³  ìƒê°í•˜ì‹œëŠ” ë¶„ë“¤ì´ ê³„ì‹¤í…ë°ìš” (ì €ë„ ê·¸ë¬ìŠµë‹ˆë‹¤â€¦)ì´ ë¶€ë¶„ì€ SSH Tunneling í˜¹ì€ SSH Reverse Tunneling ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìˆìœ¼ë‹ˆ ê¶ê¸ˆí•˜ì‹  ë¶„ë“¤ì€ ê²€ìƒ‰í•´ ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤.NAT Gateway ìƒì„±í•˜ê¸°Bastion Hostë¥¼ í†µí•´ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ìˆëŠ” ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼ê¹Œì§€ëŠ” ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì€ í˜„ì¬ ì¸í„°ë„·ê³¼ ê´€ë ¨ëœ ë™ì‘ì€ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ìœ ëŠ” ë‚˜ê°€ëŠ” ë¼ìš°íŒ…(ëª©ì ì§€)ì´ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.ì¼ë¡€ë¡œ sudo yum update ëª…ë ¹ì–´ë¥¼ ì³ë„ ì•„ë¬´ê²ƒë„ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì˜¤íˆë ¤ Connection time out ì´ë¼ëŠ” íƒ€ì„ì•„ì›ƒ ì—ëŸ¬ë©”ì‹œì§€ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë•Œ í•„ìš”í•œ ê²ƒì´ NAT Gateway ì…ë‹ˆë‹¤.AWS ì½˜ì†”ì—ì„œ NAT ê²Œì´íŠ¸ì›¨ì´ë¥¼ ê²€ìƒ‰í•˜ì—¬ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™í•œ í›„ì— ìš°ì¸¡ ìƒë‹¨ì˜ NAT ê²Œì´íŠ¸ì›¨ì´ ìƒì„±ì„ ëˆŒëŸ¬ ìƒì„±í™”ë©´ìœ¼ë¡œ ì´ë™í•´ë³´ê² ìŠµë‹ˆë‹¤. ì´ë¦„ì„ ì§€ì •í•˜ê³  ì„œë¸Œë„·ì€ subnet-public-1 ì„ ì§€ì •í•´ 2a ê°€ìš©ì˜ì—­ì˜ í¼ë¸”ë¦­ ì„œë¸Œë„·ì— NAT Gatewayê°€ ìƒì„±ë  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.ë§ˆì§€ë§‰ìœ¼ë¡œ íƒ„ë ¥ì  IPë¥¼ í•˜ë‚˜ í• ë‹¹ ë°›ì•„ ì ìš©í•˜ê³  NAT Gatewayë¥¼ ìƒì„±í•©ë‹ˆë‹¤.NAT Gatewayë¥¼ ìƒì„±í•˜ì˜€ì§€ë§Œ ì•„ì§ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ ì¸ìŠ¤í„´ìŠ¤ì—ì„œëŠ” ì¸í„°ë„·ì— ì ‘ì†í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ìœ ëŠ” í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ ë¼ìš°í„°(ëª©ì ì§€)ë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì¸ë°ìš”.ì´ë¥¼ ìˆ˜ì •í•˜ê¸° ìœ„í•´ ë¼ìš°íŒ… í…Œì´ë¸” ëŒ€ì‹œë³´ë“œë¡œ ì´ë™í•˜ì—¬ í˜„ì¬ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ì ìš©ë˜ì–´ ìˆëŠ” ë¼ìš°íŒ… í…Œì´ë¸”ì„ ì„ íƒí›„ ë¼ìš°íŒ… í¸ì§‘ì„ í´ë¦­í•˜ì—¬ í¸ì§‘í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.ë¼ìš°íŒ… í¸ì§‘í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ì˜€ë‹¤ë©´ 0.0.0.0/0 ì— ëŒ€í•œ ë¼ìš°íŒ…ì„ ì¶”ê°€í•˜ê³  ëŒ€ìƒì„ ë°©ê¸ˆ ë§Œë“  NAT Gatewayë¡œ ì§€ì •í•´ì£¼ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.í¸ì§‘ì´ ëª¨ë‘ ì™„ë£Œë˜ì—ˆë‹¤ë©´ ë‹¤ì‹œ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ ì ‘ì†í•˜ì—¬ sudo yum update ëª…ë ¹ì–´ë¥¼ ì³ë³´ê² ìŠµë‹ˆë‹¤.ì¸ìŠ¤í„´ìŠ¤ê°€ NAT Gatewayë¥¼ í†µí•´ ì¸í„°ë„·ê³¼ ì—°ê²°ë˜ì–´ íŒ¨í‚¤ì§€ê°€ ì—…ê·¸ë ˆì´ë“œ ë˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ë§Œì•½ ì™¸ë¶€ ì—…ì²´ì˜ apiì— ì ‘ê·¼í•´ì•¼ í•˜ëŠ”ë° ë³´ì•ˆ ì •ì±…ìƒ ê¸°ë³¸ ì ‘ê·¼ì€ ë§‰ì•„ë‘ê³  ì ‘ê·¼ í—ˆìš©í•  IPë¥¼ ì•Œë ¤ë‹¬ë¼ê³  í•˜ë©´ ë°©ê¸ˆ ë§Œë“  NAT Gatewayì˜ EIPë¥¼ ì•Œë ¤ì£¼ë©´ ë˜ê² ì£ ?ë˜ ì§€ê¸ˆì€ 2a ê°€ìš©ì˜ì—­ì—ë§Œ NAT Gatewayë¥¼ ë§Œë“¤ì—ˆì§€ë§Œ ë³´í†µ ê°€ìš©ì¡´ì˜ ìˆ˜ë§Œí¼ ë§Œë“ ë‹¤ê³  í•˜ë‹ˆ ì•Œë§ì€ ìˆ˜ì˜ NAT Gatewayë¥¼ ë§Œë“¤ì–´ ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤.NAT Gateway ê¹Œì§€ ìƒì„± ì™„ë£Œí•œ í˜„ì¬ê¹Œì§€ì˜ êµ¬ì„±ë„ì…ë‹ˆë‹¤." }, { "title": "AWSë¥¼ ì‚¬ìš©í•´ ë¬´ì¤‘ë‹¨ ë°°í¬ ìë™í™” í™˜ê²½ êµ¬ì¶•í•˜ê¸° - 2. VPCì™€ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤", "url": "/posts/aws-cicd-2/", "categories": "AWS", "tags": "AWS, DevOps", "date": "2021-06-22 20:12:00 +0900", "snippet": "AWSë¥¼ ì‚¬ìš©í•´ ë¬´ì¤‘ë‹¨ ë°°í¬ ìë™í™” í™˜ê²½ êµ¬ì¶•í•˜ê¸° ì‹œë¦¬ì¦ˆ ê°œìš” VPCì™€ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ VPCì™€ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ ìƒì„±í•˜ê¸° ì–´í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¶• ë° ë¡œë“œë°¸ëŸ°ì„œ ì ìš© AWS ë¦¬ì†ŒìŠ¤ ì„¸íŒ… CodeDeploy ì—°ë™ / ë§ˆë¬´ë¦¬VPCì™€ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ì„œë²„ êµ¬ì¶•ì˜ ì²«ë²ˆì§¸ ë‹¨ê³„ë¡œ AWSì˜ VPC (Virtual Private Cloud) ì™€ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ë“¤ì˜ ê°œë…ì„ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.ë¦¬ì „ &amp; ê°€ìš©ì˜ì—­VPCì— ëŒ€í•´ ì•Œì•„ë³´ê¸° ì „ì—, ë¦¬ì „ &amp; ê°€ìš©ì˜ì—­ ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.AWSì—ëŠ” ë¦¬ì „ì´ë¼ëŠ” ê°œë…ì´ ìˆìŠµë‹ˆë‹¤. AWSëŠ” ì „ ì„¸ê³„ì— ë°ì´í„° ì„¼í„°ë¥¼ ë‘ê³  ìˆëŠ”ë°ìš”, ì´ ë°ì´í„° ì„¼í„°ë¥¼ í´ë¦¬ìŠ¤í„°ë§í•˜ëŠ” ë¬¼ë¦¬ì  ìœ„ì¹˜ë¥¼ ë¦¬ì „ì´ë¼ê³  í•©ë‹ˆë‹¤.ê° ë¦¬ì „ì€ ì§€ë¦¬ ì˜ì—­ ë‚´ì—ì„œ ê²©ë¦¬ë˜ê³  ë¬¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬ëœ ì—¬ëŸ¬ ê°œì˜ ê°€ìš©ì˜ì—­(Availability Zone) ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” ë¦¬ì „ì„ ì„ íƒí•˜ì—¬ VPC ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ê°€ìš©ì˜ì—­(Availability Zone)ì€ AWS ë¦¬ì „ì˜ ì¤‘ë³µ ì „ë ¥, ë„¤íŠ¸ì›Œí‚¹ ë° ì—°ê²°ì´ ì œê³µë˜ëŠ” í•˜ë‚˜ ì´ìƒì˜ ê°œë³„ ë°ì´í„° ì„¼í„°ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. Nê°œì˜ ê°€ìš©ì˜ì„ ì‚¬ìš©í•˜ë©´1ê°œì˜ ê°€ìš©ì˜ì—­ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ ë†’ì€ ê°€ìš©ì„±, ë‚´ê²°í•¨ì„± ë° í™•ì¥ì„±ì„ ê°–ì¶˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ê³¼ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìš´ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‰½ê²Œ ë§í•´ ë¬¼ë¦¬ì ìœ¼ë¡œ ì˜ì—­ì´ ë¶„ë¦¬ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— í•œ ì˜ì—­ì— ì¥ì• ê°€ ë°œìƒí•´ë„ë‹¤ë¥¸ ì˜ì—­ì— íŠ¸ë˜í”½ì´ ëª°ë¦¬ê²Œ ë˜ì–´ ì»´í“¨í„°ì˜ ìì› ì‚¬ìš©ë¥ ì€ ë†’ì•„ì§€ê² ì§€ë§Œ ì‹œìŠ¤í…œì´ ë¨¹í†µì´ ë˜ëŠ” í˜„ìƒì€ í”¼í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤. ë¬¼ë¡  ì»´í“¨í„° ìì›ì— ë”°ë¼ ë¬¼ë¦¬ì ì¸ ì»´í“¨í„° ìˆ˜ë¥¼ ì¡°ì ˆí•˜ëŠ”ì˜¤í†  ìŠ¤ì¼€ì¼ë§ ê·¸ë£¹ì„ ì‚¬ìš©í•˜ë©´ ìì› ì‚¬ìš©ë¥ ì€ ìƒê´€ ì—†ëŠ” ì´ì•¼ê¸°ì´ê¸´ í•©ë‹ˆë‹¤.VPCVPC ëŠ” Virtual Private Cloudì˜ ì•½ìë¡œ, ì•„ë§ˆì¡´ì€ ê³µì‹ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ëª…í•˜ê³  ìˆìŠµë‹ˆë‹¤. Amazon Virtual Private Cloud(VPC)ë¥¼ ì‚¬ìš©í•˜ë©´ AWS í´ë¼ìš°ë“œì—ì„œ ë…¼ë¦¬ì ìœ¼ë¡œ ê²©ë¦¬ëœ ê³µê°„ì„ í”„ë¡œë¹„ì €ë‹í•˜ì—¬ ê³ ê°ì´ ì •ì˜í•˜ëŠ” ê°€ìƒ ë„¤íŠ¸ì›Œí¬ì—ì„œ AWS ë¦¬ì†ŒìŠ¤ë¥¼ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.IP ì£¼ì†Œ ë²”ìœ„ ì„ íƒ, ì„œë¸Œë„· ìƒì„±, ë¼ìš°íŒ… í…Œì´ë¸” ë° ë„¤íŠ¸ì›Œí¬ ê²Œì´íŠ¸ì›¨ì´ êµ¬ì„± ë“± ê°€ìƒ ë„¤íŠ¸ì›Œí‚¹ í™˜ê²½ì„ ì™„ë²½í•˜ê²Œ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.VPCì—ì„œ IPv4ì™€ IPv6ë¥¼ ëª¨ë‘ ì‚¬ìš©í•˜ì—¬ ë¦¬ì†ŒìŠ¤ì™€ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì•ˆì „í•˜ê³  ì‰½ê²Œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì¦‰, â€œAWSëŠ” ë…¼ë¦¬ì ìœ¼ë¡œ ê²©ë¦¬ëœ ê³µê°„ì„ í”„ë¡œë¹„ì €ë‹ í•˜ì—¬ ë…ë¦½ëœ í•˜ë‚˜ì˜ ê°€ìƒ ë¸”ë¡ì„ ì œê³µí•˜ë©°, VPCëŠ” AWSê°€ ì œê³µí•œ ê°€ìƒ ë¸”ë¡ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ì‚¬ìš©ìì˜ ê³„ì • ì „ìš© ê°€ìƒ ë„¤íŠ¸ì›Œí¬â€ ë¼ê³  ìƒê°í•˜ë©´ ì‰¬ìš¸ê²ƒ ê°™ìŠµë‹ˆë‹¤.ì´ ê°€ìƒ ë¸”ë¡ì€ ë‚´ë¶€ ë¦¬ì†ŒìŠ¤ë“¤ì„ ëª¨ë‘ public ìœ¼ë¡œ ê³µê°œí•  ìˆ˜ ìˆì§€ë§Œ, ëŒ€ë¶€ë¶„ì˜ ì‚¬ìš©ìë“¤ì´ ë‚´ë¶€ ë¦¬ì†ŒìŠ¤ë“¤ì„ ëª¨ë‘ private ìœ¼ë¡œ ë‘ê³  ê·¸ private ë¦¬ì†ŒìŠ¤ë“¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í•˜ë‚˜ì˜ Public EC2 ì¸ìŠ¤í„´ìŠ¤(Bastion Host) ë¥¼ ë‘ê³  ì‚¬ìš©í•˜ëŠ” í¸ì…ë‹ˆë‹¤. (Bastion Host ì— ëŒ€í•´ì„œ ëŠ” ì¶”í›„ì— ë‹¤ì‹œ ë‹¤ë£¨ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.)VPC ëŠ” 2019ë…„ë¶€í„° ê°•ì œë˜ì—ˆê¸° ë•Œë¬¸ì— AWSì—ì„œ ì œê³µí•˜ëŠ” ëŒ€ë¶€ë¶„ì˜ ì„œë¹„ìŠ¤ëŠ” VPC ì—†ì´ëŠ” ì‚¬ìš©í• ìˆ˜ê°€ ì—†ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.í•˜ë‚˜ì˜ VPCë¥¼ ë§Œë“¤ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ë¦¬ì†ŒìŠ¤ë“¤ì´ ìˆìŠµë‹ˆë‹¤. ê°œì¸ì ìœ¼ë¡œ AWSë¥¼ ì´ìš©í•´ ì„œë²„ êµ¬ì¶•ì„ í•˜ë ¤ë©´ í•„ìˆ˜ë¡œ ì•Œì•„ì•¼ í•œë‹¤ê³  ìƒê°ë˜ëŠ” ê°œë…ë“¤ì¸ë°ìš”. í•˜ë‚˜í•˜ë‚˜ ì§šì–´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.CIDRAWS ì½˜ì†”ì„ ì´ìš©í•´ VPCë¥¼ ìƒì„±í•˜ë ¤ê³  í•˜ë©´ CIDR ë¸”ë¡ ì„ ì§€ì •í•´ì•¼ í•œë‹¤ëŠ” ë¬¸êµ¬ë¥¼ ë§Œë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ê²°ë¡ ë¶€í„° ë§í•˜ìë©´ CIDRì€ â€œIPì£¼ì†Œ í• ë‹¹ ê¸°ë²•â€ ì…ë‹ˆë‹¤.CIDR ë¸”ë¡ì€ IP ì£¼ì†Œì™€ ìŠ¬ë˜ì‰¬ê°€ ë’¤ì— ë”°ë¼ì˜¤ëŠ” ë„·ë§ˆìŠ¤í¬ í˜•íƒœì˜ ìˆ«ìë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ìŠ¬ë˜ì‰¬ ë’¤ì— ì˜¤ëŠ” ìˆ«ìëŠ” IPì˜ ë²”ìœ„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.ì˜ˆë¥¼ ë“¤ì–´ IP 172.31.0.0/32 ëŠ” ì •í™•íˆ 172.31.0.0 ë¥¼ ê°€ë¦¬í‚µë‹ˆë‹¤.IPì˜ ë²”ìœ„ëŠ” ì§€ì •ëœ IPë¶€í„° 2^(32-n)ê°œ ì…ë‹ˆë‹¤. ë§Œì•½ ìˆ«ìê°€ 16ì´ë©´ 2^(32-16) = 65,536 ê°œì˜ IP ì£¼ì†Œë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.VPC ë‚´ë¶€ì˜ ìì›ë“¤ì€ ê°ê°ì˜ í”„ë¼ì´ë¹— ipë¥¼ ê°€ì§€ëŠ”ë°ìš”, ì´ë•Œ CIDR ë¸”ë¡ì˜ ë²”ìœ„ ì•ˆì—ì„œ IPë¥¼ í• ë‹¹ë°›ê²Œ ë©ë‹ˆë‹¤.VPC ë²”ìœ„ ë‚´ì—ì„œ í• ë‹¹ ê°€ëŠ¥í•œ IPê°€ ëª¨ë‘ í• ë‹¹ë˜ë©´ ë”ì´ìƒ ë¦¬ì†ŒìŠ¤ë¥¼ ë§Œë“¤ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í•œ VPC ì˜ ìµœëŒ€ í¬ê¸°ëŠ” 16ì…ë‹ˆë‹¤. ì¦‰, 65,356ê°œì˜ IPë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ì´ë³´ë‹¤ í° VPCëŠ” ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ë¬¼ë¡  ê·¸ëŸ´ì¼ì€ ì˜ ì—†ê² ì§€ìš”.)CIDR ë¸”ë¡ì„ ë§Œë“¤ë•Œ ì£¼ì˜í•´ì•¼í•  ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ì‚¬ì„¤ë§ ëŒ€ì—­ì´ ì•„ë‹Œ ì¸í„°ë„·ê³¼ ì—°ê²°ë˜ì–´ ìˆëŠ” ê²½ìš° ë¬¸ì œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ 3.51.0.0/16ë¥¼ ë¸”ë¡ìœ¼ë¡œ ì§€ì •í•œ ê²½ìš° ì´ VPC ì—ì„œ 3.51.0.0/16ë¡œ ì ‘ì†í•˜ëŠ” íŠ¸ë˜í”½ì€ VPC ë‚´ë¶€ë¡œ ë¼ìš°íŒ…ë©ë‹ˆë‹¤.ê·¸ëŸ°ë° 3.51.0.0/16 ë²”ìœ„ëŠ” ì™¸ë¶€ ì¸í„°ë„·ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë²”ìœ„ì˜ IP ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ VPC ë‚´ë¶€ì—ì„œëŠ” 3.51.0.0/16 ì— ì†í•œ ì¸í„°ë„· IPì— ì ‘ê·¼í•˜ëŠ” ê²ƒì´ ë¶ˆê°€ëŠ¥ í•©ë‹ˆë‹¤. ì™¸ë¶€ë¡œì˜ ì—°ê²°ì´ í•„ìš”í•œ ê²½ìš°ë¼ë©´ ë¬´ì¡°ê±´ ì‚¬ì„¤ë§ ëŒ€ì—­ì„ ì‚¬ìš©í•´ì•¼ í•˜ë©°, ê·¸ë ‡ì§€ ì•Šë”ë¼ë„ì‚¬ì„¤ë§ ëŒ€ì—­ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë˜ëŠ” í¸ì…ë‹ˆë‹¤. ì‚¬ì„¤ IP ëŒ€ì—­ì—ëŠ” ì•„ë˜ 3ê°€ì§€ ëŒ€ì—­ì´ ìˆìŠµë‹ˆë‹¤. Class A : 10.0.0.0 ~ 10.255.255.255 Class B : 172.16.0.0 ~ 172.31.255.255 Class C : 192.168.0.0 ~ 192.168.255.255ì„œë¸Œë„·VPCë¥¼ ë¦¬ì „ì— ìƒì„±í•œê²ƒ ë§Œìœ¼ë¡œëŠ” ì•„ë¬´ê²ƒë„ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. VPCëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ë‹¤ì‹œ CIDR ë¸”ë¡ìœ¼ë¡œ ë‚˜ë‰˜ì–´ì§€ê³ , ì„œë¸Œë„·ì€ ì‹¤ì œ VPC ë‚´ë¶€ì—ì„œ ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ë˜ëŠ” ë¬¼ë¦¬ì  ê³µê°„ì¸ ê°€ìš©ì˜ì—­(Availability Zone) ê³¼ ì—°ê²°ë©ë‹ˆë‹¤.VPCê°€ ë…¼ë¦¬ì ì¸ ë²”ìœ„ë¼ë©´, ì„œë¸Œë„·ì€ VPC ë‚´ë¶€ì—ì„œ ì‹¤ì œë¡œ ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ë  ìˆ˜ ìˆëŠ” ê°€ìƒ ë„¤íŠ¸ì›Œí¬ë¼ê³  ìƒê°í•˜ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.AWS ì½˜ì†”ì—ì„œ ì–´ë–¤ ë¦¬ì†ŒìŠ¤(ex. EC2, RDS)ë¥¼ ìƒì„±í•  ë•Œ, VPCë§Œ ì§€ì •í•˜ëŠ” ê²½ìš°ëŠ” ì—†ìŠµë‹ˆë‹¤. ì„œë¸Œë„·ë„ í•¨ê»˜ ì§€ì •í•˜ëŠ”ë°ìš”, ë³´í†µ ì„œë¸Œë„·ì„ ì§€ì •í•˜ë©´ VPCëŠ” ìë™ìœ¼ë¡œ ì§€ì •ë˜ëŠ” í˜•íƒœë¥¼ ë•ë‹ˆë‹¤.í•˜ë‚˜ì˜ VPCëŠ” Nê°œì˜ ì„œë¸Œë„·ì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„œë¸Œë„·ì˜ ìµœëŒ€ í¬ê¸°ëŠ” VPCì˜ í¬ê¸°ì™€ ê°™ìŠµë‹ˆë‹¤. (ë„·ë§ˆìŠ¤í¬ 16 ~ 28ì˜ ë²”ìœ„) ë³´í†µ í•œ ë¦¬ì „ ë‚´ì˜ ì‚¬ìš© ê°€ëŠ¥í•œê°€ìš©ì˜ì—­ì„ ê³ ë ¤í•˜ì—¬ ì ì ˆí•œ ê°¯ìˆ˜ì˜ ì„œë¸Œë„·ì„ ê°€ìš©ì˜ì—­ ë‚´ë¶€ì— ìƒì„±í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ ê°ê° ê°€ìš©ì˜ì—­ ë‚´ë¶€ì— ë™ì¼í•œ í˜•íƒœì˜ ë³„ë„ì˜ ì„œë¸Œë„·ì„ ê°€ì§€ë©´ í•œê°œì˜ ê°€ìš©ì˜ì—­ì— ì¥ì• ê°€ ìƒê²¨ë„ íŠ¸ë˜í”½ ë¶„ì‚° ì¸¡ë©´ì—ì„œ ì‰½ê²Œ ì¥ì• ì— ëŒ€ì‘í•  ìˆ˜ ìˆê² ì§€ìš”.ì¥ì•  ëŒ€ì‘ ì¸¡ë©´ì—ì„œ ì„œë¸Œë„·ì„ ê°€ìš©ì˜ì—­ë§Œí¼ ë‚˜ëˆ„ëŠ” ê²½ìš° ì‚¬ìš©í•  ë¦¬ì „ì—ì„œ ì‚¬ìš©ê°€ëŠ¥í•œ ê°€ìš©ì˜ì—­ì˜ ê°¯ìˆ˜ë¥¼ ë¯¸ë¦¬ íŒŒì•… í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. (ì„œìš¸ ë¦¬ì „ì˜ ê²½ìš° 4ê°œ)ëª¨ë“  ê°€ìš©ì˜ì—­ ì‚¬ìš©í•  í•„ìš”ëŠ” ì—†ì§€ë§Œ ë³´í†µ 2ê°œ ì´ìƒì˜ ê°€ìš©ì˜ì—­ì„ êµ¬ì„±í•˜ëŠ”ê²Œ ì¼ë°˜ì ì…ë‹ˆë‹¤.í¼ë¸”ë¦­ ì„œë¸Œë„· &amp; í”„ë¼ì´ë¹— ì„œë¸Œë„·ì„œë¸Œë„·ë„ ì–´ë–»ê²Œ ì„¤ì •í•˜ëŠëƒì— ë”°ë¼ ë‘ê°€ì§€ë¡œ ë‚˜ë‰  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¨¼ì € í¼ë¸”ë¦­ ì„œë¸Œë„·ì€ VPC ë‚´ë¶€ì— ìˆë”ë¼ë„ ì™¸ë¶€ì—ì„œ í¼ë¸”ë¦­ IP (íƒ„ë ¥ì  IP) ë¥¼ í†µí•´ ë“¤ì–´ì˜¬ ìˆ˜ ìˆëŠ” ì„œë¸Œë„·ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.ë³´í†µ í¼ë¸”ë¦¿ ì„œë¸Œë„·ì— Bastion Hostë¥¼ ë‘ì–´ ê°™ì€ VPC ë‚´ë¶€ì— ìˆëŠ” í”„ë¼ì´ë¹— ì„œë¸Œë„·, RDS ë“±ì— ì ‘ê·¼ í•˜ê³¤ í•©ë‹ˆë‹¤. Bastion Hostì— ëŒ€í•´ì„  ì¶”í›„ ì„œë²„ êµ¬ì¶•ì‹œ ìì„¸íˆ ë‹¤ë£¨ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.í”„ë¼ì´ë¹— ì„œë¸Œë„·ì€ ì™¸ë¶€ì—ì„œ ì§ì ‘ ë“¤ì–´ì˜¬ìˆ˜ë„, ë‚˜ê°ˆ ìˆ˜ë„ ì—†ëŠ” VPC ë‚´ë¶€ì— ë‹¨ì ˆëœ ë„¤íŠ¸ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ì„œë¸Œë„·ì…ë‹ˆë‹¤.í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ë“¤ì–´ì˜¤ë ¤ë©´ í¼ë¸”ë¦­ ìì›(Load Balancer ë“±) ì„ í†µí•´ ë“¤ì–´ì™€ì•¼ í•˜ë©° í”„ë¼ì´ë¹— ì„œë¸Œë„·ì—ì„œ ì™¸ë¶€ ì¸í„°ë„·ì— ì—°ê²°í•˜ë ¤ë©´ â€œí¼ë¸”ë¦­ ì„œë¸Œë„·ì— ìˆìœ¼ë©° íƒ„ë ¥ì  IPì— ì—°ê²°ëœ NAT Gatewayâ€ë¥¼ í†µí•´ ë‚˜ê°€ì•¼ í•©ë‹ˆë‹¤.NAT GatewayNAT GatewayëŠ” í”„ë¼ì´ë¹— ì„œë¸Œë„·ì´ ì¸í„°ë„·ê³¼ í†µì‹ í• ë•Œ í•„ìš”ë¡œ í•˜ëŠ” ì•„ì›ƒë°”ìš´ë“œ ë¦¬ì†ŒìŠ¤ ì…ë‹ˆë‹¤. í”„ë¼ì´ë¹— ì„œë¸Œë„·ì—ì•„ì›ƒë°”ìš´ë“œ íŠ¸ë˜í”½ì´ í•„ìš”í•œ ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤. (ex. ì™¸ë¶€ ì—°ë™ API ì„œë²„ í˜¸ì¶œ, OS íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸ ë“±)ì´ë•Œ, í¼ë¸”ë¦­ ì„œë¸Œë„·ì— ì¡´ì¬í•˜ëŠ” NAT GatewayëŠ” í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ ì•„ì›ƒë°”ìš´ë“œ ìš”ì²­ì„ ë°›ì•„ ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ë¡œ ì—°ê²°í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´VPCëŠ” ë…ë¦½ëœ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ì•„ë¬´ ì„¤ì •ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ë‚´ë¶€ ì„œë¸Œë„· ì„¤ì •ì´ ì–´ë–»ë“  ê°„ì— ì¸í„°ë„·ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.ì´ë•Œ ì¸í„°ë„·ì— ì—°ê²°í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ê²ƒì´ ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ ì…ë‹ˆë‹¤. ì™¸ë¶€ ì¸í„°ë„·ê³¼ VPCë¥¼ ì—°ê²°í•´ ì£¼ëŠ” ê´€ë¬¸ì´ ë˜ëŠ” ê²ƒì´ì§€ìš”.ë¼ìš°í„° &amp; ë¼ìš°íŒ… í…Œì´ë¸”í•œ ì„œë¸Œë„· ì•ˆì—ì„œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì´ ë°œìƒí•˜ë©´ ë¯¸ë¦¬ ì •ì˜ëœ ë¼ìš°íŒ… í…Œì´ë¸”ì— ë”°ë¼ ë¼ìš°í„°ë¡œ í–¥í•˜ê²Œ ë©ë‹ˆë‹¤. ë¼ìš°í„°ëŠ” ìµœì¢… ëª©ì ì§€ì´ê³ , ë¼ìš°íŒ… í…Œì´ë¸”ì€ ëª©ì ì§€(ë¼ìš°í„°)ì— ë„ë‹¬í•˜ê¸° ìœ„í•œ ë„¤íŠ¸ì›Œí¬ ë…¸ì„  ì´ë¼ê³  ì´í•´í•˜ë©´ ì‰½ìŠµë‹ˆë‹¤.ìœ„ì—ì„œ ì¥í™©í•˜ê²Œ ì„¤ëª…í•˜ê¸´ í–ˆì§€ë§Œ Aì„œë¸Œë„·ì— ì—°ê²°ëœ ë¼ìš°íŒ… í…Œì´ë¸”ì˜ 0.0.0.0/0 ì¦‰, ê¸°ë³¸ ê²½ë¡œê°€ ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ì™€ ì§ì ‘ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´ í¼ë¸”ë¦­ ì„œë¸Œë„·ì´ê³ ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ì™€ ì§ì ‘ ì—°ê²°ë˜ì–´ ìˆì§€ ì•Šê±°ë‚˜ NAT Gatewayì™€ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì´ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.ë³´ì•ˆê·¸ë£¹ (Security Group)ìœ„ì˜ ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ &amp; ë¼ìš°í„° &amp; ë¼ìš°íŒ… í…Œì´ë¸”ì´ VPC ì™€ ì„œë¸Œë„·ê°„ì˜ íŠ¸ë˜í”½ì„ ì œì–´í•œë‹¤ë©´, ë³´ì•ˆê·¸ë£¹ì€ EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ ì¸ë°”ìš´ë“œ, ì•„ì›ƒë°”ìš´ë“œë¥¼ í¬íŠ¸ ë²ˆí˜¸ë³„ë¡œ ì œì–´í•˜ê¸° ìœ„í•œ ì„¤ì •ì…ë‹ˆë‹¤.í¼ë¸”ë¦­ ì„œë¸Œë„·ì— ì¡´ì¬í•˜ë”ë¼ë„ ê´€ë ¨ëœ ë³´ì•ˆê·¸ë£¹ì˜ í¬íŠ¸ê°€ ì˜¤í”ˆë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ ì§ì ‘ ì¸ìŠ¤í„´ìŠ¤ë¡œ ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê°œì¸ì ìœ¼ë¡œ ìµœì¢… ë°©í™”ë²½(?) ê°™ì€ ëŠë‚Œì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤.ë§ˆì¹˜ë©°â€¦VPCì™€ ê·¸ë¥¼ ì‚¬ìš©í•˜ê³ ì í•  ë•Œ í•„ìš”í•œ ì—¬ëŸ¬ ë¦¬ì†ŒìŠ¤ë“¤ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. ì‚¬ì‹¤ ì €ë„ ê¸€ë¡œë§Œ ì“°ë©´ì„œ í—·ê°ˆë¦¬ëŠ” ê²ƒë“¤ì´ ìˆì—ˆëŠ”ë°ìš”, ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ëŠ” í•˜ë‚˜í•˜ë‚˜ ì§ì ‘ ë§Œë“¤ë©´ì„œ ìì„¸íˆ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤." }, { "title": "AWSë¥¼ ì‚¬ìš©í•´ ë¬´ì¤‘ë‹¨ ë°°í¬ ìë™í™” í™˜ê²½ êµ¬ì¶•í•˜ê¸° - 1. ê°œìš”", "url": "/posts/aws-cicd-1/", "categories": "AWS", "tags": "AWS, DevOps", "date": "2021-06-21 19:32:00 +0900", "snippet": "AWSë¥¼ ì‚¬ìš©í•´ ë¬´ì¤‘ë‹¨ ë°°í¬ ìë™í™” í™˜ê²½ êµ¬ì¶•í•˜ê¸° ì‹œë¦¬ì¦ˆ ê°œìš” VPCì™€ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ VPCì™€ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ ìƒì„±í•˜ê¸° ì–´í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¶• ë° ë¡œë“œë°¸ëŸ°ì„œ ì ìš© AWS ë¦¬ì†ŒìŠ¤ ì„¸íŒ… CodeDeploy ì—°ë™ / ë§ˆë¬´ë¦¬ê°œìš”AWSë¥¼ ì´ìš©í•˜ì—¬ ê°€ì¥ ê¸°ë³¸ì ì¸ í˜•íƒœì˜ ì¸í”„ë¼ë¥¼ êµ¬ì¶•í•˜ê³  GithubAction - CodeDeploy ë¥¼ ì´ìš©í•˜ì—¬ CI/CD ì„œë²„ë¥¼ êµ¬ì¶•í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. AWSì˜ ê¸°ë³¸ì ì¸ ê°œë…ì€ ìˆ™ì§€í•˜ê³  ìˆë‹¤ëŠ” ê°€ì •í•˜ì— ì§„í–‰ë©ë‹ˆë‹¤. ë¸”ë£¨ - ê·¸ë¦° ë°°í¬ ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.ì„œë²„ êµ¬ì„±ìµœì¢…ì ìœ¼ë¡œ êµ¬ì¶•í•  ì›¹ì„œë²„ ì•„í‚¤í…ì²˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. (ì§ì ‘ ê·¸ë¦°ê±°ë¼ ì‚ëš¤ì‚ëš¤í•©ë‹ˆë‹¤ ã… ã… â€¦) ì¤‘ê°„ Private Subnet ì˜ì—­ì˜ Auto Scailing group ì— í¬í•¨ë˜ì§€ ì•Šì€ ì¸ìŠ¤í„´ìŠ¤ëŠ” ë§ì€ íŠ¸ë˜í”½ì„ í•„ìš”ë¡œ í•˜ì§€ ì•ŠëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ ì…ë‹ˆë‹¤. (ex. ë‹¨ìˆœ ì¡°íšŒìš© ì‚¬ì´íŠ¸) Auto Scailing group ì— í¬í•¨ëœ ì¸ìŠ¤í„´ìŠ¤ëŠ” ë§ì€ íŠ¸ë˜í”½ì´ ë°œìƒí•©ë‹ˆë‹¤. (ex. ëŒ€ê³ ê° ì‚¬ì´íŠ¸, ì™¸ë¶€ ì—°ë™ api ì„œë²„) Auto Scailing group ë‚´ë¶€ ì¸ìŠ¤í„´ìŠ¤ì˜ ë‚´ë¶€ êµ¬ì¡°ëŠ” ì›¹ì„œë²„ë¡œ Nginx ë¥¼ ë‘ê³  location ì„¤ì •ì„ ë°”íƒ•ìœ¼ë¡œ Spring-Boot Applicaton ì— ì ‘ê·¼í•©ë‹ˆë‹¤. (ex. /api - api ì„œë²„ë¡œ)ë°°í¬ êµ¬ì„±ìë™í™” ë°°í¬ì— ì‚¬ìš©í•  ë°°í¬ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. Github ì— ì½”ë“œë¥¼ commit &amp; push í•©ë‹ˆë‹¤. ë¯¸ë¦¬ ì •ì˜í•´ë‘” GithubAction Workflowì— ì˜í•´ jobì´ ì‹¤í–‰ë©ë‹ˆë‹¤. GithubActionì€ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë¹Œë“œí•˜ê³  S3 Bucketì— ì „ì†¡í•©ë‹ˆë‹¤. GithubActionì€ CodeDeploy ì—ê²Œ ë°°í¬ ëª…ë ¹ì„ ë‚´ë¦½ë‹ˆë‹¤. CodeDeployëŠ” ë¸”ë£¨-ê·¸ë¦° ë°°í¬ë°©ì‹ì„ ë°”íƒ•ìœ¼ë¡œ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ ê·¸ë£¹ì„ ìƒì„±í•©ë‹ˆë‹¤. ë¯¸ë¦¬ ì •í•´ë‘” í…œí”Œë¦¿ì„ ë°”íƒ•ìœ¼ë¡œ ì‹œì‘ëœ ì¸ìŠ¤í„´ìŠ¤ëŠ” S3 Bucket ì— ì €ì¥ëœ ë¹Œë“œ íŒŒì¼(ë²ˆë“¤)ì„ ë‹¤ìš´ë°›ìŠµë‹ˆë‹¤. ë¹Œë“œíŒŒì¼ì— í¬í•¨ëœ AppSpec.yml íŒŒì¼ì„ ë°”íƒ•ìœ¼ë¡œ ë°°í¬ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤. ëª¨ë“  ë°°í¬ê°€ ì„±ê³µì ìœ¼ë¡œ ëë‚˜ë©´ CodeDeployëŠ” Application Load Balancerì˜ íŠ¸ë˜í”½ì„ ìƒˆë¡œìš´ íƒ€ê²Ÿ ê·¸ë£¹ìœ¼ë¡œ ë³€ê²½í•˜ê³ , ê¸°ì¡´ì˜ ê·¸ë£¹ì„ ì¢…ë£Œí•©ë‹ˆë‹¤." } ]
