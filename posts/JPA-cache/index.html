<!DOCTYPE html><html lang="ko-KS" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="JPA 캐시" /><meta name="author" content="keencho" /><meta property="og:locale" content="ko_KS" /><meta name="description" content="JPA 캐시 데이터베이스에 접근하는 비용은 매우 비쌉니다. 실제 운영하는 서비스라면 DB가 같은 시스템 안에 존재하는 일이 없기 때문에 네트워크 비용까지 발생합니다. 결과값을 뻔히 알 수 있는 쿼리에 대해 이런 값비싼 작업을 수행한다면 어플리케이션의 성능은 낮아질 것입니다." /><meta property="og:description" content="JPA 캐시 데이터베이스에 접근하는 비용은 매우 비쌉니다. 실제 운영하는 서비스라면 DB가 같은 시스템 안에 존재하는 일이 없기 때문에 네트워크 비용까지 발생합니다. 결과값을 뻔히 알 수 있는 쿼리에 대해 이런 값비싼 작업을 수행한다면 어플리케이션의 성능은 낮아질 것입니다." /><link rel="canonical" href="https://keencho.github.io/posts/JPA-cache/" /><meta property="og:url" content="https://keencho.github.io/posts/JPA-cache/" /><meta property="og:site_name" content="keencho’s blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-11-27T17:12:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="JPA 캐시" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@keencho" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"keencho"},"dateModified":"2022-01-12T12:07:23+09:00","datePublished":"2021-11-27T17:12:00+09:00","description":"JPA 캐시 데이터베이스에 접근하는 비용은 매우 비쌉니다. 실제 운영하는 서비스라면 DB가 같은 시스템 안에 존재하는 일이 없기 때문에 네트워크 비용까지 발생합니다. 결과값을 뻔히 알 수 있는 쿼리에 대해 이런 값비싼 작업을 수행한다면 어플리케이션의 성능은 낮아질 것입니다.","headline":"JPA 캐시","mainEntityOfPage":{"@type":"WebPage","@id":"https://keencho.github.io/posts/JPA-cache/"},"url":"https://keencho.github.io/posts/JPA-cache/"}</script><title>JPA 캐시 | keencho's blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="keencho's blog"><meta name="application-name" content="keencho's blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/custom/keencho.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">keencho's blog</a></div><div class="site-subtitle font-italic">이것저것 정리하는 블로그.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/keencho" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['seyoung050412','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>JPA 캐시</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>JPA 캐시</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1638000720" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Nov 27, 2021 </em> </span><div class="d-flex justify-content-between"> <span> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3243 words"> <em>18 min</em> read</span></div></div></div><div class="post-content"><h1 id="jpa-캐시"><strong>JPA 캐시</strong></h1><p>데이터베이스에 접근하는 비용은 매우 비쌉니다. 실제 운영하는 서비스라면 DB가 같은 시스템 안에 존재하는 일이 없기 때문에 네트워크 비용까지 발생합니다. 결과값을 뻔히 알 수 있는 쿼리에 대해 이런 값비싼 작업을 수행한다면 어플리케이션의 성능은 낮아질 것입니다.</p><p>하이버네이트를 포함한 JPA 구현체들은 캐시를 지원합니다. 하이버네이트의 캐시는 어플리케이션과 데이터베이스 사이에 중간다리 계층 역할을 하며, 데이터베이스를 직접 호출하는 대신 서버 메모리에서 결과값을 반환하므로 데이터를 얻는데 걸리는 시간을 줄여줄뿐 아니라 어플리케이션의 성능까지 높일 수 있습니다.</p><h2 id="1차-캐시"><span class="mr-2"><strong>1차 캐시</strong></span><a href="#1차-캐시" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>1차캐시부터 살펴보겠습니다. 1차캐시는 영속성 컨텍스트 내부에 엔티티를 보관하는 장소를 의미합니다. 1차캐시는 하이버네이트에서 기본적으로 사용되도록 설정되어 있습니다. 1차캐시는 트랜잭션을 시작하고 종료할 때까지만 존재합니다.</p><p><img data-src="/assets/img/custom/spring/jpa/cache/first-level-cache.png" alt="first-level-cache" data-proofer-ignore> 플로우를 간단히 도식화해보면 위와 같습니다. 요청이 오면 1차 캐시에서 요청과 일치하는 엔티티가 있는지 확인합니다. 만약 있다면 그대로 해당 엔티티를 반환하고 없다면 db에서 실제로 조회 후에 1차 캐시에 저장 후 해당 결과값을 반환합니다.</p><h3 id="예제"><span class="mr-2"><strong>예제</strong></span><a href="#예제" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>간단한 예제를 통해 1차 캐시가 잘 동작하는지 확인해보겠습니다.</p><p>테스트에 활용된 설정 정보는 다음과 같습니다.</p><p>build.gradle</p><div class="language-gradle highlighter-rouge"><div class="code-header"> <span data-label-text="Gradle"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">dependencies</span> <span class="o">{</span>
    <span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-data-jpa'</span>
    <span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-web'</span>
    <span class="n">implementation</span> <span class="s1">'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.7.1'</span>

    <span class="n">compileOnly</span> <span class="s1">'org.projectlombok:lombok'</span>
    <span class="n">runtimeOnly</span> <span class="s1">'com.h2database:h2'</span>
    <span class="n">annotationProcessor</span> <span class="s1">'org.projectlombok:lombok'</span>
    <span class="n">testImplementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-test'</span>
<span class="o">}</span>
</pre></table></code></div></div><p>application.yml</p><div class="language-yml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="na">spring</span><span class="pi">:</span>
  <span class="na">datasource</span><span class="pi">:</span>
    <span class="na">driver-class-name</span><span class="pi">:</span> <span class="s">org.h2.Driver</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">jdbc:h2:../test</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">sa</span>
    <span class="na">password</span><span class="pi">:</span>
  <span class="na">jpa</span><span class="pi">:</span>
    <span class="na">database-platform</span><span class="pi">:</span> <span class="s">org.hibernate.dialect.H2Dialect</span>
    <span class="na">hibernate</span><span class="pi">:</span>
      <span class="na">ddl-auto</span><span class="pi">:</span> <span class="s">create-drop</span>
</pre></table></code></div></div><p>코드는 다음과 같습니다.</p><p>TestModel.java</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="nd">@Data</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"test_model"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestModel</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">AUTO</span><span class="o">)</span>
    <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nc">String</span> <span class="n">keyword</span><span class="o">;</span>

<span class="o">}</span>
</pre></table></code></div></div><p>TestService.java</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nc">TestRepository</span> <span class="n">testRepository</span><span class="o">;</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">insertDummyData</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">r</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"banana"</span><span class="o">,</span> <span class="s">"monkey"</span><span class="o">,</span> <span class="s">"apple"</span><span class="o">,</span> <span class="s">"bear"</span><span class="o">);</span>

        <span class="nc">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Random</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">var</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">a</span> <span class="o">++)</span> <span class="o">{</span>
            <span class="nc">TestModel</span> <span class="n">testModel</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TestModel</span><span class="o">();</span>
            <span class="n">testModel</span><span class="o">.</span><span class="na">setKeyword</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">size</span><span class="o">())));</span>

            <span class="n">testRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">testModel</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Test.java</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="nd">@Transactional</span>
<span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>

    <span class="n">testService</span><span class="o">.</span><span class="na">insertDummyData</span><span class="o">();</span>

    <span class="kt">var</span> <span class="n">listAll</span> <span class="o">=</span> <span class="n">testRepo</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>

    <span class="nc">Assert</span><span class="o">.</span><span class="na">notNull</span><span class="o">(</span><span class="n">listAll</span><span class="o">,</span> <span class="s">"ENTITY LIST SHOULD NOT BE NULL"</span><span class="o">);</span>

    <span class="k">for</span> <span class="o">(</span><span class="kt">var</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">10L</span><span class="o">;</span> <span class="n">i</span> <span class="o">++)</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">testRepo</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>

        <span class="nc">Assert</span><span class="o">.</span><span class="na">notNull</span><span class="o">(</span><span class="n">entity</span><span class="o">,</span> <span class="s">"ENTITY SHOULD NOT BE NULL"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kt">var</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">testRepo</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">12L</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>

    <span class="nc">Assert</span><span class="o">.</span><span class="na">isNull</span><span class="o">(</span><span class="n">entity</span><span class="o">,</span> <span class="s">"ENTITY SHOULD BE NULL"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>10개의 엔티티를 저장하고 <code class="language-plaintext highlighter-rouge">testRepo.findAll()</code> 로 모든 엔티티를 불러와 1차캐시에 저장하였습니다. 만약 1차 캐시가 없다면 반복문 부분에서 1L부터 10L까지 10번 조회하는 쿼리가 날라갈 것입니다.</p><p><img data-src="/assets/img/custom/spring/jpa/cache/first-level-cache-ex.png" alt="first-level-cache-ex" data-proofer-ignore> 하지만 위와 같이 <code class="language-plaintext highlighter-rouge">select * from test_model</code>절 이후에 반복문 내부의 <code class="language-plaintext highlighter-rouge">findById()</code> 로 생성되고 실행되어야 할 쿼리는 생성되지 않고 바로 <code class="language-plaintext highlighter-rouge">testRepo.findById(12L).orElse(null)</code>의 쿼리인 <code class="language-plaintext highlighter-rouge">select * from test_model where id=12</code>절이 실행된것을 확인할 수 있습니다.</p><p>이로써 <code class="language-plaintext highlighter-rouge">findAll()</code> 로 조회된 id 1~10까지의 엔티티는 1차캐시에서 바로 반환되었고 1차캐시에 존재하지 않는 id 12의 경우 쿼리가 생성되어 실제 db에서 조회하여 결과값을 반환한 것을 확인할 수 있습니다.</p><h2 id="2차-캐시"><span class="mr-2"><strong>2차 캐시</strong></span><a href="#2차-캐시" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>1차 캐시가 트랜잭션 단위의 캐시라면 2차 캐시는 어플리케이션 단위의 캐시입니다. 따라서 어플리케이션을 시작하고 종료할 때까지 캐시가 유지됩니다. 2차 캐시는 다음과 같은 특징을 가지고 있습니다.</p><ol><li>동시성을 극대화하기 위해 엔티티를 직접 반환하지 않고 복사본(dto)을 만들어 반환한다.<li>2차 캐시는 영속성 유닛 범위의 캐시다.<li>2차 캐시는 데이터베이스의 기본키를 기준으로 캐싱하지만 영속성 컨텍스트가 다르면 객체 동일성 (a == b)를 보장하지 않는다.</ol><p><img data-src="/assets/img/custom/spring/jpa/cache/second-level-cache-flow.png" alt="second-level-cache" data-proofer-ignore><br /> 2차 캐시의 플로우를 도식화 하였습니다. 1차 캐시와 DB 사이에 2차 캐시 레이어가 추가되었습니다. 1차, 2차 캐시에 모두 원하는 요청값이 없는 경우 DB에서 조회후 2차캐시, 1차캐시에 순차적으로 저장 후 결과값을 반환합니다.</p><h3 id="region-factory"><span class="mr-2"><strong>Region Factory</strong></span><a href="#region-factory" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>하이버네이트 2차 캐시는 실제로 어떤 캐시 프로바이더가 사용되는지 알 수 없게 설계되었습니다. 하이버네이트는 <code class="language-plaintext highlighter-rouge">org.hibernate.cache.spi.RegionFactory</code> 인터페이스를 구현한 구현체만을 필요로 합니다.</p><p>위 인터페이스는 실제 캐시 프로바이더와 관련된 모든 정보를 캡슐화합니다. 또한 기본적으로 하이버네이트와 캐시 프로바이더 사이의 브릿지 역할을 합니다.</p><p>아래 예제에서는 Ehcache를 사용합니다. <code class="language-plaintext highlighter-rouge">RegionFactory</code> 인터페이스가 구현되어있는 어떤 구현체를 사용해도 문제 없습니다.</p><h3 id="예제-1"><span class="mr-2"><strong>예제</strong></span><a href="#예제-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>2차 캐시를 실제로 적용해보겠습니다.</p><p>일단 gradle 디펜던시에 ehcache를 추가합니다.</p><div class="language-gradle highlighter-rouge"><div class="code-header"> <span data-label-text="Gradle"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">implementation</span> <span class="s1">'org.hibernate:hibernate-ehcache:5.6.3.Final'</span>
</pre></table></code></div></div><p>그 후 application.yml 파일에 프로퍼티를 추가합니다.</p><div class="language-gradle highlighter-rouge"><div class="code-header"> <span data-label-text="Gradle"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nl">spring:</span>
  <span class="nl">jpa:</span>
    <span class="nl">properties:</span>
      <span class="nl">javax:</span>
        <span class="nl">persistence:</span>
          <span class="nl">sharedCache:</span>
            <span class="nl">mode:</span> <span class="n">ALL</span>
      <span class="nl">hibernate:</span>
        <span class="nl">cache:</span>
          <span class="nl">use_second_level_cache:</span> <span class="kc">true</span>
          <span class="nl">region:</span>
            <span class="nl">factory_class:</span> <span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">ehcache</span><span class="o">.</span><span class="na">EhCacheRegionFactory</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">use_second_level_cache</code> 프로퍼티를 통해 2차캐시를 활성화하고 <code class="language-plaintext highlighter-rouge">factory_class</code> 프로퍼티를 통해 <code class="language-plaintext highlighter-rouge">EhCacheRegionFactory</code>를 2차 캐시 프로바이더로 선택합니다. <code class="language-plaintext highlighter-rouge">sharedCache.mode</code> 프로퍼티를 통해 캐싱할 엔티티의 범위를 지정할 수 있는데 선택 가능한 모드는 다음과 같습니다.</p><blockquote><p><strong>ALL</strong>: 모든 엔티티 및 엔티티 관련 상태와 데이터가 캐시됩니다.<br /> <strong>DISABLE_SELECTIVE</strong>: @Cacheable 어노테이션에 false 라고 명시된 엔티티를 제외한 모든 엔티티에 대해 캐싱을 사용할 수 있습니다.<br /> <strong>ENABLE_SELECTIVE</strong>: @Cacheable 어노테이션에 true 라고 명시된 모든 엔티티에 대해 캐싱을 사용할 수 있습니다.<br /> <strong>NONE</strong>: 영속성 유닛에서 캐싱을 사용할 수 없습니다.<br /> <strong>UNSPECIFIED</strong>: 캐싱 동작이 정의되지 않았습니다. 프로바이더별 기본값이 적용될 수 있습니다.</p></blockquote><p>더 자세한 정보는 <a href="https://docs.oracle.com/javaee/7/api/javax/persistence/SharedCacheMode.html">이곳</a>을 참조하세요.</p><p>다음으로 캐싱할 엔티티에 캐시 기능을 사용하겠다고 어노테이션을 추가해줘야 합니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="nd">@Data</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"test_model"</span><span class="o">)</span>
<span class="nd">@Cacheable</span>
<span class="nd">@org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">annotations</span><span class="o">.</span><span class="na">Cache</span><span class="o">(</span><span class="n">usage</span> <span class="o">=</span> <span class="nc">CacheConcurrencyStrategy</span><span class="o">.</span><span class="na">NONSTRICT_READ_WRITE</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestModel</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">AUTO</span><span class="o">)</span>
    <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nc">String</span> <span class="n">keyword</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">@Cacheable</code> 어노테이션으로 이 엔티티가 캐싱될수 있음을 명시하였습니다. <code class="language-plaintext highlighter-rouge">@Cache</code> 어노테이션와 <code class="language-plaintext highlighter-rouge">usage()</code> 속성을 통해 캐시 전략을 명시하였습니다. 사용할수 있는 전략은 다음과 같습니다.</p><blockquote><p><strong>NONE</strong>: 전략이 없습니다.<br /> <strong>READ_ONLY</strong>: 읽기 전용입니다. 불변값에 적합합니다. <br /> <strong>NONSTRICT_READ_WRITE</strong>: 엄격하지 않은 읽기/쓰기 전략입니다. 동시성 접근을 고려하지 않고 캐싱합니다. 수정이 자주 일어나지 않는 엔티티에 적합합니다.<br /> <strong>READ_WRITE</strong>: 엄격한 읽기/쓰기 전략입니다. 동시 접근을 고려하고 개발해야 합니다.<br /> <strong>TRANSACTIONAL</strong>: JTA 환경에서 사용되며 hibernate.transaction.manager_lookup_class 프로퍼티를 명시해야 합니다.</p></blockquote><p><a href="https://docs.jboss.org/hibernate/core/3.3/reference/en/html/performance.html#performance-cache-readonly">이곳</a> 에서 더 자세한 정보를 확인해보세요.</p><p>설정이 모두 끝났습니다. 테스트에 사용될 코드는 다음과 같습니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CacheTestController</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nc">TestRepository</span> <span class="n">testRepository</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="nc">TestService</span> <span class="n">testService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="nc">SessionFactory</span> <span class="n">sessionFactory</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/insert"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;?&gt;</span> <span class="n">insert</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">r</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"banana"</span><span class="o">,</span> <span class="s">"monkey"</span><span class="o">,</span> <span class="s">"apple"</span><span class="o">,</span> <span class="s">"bear"</span><span class="o">);</span>

        <span class="nc">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Random</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">var</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">a</span> <span class="o">++)</span> <span class="o">{</span>
            <span class="nc">TestModel</span> <span class="n">testModel</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TestModel</span><span class="o">();</span>
            <span class="n">testModel</span><span class="o">.</span><span class="na">setKeyword</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">size</span><span class="o">())));</span>

            <span class="n">testRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">testModel</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="s">"SUCCESS"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/getById"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;?&gt;</span> <span class="n">getById</span><span class="o">(</span><span class="nd">@RequestParam</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getStatistics</span><span class="o">().</span><span class="na">setStatisticsEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"========================="</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"find entity start"</span><span class="o">);</span>
        <span class="kt">var</span> <span class="n">e</span> <span class="o">=</span> <span class="n">testRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"second level cache hit count: "</span> <span class="o">+</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getStatistics</span><span class="o">().</span><span class="na">getSecondLevelCacheHitCount</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"second level cache miss count: "</span> <span class="o">+</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getStatistics</span><span class="o">().</span><span class="na">getSecondLevelCacheMissCount</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"second level cache put count: "</span> <span class="o">+</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getStatistics</span><span class="o">().</span><span class="na">getSecondLevelCachePutCount</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"find entity end"</span><span class="o">);</span>
        <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>편의를 위해 h2 메모리 db를 사용하였습니다. 테스트 시나리오는 어플리케이션 실행후 <code class="language-plaintext highlighter-rouge">insert()</code> 메소드를 통해 10개의 엔티티를 저장합니다. 그 후 <code class="language-plaintext highlighter-rouge">getById(id)</code> 메소드를 통해 id가 1인 엔티티를 두번 조회후 id가 2인 엔티티를 두번 조회해 보겠습니다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre><td class="rouge-code"><pre>10:11:42.982 [INFO ][p6spy.logSQL:line60] - 
=========================
find entity start
10:12:03.542 [INFO ][p6spy.logSQL:line60] - 

    select
        testmodel0_.id as id1_0_0_,
        testmodel0_.keyword as keyword2_0_0_ 
    from
        test_model testmodel0_ 
    where
        testmodel0_.id=1

	Connection ID: 4
	Execution Time: 0 ms

	Call Stack (number 1 is entry point): 
		1. sycho.spring.controller.CacheTestController.getById(CacheTestController.java:50)

----------------------------------------------------------------------------------------------------
10:12:03.560 [INFO ][p6spy.logSQL:line60] - 
second level cache hit count: 0
second level cache miss count: 1
second level cache put count: 1
find entity end
=========================
find entity start
10:12:05.356 [INFO ][p6spy.logSQL:line60] - 
second level cache hit count: 1
second level cache miss count: 1
second level cache put count: 1
find entity end
=========================
find entity start
10:12:06.855 [INFO ][p6spy.logSQL:line60] - 

    select
        testmodel0_.id as id1_0_0_,
        testmodel0_.keyword as keyword2_0_0_ 
    from
        test_model testmodel0_ 
    where
        testmodel0_.id=2

	Connection ID: 6
	Execution Time: 0 ms

	Call Stack (number 1 is entry point): 
		1. sycho.spring.controller.CacheTestController.getById(CacheTestController.java:50)

----------------------------------------------------------------------------------------------------
10:12:06.858 [INFO ][p6spy.logSQL:line60] - 
second level cache hit count: 1
second level cache miss count: 2
second level cache put count: 2
find entity end
=========================
find entity start
10:12:07.940 [INFO ][p6spy.logSQL:line60] - 
second level cache hit count: 2
second level cache miss count: 2
second level cache put count: 2
find entity end
</pre></table></code></div></div><p>테스트 결과는 위와 같습니다. 최초 id가 1인 엔티티를 조회할때는 2차 캐시에 데이터가 존재하지 않기 때문에 실제 쿼리가 날라가고 <code class="language-plaintext highlighter-rouge">miss count</code>와 <code class="language-plaintext highlighter-rouge">put count</code> 가 1이 되었습니다. 그 후 다시한번 id가 1인 엔티티를 조회할 때는 2차 캐시에 엔티티가 존재하기 때문에 쿼리가 날라가지 않고 <code class="language-plaintext highlighter-rouge">hit count</code>가 1이 되었습니다.</p><p>id를 2로하여 조회해봐도 1로 조회할때와 마찬가지로 최초 조회때는 실제 쿼리가 날라가고 2번째 조회때는 캐시된 엔티티를 반환하는 것을 확인할 수 있습니다.</p><h3 id="분산환경에서의-2차-캐시"><span class="mr-2"><strong>분산환경에서의 2차 캐시</strong></span><a href="#분산환경에서의-2차-캐시" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>하지만 요즘에는 단일환경에서 어플리케이션을 잘 운영하지 않습니다. AWS를 사용한다고 가정하면 오토 스케일링 그룹의 EC2에 동일한 어플리케이션을 구동하여 분산환경에서 자유롭게 스케일링 in / out 할 수 있는 형태로 서버를 구성합니다.</p><p>메모리 db가 어플리케이션 단위로 동작하는 경우 최종 db에 커밋시에 문제가 생길수 있습니다. db lock 에 의해 문제가 생기지 않을 수 있지만 뒤에 처리하는 비즈니스 로직에서 문제가 발생할 수 있습니다. 따라서 기본적으로 별도의 서버에 메모리 db 을 구축하여 사용할 수 있습니다. 물론 이때도 올바른 캐시 전략을 지정하는것은 중요합니다.</p><p>단일 노드 환경에서는 <code class="language-plaintext highlighter-rouge">READ_WRITE</code>, <code class="language-plaintext highlighter-rouge">TRANSACTIONL</code> 전략을 사용할 수 있습니다. 그러나 분산 노드 환경에서는 db lock 에 의존할 수 없으므로 <code class="language-plaintext highlighter-rouge">NONSTRICT_READ_WRITE</code> 전략을 사용해야 합니다. 어떤 곳에서는 일관성을 위해 (quorum 알고리즘)[https://en.wikipedia.org/wiki/Quorum_(distributed_computing)] 을 사용하는 메모리 db 에서는 <code class="language-plaintext highlighter-rouge">READ_WRITE</code> 을 사용해도 된다고 하네요.</p><p>개인적으로 외부로 메모리 db를 빼고 <code class="language-plaintext highlighter-rouge">_WRITE</code> 전략을 사용하는것은 세세한 설정이 필요하고 유지보수에 더 큰 리소스가 들어갈 수 있기 때문에 선호하지 않는 편입니다. 그렇다 하더라도 2차캐시 자체는 충분히 매력적인 기능이라 생각합니다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/jpa/'>JPA</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spring/" class="post-tag no-text-decoration" >Spring</a> <a href="/tags/jpa/" class="post-tag no-text-decoration" >JPA</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=JPA+%EC%BA%90%EC%8B%9C+-+keencho%27s+blog&url=https%3A%2F%2Fkeencho.github.io%2Fposts%2FJPA-cache%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=JPA+%EC%BA%90%EC%8B%9C+-+keencho%27s+blog&u=https%3A%2F%2Fkeencho.github.io%2Fposts%2FJPA-cache%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fkeencho.github.io%2Fposts%2FJPA-cache%2F&text=JPA+%EC%BA%90%EC%8B%9C+-+keencho%27s+blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/jpa-flush/">JPA & Hibernate Flush Mode</a><li><a href="/posts/aws-cicd-1/">AWS를 사용해 무중단 배포 자동화 환경 구축하기 - 1. 개요</a><li><a href="/posts/terraform-aws-infra-6/">Terraform으로 AWS 무중단 배포 인프라 구성하기 - 6. 운영환경 (백엔드)</a><li><a href="/posts/aapt2-arm/">Arm 아키텍처에서 AAPT2 빌드 도구 사용하기</a><li><a href="/posts/terraform-aws-infra-1/">Terraform으로 AWS 무중단 배포 인프라 구성하기 - 1. 개요</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/ecs/">ECS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/querydsl/">QueryDSL</a> <a class="post-tag" href="/tags/react/">React</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/spring-new-transaction-in-same-class/"><div class="card-body"> <em class="small" data-ts="1676805120" data-df="ll" > Feb 19, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>동일한 클래스 안에서 새로운 트랜잭션 생성하기</h3><div class="text-muted small"><p> 동일한 클래스 안에서 새로운 트랜잭션 생성하기 동일한 클래스 내에서 새로운 트랜잭션을 만들어 예외를 회피하려고 하는 경우, 의도했던 것과는 다른 결과가 나올 수 있습니다. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 @Transactional public void a...</p></div></div></a></div><div class="card"> <a href="/posts/osiv/"><div class="card-body"> <em class="small" data-ts="1638605520" data-df="ll" > Dec 4, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>OSIV(Open-Session-In-View)</h3><div class="text-muted small"><p> OSIV OSIV(Open-Session-In-View)는 영속성 컨텍스트를 뷰 영역까지 열어두는 기능입니다. 여기서 뷰 영역은 Controller 혹은 템플릿 렌더링 영역까지를 의미합니다. 뷰 영역까지 영속성 컨텍스트가 살아있다면 뷰 영역에서도 지연 로딩 (Lazy Loading) 을 사용할 수 있습니다. 별다른 설정 없이도 지금까지 뷰 영역에서 ...</p></div></div></a></div><div class="card"> <a href="/posts/transaction-rollback/"><div class="card-body"> <em class="small" data-ts="1627470720" data-df="ll" > Jul 28, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Transaction silently rolled back because it has been marked as rollback-only</h3><div class="text-muted small"><p> 이게 왜 저장이 안될까? 서비스를 운영하다가 이 포스팅의 제목과 같이 Transaction silently rolled back because it has been marked as rollback-only 라는 에러 메시지를 받게 되었습니다. 해당 에러의 원인은 금방 찾았으나, 한 서비스가 내부 서비스의 메소드를 try-catch 블록으로 감싸 호출...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/aws-alb-static-ip/" class="btn btn-outline-primary" prompt="Older"><p>AWS ALB에 람다 없이 고정 IP로 접근하기</p></a> <a href="/posts/osiv/" class="btn btn-outline-primary" prompt="Newer"><p>OSIV(Open-Session-In-View)</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/keencho">keencho</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/ecs/">ECS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/querydsl/">QueryDSL</a> <a class="post-tag" href="/tags/react/">React</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
