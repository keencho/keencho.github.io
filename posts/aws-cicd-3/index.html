<!DOCTYPE html><html lang="ko-KS" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="AWS를 사용해 무중단 배포 자동화 환경 구축하기 - 3. VPC와 기본 리소스 생성하기" /><meta name="author" content="keencho" /><meta property="og:locale" content="ko_KS" /><meta name="description" content="AWS를 사용해 무중단 배포 자동화 환경 구축하기 시리즈 개요 VPC와 기본 리소스 VPC와 기본 리소스 생성하기 어플리케이션 구축 및 로드밸런서 적용 AWS 리소스 세팅 CodeDeploy 연동 / 마무리" /><meta property="og:description" content="AWS를 사용해 무중단 배포 자동화 환경 구축하기 시리즈 개요 VPC와 기본 리소스 VPC와 기본 리소스 생성하기 어플리케이션 구축 및 로드밸런서 적용 AWS 리소스 세팅 CodeDeploy 연동 / 마무리" /><link rel="canonical" href="https://keencho.github.io/posts/aws-cicd-3/" /><meta property="og:url" content="https://keencho.github.io/posts/aws-cicd-3/" /><meta property="og:site_name" content="keencho’s blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-26T10:28:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="AWS를 사용해 무중단 배포 자동화 환경 구축하기 - 3. VPC와 기본 리소스 생성하기" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@keencho" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"keencho"},"dateModified":"2022-06-21T12:42:01+09:00","datePublished":"2021-06-26T10:28:00+09:00","description":"AWS를 사용해 무중단 배포 자동화 환경 구축하기 시리즈 개요 VPC와 기본 리소스 VPC와 기본 리소스 생성하기 어플리케이션 구축 및 로드밸런서 적용 AWS 리소스 세팅 CodeDeploy 연동 / 마무리","headline":"AWS를 사용해 무중단 배포 자동화 환경 구축하기 - 3. VPC와 기본 리소스 생성하기","mainEntityOfPage":{"@type":"WebPage","@id":"https://keencho.github.io/posts/aws-cicd-3/"},"url":"https://keencho.github.io/posts/aws-cicd-3/"}</script><title>AWS를 사용해 무중단 배포 자동화 환경 구축하기 - 3. VPC와 기본 리소스 생성하기 | keencho's blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="keencho's blog"><meta name="application-name" content="keencho's blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/custom/keencho.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">keencho's blog</a></div><div class="site-subtitle font-italic">이것저것 정리하는 블로그.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/keencho" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['seyoung050412','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>AWS를 사용해 무중단 배포 자동화 환경 구축하기 - 3. VPC와 기본 리소스 생성하기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>AWS를 사용해 무중단 배포 자동화 환경 구축하기 - 3. VPC와 기본 리소스 생성하기</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1624670880" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 26, 2021 </em> </span><div class="d-flex justify-content-between"> <span> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4092 words"> <em>22 min</em> read</span></div></div></div><div class="post-content"><h1 id="aws를-사용해-무중단-배포-자동화-환경-구축하기-시리즈"><strong>AWS를 사용해 무중단 배포 자동화 환경 구축하기 시리즈</strong></h1><ol><li><a href="/posts/aws-cicd-1">개요</a><li><a href="/posts/aws-cicd-2">VPC와 기본 리소스</a><li><strong>VPC와 기본 리소스 생성하기</strong><li><a href="/posts/aws-cicd-4">어플리케이션 구축 및 로드밸런서 적용</a><li><a href="/posts/aws-cicd-5">AWS 리소스 세팅</a><li><a href="/posts/aws-cicd-6">CodeDeploy 연동 / 마무리</a></ol><h1 id="vpc와-기본-리소스-생성하기"><strong>VPC와 기본 리소스 생성하기</strong></h1><p>AWS 콘솔을 사용해 직접 VPC와 필요한 리소스들을 생성해 보겠습니다.</p><h2 id="vpc-생성하기"><span class="mr-2"><strong>VPC 생성하기</strong></span><a href="#vpc-생성하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>첫번째로 VPC를 생성해보도록 하겠습니다.</p><p>일단 AWS 콘솔에 접속한 후에, 검색창에 VPC를 검색해 VPC 대시보드로 들어갑니다. <img data-src="/assets/img/custom/aws-cicd/build/vpc-1.PNG" alt="vpc-1" data-proofer-ignore></p><p>그 후 오른쪽 상단의 <code class="language-plaintext highlighter-rouge">VPC 생성</code>을 눌러 VPC 생성 화면으로 이동합니다. 앞 포스팅에서 말씀드렸듯이 CIDR 블록에는 사설망 대역을 사용하는게 일반적인데요, 저는 3가지중 <code class="language-plaintext highlighter-rouge">192.168.0.0/16</code> 을 사용하겠습니다. IPv6 CIDR 블록도 사용할 수 있지만 여기서는 IPv4 CIDR 블록에만 초점을 맞추도록 하겠습니다. <img data-src="/assets/img/custom/aws-cicd/build/vpc-2.PNG" alt="vpc-2" data-proofer-ignore></p><p>VPC 가 생성 되었습니다. <img data-src="/assets/img/custom/aws-cicd/build/vpc-3.PNG" alt="vpc-3" data-proofer-ignore></p><p>여기까지의 구성도입니다. <img data-src="/assets/img/custom/aws-cicd/build/vpc-4.PNG" alt="vpc-4" data-proofer-ignore></p><h2 id="서브넷-생성하기"><span class="mr-2"><strong>서브넷 생성하기</strong></span><a href="#서브넷-생성하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>AWS 콘솔 검색창에 서브넷을 검색하여 서브넷 대시보드로 들어갑니다. 그 후 오른쪽 상단의 <code class="language-plaintext highlighter-rouge">서브넷 생성</code>을 눌러 서브넷 생성 화면으로 이동합니다.</p><p>먼저 방금전 만든 VPC를 선택해줍니다. 서브넷은 총 4개를 만들어야 합니다. 가용존 ap-northeast-2a, ap-northeast-2c 에 각각 서브넷 2개씩 만들어 줍니다. 가용존 하나에 만들어도 되지만 장애 대응 측면에서 가용존을 나누어 만들도록 하겠습니다. (물론 더 많은 가용존에 만들어도 무방합니다.) 우리가 만든 VPC의 IP 범위는 <code class="language-plaintext highlighter-rouge">192.168.0.0 ~ 192.168.255.255</code> 이기 때문에, 하나의 서브넷당 IP의 범위를 <code class="language-plaintext highlighter-rouge">192.168.X.X</code> 만큼 설정해 주도록 하겠습니다. <img data-src="/assets/img/custom/aws-cicd/build/subnet-1.PNG" alt="subnet-1" data-proofer-ignore> <img data-src="/assets/img/custom/aws-cicd/build/subnet-2.PNG" alt="subnet-2" data-proofer-ignore></p><p>서브넷 4개가 생성되었습니다. <img data-src="/assets/img/custom/aws-cicd/build/subnet-3.PNG" alt="subnet-3" data-proofer-ignore></p><p>여기까지의 구성도입니다. <img data-src="/assets/img/custom/aws-cicd/build/subnet-4.PNG" alt="subnet-4" data-proofer-ignore></p><h2 id="인터넷-게이트웨이-생성하기"><span class="mr-2"><strong>인터넷 게이트웨이 생성하기</strong></span><a href="#인터넷-게이트웨이-생성하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>앞서 만든 VPC는 인터넷과 연결된 통로가 없습니다. 그래서 이 상태에서 인스턴스를 만들어도 접속할 수 없는데요. 아마존에서는 인터넷 액세스를 활성화하려면 다음을 수행해야 한다고 설명하고 있습니다.</p><blockquote><ol><li>인터넷 게이트웨이를 생성하여 VPC에 연결합니다.<li>인터넷 바인딩된 트래픽을 인터넷 게이트웨이로 전달하는 라우팅을 서브넷의 라우팅 테이블에 추가합니다.<li>서브넷의 인스턴스에 전역적으로 고유한 IP 주소(퍼블릭 IPv4 주소, 탄력적 IP 주소 또는 IPv6 주소)가 있는지 확인합니다.<li>네트워크 액세스 제어 목록 및 보안 그룹 규칙에서 관련 트래픽이 인스턴스로, 그리고 인스턴스에서 흐르도록 허용되는지 확인합니다.</ol></blockquote><p>AWS 콘솔 검색창에 인터넷 게이트웨이를 검색하여 대시보드로 들어갑니다. 그 후 오른쪽 상단의 <code class="language-plaintext highlighter-rouge">인터넷 게이트웨이 생성</code>을 눌러 생성 화면으로 이동하고 이름을 입력하여 인터넷 게이트웨이를 생성합니다. <img data-src="/assets/img/custom/aws-cicd/build/igw-1.PNG" alt="igw-1" data-proofer-ignore></p><p>인터넷 게이트웨이는 생성후에 VPC와 연결해 주어야 합니다. 오른쪽 상단의 <code class="language-plaintext highlighter-rouge">작업</code> 탭을 선택후 <code class="language-plaintext highlighter-rouge">VPC에 연결</code>을 선택하여 VPC 연결 화면으로 이동합니다. 그후 처음에 만든 VPC를 선택하고 <code class="language-plaintext highlighter-rouge">인터넷 게이트웨이 연결</code>을 눌러 VPC와 인터넷 게이트웨이를 연결해줍니다. <img data-src="/assets/img/custom/aws-cicd/build/igw-2.PNG" alt="igw-1" data-proofer-ignore></p><p>여기까지의 구성도입니다. <img data-src="/assets/img/custom/aws-cicd/build/igw-3.PNG" alt="igw-3" data-proofer-ignore></p><h2 id="라우팅-테이블-생성하기"><span class="mr-2"><strong>라우팅 테이블 생성하기</strong></span><a href="#라우팅-테이블-생성하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>인터넷 게이트웨이를 생성하여 VPC와 연결했지만 아직 인스턴스에 연결할 수 없습니다. 아마존에서 설명한대로 서브넷의 라우팅 테이블이 방금 만든 인터넷 게이트웨이를 향하게 해야하는데요. 일단 라우팅 테이블을 검색하여 라우팅 테이블 대시보드로 진입합니다.</p><p>그러면 기본으로 생성된 라우팅 테이블 한개를 볼 수 있습니다. 쉽게 구분하기 위해 일단 이름을 rtb-public으로 변경합니다. 그 후 하단의 라우팅을 눌러보면 VPC 내부연결을 위한 규칙만 존재하는것을 확인 할 수 있습니다. 라우팅 탭의 <code class="language-plaintext highlighter-rouge">라우팅 편집</code> 을 눌러 라우팅을 추가해봅시다. 라우터(목적지)는 0.0.0.0/0 을 지정하고 방금 만든 인터넷 게이트웨이를 타겟과 연결합니다. <img data-src="/assets/img/custom/aws-cicd/build/rtb-1.PNG" alt="rtb-1" data-proofer-ignore></p><p>라우팅 테이블의 라우팅(목적지)이 수정되었습니다. <img data-src="/assets/img/custom/aws-cicd/build/rtb-2.PNG" alt="rtb-2" data-proofer-ignore></p><p>이제 라우팅 테이블과 서브넷을 연결해야 합니다. 서브넷 연결 탭을 눌러보면 <code class="language-plaintext highlighter-rouge">명시적 연결이 없는 서브넷</code> 이 보이는데요, 이중 <code class="language-plaintext highlighter-rouge">subnet-public-1</code> 과 <code class="language-plaintext highlighter-rouge">subnet-public-2</code> 서브넷을 연결하여 이름뿐이 아닌 진짜 퍼블릭 서브넷으로 만들어 보겠습니다. <img data-src="/assets/img/custom/aws-cicd/build/rtb-3.PNG" alt="rtb-3" data-proofer-ignore></p><p>서브넷 연결 탭의 명시적 연결이 없는 서브넷 박스에서 <code class="language-plaintext highlighter-rouge">서브넷 연결 편집</code> 을 눌러 서브넷 연결을 편집 화면에 진입합니다.</p><p><code class="language-plaintext highlighter-rouge">subnet-public-1</code> 과 <code class="language-plaintext highlighter-rouge">subnet-public-2</code> 을 선택하고 하단의 <code class="language-plaintext highlighter-rouge">연결 저장</code> 버튼을 클릭합니다. <img data-src="/assets/img/custom/aws-cicd/build/rtb-4.PNG" alt="rtb-4" data-proofer-ignore></p><p>이제 위에서 만든 4개의 서브넷중 2개의 서브넷이 <code class="language-plaintext highlighter-rouge">퍼블릭 서브넷</code>이 되었습니다. 실제로 연결되는지 한번 확인해봅시다.</p><p>인스턴스를 생성하기 위해 인스턴스 대시보드로 들어가 오른쪽 상단의 <code class="language-plaintext highlighter-rouge">인스턴스 시작</code>을 눌러 인스턴스 마법사를 시작합니다. 인스턴스 마법사 설정을 간단하게 설명드리겠습니다.</p><ol><li>AMI 선택 - 여기서는 Amazon Linux 2 AMI를 선택하겠습니다.<li>인스턴스 유형 선택 - 자금의 압박이 있기 때문에 프리티어 사용 가능 유형인 t2.micro를 선택하겠습니다.<li>인스턴스 세부 정보 구성 - 이곳이 중요합니다. 네트워크는 우리가 만든 VPC를 선택해주고 서브넷은 subnet-public-1을 선택하도록 하겠습니다.<li>스토리지는 기본 8GB 스토리지를 사용하겠습니다<li>태그는 건너 뛰겠습니다.<li>보안그룹도 새로 생성되는 보안그룹을 선택하겠습니다. 기본은 0.0.0.0/0 에 대해 22번 포트가 열려있는 형태입니다.<li>인스턴스 시작을 클릭합니다. 그 후 새 키 페어 생성을 선택하고 키 페어를 다운받아 잘 저장해 둡니다. <strong>(주의! 다시 다운로드 할 수 없습니다.)</strong></ol><p><img data-src="/assets/img/custom/aws-cicd/build/rtb-5.PNG" alt="rtb-5" data-proofer-ignore></p><p>생성한 인스턴스의 정보입니다. VPC 와 퍼블릭 서브넷이 올바르게 매핑되었는지 확인합니다. <img data-src="/assets/img/custom/aws-cicd/build/rtb-6.PNG" alt="rtb-6" data-proofer-ignore></p><p>그 후 탄력적 IP를 한개 발급받아 인스턴스와 연결하고, SSH Client를 사용해 원격 접속되는지 확인합니다.</p><blockquote><p>탄력적 IP는 대시보드 좌측의 <code class="language-plaintext highlighter-rouge">네트워크 및 보안 - 탄력적 IP</code> 탭에서 할당받고 연결시킬 수 있습니다. SSH Client의 사용법을 모르신다면 <a href="https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/putty.html">이곳</a> 에서 확인해보세요.</p></blockquote><p>퍼블릭 서브넷으로의 전환까지 완료한 구성도입니다. <img data-src="/assets/img/custom/aws-cicd/build/rtb-7.PNG" alt="rtb-7" data-proofer-ignore></p><p>앞 포스팅에서 설명드렸듯이 <code class="language-plaintext highlighter-rouge">인터넷 게이트웨이로 향하는 라우팅이 없는 라우팅 테이블과 연결된 서브넷</code>을 프라이빗 서브넷 이라 합니다. 프라이빗 서브넷을 만들기 위해 rtb-private 라는 이름을 가진 라우팅 테이블을 만들고 subnet-private-1 과 subnet-private-2 서브넷을 연결해 두겠습니다. <img data-src="/assets/img/custom/aws-cicd/build/rtb-8.PNG" alt="rtb-8" data-proofer-ignore> <img data-src="/assets/img/custom/aws-cicd/build/rtb-9.PNG" alt="rtb-9" data-proofer-ignore></p><p>여기까지 라우팅 테이블을 만들고 퍼블릭 서브넷, 프라이빗 서브넷에 연결하여 구성 완료한 구성도입니다. <img data-src="/assets/img/custom/aws-cicd/build/rtb-10.PNG" alt="rtb-10" data-proofer-ignore></p><h2 id="bastion-host-생성하기"><span class="mr-2"><strong>Bastion Host 생성하기</strong></span><a href="#bastion-host-생성하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>퍼블릭 서브넷에 프론트 &amp; 백엔드 어플리케이션을 올리지는 않습니다. (물론 가능은 합니다.) 보통 프라이빗 서브넷에 어플리케이션을 올리고 외부에서의 접근은 로드밸런서를 통해 80, 443 포트만 프라이빗 서브넷의 인스턴스에 접근할 수 있게 하지요.</p><p>그렇다면 프라이빗 서브넷 내부 인스턴스에 문제가 생겨 내 PC 에서 직접 인스턴스에 접속하려면 어떻게 해야 할까요? 정답은 <code class="language-plaintext highlighter-rouge">Bastion Host</code> 입니다. 퍼블릭 서브넷에 안스턴스를 생성하고 생성한 인스턴스에서 프라이빗 IPv4 주소를 통해 재접속하는 방식입니다. 일종의 프록시 서버이죠.</p><p>시작하기 전에 프라이빗 서브넷에 인스턴스 한개를 만들어 두도록 하겠습니다. 아까 인스턴스 생성 과정의 <code class="language-plaintext highlighter-rouge">3. 인스턴스 세부 정보 구성</code> 에서 서브넷만 subnet-private-1 으로 바꾸고 다른 옵션은 유지한채 인스턴스를 시작합니다. <img data-src="/assets/img/custom/aws-cicd/build/bastionhost-1.PNG" alt="bastionhost-1" data-proofer-ignore> 퍼블릭 IPv4 주소가 없고 서브넷 ID가 subnet-private-1 인 인스턴스 한개를 생성하였습니다. 사설 IP 대역이기 때문에 당연히 현재 PC 에서 이 인스턴스로 접근할 수 없습니다.</p><p>이제 퍼블릭 서브넷에 Bastion Host 용도의 인스턴스 한개를 만들어 보겠습니다.</p><blockquote><p>Bastion Host는 보통 Linux로 구성합니다. 하지만 자신이 터미널 환경의 운영체제에 익숙하지 않거나 터미널 환경의 DB 조작에 익숙하지 않다면 Windows 환경으로 구성하는것도 무방합니다. Windows 환경으로 구축하였을 경우 원격 데스크톱으로 해당 인스턴스에 접근해야 하는데요, 관련해서는 많은 글과 예제가 있으니 검색해 보시기 바랍니다.</p></blockquote><p><img data-src="/assets/img/custom/aws-cicd/build/bastionhost-2.PNG" alt="bastionhost-2" data-proofer-ignore> 퍼블릭 서브넷에 인스턴스 한개를 생성하고 탄력적 IP를 연결하였습니다. 이 인스턴스가 Bastion Host 용도의 인스턴스가 되는 것입니다.</p><p>이제 SSH Client를 이용해 방금 만든 Bastion Host에 접속해 보겠습니다.</p><p><img data-src="/assets/img/custom/aws-cicd/build/bastionhost-3.PNG" alt="bastionhost-3" data-proofer-ignore> ifconfig 명령어를 통해 현재 ip를 확인해 보니 192.168.0.247로 subnet-public-1에 있는 컴퓨터인것을 확인하였습니다.</p><p>그 후 프라이빗 서브넷에 있는 인스턴스를 생성할때 만든 .pem 파일을 Bastion Host로 옮깁니다. 옮긴 후에 <code class="language-plaintext highlighter-rouge">ssh -i key.pem ec2-user:192.168.X.X</code> 명령어를 사용하여 인스턴스에 접근해 보겠습니다. 음? 접속이 되지 않습니다. 어떻게 된 일일까요?</p><p>정답은 보안그룹입니다. 프라이빗 서브넷의 인스턴스를 생성하실때 보안그룹을 잘 확인하지 않고 그냥 기본 생성되는 보안그룹을 적용하셨다면 문제없이 접근하셨을 수도 있습니다. 그러나 22번 포트에 대해 인바운드 규칙을 없애버리셨다면 접근 할 수 없는것이 당연합니다.</p><p>보안그룹 탭에 들어가 현재 프라이빗 서브넷에 적용되어 있는 보안그룹을 변경하겠습니다. 유형에 SSH를 선택하시고 소스에는 Bastion Host의 EIP CIDR 블록을 직접 입력하는 것이 아닌 Bastion Host에 적용되어 있는 보안그룹을 선택해주세요. (여기서는 편의상 public, private sg 라 지칭해 두었습니다.) <img data-src="/assets/img/custom/aws-cicd/build/bastionhost-4.PNG" alt="bastionhost-4" data-proofer-ignore> 보안그룹이 적용되었다면 다시한번 Bastion Host에 접속해서 프라이빗 서브넷의 인스턴스에 접속해 보겠습니다.</p><p><img data-src="/assets/img/custom/aws-cicd/build/bastionhost-5.PNG" alt="bastionhost-5" data-proofer-ignore> 프라이빗 서브넷 내부 인스턴스에 접속 성공하였고 ifconfig 명령어를 통해 subnet-private-1에 있는 컴퓨터인것을 확인하였습니다.</p><p>혹시 아래와 같은 에러 메시지를 보게 된다면 전송한 key.pem 파일의 권한을 <code class="language-plaintext highlighter-rouge">chmod 600 key.pem</code> 명령어를 통해 바꿔주세요. <img data-src="/assets/img/custom/aws-cicd/build/bastionhost-6.PNG" alt="bastionhost-6" data-proofer-ignore></p><p>Bastion Host 생성을 완료하였고 여기까지의 구성도는 다음과 같습니다. <img data-src="/assets/img/custom/aws-cicd/build/bastionhost-7.PNG" alt="bastionhost-7" data-proofer-ignore></p><blockquote><p>귀찮게 뭐하러 한단계 거쳐서 접근해? 내 컴퓨터에서 바로 접근하는 방법은 없어? 라고 생각하시는 분들이 계실텐데요 (저도 그랬습니다…) 이 부분은 <code class="language-plaintext highlighter-rouge">SSH Tunneling</code> 혹은 <code class="language-plaintext highlighter-rouge">SSH Reverse Tunneling</code> 으로 해결할 수 있으니 궁금하신 분들은 검색해 보시기 바랍니다.</p></blockquote><h2 id="nat-gateway-생성하기"><span class="mr-2"><strong>NAT Gateway 생성하기</strong></span><a href="#nat-gateway-생성하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Bastion Host를 통해 프라이빗 서브넷에 있는 인스턴스에 접근까지는 성공하였습니다. 하지만 프라이빗 서브넷은 현재 인터넷과 관련된 동작은 할 수 없습니다. 이유는 나가는 라우팅(목적지)이 없기 때문입니다. 일례로 <code class="language-plaintext highlighter-rouge">sudo yum update</code> 명령어를 쳐도 아무것도 동작하지 않습니다. 오히려 <code class="language-plaintext highlighter-rouge">Connection time out</code> 이라는 타임아웃 에러메시지를 확인 할 수 있습니다. 이때 필요한 것이 NAT Gateway 입니다.</p><p>AWS 콘솔에서 <code class="language-plaintext highlighter-rouge">NAT 게이트웨이</code>를 검색하여 대시보드로 이동한 후에 우측 상단의 <code class="language-plaintext highlighter-rouge">NAT 게이트웨이 생성</code>을 눌러 생성화면으로 이동해보겠습니다. 이름을 지정하고 서브넷은 subnet-public-1 을 지정해 2a 가용영역의 퍼블릭 서브넷에 NAT Gateway가 생성될 수 있도록 합니다. 마지막으로 탄력적 IP를 하나 할당 받아 적용하고 NAT Gateway를 생성합니다. <img data-src="/assets/img/custom/aws-cicd/build/nat-1.PNG" alt="nat-1" data-proofer-ignore></p><p>NAT Gateway를 생성하였지만 아직 프라이빗 서브넷의 인스턴스에서는 인터넷에 접속할 수 없습니다. 이유는 프라이빗 서브넷의 라우터(목적지)를 수정하지 않았기 때문인데요. 이를 수정하기 위해 라우팅 테이블 대시보드로 이동하여 현재 프라이빗 서브넷에 적용되어 있는 라우팅 테이블을 선택후 <code class="language-plaintext highlighter-rouge">라우팅 편집</code>을 클릭하여 편집화면으로 이동하도록 하겠습니다. 라우팅 편집화면으로 이동하였다면 0.0.0.0/0 에 대한 라우팅을 추가하고 대상을 방금 만든 NAT Gateway로 지정해주도록 하겠습니다. <img data-src="/assets/img/custom/aws-cicd/build/nat-2.PNG" alt="nat-2" data-proofer-ignore></p><p>편집이 모두 완료되었다면 다시 프라이빗 서브넷의 인스턴스로 접속하여 <code class="language-plaintext highlighter-rouge">sudo yum update</code> 명령어를 쳐보겠습니다. <img data-src="/assets/img/custom/aws-cicd/build/nat-3.PNG" alt="nat-3" data-proofer-ignore></p><p>인스턴스가 NAT Gateway를 통해 인터넷과 연결되어 패키지가 업그레이드 되는것을 확인할 수 있습니다. 만약 외부 업체의 api에 접근해야 하는데 보안 정책상 기본 접근은 막아두고 접근 허용할 IP를 알려달라고 하면 방금 만든 NAT Gateway의 EIP를 알려주면 되겠죠? 또 지금은 2a 가용영역에만 NAT Gateway를 만들었지만 보통 가용존의 수만큼 만든다고 하니 알맞은 수의 NAT Gateway를 만들어 보시기 바랍니다.</p><p>NAT Gateway 까지 생성 완료한 현재까지의 구성도입니다. <img data-src="/assets/img/custom/aws-cicd/build/nat-4.PNG" alt="nat-4" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/aws/'>AWS</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/aws/" class="post-tag no-text-decoration" >AWS</a> <a href="/tags/devops/" class="post-tag no-text-decoration" >DevOps</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=AWS%EB%A5%BC+%EC%82%AC%EC%9A%A9%ED%95%B4+%EB%AC%B4%EC%A4%91%EB%8B%A8+%EB%B0%B0%ED%8F%AC+%EC%9E%90%EB%8F%99%ED%99%94+%ED%99%98%EA%B2%BD+%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0+-+3.+VPC%EC%99%80+%EA%B8%B0%EB%B3%B8+%EB%A6%AC%EC%86%8C%EC%8A%A4+%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0+-+keencho%27s+blog&url=https%3A%2F%2Fkeencho.github.io%2Fposts%2Faws-cicd-3%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=AWS%EB%A5%BC+%EC%82%AC%EC%9A%A9%ED%95%B4+%EB%AC%B4%EC%A4%91%EB%8B%A8+%EB%B0%B0%ED%8F%AC+%EC%9E%90%EB%8F%99%ED%99%94+%ED%99%98%EA%B2%BD+%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0+-+3.+VPC%EC%99%80+%EA%B8%B0%EB%B3%B8+%EB%A6%AC%EC%86%8C%EC%8A%A4+%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0+-+keencho%27s+blog&u=https%3A%2F%2Fkeencho.github.io%2Fposts%2Faws-cicd-3%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fkeencho.github.io%2Fposts%2Faws-cicd-3%2F&text=AWS%EB%A5%BC+%EC%82%AC%EC%9A%A9%ED%95%B4+%EB%AC%B4%EC%A4%91%EB%8B%A8+%EB%B0%B0%ED%8F%AC+%EC%9E%90%EB%8F%99%ED%99%94+%ED%99%98%EA%B2%BD+%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0+-+3.+VPC%EC%99%80+%EA%B8%B0%EB%B3%B8+%EB%A6%AC%EC%86%8C%EC%8A%A4+%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0+-+keencho%27s+blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/jpa-flush/">JPA & Hibernate Flush Mode</a><li><a href="/posts/aws-cicd-1/">AWS를 사용해 무중단 배포 자동화 환경 구축하기 - 1. 개요</a><li><a href="/posts/terraform-aws-infra-6/">Terraform으로 AWS 무중단 배포 인프라 구성하기 - 6. 운영환경 (백엔드)</a><li><a href="/posts/aapt2-arm/">Arm 아키텍처에서 AAPT2 빌드 도구 사용하기</a><li><a href="/posts/terraform-aws-infra-1/">Terraform으로 AWS 무중단 배포 인프라 구성하기 - 1. 개요</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/ecs/">ECS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/querydsl/">QueryDSL</a> <a class="post-tag" href="/tags/react/">React</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/aws-cicd-1/"><div class="card-body"> <em class="small" data-ts="1624271520" data-df="ll" > Jun 21, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS를 사용해 무중단 배포 자동화 환경 구축하기 - 1. 개요</h3><div class="text-muted small"><p> AWS를 사용해 무중단 배포 자동화 환경 구축하기 시리즈 개요 VPC와 기본 리소스 VPC와 기본 리소스 생성하기 어플리케이션 구축 및 로드밸런서 적용 AWS 리소스 세팅 CodeDeploy 연동 / 마무리 개요 AWS를 이용하여 가장 기본적인 형태의 인프라를 구축하고 GithubAction - CodeDeploy 를 이용하...</p></div></div></a></div><div class="card"> <a href="/posts/aws-cicd-2/"><div class="card-body"> <em class="small" data-ts="1624360320" data-df="ll" > Jun 22, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS를 사용해 무중단 배포 자동화 환경 구축하기 - 2. VPC와 기본 리소스</h3><div class="text-muted small"><p> AWS를 사용해 무중단 배포 자동화 환경 구축하기 시리즈 개요 VPC와 기본 리소스 VPC와 기본 리소스 생성하기 어플리케이션 구축 및 로드밸런서 적용 AWS 리소스 세팅 CodeDeploy 연동 / 마무리 VPC와 기본 리소스 서버 구축의 첫번째 단계로 AWS의 VPC (Virtual Private Cloud) 와 기본 리...</p></div></div></a></div><div class="card"> <a href="/posts/aws-cicd-4/"><div class="card-body"> <em class="small" data-ts="1624792320" data-df="ll" > Jun 27, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS를 사용해 무중단 배포 자동화 환경 구축하기 - 4. 어플리케이션 구축 및 로드밸런서 적용</h3><div class="text-muted small"><p> AWS를 사용해 무중단 배포 자동화 환경 구축하기 시리즈 개요 VPC와 기본 리소스 VPC와 기본 리소스 생성하기 어플리케이션 구축 및 로드밸런서 적용 AWS 리소스 세팅 CodeDeploy 연동 / 마무리 어플리케이션 구축 및 로드밸런서 적용 이번 포스팅에서는 간단한 Spring Boot 어플리케이션을 만들어 ec2 인스턴...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/aws-cicd-2/" class="btn btn-outline-primary" prompt="Older"><p>AWS를 사용해 무중단 배포 자동화 환경 구축하기 - 2. VPC와 기본 리소스</p></a> <a href="/posts/aws-cicd-4/" class="btn btn-outline-primary" prompt="Newer"><p>AWS를 사용해 무중단 배포 자동화 환경 구축하기 - 4. 어플리케이션 구축 및 로드밸런서 적용</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/keencho">keencho</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/ecs/">ECS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/querydsl/">QueryDSL</a> <a class="post-tag" href="/tags/react/">React</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
