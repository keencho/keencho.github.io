<!DOCTYPE html><html lang="ko-KS" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="JPA 3.1" /><meta name="author" content="keencho" /><meta property="og:locale" content="ko_KS" /><meta name="description" content="JPA 3.1 Spring 6.0, Spring Boot 3.0 버전이 릴리즈된지 한달이 지났습니다. 현재 날짜 (2022-12-26) 기준으로는 Spring의 경우 6.0.3, Spring Boot의 경우 3.0.1 버전까지 올라왔네요." /><meta property="og:description" content="JPA 3.1 Spring 6.0, Spring Boot 3.0 버전이 릴리즈된지 한달이 지났습니다. 현재 날짜 (2022-12-26) 기준으로는 Spring의 경우 6.0.3, Spring Boot의 경우 3.0.1 버전까지 올라왔네요." /><link rel="canonical" href="https://keencho.github.io/posts/jpa3.1/" /><meta property="og:url" content="https://keencho.github.io/posts/jpa3.1/" /><meta property="og:site_name" content="keencho’s blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-12-26T10:12:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="JPA 3.1" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@keencho" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"keencho"},"dateModified":"2022-12-27T10:36:52+09:00","datePublished":"2022-12-26T10:12:00+09:00","description":"JPA 3.1 Spring 6.0, Spring Boot 3.0 버전이 릴리즈된지 한달이 지났습니다. 현재 날짜 (2022-12-26) 기준으로는 Spring의 경우 6.0.3, Spring Boot의 경우 3.0.1 버전까지 올라왔네요.","headline":"JPA 3.1","mainEntityOfPage":{"@type":"WebPage","@id":"https://keencho.github.io/posts/jpa3.1/"},"url":"https://keencho.github.io/posts/jpa3.1/"}</script><title>JPA 3.1 | keencho's blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="keencho's blog"><meta name="application-name" content="keencho's blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/custom/keencho.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">keencho's blog</a></div><div class="site-subtitle font-italic">이것저것 정리하는 블로그.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/keencho" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['seyoung050412','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>JPA 3.1</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>JPA 3.1</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1672017120" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 26, 2022 </em> </span><div class="d-flex justify-content-between"> <span> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3595 words"> <em>19 min</em> read</span></div></div></div><div class="post-content"><h1 id="jpa-31"><strong>JPA 3.1</strong></h1><p>Spring 6.0, Spring Boot 3.0 버전이 릴리즈된지 한달이 지났습니다. 현재 날짜 (2022-12-26) 기준으로는 Spring의 경우 6.0.3, Spring Boot의 경우 3.0.1 버전까지 올라왔네요.</p><p>Spring Boot를 주요 서버 프레임워크로 사용하는 저로써는 Spring Data JPA가 가장 기대됩니다. 그중에서도 최신 JPA 3.1 스펙을 사용해보기를 기대해 보고 있는데요, 아직까지 하이버네이트 메이저 버전에서는 JPA 3.0에 의존하고 있는 것으로 보입니다.</p><p><img data-src="/assets/img/custom/jpa3.1/hibernate-6.1.6-jpa-dependency.JPG" alt="hibernate6.1.6-jpa-dependency" data-proofer-ignore><br /> 위 이미지는 <code class="language-plaintext highlighter-rouge">Hibernate 6.1.6 Final</code> 버전이 의존하고 있는 디펜던시 목록입니다. JPA 3.0에 의존하고 있네요.</p><p><img data-src="/assets/img/custom/jpa3.1/hibernate-6.2.0-jpa-dependency.JPG" alt="hibernate6.2.0-jpa-dependency" data-proofer-ignore><br /> 위 이미지는 최근(2022-12-23)에 출시된 <code class="language-plaintext highlighter-rouge">Hibernate 6.2.0 CR</code> 버전이 의존하고 있는 디펜던시 목록입니다. JPA 3.1에 의존하고 있죠? <code class="language-plaintext highlighter-rouge">Spring Data JPA 3.0.0</code> 버전이 <code class="language-plaintext highlighter-rouge">Hibernate 6.1.4 Final</code> 버전을 사용하고 있기 때문에 2023년 안에는 JPA 3.1 스펙의 기능들을 Spring Boot에서 기본적으로 사용할 수 있을 것으로 보입니다.</p><p>그래서 오늘은 새로운 <code class="language-plaintext highlighter-rouge">Spring Data JPA</code>를 기다리며 JPA 3.1의 새로운 기능들, 변경점에 대해 알아보고자 합니다.</p><h2 id="jpa-30"><span class="mr-2"><strong>JPA 3.0</strong></span><a href="#jpa-30" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>JPA 3.1 출시 이전에 JPA 3.0이 먼저 출시되었겠죠? 현재 시점의 최신 Hibernate 는 JPA 3.0 스펙을 완전히 지원합니다. Hibernate 6.0.x, 6.1.x 버전이 의존하고 있는 종속성을 확인해보면 <code class="language-plaintext highlighter-rouge">jakarta.persistence-api:3.x</code> 를 의존하고 있는것을 확인할 수 있습니다.</p><p>JPA가 3.0 버전으로 올라오면서 기존 JPA 2.2과 비교해 새로생긴 기능은 없습니다. 단, 모든 API클래스, 패키지, 점두사, 및 모든 XML 기반 구성 파일의 스키마 네임스페이스는 변경되었습니다. 간단히 말해 <code class="language-plaintext highlighter-rouge">javax.persistence</code> 패키지 내에 존재했던 클래스들이 <code class="language-plaintext highlighter-rouge">jakarta.persistence</code> 패키지 내부로 들어갔다고 보시면 되는데요, 관련해서는 <a href="https://www.samsungsds.com/kr/insights/java_jakarta.html">이 글</a> 을 읽어보시면 도움이 될것 같습니다. 왜 자바EE가 이클립스 재단으로 이관되고 자카르타EE 라는 명칭을 가지게 되었는지 확인하실 수 있습니다.</p><h2 id="jpa-31-1"><span class="mr-2"><strong>JPA 3.1</strong></span><a href="#jpa-31-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>JPA 3.1은 <a href="https://projects.eclipse.org/releases/jakarta-10">Jakarta 10</a> 의 일부로서 2022년 3월 30일에 릴리즈 되었습니다. 아래부터는 변경점과 새로운 기능들에 대해 알아보겠습니다.</p><p>새로 추가된 기능들은 예제를 통해 알아보고자 합니다. 일단 예제 프로젝트부터 구성해 보겠습니다.</p><p>첫번째로 build.gradle 파일입니다. <code class="language-plaintext highlighter-rouge">hibernate-core 6.2.0 CR1</code> 버전을 사용하였습니다. 파라미터 로깅을 위해 log4j2를 사용하며 db는 h2를 사용합니다.</p><div class="language-gradle highlighter-rouge"><div class="code-header"> <span data-label-text="Gradle"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="n">plugins</span> <span class="o">{</span>
    <span class="n">id</span> <span class="s1">'java'</span>
<span class="o">}</span>

<span class="n">group</span> <span class="s1">'com.keencho'</span>
<span class="n">version</span> <span class="s1">'1.0-SNAPSHOT'</span>

<span class="k">repositories</span> <span class="o">{</span>
    <span class="n">mavenCentral</span><span class="o">()</span>
<span class="o">}</span>

<span class="n">tasks</span><span class="o">.</span><span class="na">withType</span><span class="o">(</span><span class="n">JavaCompile</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">options</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="s1">'UTF-8'</span>
<span class="o">}</span>

<span class="n">test</span> <span class="o">{</span>
    <span class="n">useJUnitPlatform</span><span class="o">()</span>
<span class="o">}</span>

<span class="k">dependencies</span> <span class="o">{</span>
    <span class="n">implementation</span> <span class="s1">'org.hibernate.orm:hibernate-core:6.2.0.CR1'</span>
    <span class="n">implementation</span> <span class="s1">'com.h2database:h2:2.1.214'</span>
    <span class="n">implementation</span> <span class="nl">group:</span> <span class="s1">'org.apache.logging.log4j'</span><span class="o">,</span> <span class="nl">name:</span> <span class="s1">'log4j-core'</span><span class="o">,</span> <span class="nl">version:</span> <span class="s1">'2.19.0'</span>

    <span class="n">implementation</span> <span class="s1">'org.projectlombok:lombok:1.18.24'</span>
    <span class="n">annotationProcessor</span> <span class="s1">'org.projectlombok:lombok:1.18.24'</span>

    <span class="n">testImplementation</span> <span class="s1">'org.junit.jupiter:junit-jupiter-api:5.9.1'</span>
    <span class="n">testRuntimeOnly</span> <span class="s1">'org.junit.jupiter:junit-jupiter-engine:5.9.1'</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">log4j2.xml</code> 파일입니다. 로깅을 위해 사용됩니다.</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="nt">&lt;Configuration</span> <span class="na">monitorInterval=</span><span class="s">"60"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Properties&gt;</span>
        <span class="nt">&lt;Property</span> <span class="na">name=</span><span class="s">"log-path"</span><span class="nt">&gt;</span>PropertiesConfiguration<span class="nt">&lt;/Property&gt;</span>
    <span class="nt">&lt;/Properties&gt;</span>
    <span class="nt">&lt;Appenders&gt;</span>
        <span class="nt">&lt;Console</span> <span class="na">name=</span><span class="s">"Console-Appender"</span> <span class="na">target=</span><span class="s">"SYSTEM_OUT"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;PatternLayout&gt;</span>
                <span class="nt">&lt;pattern&gt;</span>
                    [%-5level] %d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %c{1} - %msg%n
                <span class="nt">&lt;/pattern&gt;</span>&gt;
            <span class="nt">&lt;/PatternLayout&gt;</span>
        <span class="nt">&lt;/Console&gt;</span>
    <span class="nt">&lt;/Appenders&gt;</span>
    <span class="nt">&lt;Loggers&gt;</span>
        <span class="nt">&lt;Logger</span> <span class="na">name=</span><span class="s">"org.hibernate.SQL"</span> <span class="na">level=</span><span class="s">"debug"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"Console-Appender"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Logger&gt;</span>
        <span class="nt">&lt;Logger</span> <span class="na">name=</span><span class="s">"org.hibernate.orm.jdbc.bind"</span> <span class="na">level=</span><span class="s">"trace"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"Console-Appender"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Logger&gt;</span>
        <span class="nt">&lt;Logger</span> <span class="na">name=</span><span class="s">"org.hibernate.stat"</span> <span class="na">level=</span><span class="s">"trace"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"Console-Appender"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Logger&gt;</span>
        <span class="nt">&lt;Logger</span> <span class="na">name=</span><span class="s">"org.hibernate.SQL_SLOW"</span> <span class="na">level=</span><span class="s">"trace"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"Console-Appender"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Logger&gt;</span>
        <span class="nt">&lt;Logger</span> <span class="na">name=</span><span class="s">"org.hibernate.cache"</span> <span class="na">level=</span><span class="s">"trace"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"Console-Appender"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Logger&gt;</span>

        <span class="nt">&lt;Root</span> <span class="na">level=</span><span class="s">"info"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"Console-Appender"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Root&gt;</span>
    <span class="nt">&lt;/Loggers&gt;</span>
<span class="nt">&lt;/Configuration&gt;</span>
</pre></table></code></div></div><p>다음은 <code class="language-plaintext highlighter-rouge">/src/main/resources/META-INF/persistence.xml</code> 경로에 존재해야 하는 persistence.xml 파일입니다.</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="nt">&lt;persistence</span> <span class="na">xmlns=</span><span class="s">"https://jakarta.ee/xml/ns/persistence"</span>
             <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
             <span class="na">xsi:schemaLocation=</span><span class="s">"https://jakarta.ee/xml/ns/persistence https://jakarta.ee/xml/ns/persistence/persistence_3_1.xsd"</span>
             <span class="na">version=</span><span class="s">"3.1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;persistence-unit</span> <span class="na">name=</span><span class="s">"pu"</span> <span class="na">transaction-type=</span><span class="s">"RESOURCE_LOCAL"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;description&gt;</span>JPA3.1 Test with hibernate6 persistence-unit<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;provider&gt;</span>org.hibernate.jpa.HibernatePersistenceProvider<span class="nt">&lt;/provider&gt;</span>

        <span class="nt">&lt;class&gt;</span>com.keencho.jpa31.model.Book<span class="nt">&lt;/class&gt;</span>

        <span class="nt">&lt;properties&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.archive.autodetection"</span> <span class="na">value=</span><span class="s">"class, hbm"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.dialect"</span> <span class="na">value=</span><span class="s">"org.hibernate.dialect.H2Dialect"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.connection.driver_class"</span> <span class="na">value=</span><span class="s">"org.h2.Driver"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.connection.url"</span> <span class="na">value=</span><span class="s">"jdbc:h2:mem:db1;DB_CLOSE_DELAY=-1"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.connection.username"</span> <span class="na">value=</span><span class="s">"sa"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.connection.pool_size"</span> <span class="na">value=</span><span class="s">"5"</span><span class="nt">/&gt;</span>

            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.format_sql"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.hbm2ddl.auto"</span> <span class="na">value=</span><span class="s">"create-drop"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.max_fetch_depth"</span> <span class="na">value=</span><span class="s">"5"</span><span class="nt">/&gt;</span>

            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.jdbc.batch_versioned_data"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"jakarta.persistence.validation.mode"</span> <span class="na">value=</span><span class="s">"NONE"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.service.allow_crawling"</span> <span class="na">value=</span><span class="s">"false"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.session.events.log"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/persistence-unit&gt;</span>
<span class="nt">&lt;/persistence&gt;</span>
</pre></table></code></div></div><p>Book 엔티티 입니다. 이 엔티티로 새로운 기능들을 확인해 볼 것입니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="nd">@Data</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">AUTO</span><span class="o">)</span>
    <span class="kd">private</span> <span class="no">UUID</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">pages</span><span class="o">;</span>

    <span class="c1">// 판매율 (소수점)</span>
    <span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">sellingRates</span><span class="o">;</span>
    <span class="c1">// 분류기호 (소수점)</span>
    <span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">classificationSymbol</span><span class="o">;</span>

    <span class="c1">// 발매일</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">releaseDateTime</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>다음은 테스트를 도와줄 설정 클래스 입니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HibernateHelper</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">HibernateHelper</span> <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HibernateHelper</span><span class="o">();</span>

    <span class="nd">@Getter</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">EntityManagerFactory</span> <span class="n">entityManagerFactory</span><span class="o">;</span>

    <span class="nd">@Getter</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">HibernateHelper</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManagerFactory</span> <span class="o">=</span> <span class="nc">Persistence</span><span class="o">.</span><span class="na">createEntityManagerFactory</span><span class="o">(</span><span class="s">"pu"</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManagerFactory</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">beginTransaction</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">instance</span><span class="o">.</span><span class="na">getEntityManager</span><span class="o">().</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">begin</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">commit</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">instance</span><span class="o">.</span><span class="na">getEntityManager</span><span class="o">().</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">commit</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">instance</span><span class="o">.</span><span class="na">getEntityManagerFactory</span><span class="o">().</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">persist</span><span class="o">(</span><span class="nc">Object</span> <span class="n">entity</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">instance</span><span class="o">.</span><span class="na">getEntityManager</span><span class="o">().</span><span class="na">persist</span><span class="o">(</span><span class="n">entity</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">////////////////////////////////////////////////////////////////////</span>
    <span class="c1">/////////////////////////////////// SELECT</span>
    <span class="c1">////////////////////////////////////////////////////////////////////</span>

    <span class="nd">@FunctionalInterface</span>
    <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">SelectHelper</span> <span class="o">{</span>
        <span class="nc">Selection</span><span class="o">&lt;?&gt;</span> <span class="n">apply</span><span class="o">(</span><span class="nc">CriteriaBuilder</span> <span class="n">cb</span><span class="o">,</span> <span class="nc">Root</span><span class="o">&lt;?&gt;</span> <span class="n">root</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">CriteriaBuilder</span> <span class="nf">getCriteriaBuilder</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// https://hibernate.zulipchat.com/#narrow/stream/132096-hibernate-user/topic/New.20functions.20in.20JPA.203.2E1/near/289429903</span>
        <span class="c1">// hibernate 6.1.x final 버전까지 jpa3.0에 의존하고 있기 때문에 HibernateCriteriaBuilder 로 형변환 해야한다.</span>
        <span class="c1">// 아직 final은 아니지만 hibernate 6.2.x CR 버전에서는 jpa 3.1에 의존하고 있으며 그냥 이 코드로 사용 가능하다. (형변환이 필요 없다.)</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">.</span><span class="na">getEntityManager</span><span class="o">().</span><span class="na">getCriteriaBuilder</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">listAll</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">rootClass</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">list</span><span class="o">(</span><span class="n">rootClass</span><span class="o">).</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="no">T</span><span class="o">)</span> <span class="n">i</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">)).</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">rootClass</span><span class="o">,</span> <span class="nc">SelectHelper</span><span class="o">...</span> <span class="n">selectHelper</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">getCriteriaBuilder</span><span class="o">();</span>
        <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="na">createTupleQuery</span><span class="o">();</span>
        <span class="kt">var</span> <span class="n">root</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">rootClass</span><span class="o">);</span>

        <span class="kt">var</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Selection</span><span class="o">&lt;?&gt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">SelectHelper</span> <span class="n">helper</span> <span class="o">:</span> <span class="n">selectHelper</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">helper</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">cb</span><span class="o">,</span> <span class="n">root</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(!</span><span class="n">list</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">query</span><span class="o">.</span><span class="na">multiselect</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">instance</span><span class="o">.</span><span class="na">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="n">query</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;?&gt;</span> <span class="n">list</span><span class="o">(</span><span class="nc">String</span> <span class="n">query</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">.</span><span class="na">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="n">query</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Hibernate 6.1.x</code> 이하 버전을 사용하신다면 중간의 <code class="language-plaintext highlighter-rouge">getCriteriaBuilder()</code> 메소드는 <code class="language-plaintext highlighter-rouge">HibernateCriteriaBuilder</code>를 리턴해야 합니다. <code class="language-plaintext highlighter-rouge">Hibernate 6.1.x</code> 이하 버전은 JPA 3.0을 사용하기 때문인 것으로 보이며 이 글을 그대로 따라하셨거나 <code class="language-plaintext highlighter-rouge">Hibernate 6.2.x</code> 이상 버전을 사용한다면 이는 JPA 3.1을 사용하기 때문에 예제 그대로 <code class="language-plaintext highlighter-rouge">CriteriaBuilder</code>를 리턴하게 두시면 됩니다. 자세한 내용은 <a href="https://hibernate.zulipchat.com/#narrow/stream/132096-hibernate-user/topic/New.20functions.20in.20JPA.203.2E1/near/289429903">이 스레드</a>를 확인해 보세요.</p><p>마지막으로 테스트 클래스 입니다. 테스트 전에 트랜잭션을 시작하고 2개의 엔티티를 영속화 합니다. 아래에서 작성할 모든 예제 테스트들은 이 클래스 내부에 위치하게 됩니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JPA31Test</span> <span class="o">{</span>

    <span class="nd">@BeforeAll</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// disable hibernate info log</span>
        <span class="nc">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="nc">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">"org.hibernate"</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">setLevel</span><span class="o">(</span><span class="nc">Level</span><span class="o">.</span><span class="na">OFF</span><span class="o">);</span>

        <span class="nc">HibernateHelper</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>

        <span class="kt">var</span> <span class="n">book1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
        <span class="n">book1</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"Effective Java"</span><span class="o">);</span>
        <span class="n">book1</span><span class="o">.</span><span class="na">setPages</span><span class="o">(</span><span class="mi">342</span><span class="o">);</span>
        <span class="n">book1</span><span class="o">.</span><span class="na">setSellingRates</span><span class="o">(</span><span class="k">new</span> <span class="nc">BigDecimal</span><span class="o">(</span><span class="s">"48.54"</span><span class="o">));</span>
        <span class="n">book1</span><span class="o">.</span><span class="na">setClassificationSymbol</span><span class="o">(</span><span class="k">new</span> <span class="nc">BigDecimal</span><span class="o">(</span><span class="s">"170.537"</span><span class="o">));</span>
        <span class="n">book1</span><span class="o">.</span><span class="na">setReleaseDateTime</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2020</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">13</span><span class="o">,</span> <span class="mi">17</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">30</span><span class="o">));</span>

        <span class="kt">var</span> <span class="n">book2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
        <span class="n">book2</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"Modern Java in Action"</span><span class="o">);</span>
        <span class="n">book2</span><span class="o">.</span><span class="na">setPages</span><span class="o">(</span><span class="mi">573</span><span class="o">);</span>
        <span class="n">book2</span><span class="o">.</span><span class="na">setSellingRates</span><span class="o">(</span><span class="k">new</span> <span class="nc">BigDecimal</span><span class="o">(</span><span class="s">"51.46"</span><span class="o">));</span>
        <span class="n">book2</span><span class="o">.</span><span class="na">setClassificationSymbol</span><span class="o">(</span><span class="k">new</span> <span class="nc">BigDecimal</span><span class="o">(</span><span class="s">"2096.331"</span><span class="o">));</span>
        <span class="n">book2</span><span class="o">.</span><span class="na">setReleaseDateTime</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2022</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">13</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">43</span><span class="o">,</span> <span class="mi">0</span><span class="o">));</span>

        <span class="nc">HibernateHelper</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">book1</span><span class="o">);</span>
        <span class="nc">HibernateHelper</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">book2</span><span class="o">);</span>

        <span class="nc">HibernateHelper</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@AfterAll</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">HibernateHelper</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="1-entitymanagerfactory-entitymanager-인터페이스가-javalangautocloseable-인터페이스를-상속합니다-변경"><span class="mr-2"><strong>1. EntityManagerFactory, EntityManager 인터페이스가 java.lang.AutoCloseable 인터페이스를 상속합니다. (변경)</strong></span><a href="#1-entitymanagerfactory-entitymanager-인터페이스가-javalangautocloseable-인터페이스를-상속합니다-변경" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><img data-src="/assets/img/custom/jpa3.1/jpa3.0-emf.JPG" alt="jpa3.0-emf" data-proofer-ignore><br /> <img data-src="/assets/img/custom/jpa3.1/jpa3.1-emf.JPG" alt="jpa3.1-emf" data-proofer-ignore></p><p>순서대로 JPA 3.0의 EntityManagerFactory, JPA 3.1의 EntityManagerFactory 인터페이스 입니다. 이제 <code class="language-plaintext highlighter-rouge">SessionFactory</code>와 관련된 자원들을 자동으로 종료하게 됩니다.</p><p><img data-src="/assets/img/custom/jpa3.1/jpa3.1-sf.JPG" alt="jpa3.1-sf" data-proofer-ignore></p><h3 id="2-classtransformertransform-메소드가-persistence-api-스펙의-예외를-던집니다-변경"><span class="mr-2"><strong>2. ClassTransformer.transform 메소드가 Persistence API 스펙의 예외를 던집니다. (변경)</strong></span><a href="#2-classtransformertransform-메소드가-persistence-api-스펙의-예외를-던집니다-변경" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><img data-src="/assets/img/custom/jpa3.1/jpa3.1-classtransformer.JPG" alt="jpa3.1-classtransformer" data-proofer-ignore></p><p>기존 <code class="language-plaintext highlighter-rouge">transform</code> 메소드는 <code class="language-plaintext highlighter-rouge">IllegalClassFormatException</code>를 던졌었는데 이제는 <code class="language-plaintext highlighter-rouge">TransformerException</code>를 던지게 됩니다.</p><h3 id="3-javautiluuid와-generationtypeuuid-지원-추가"><span class="mr-2"><strong>3. java.util.UUID와 GenerationType.UUID 지원 (추가)</strong></span><a href="#3-javautiluuid와-generationtypeuuid-지원-추가" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">@GeneratedValue</code> 어노테이션의 생성전략을 <code class="language-plaintext highlighter-rouge">AUTO</code> 로 저장하거나 새롭게 추가된 <code class="language-plaintext highlighter-rouge">UUID</code>로 지정할 수 있습니다. 만약 베이직 타입을 UUID로 맞추고 생성 전략을 <code class="language-plaintext highlighter-rouge">AUTO</code>로 하였다면 자동으로 <code class="language-plaintext highlighter-rouge">UUID</code>전략을 따르게 됩니다.</p><p><img data-src="/assets/img/custom/jpa3.1/generation-type.JPG" alt="generation-type" data-proofer-ignore></p><p>다음은 예제입니다. 영속화된 엔티티의 id가 uuid형태가 맞는지 정규 표현식으로 확인합니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">UUID_PATTERN</span> <span class="o">=</span> <span class="s">"[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}"</span><span class="o">;</span>

<span class="nd">@Test</span>
<span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"GenerationType.UUID test"</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">testUUID</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">resultList</span> <span class="o">=</span> <span class="nc">HibernateHelper</span><span class="o">.</span><span class="na">listAll</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="n">resultList</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">book</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">id</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"uuid: "</span> <span class="o">+</span> <span class="n">id</span><span class="o">);</span>
        <span class="nc">Assertions</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="nc">Pattern</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="no">UUID_PATTERN</span><span class="o">,</span> <span class="n">id</span><span class="o">));</span>
    <span class="o">});</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>uuid: 9a612d02-1905-497a-9d9b-719918eec58f
uuid: 39824f2f-ac89-4357-9a3d-8b67d24a6fe1
</pre></table></code></div></div><h3 id="4-numeric-함수-추가-추가"><span class="mr-2"><strong>4. Numeric 함수 추가 (추가)</strong></span><a href="#4-numeric-함수-추가-추가" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">CEILING</code>, <code class="language-plaintext highlighter-rouge">EXP</code>, <code class="language-plaintext highlighter-rouge">FLOOR</code>, <code class="language-plaintext highlighter-rouge">LN</code>, <code class="language-plaintext highlighter-rouge">POWER</code>, <code class="language-plaintext highlighter-rouge">ROUND</code>, <code class="language-plaintext highlighter-rouge">SIGN</code> 함수가 JPQL에 추가되었으며 <code class="language-plaintext highlighter-rouge">ceiling()</code>, <code class="language-plaintext highlighter-rouge">exp()</code>, <code class="language-plaintext highlighter-rouge">floor()</code>, <code class="language-plaintext highlighter-rouge">ln()</code>, <code class="language-plaintext highlighter-rouge">power()</code>, <code class="language-plaintext highlighter-rouge">round()</code>, <code class="language-plaintext highlighter-rouge">sign()</code> 함수가 Criteria API에 추가되었습니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"new numeric functions test"</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">testNewNumericFunctions</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">listAll</span> <span class="o">=</span> <span class="nc">HibernateHelper</span><span class="o">.</span><span class="na">listAll</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kt">var</span> <span class="n">resultList</span> <span class="o">=</span> <span class="nc">HibernateHelper</span><span class="o">.</span><span class="na">list</span><span class="o">(</span>
            <span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
            <span class="c1">// 수 올림</span>
            <span class="o">(</span><span class="n">cb</span><span class="o">,</span> <span class="n">root</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">cb</span><span class="o">.</span><span class="na">ceiling</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"sellingRates"</span><span class="o">)),</span>
            <span class="c1">// 수 내림</span>
            <span class="o">(</span><span class="n">cb</span><span class="o">,</span> <span class="n">root</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">cb</span><span class="o">.</span><span class="na">floor</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"sellingRates"</span><span class="o">)),</span>
            <span class="c1">// n번째 자리 반올림</span>
            <span class="o">(</span><span class="n">cb</span><span class="o">,</span> <span class="n">root</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">cb</span><span class="o">.</span><span class="na">round</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"sellingRates"</span><span class="o">),</span> <span class="mi">1</span><span class="o">),</span>
            <span class="c1">// x를 인수로 하는 e^x 값을 반환</span>
            <span class="o">(</span><span class="n">cb</span><span class="o">,</span> <span class="n">root</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">cb</span><span class="o">.</span><span class="na">exp</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"sellingRates"</span><span class="o">)),</span>
            <span class="c1">// 자연 로그를 반환</span>
            <span class="o">(</span><span class="n">cb</span><span class="o">,</span> <span class="n">root</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">cb</span><span class="o">.</span><span class="na">ln</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"sellingRates"</span><span class="o">)),</span>
            <span class="c1">// n만큼 거듭제곱하여 반환</span>
            <span class="o">(</span><span class="n">cb</span><span class="o">,</span> <span class="n">root</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">cb</span><span class="o">.</span><span class="na">power</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"sellingRates"</span><span class="o">),</span> <span class="mi">2</span><span class="o">),</span>
            <span class="c1">// 인수의 부호를 반환 (-1, 0, 1)</span>
            <span class="o">(</span><span class="n">cb</span><span class="o">,</span> <span class="n">root</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">cb</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"sellingRates"</span><span class="o">))</span>
    <span class="o">);</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\n\n"</span><span class="o">);</span>

    <span class="k">for</span> <span class="o">(</span><span class="kt">var</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">listAll</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span> <span class="o">++)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"=========================="</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"원래 값: %s%n"</span><span class="o">,</span> <span class="n">listAll</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getSellingRates</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"ceiling 함수: %s%n"</span><span class="o">,</span> <span class="n">resultList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"floor 함수: %s%n"</span><span class="o">,</span> <span class="n">resultList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"round 함수: %s%n"</span><span class="o">,</span> <span class="n">resultList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">2</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"exp 함수: %s%n"</span><span class="o">,</span> <span class="n">resultList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">3</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"ln 함수: %s%n"</span><span class="o">,</span> <span class="n">resultList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">4</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"power 함수: %s%n"</span><span class="o">,</span> <span class="n">resultList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">5</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"sign 함수: %s%n"</span><span class="o">,</span> <span class="n">resultList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">6</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\n\n"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>==========================
원래 값: 48.54
ceiling 함수: 49
floor 함수: 48
round 함수: 48.50
exp 함수: 1.2040766975298458E21
ln 함수: 3.8823882002984553
power 함수: 2356.1315999999997
sign 함수: 1
==========================
원래 값: 51.46
ceiling 함수: 52
floor 함수: 51
round 함수: 51.50
exp 함수: 2.232513217248359E22
ln 함수: 3.940804806853598
power 함수: 2648.1316
sign 함수: 1
</pre></table></code></div></div><h3 id="5-date-time-관련-함수-추가-추가"><span class="mr-2"><strong>5. Date Time 관련 함수 추가 (추가)</strong></span><a href="#5-date-time-관련-함수-추가-추가" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">LOCAL DATE</code>, <code class="language-plaintext highlighter-rouge">LOCAL DATETIME</code>, <code class="language-plaintext highlighter-rouge">LOCAL TIME</code> 함수가 JPQL에 추가되었으며 <code class="language-plaintext highlighter-rouge">localDate()</code>, <code class="language-plaintext highlighter-rouge">localDateTime()</code>, <code class="language-plaintext highlighter-rouge">localTime()</code>함수가 Criteria API에 추가되었습니다.</p><p>이 함수들은 날짜를 계산하는 함수가 아닌 현재 시간을 반환하는 함수들 입니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"new DateTime functions test"</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">testNewDateTimeFunctions</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
    <span class="kt">var</span> <span class="n">firstResult</span> <span class="o">=</span> <span class="nc">HibernateHelper</span><span class="o">.</span><span class="na">list</span><span class="o">(</span>
            <span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
            <span class="c1">// 현재 시간</span>
            <span class="o">(</span><span class="n">cb</span><span class="o">,</span> <span class="n">root</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">cb</span><span class="o">.</span><span class="na">localTime</span><span class="o">(),</span>
            <span class="c1">// 현재 날짜</span>
            <span class="o">(</span><span class="n">cb</span><span class="o">,</span> <span class="n">root</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">cb</span><span class="o">.</span><span class="na">localDate</span><span class="o">(),</span>
            <span class="c1">// 현재 날짜 + 현재 시간</span>
            <span class="o">(</span><span class="n">cb</span><span class="o">,</span> <span class="n">root</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">cb</span><span class="o">.</span><span class="na">localDateTime</span><span class="o">()</span>
    <span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\n\n"</span><span class="o">);</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"현재시간: "</span> <span class="o">+</span> <span class="n">now</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="nc">DateTimeFormatter</span><span class="o">.</span><span class="na">ofPattern</span><span class="o">(</span><span class="s">"yyyy-MM-dd HH:mm:ss"</span><span class="o">)));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"시간: "</span> <span class="o">+</span> <span class="n">firstResult</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"날짜: "</span> <span class="o">+</span> <span class="n">firstResult</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"날짜 + 시간: "</span> <span class="o">+</span> <span class="n">firstResult</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">2</span><span class="o">));</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\n\n"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>현재시간: 2022-12-26 16:23:16
시간: 16:23:16
날짜: 2022-12-26
날짜 + 시간: 2022-12-26T16:23:16.323509
</pre></table></code></div></div><h3 id="6-extract-함수-추가-추가"><span class="mr-2"><strong>6. EXTRACT 함수 추가 (추가)</strong></span><a href="#6-extract-함수-추가-추가" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">EXTRACT</code> 함수가 JPQL에 추가되었습니다. 안타깝게도 Criteria API에는 이에 대응하는 함수가 아직 없습니다. <a href="https://github.com/jakartaee/persistence/pull/356">PR</a>에 게빈 킹이 요청한 흔적이 있긴 합니다만 JPA 3.1에는 추가되지 않은듯 합니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"new extract functions test"</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">textExtractFunctions</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// https://github.com/jakartaee/persistence/pull/356</span>
    <span class="c1">// criteria api에는 extract 함수가 존재하지 않는다 흑흑</span>

    <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="sh">"""
            SELECT 
                b.releaseDateTime as releaseDateTime,
                EXTRACT(YEAR from b.releaseDateTime) as year,
                EXTRACT(MONTH from b.releaseDateTime) as month,
                EXTRACT(DAY from b.releaseDateTime) as day,
                EXTRACT(HOUR from b.releaseDateTime) as hour,
                EXTRACT(MINUTE from b.releaseDateTime) as minute,
                EXTRACT(SECOND from b.releaseDateTime) as second
            FROM Book b
            """</span><span class="o">;</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\n\n"</span><span class="o">);</span>

    <span class="kt">var</span> <span class="n">list</span> <span class="o">=</span> <span class="nc">HibernateHelper</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>

    <span class="k">for</span> <span class="o">(</span><span class="kt">var</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span> <span class="o">++)</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Object</span><span class="o">[])</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"=========================="</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"오리지널 값 (발매일): "</span> <span class="o">+</span> <span class="n">result</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"년도: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"달: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">[</span><span class="mi">2</span><span class="o">]);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"날짜: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">[</span><span class="mi">3</span><span class="o">]);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"시: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">[</span><span class="mi">4</span><span class="o">]);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"분: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">[</span><span class="mi">5</span><span class="o">]);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"초: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">[</span><span class="mi">6</span><span class="o">]);</span>
    <span class="o">}</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\n\n"</span><span class="o">);</span>

<span class="o">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>==========================
오리지널 값 (발매일): 2020-03-13T17:20:30
년도: 2020
달: 3
날짜: 13
시: 17
분: 20
초: 30.0
==========================
오리지널 값 (발매일): 2022-08-13T10:43
년도: 2022
달: 8
날짜: 13
시: 10
분: 43
초: 0.0
</pre></table></code></div></div><h3 id="7-criteria-case-표현식에서-expressions를-조건식으로-사용할-수-있도록-지원-추가"><span class="mr-2"><strong>7. Criteria CASE 표현식에서 Expressions를 조건식으로 사용할 수 있도록 지원 (추가)</strong></span><a href="#7-criteria-case-표현식에서-expressions를-조건식으로-사용할-수-있도록-지원-추가" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><img data-src="/assets/img/custom/jpa3.1/hibernate-6.1.6-simplecase.JPG" alt="hibernate-6.1.6-simplecase" data-proofer-ignore><br /> <img data-src="/assets/img/custom/jpa3.1/hibernate-6.2.0-simplecase.JPG" alt="hibernate-6.2.0-simplecase" data-proofer-ignore></p><p><code class="language-plaintext highlighter-rouge">SimpleCase&lt;C, R&gt; when(Expression&lt;? extends C&gt; condition, R result)</code> 메소드와 <code class="language-plaintext highlighter-rouge">SimpleCase&lt;C, R&gt; when(Expression&lt;? extends C&gt; condition, Expression&lt;? extends R&gt; result)</code> 메소드가 추가되었습니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"new criteria simple case expressions"</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">testCriteriaCaseExpressions</span><span class="o">()</span> <span class="o">{</span>

    <span class="kt">var</span> <span class="n">list</span> <span class="o">=</span> <span class="nc">HibernateHelper</span><span class="o">.</span><span class="na">list</span><span class="o">(</span>
            <span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
            <span class="o">(</span><span class="n">cb</span><span class="o">,</span> <span class="n">root</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"title"</span><span class="o">),</span>
            <span class="o">(</span><span class="n">cb</span><span class="o">,</span> <span class="n">root</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">cb</span><span class="o">.</span><span class="na">selectCase</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"title"</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">cb</span><span class="o">.</span><span class="na">literal</span><span class="o">(</span><span class="s">"Effective Java"</span><span class="o">),</span> <span class="n">cb</span><span class="o">.</span><span class="na">literal</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">otherwise</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
    <span class="o">);</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\n\n"</span><span class="o">);</span>

    <span class="n">list</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">item</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"title: "</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">+</span> <span class="s">" / title is 'Effective Java'?: "</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">)));</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\n\n"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>참고로 현재 영속화된 book 엔티티는 2개이며 각각 <code class="language-plaintext highlighter-rouge">Effective Java</code>, <code class="language-plaintext highlighter-rouge">Modern Java in Action</code> 이라는 제목을 가지고 있습니다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>select
    b1_0.title,
    case b1_0.title 
        when 'Effective Java' then true 
        else cast(? as boolean) 
    end 
from
    Book b1_0
[TRACE] 2022-12-27 08:17:10.015 [main] bind - binding parameter [1] as [BOOLEAN] - [false]

title: Effective Java / title is 'Effective Java'?: true
title: Modern Java in Action / title is 'Effective Java'?: false
</pre></table></code></div></div><p>위 테스트를 돌려보면 결과는 위와같이 나오는데요, sql문을 보시면 상수표현식(literal)으로 작성한 첫번째 when 구문은 파라미터가 나중에 바인딩 되는것이 아니고 바로 바인딩 되게 됩니다. 이렇게 되면 내부적으로 <code class="language-plaintext highlighter-rouge">Prepared Statements</code>로써 동작하지는 않겠습니다만 sql구문을 <code class="language-plaintext highlighter-rouge">Prepared Statements</code>로 풀어낼수 없는 상황은 분명히 존재하므로 필요한 기능이라고 생각됩니다.</p><h3 id="8-기타-수정"><span class="mr-2"><strong>8. 기타 (수정)</strong></span><a href="#8-기타-수정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>기타 수정된 사항들도 있습니다. 이들은 어떤 기능을 추가 / 수정한 것이 아니라 어떤 주제를 명확히, 따지자면 문서 수정작업 정도로 보시면 될것 같습니다. 변경점 원문 그대로와 Github PR 링크를 걸어드리니 한번 읽어보시기 바랍니다.</p><ol><li><a href="https://github.com/jakartaee/persistence/pull/331">Adds missing definition of single_valued_embeddable_object_field in Jakarta Persistence QL BNF</a><li><a href="https://github.com/jakartaee/persistence/pull/341">Clarifies mixing types of query input parameters</a><li><a href="https://github.com/jakartaee/persistence/pull/335/files/a3a1ba0a6a7a9ca8b96431e5dd45035b5719ac9d">Clarifies definition of the Basic type</a><li><a href="https://github.com/jakartaee/persistence/pull/347">Clarifies the order of parameters in the LOCATE function</a><li><a href="http://github.com/jakartaee/persistence/pulls?q=sqlresultsetmapping">Clarifies SqlResultSetMapping with multiple EntityResults and conflicting aliases</a></ol><h2 id="마치며"><span class="mr-2"><strong>마치며</strong></span><a href="#마치며" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>JPA 3.1에 대해 간략히 알아보았습니다. JPA 3.1에 의존하는 Hibernate Final 버전과 이 Hibernate Final 버전에 의존하는 Spring Data JPA가 얼른 나오면 좋겠습니다. Spring 팀이 어떻게 이를 응용해 새로운 기능들을 만들어낼지 궁금하네요.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/jpa/'>JPA</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/jpa/" class="post-tag no-text-decoration" >JPA</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=JPA+3.1+-+keencho%27s+blog&url=https%3A%2F%2Fkeencho.github.io%2Fposts%2Fjpa3.1%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=JPA+3.1+-+keencho%27s+blog&u=https%3A%2F%2Fkeencho.github.io%2Fposts%2Fjpa3.1%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fkeencho.github.io%2Fposts%2Fjpa3.1%2F&text=JPA+3.1+-+keencho%27s+blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/jpa-flush/">JPA & Hibernate Flush Mode</a><li><a href="/posts/aws-cicd-1/">AWS를 사용해 무중단 배포 자동화 환경 구축하기 - 1. 개요</a><li><a href="/posts/terraform-aws-infra-6/">Terraform으로 AWS 무중단 배포 인프라 구성하기 - 6. 운영환경 (백엔드)</a><li><a href="/posts/aapt2-arm/">Arm 아키텍처에서 AAPT2 빌드 도구 사용하기</a><li><a href="/posts/terraform-aws-infra-1/">Terraform으로 AWS 무중단 배포 인프라 구성하기 - 1. 개요</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/ecs/">ECS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/querydsl/">QueryDSL</a> <a class="post-tag" href="/tags/react/">React</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/hibernate-where/"><div class="card-body"> <em class="small" data-ts="1653520320" data-df="ll" > May 26, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hibernate @Where</h3><div class="text-muted small"><p> Hibernate @Where @Where 란? 떄때로 커스텀한 SQL을 이용해 엔티티 혹은 컬렉션을 필터링하고 싶은 경우가 있습니다. 이 경우 Hibernate 에서 제공하는 어노테이션중 @Where 이라는 어노테이션을 사용해 쉽게 필터링 할 수 있습니다. @Target({TYPE, METHOD, FIELD}) @Retention(RUNTIME)...</p></div></div></a></div><div class="card"> <a href="/posts/hibernate-cross-join/"><div class="card-body"> <em class="small" data-ts="1658315520" data-df="ll" > Jul 20, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hibernate, JPA 에서 발생하는 Cross Join 문제 해결하기</h3><div class="text-muted small"><p> Hibernate, JPA 에서 발생하는 Cross Join 문제 해결하기 개요 평화롭게 코딩하던 어느날, 쿼리 결과가 의도한대로 리턴되지 않는 문제가 발생하였습니다. 쿼리에 문제가 있나 싶어 자세히 살펴봤지만 (queryDSL을 사용중이었습니다.) 자바 코드상의 문제는 찾을 수 없었습니다. 데이터베이스에 날라가는 sql문을 보고 나서야 문제를 찾...</p></div></div></a></div><div class="card"> <a href="/posts/querydsl-qbuilder-qsetter-1/"><div class="card-body"> <em class="small" data-ts="1664316720" data-df="ll" > Sep 28, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>QueryProjection 에서 한단계 더 나아가 QueryProjectionBuilder 만들기 (1)</h3><div class="text-muted small"><p> QueryProjection 에서 한단계 더 나아가 QueryProjectionBuilder 만들기 (1) - 개요 Querydsl을 사용해 db조회를 하는 경우 엔티티 자체를 반환하는 경우는 잘 없습니다. 대부분 필요한 필드만 지정하여 Projections를 사용하여 조회하게 되는것 같습니다. 잘 알려진 projection 방법에는 3가지가 있습니...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/dirty-checking/" class="btn btn-outline-primary" prompt="Older"><p>Dirty Checking</p></a> <a href="/posts/2022-retrospect/" class="btn btn-outline-primary" prompt="Newer"><p>22년 회고</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/keencho">keencho</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/ecs/">ECS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/querydsl/">QueryDSL</a> <a class="post-tag" href="/tags/react/">React</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
