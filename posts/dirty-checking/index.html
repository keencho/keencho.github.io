<!DOCTYPE html><html lang="ko-KS" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Dirty Checking" /><meta name="author" content="keencho" /><meta property="og:locale" content="ko_KS" /><meta name="description" content="Dirty Checking" /><meta property="og:description" content="Dirty Checking" /><link rel="canonical" href="https://keencho.github.io/posts/dirty-checking/" /><meta property="og:url" content="https://keencho.github.io/posts/dirty-checking/" /><meta property="og:site_name" content="keencho’s blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-10-16T07:12:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Dirty Checking" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@keencho" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"keencho"},"dateModified":"2022-12-08T20:42:57+09:00","datePublished":"2022-10-16T07:12:00+09:00","description":"Dirty Checking","headline":"Dirty Checking","mainEntityOfPage":{"@type":"WebPage","@id":"https://keencho.github.io/posts/dirty-checking/"},"url":"https://keencho.github.io/posts/dirty-checking/"}</script><title>Dirty Checking | keencho's blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="keencho's blog"><meta name="application-name" content="keencho's blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/custom/keencho.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">keencho's blog</a></div><div class="site-subtitle font-italic">이것저것 정리하는 블로그.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/keencho" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['seyoung050412','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Dirty Checking</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Dirty Checking</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1665871920" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 16, 2022 </em> </span><div class="d-flex justify-content-between"> <span> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1418 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><h1 id="dirty-checking"><strong>Dirty Checking</strong></h1><h2 id="1-개요"><span class="mr-2"><strong>1. 개요</strong></span><a href="#1-개요" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>하이버네이트 / jpa를 사용하다보면 이미 저장된 엔티티의 경우 jpa repository의 save() 메소드를 호출하지 않아도 한 트랜잭션이 종료되면 엔티티의 변경점이 자동으로 업데이트되는 현상을 발견할 수 있습니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kt">var</span> <span class="n">delivery</span> <span class="o">=</span> <span class="n">deliveryRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">1L</span><span class="o">).</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">RuntimeException</span><span class="o">(</span><span class="s">"delivery entity not exist!"</span><span class="o">));</span>
<span class="n">delivery</span><span class="o">.</span><span class="na">setDtDeliveryStartedAt</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">());</span>
</pre></table></code></div></div><p>위와같이 save 메소드 없이 코드를 작성해도 트랜잭션이 종료되면 <code class="language-plaintext highlighter-rouge">dtDeliveryStartedAt</code> 컬럼이 업데이트되게 됩니다.</p><p>위 동작을 Dirty Checking 이라 하는데요, Dirty Checking의 동작 메커니즘은 다음과 같습니다.</p><blockquote><p>영속선 컨텍스트는 플러시가 일어날 경우 엔티티의 변경점들을 대기열에 넣습니다. 하이버네이트는 관리되는 엔티티들의 모든 변경을 자동으로 감지하고 개발자들을 대신하여 SQL Update문을 계획하고 수행합니다.</p></blockquote><p>하이버네이트는 기본적으로 모든 엔티티의 속성 / 변경점을 확인합니다. 엔티티가 로딩될 때마다 하이버네이트는 모든 엔티티 속성값을 가지고 있는 스냅샷(복사본)을 생성합니다. 그 후 플러시가 일어나는 시점에 엔티티와 스냅샷을 비교하여 변경된 부분을 체크하고 업데이트 합니다.</p><p>단순히 불러와서 값을 변경했다하여 모두 업데이트되는 것이 아닙니다. Dirty Checking이 일어나려면 아래 조건을 충족해야 합니다.</p><ol><li>엔티티가 영속상태인 경우<li>Transaction 안에서 엔티티의 값을 변경하는 경우<li>이미 저장된 엔티티인 경우</ol><p>스프링을 사용한다면 <code class="language-plaintext highlighter-rouge">@Transactional</code> 어노테이션을 서비스 레이어에서 사용하면 위 조건은 만족하게 됩니다.</p><h2 id="2-특정-컬럼만-업데이트하기"><span class="mr-2"><strong>2. 특정 컬럼만 업데이트하기</strong></span><a href="#2-특정-컬럼만-업데이트하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>JPA에서는 모든 필드를 업데이트하는 방식을 기본값으로 사용합니다. 이는 다음과 같은 장점을 갖고 있습니다.</p><ol><li>생성되는 쿼리가 모두 같아 어플리케이션이 실행되는 시점에 만들어서 재사용 가능<li>업데이트되는 컬럼수가 동일하기 때문에 캐싱된 SQL 구문을 사용할 수 있고, 데이터베이스 입장에서 업데이트 컬럼이 작다면 특정 컬럼만 업데이트하는 구문에 비해 성능상 이점을 가져갈 수 있음</ol><p>특정 컬럼만 업데이트하는 방법들을 몇가지 소개하긴 할테지만, 특정 상황이 아닌 경우 오히려 이러한 방법들은 전체 컬럼을 업데이트하는 방법보다 오히려 많은 자원을 소모할 수 있습니다.</p><p>컬럼이 30개정도 된다면 특정 컬럼만 업데이트 하는 것이 도움이 될테지만 애초에 컬럼이 30개라면 정규화가 잘못되어 있다는 의미겠죠? 항상 생각하는 것이지만 역시 제일 중요한 것은 db 설계 같습니다.</p><h4 id="1-dynamicupdate-사용"><span class="mr-2"><strong>1. @DynamicUpdate 사용</strong></span><a href="#1-dynamicupdate-사용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>첫번째 방법은 엔티티에 <code class="language-plaintext highlighter-rouge">@DynamicUpdate</code> 어노테이션을 선언하는 것입니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="nd">@Data</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"delivery"</span><span class="o">)</span>
<span class="nd">@DynamicUpdate</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Delivery</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></table></code></div></div><p>위와같이 어노테이션을 선언하는 것만으로도 변경 필드만 반영되게 할 수 있습니다.</p><h4 id="2-query-사용"><span class="mr-2"><strong>2. @Query 사용</strong></span><a href="#2-query-사용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>두번째 방법은 <code class="language-plaintext highlighter-rouge">@Query</code>어노테이션을 사용하여 직접 update 구문을 작성하는 것입니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nd">@Modifying</span>
<span class="nd">@Query</span><span class="o">(</span><span class="s">"UPDATE Delivery d set d.dtDeliveryStartedAt = :date where d.deliveryId = :id"</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">updateDtDeliveryStartedAtById</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"date"</span><span class="o">)</span> <span class="nc">LocalDateTime</span> <span class="n">date</span><span class="o">,</span> <span class="nd">@Param</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>
</pre></table></code></div></div><p>이렇듯 직접 update 문을 작성하여 특정 컬럼만 업데이트 할 수 있습니다. select가 아닌 DML 이기 때문에 <code class="language-plaintext highlighter-rouge">@Modifying</code> 어노테이션을 붙여야 함을 잊지 마세요.</p><h4 id="3-querydsl-jpaupdateclause-사용"><span class="mr-2"><strong>3. QueryDSL JPAUpdateClause 사용</strong></span><a href="#3-querydsl-jpaupdateclause-사용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>세번째 제가 주로 사용하는 방법은 QueryDSL의 <code class="language-plaintext highlighter-rouge">JPAUpdateClause</code> 클래스를 사용하는 방법입니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="n">emf</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>
    <span class="nc">QDelivery</span> <span class="n">q</span> <span class="o">=</span> <span class="nc">QDelivery</span><span class="o">.</span><span class="na">delivery</span><span class="o">;</span>
    <span class="nc">JPAUpdateClause</span> <span class="n">jpaUpdateClause</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JPAUpdateClause</span><span class="o">(</span><span class="n">em</span><span class="o">,</span> <span class="n">q</span><span class="o">);</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Path</span><span class="o">&lt;?&gt;,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">q</span><span class="o">.</span><span class="na">dtDeliveryStartedAt</span><span class="o">,</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">());</span>

    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Path</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">paths</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">values</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="k">for</span> <span class="o">(</span><span class="kt">var</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">paths</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
        <span class="n">values</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kt">long</span> <span class="n">result</span> <span class="o">=</span> <span class="n">jpaUpdateClause</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">q</span><span class="o">.</span><span class="na">deliveryId</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="mi">1L</span><span class="o">)).</span><span class="na">set</span><span class="o">(</span><span class="n">paths</span><span class="o">,</span> <span class="n">values</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>

    <span class="nc">Assert</span><span class="o">.</span><span class="na">isTrue</span><span class="o">(</span><span class="n">result</span> <span class="o">==</span> <span class="mi">1</span><span class="o">,</span> <span class="s">"update result is not 1"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>위와같이 <code class="language-plaintext highlighter-rouge">JPAUpdateClause</code> 를 사용하면 <code class="language-plaintext highlighter-rouge">@Query</code> 어노테이션을 사용하는 방식에 비해 조금더 type-safe하게 update 문을 자바 코드로 작성할 수 있습니다. 위 코드는 많은 보일러플레이트 코드를 만들수 있는데요, 제 경우 별도의 repository를 만들어서 코드를 작성하곤 합니다. (<a href="https://github.com/keencho/lib-spring/tree/master/src/main/java/com/keencho/lib/spring/jpa/querydsl/repository">링크</a> 에서 확인해보세요.)</p><p>그렇다면 아래와 같이 코드량이 줄게 되지요.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">q</span> <span class="o">=</span> <span class="nc">QDelivery</span><span class="o">.</span><span class="na">delivery</span><span class="o">;</span>
    <span class="kt">var</span> <span class="n">map</span> <span class="o">=</span> <span class="no">Q</span><span class="o">.</span><span class="na">newUpdateMap</span><span class="o">();</span>

    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">q</span><span class="o">.</span><span class="na">dtDeliveryStartedAt</span><span class="o">,</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">());</span>

    <span class="n">deliveryRepository</span><span class="o">.</span><span class="na">updateOne</span><span class="o">(</span><span class="n">q</span><span class="o">.</span><span class="na">deliveryId</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="mi">1L</span><span class="o">),</span> <span class="n">map</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="3-결론"><span class="mr-2"><strong>3. 결론</strong></span><a href="#3-결론" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Dirty Checking과 특정 컬럼만 업데이트 하는 방법에 대해 알아보았습니다. 모든 컬럼을 업데이트 한다고 하여 성능상에 문제가 생기것은 아니기 때문에 테이블의 컬럼 수와 상황을 잘 고려하여 전체를 업데이트 할지, 특정 컬럼만 업데이트 할지 고민해 보시기 바랍니다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hibernate/'>Hibernate</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/jpa/" class="post-tag no-text-decoration" >JPA</a> <a href="/tags/hibernate/" class="post-tag no-text-decoration" >Hibernate</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Dirty+Checking+-+keencho%27s+blog&url=https%3A%2F%2Fkeencho.github.io%2Fposts%2Fdirty-checking%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Dirty+Checking+-+keencho%27s+blog&u=https%3A%2F%2Fkeencho.github.io%2Fposts%2Fdirty-checking%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fkeencho.github.io%2Fposts%2Fdirty-checking%2F&text=Dirty+Checking+-+keencho%27s+blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/jpa-flush/">JPA & Hibernate Flush Mode</a><li><a href="/posts/aws-cicd-1/">AWS를 사용해 무중단 배포 자동화 환경 구축하기 - 1. 개요</a><li><a href="/posts/terraform-aws-infra-6/">Terraform으로 AWS 무중단 배포 인프라 구성하기 - 6. 운영환경 (백엔드)</a><li><a href="/posts/aapt2-arm/">Arm 아키텍처에서 AAPT2 빌드 도구 사용하기</a><li><a href="/posts/terraform-aws-infra-1/">Terraform으로 AWS 무중단 배포 인프라 구성하기 - 1. 개요</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/ecs/">ECS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/querydsl/">QueryDSL</a> <a class="post-tag" href="/tags/react/">React</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/jpa-entity-listener-di/"><div class="card-body"> <em class="small" data-ts="1647515520" data-df="ll" > Mar 17, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JPA EntityListeners 에 의존성 주입하기</h3><div class="text-muted small"><p> JPA EntityListeners JPA를 사용하다보면 여러가지 상황(before insert, after insert, before update, after update…)을 캐치하여 작업을 해야할 경우가 생기곤 합니다. 그럴때 하이버네이트 에서 제공하는 EntityListeners를 사용하여 원하는 작업을 수행할 수 있습니다. 위 캡쳐 이미...</p></div></div></a></div><div class="card"> <a href="/posts/jpa-union/"><div class="card-body"> <em class="small" data-ts="1673759520" data-df="ll" > Jan 15, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hibernate, Spring Data JPA, QueryDSL 에서 UNION 사용하기</h3><div class="text-muted small"><p> JPA 에서 union 사용하기 JPA 환경에서 집합 연산자(UNION, UNION ALL, INTERSECT, EXCEPT)를 사용할 수 있을까요? JPA의 버전이 3.1까지 올라왔어도 아직 이에대한 명세, 지원은 없는 것으로 보입니다. native sql로 작성하면 안되는 쿼리는 없긴 합니다만, 추상화된 SQL을 사용할 수 없다는 단점이 존재합니다...</p></div></div></a></div><div class="card"> <a href="/posts/use-java-record-in-jpa-hibernate/"><div class="card-body"> <em class="small" data-ts="1678360320" data-df="ll" > Mar 9, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JPA 에서 Java Record 사용하기</h3><div class="text-muted small"><p> JPA 에서 Java Record 사용하기 Java Record 자바 레코드는 JDK14에서 preview로써 처음 등장했으며 JDK16에서 정식 스펙으로 포함된 기능입니다. 이는 클래스의 기능과 데이터 구조를 결합한 새로운 클래스 유형입니다. 레코드는 record 예약어를 사용합니다. 레코드의 구성요소들은 메서드의 매개변수 정의와 동일한 형태의 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/querydsl-qbuilder-qsetter-2/" class="btn btn-outline-primary" prompt="Older"><p>QueryProjection 에서 한단계 더 나아가 QueryProjectionBuilder 만들기 (2)</p></a> <a href="/posts/jpa3.1/" class="btn btn-outline-primary" prompt="Newer"><p>JPA 3.1</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/keencho">keencho</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/ecs/">ECS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/querydsl/">QueryDSL</a> <a class="post-tag" href="/tags/react/">React</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
