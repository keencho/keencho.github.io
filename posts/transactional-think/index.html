<!DOCTYPE html><html lang="ko-KS" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="JPA Transactional 점검하기" /><meta name="author" content="keencho" /><meta property="og:locale" content="ko_KS" /><meta name="description" content="JPA Transactional 점검하기 JPA를 다루는 개발자라면 Transactional의 동작 원리를 정확히 이해해야 한다. 하지만 솔직히 말하면, 프로젝트 초기에 세운 가이드라인을 처음에는 잘 지켰지만 개발이 진행되면서 점점 일단 @Transactional 붙이고 보자는 식으로 습관적으로 사용했던 적이 많다. 당연히 이런 무분별한 사용은 여러 문제를 야기했고, 이를 계기로 JPA Transactional 사용법을 다시 점검하고 명확한 원칙을 정립해보고자 한다." /><meta property="og:description" content="JPA Transactional 점검하기 JPA를 다루는 개발자라면 Transactional의 동작 원리를 정확히 이해해야 한다. 하지만 솔직히 말하면, 프로젝트 초기에 세운 가이드라인을 처음에는 잘 지켰지만 개발이 진행되면서 점점 일단 @Transactional 붙이고 보자는 식으로 습관적으로 사용했던 적이 많다. 당연히 이런 무분별한 사용은 여러 문제를 야기했고, 이를 계기로 JPA Transactional 사용법을 다시 점검하고 명확한 원칙을 정립해보고자 한다." /><link rel="canonical" href="https://keencho.github.io/posts/transactional-think/" /><meta property="og:url" content="https://keencho.github.io/posts/transactional-think/" /><meta property="og:site_name" content="keencho’s blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-06-27T20:12:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="JPA Transactional 점검하기" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@keencho" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"keencho"},"dateModified":"2025-06-27T20:12:00+09:00","datePublished":"2025-06-27T20:12:00+09:00","description":"JPA Transactional 점검하기 JPA를 다루는 개발자라면 Transactional의 동작 원리를 정확히 이해해야 한다. 하지만 솔직히 말하면, 프로젝트 초기에 세운 가이드라인을 처음에는 잘 지켰지만 개발이 진행되면서 점점 일단 @Transactional 붙이고 보자는 식으로 습관적으로 사용했던 적이 많다. 당연히 이런 무분별한 사용은 여러 문제를 야기했고, 이를 계기로 JPA Transactional 사용법을 다시 점검하고 명확한 원칙을 정립해보고자 한다.","headline":"JPA Transactional 점검하기","mainEntityOfPage":{"@type":"WebPage","@id":"https://keencho.github.io/posts/transactional-think/"},"url":"https://keencho.github.io/posts/transactional-think/"}</script><title>JPA Transactional 점검하기 | keencho's blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="keencho's blog"><meta name="application-name" content="keencho's blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/custom/keencho.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">keencho's blog</a></div><div class="site-subtitle font-italic">이것저것 정리하는 블로그.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/keencho" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['seyoung050412','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>JPA Transactional 점검하기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>JPA Transactional 점검하기</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1751022720" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 27, 2025 </em> </span><div class="d-flex justify-content-between"> <span> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="8605 words"> <em>47 min</em> read</span></div></div></div><div class="post-content"><h1 id="jpa-transactional-점검하기"><strong>JPA Transactional 점검하기</strong></h1><p>JPA를 다루는 개발자라면 Transactional의 동작 원리를 정확히 이해해야 한다. 하지만 솔직히 말하면, 프로젝트 초기에 세운 가이드라인을 처음에는 잘 지켰지만 개발이 진행되면서 점점 <code class="language-plaintext highlighter-rouge">일단 @Transactional 붙이고 보자</code>는 식으로 습관적으로 사용했던 적이 많다. 당연히 이런 무분별한 사용은 여러 문제를 야기했고, 이를 계기로 JPA Transactional 사용법을 다시 점검하고 명확한 원칙을 정립해보고자 한다.</p><h2 id="transactional-남용하지-않기"><span class="mr-2"><strong>@Transactional 남용하지 않기</strong></span><a href="#transactional-남용하지-않기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>@Transactional을 남용하면 어떤 일이 일어날 수 있는지 알아보자. 테스트 환경은 다음과 같다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="nl">hikari:</span>
  <span class="n">maximum</span><span class="o">-</span><span class="n">pool</span><span class="o">-</span><span class="nl">size:</span> <span class="mi">1</span>
  <span class="n">connection</span><span class="o">-</span><span class="nl">timeout:</span> <span class="mi">1000</span>
<span class="nl">jpa:</span>
  <span class="n">open</span><span class="o">-</span><span class="n">in</span><span class="o">-</span><span class="nl">view:</span> <span class="kc">false</span>
  
<span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/concurrent"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;?&gt;</span> <span class="n">concurrentTest</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"🚀 동시 테스트 시작!"</span><span class="o">);</span>

    <span class="kt">var</span> <span class="n">future1</span> <span class="o">=</span> <span class="nc">CompletableFuture</span><span class="o">.</span><span class="na">supplyAsync</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"🔴 스레드1 시작: "</span> <span class="o">+</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
            <span class="n">testService</span><span class="o">.</span><span class="na">test</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"🟢 스레드1 완료: "</span> <span class="o">+</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
            <span class="k">return</span> <span class="s">"완료1"</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"❌ 스레드1 실패: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="s">"실패1: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">});</span>

    <span class="kt">var</span> <span class="n">future2</span> <span class="o">=</span> <span class="nc">CompletableFuture</span><span class="o">.</span><span class="na">supplyAsync</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"🔴 스레드2 시작: "</span> <span class="o">+</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
            <span class="n">testService</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"🟢 스레드2 완료: "</span> <span class="o">+</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
            <span class="k">return</span> <span class="s">"완료2"</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"❌ 스레드2 실패: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="s">"실패2: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">});</span>

    <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span>
            <span class="nc">Map</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
                    <span class="s">"result1"</span><span class="o">,</span> <span class="n">future1</span><span class="o">.</span><span class="na">join</span><span class="o">(),</span>
                    <span class="s">"result2"</span><span class="o">,</span> <span class="n">future2</span><span class="o">.</span><span class="na">join</span><span class="o">()</span>
            <span class="o">)</span>
    <span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li>OpenEntityManagerInView가 HTTP 요청당 하나의 EntityManager를 유지하고, 이는 커넥션을 먼저 점유하기에 open-in-view 를 비활성화 한다.<li><code class="language-plaintext highlighter-rouge">CompletableFutre.supplyAsync()</code>로 2개의 별도 스레드 풀에서 동시에 <code class="language-plaintext highlighter-rouge">bookService.save()</code>를 호출한다.</ul><h5 id="db-작업-없는-메소드에-transactional"><span class="mr-2"><strong><em>DB 작업 없는 메소드에 @Transactional</em></strong></span><a href="#db-작업-없는-메소드에-transactional" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nd">@SneakyThrows</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">2000</span><span class="o">);</span>

    <span class="kt">var</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
    <span class="kt">var</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
    <span class="kt">var</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="o">;</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>DB 작업이 없다. 그럼에도 @Transactional이 트랜잭션 시작부터 끝까지 커넥션을 홀딩하기에 2개의 호출중 한개는 1초의 커넥션 타임아웃으로 인해 에러가 발생한다. 물론 DB 작업이 없기에 그리 심각하지 않은 문제이긴 할것이다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>HikariPool-1 - Connection is not available, request timed out after 1010ms (total=1, active=1, idle=0, waiting=0)
결과:
{
    "result2": "완료2",
    "result1": "실패1: Could not open JPA EntityManager for transaction"
}
</pre></table></code></div></div><h5 id="내부-db-작업이-있는-메소드에-transactional"><span class="mr-2"><strong><em>내부 DB 작업이 있는 메소드에 @Transactional</em></strong></span><a href="#내부-db-작업이-있는-메소드에-transactional" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nd">@SneakyThrows</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    
    <span class="kt">var</span> <span class="n">order</span> <span class="o">=</span> <span class="n">apiService</span><span class="o">.</span><span class="na">order</span><span class="o">();</span>
    <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">2000</span><span class="o">);</span>
    
    <span class="kt">var</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">orderResult</span><span class="o">();</span>
    <span class="n">result</span><span class="o">.</span><span class="na">setSuccess</span><span class="o">(</span><span class="n">order</span><span class="o">.</span><span class="na">isSuccess</span><span class="o">());</span>
    <span class="n">result</span><span class="o">.</span><span class="na">setMessage</span><span class="o">(</span><span class="n">order</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="n">result</span><span class="o">.</span><span class="na">setOrderNo</span><span class="o">(</span><span class="n">order</span><span class="o">.</span><span class="na">getOrderNo</span><span class="o">());</span>

    <span class="n">orderResultRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이번엔 외부 API를 호출하고 결과를 DB에 저장하는 예제이다. 외부 API 호출까진 성공하겠으나, 내부 DB에 결과를 작업하기 위해 대기하는 2초간 에러가 발생할 것이다. DB에는 1개의 결과만 저장된다. 이는 외부 서비스에는 주문 정보가 있고 내부 서비스에는 주문 결과가 없는, 상황에 따라 심각한 문제를 야기할 수 있다.</p><p>또한 외부 API 동작에 의해 트랜잭션 처리가 지연되고 그만큼 내부 서비스 DB 연결시간에 영향을 받기 때문에 매우 중요하게 접근해야할 필요가 있다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>HikariPool-1 - Connection is not available, request timed out after 1011ms (total=1, active=1, idle=0, waiting=0)
{
    "result2": "완료2",
    "result1": "실패1: Could not open JPA EntityManager for transaction"
}
</pre></table></code></div></div><h5 id="단순-조회만-수행하는-메소드에-transactional"><span class="mr-2"><strong><em>단순 조회만 수행하는 메소드에 @Transactional</em></strong></span><a href="#단순-조회만-수행하는-메소드에-transactional" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p>단순 조회만 수행하는 메소드에 @Transactional을 붙였을때 트랜잭션이 어떻게 동작하는지 확인해보자.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TransactionChecker</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>

    <span class="cm">/**
     * 1. 트랜잭션 상태 확인
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkTransactionStatus</span><span class="o">(</span><span class="nc">String</span> <span class="n">actionName</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">isTransactionActive</span> <span class="o">=</span> <span class="nc">TransactionSynchronizationManager</span><span class="o">.</span><span class="na">isActualTransactionActive</span><span class="o">();</span>
        <span class="kt">var</span> <span class="n">isSynchronizationActive</span> <span class="o">=</span> <span class="nc">TransactionSynchronizationManager</span><span class="o">.</span><span class="na">isSynchronizationActive</span><span class="o">();</span>
        <span class="kt">var</span> <span class="n">transactionName</span> <span class="o">=</span> <span class="nc">TransactionSynchronizationManager</span><span class="o">.</span><span class="na">getCurrentTransactionName</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"🔍 [%s] 트랜잭션 상태:%n"</span><span class="o">,</span> <span class="n">actionName</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"   ├─ 활성화: %s%n"</span><span class="o">,</span> <span class="n">isTransactionActive</span> <span class="o">?</span> <span class="s">"✅ YES"</span> <span class="o">:</span> <span class="s">"❌ NO"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"   ├─ 동기화: %s%n"</span><span class="o">,</span> <span class="n">isSynchronizationActive</span> <span class="o">?</span> <span class="s">"✅ YES"</span> <span class="o">:</span> <span class="s">"❌ NO"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"   └─ 이름: %s%n"</span><span class="o">,</span> <span class="n">transactionName</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">transactionName</span> <span class="o">:</span> <span class="s">"없음"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 2. HikariCP 커넥션 풀 상태 확인
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkConnectionPoolStatus</span><span class="o">(</span><span class="nc">String</span> <span class="n">actionName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">dataSource</span> <span class="k">instanceof</span> <span class="nc">HikariDataSource</span> <span class="n">hikariDataSource</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">var</span> <span class="n">poolBean</span> <span class="o">=</span> <span class="n">hikariDataSource</span><span class="o">.</span><span class="na">getHikariPoolMXBean</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"🏊‍♂️ [%s] HikariCP 상태:%n"</span><span class="o">,</span> <span class="n">actionName</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"   ├─ 활성 커넥션: %d%n"</span><span class="o">,</span> <span class="n">poolBean</span><span class="o">.</span><span class="na">getActiveConnections</span><span class="o">());</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"   ├─ 유휴 커넥션: %d%n"</span><span class="o">,</span> <span class="n">poolBean</span><span class="o">.</span><span class="na">getIdleConnections</span><span class="o">());</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"   ├─ 전체 커넥션: %d%n"</span><span class="o">,</span> <span class="n">poolBean</span><span class="o">.</span><span class="na">getTotalConnections</span><span class="o">());</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"   ├─ 대기 중인 스레드: %d%n"</span><span class="o">,</span> <span class="n">poolBean</span><span class="o">.</span><span class="na">getThreadsAwaitingConnection</span><span class="o">());</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"   └─ 최대 풀 크기: %d%n"</span><span class="o">,</span> <span class="n">hikariDataSource</span><span class="o">.</span><span class="na">getMaximumPoolSize</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"🏊‍♂️ [%s] HikariCP가 아님: %s%n"</span><span class="o">,</span> <span class="n">actionName</span><span class="o">,</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 3. 한 번에 모든 상태 확인
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkAll</span><span class="o">(</span><span class="nc">String</span> <span class="n">actionName</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">threadName</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"📊 === [%s] %s 상태 체크 ===%n"</span><span class="o">,</span> <span class="n">actionName</span><span class="o">,</span> <span class="n">threadName</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">checkTransactionStatus</span><span class="o">(</span><span class="n">actionName</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">checkConnectionPoolStatus</span><span class="o">(</span><span class="n">actionName</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"📊 ========================================"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>트랜잭션 상태를 확인할 수 있는 헬퍼 클래스다.</p><p><strong><em>1. @Transactional 없이 조회</em></strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">transactionChecker</span><span class="o">.</span><span class="na">checkAll</span><span class="o">(</span><span class="s">"읽기 전"</span><span class="o">);</span>
    <span class="kt">var</span> <span class="n">list</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
    <span class="n">transactionChecker</span><span class="o">.</span><span class="na">checkAll</span><span class="o">(</span><span class="s">"읽은 후"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>🔴 [13:57:07.976] http-nio-8080-exec-1 - 요청 시작
📊 === [읽기 전] http-nio-8080-exec-1 상태 체크 ===
🔍 [읽기 전] 트랜잭션 상태:
   ├─ 활성화: ❌ NO
   ├─ 동기화: ❌ NO
   └─ 이름: 없음
🏊‍♂️ [읽기 전] HikariCP 상태:
   ├─ 활성 커넥션: 0
   ├─ 유휴 커넥션: 1
   ├─ 전체 커넥션: 1
   ├─ 대기 중인 스레드: 0
   └─ 최대 풀 크기: 1
📊 ========================================
13:57:07.980 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
13:57:07.980 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1191829786&lt;open&gt;)] for JPA transaction
13:57:07.983 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@42c003ac]
13:57:08.054 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
13:57:08.054 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1191829786&lt;open&gt;)]
13:57:08.055 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1191829786&lt;open&gt;)] after transaction
📊 === [읽은 후] http-nio-8080-exec-1 상태 체크 ===
🔍 [읽은 후] 트랜잭션 상태:
   ├─ 활성화: ❌ NO
   ├─ 동기화: ❌ NO
   └─ 이름: 없음
🏊‍♂️ [읽은 후] HikariCP 상태:
   ├─ 활성 커넥션: 0
   ├─ 유휴 커넥션: 1
   ├─ 전체 커넥션: 1
   ├─ 대기 중인 스레드: 0
   └─ 최대 풀 크기: 1
📊 ========================================
🟢 [13:57:08.056] http-nio-8080-exec-1 - 요청 완료 (소요: 80ms)
</pre></table></code></div></div><p>결과는 위와 같다. <code class="language-plaintext highlighter-rouge">authorRepository.findAll()</code> 를 수행할때 트랜잭션이 생성되고 바로 트랜잭션이 커밋된다. 다시말해, 이때 hikari pool에서 커넥션을 획득하고 바로 반납한다는 의미가 된다.</p><p><strong><em>2. @Transactional 붙이고 조회</em></strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">transactionChecker</span><span class="o">.</span><span class="na">checkAll</span><span class="o">(</span><span class="s">"읽기 전"</span><span class="o">);</span>
    <span class="kt">var</span> <span class="n">list</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
    <span class="n">transactionChecker</span><span class="o">.</span><span class="na">checkAll</span><span class="o">(</span><span class="s">"읽은 후"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre>🔴 [13:59:19.626] http-nio-8080-exec-3 - 요청 시작
13:59:19.628 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.keencho.spring.service.TestService.test]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
13:59:19.628 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(2125691159&lt;open&gt;)] for JPA transaction
13:59:19.631 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@27049398]
📊 === [읽기 전] http-nio-8080-exec-3 상태 체크 ===
🔍 [읽기 전] 트랜잭션 상태:
   ├─ 활성화: ✅ YES
   ├─ 동기화: ✅ YES
   └─ 이름: com.keencho.spring.service.TestService.test
🏊‍♂️ [읽기 전] HikariCP 상태:
   ├─ 활성 커넥션: 1
   ├─ 유휴 커넥션: 0
   ├─ 전체 커넥션: 1
   ├─ 대기 중인 스레드: 0
   └─ 최대 풀 크기: 1
📊 ========================================
13:59:19.634 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2125691159&lt;open&gt;)] for JPA transaction
13:59:19.634 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
📊 === [읽은 후] http-nio-8080-exec-3 상태 체크 ===
🔍 [읽은 후] 트랜잭션 상태:
   ├─ 활성화: ✅ YES
   ├─ 동기화: ✅ YES
   └─ 이름: com.keencho.spring.service.TestService.test
🏊‍♂️ [읽은 후] HikariCP 상태:
   ├─ 활성 커넥션: 1
   ├─ 유휴 커넥션: 0
   ├─ 전체 커넥션: 1
   ├─ 대기 중인 스레드: 0
   └─ 최대 풀 크기: 1
📊 ========================================
13:59:19.703 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
13:59:19.704 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(2125691159&lt;open&gt;)]
13:59:19.705 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(2125691159&lt;open&gt;)] after transaction
🟢 [13:59:19.705] http-nio-8080-exec-3 - 요청 완료 (소요: 79ms)
</pre></table></code></div></div><p>결과는 위와 같다. http 요청이 들어오고 <code class="language-plaintext highlighter-rouge">testService.test()</code> 메소드를 탔을때 트랜잭션이 생성된다. 그 후 <code class="language-plaintext highlighter-rouge">authRepository.findAll()</code> 수행시 기존 트랜잭션에 참여하고 메소드가 종료될때 트랜잭션을 커밋하고 종료한다.</p><p>정리하면 다음과 같다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>@Transactional 있음:
메소드 시작 → [커넥션 획득] → DB작업1 → DB작업2 → [커넥션 반납] ← 메소드 끝
            └───────── 쭉 홀딩 ────────────┘

@Transactional 없음:
메서드 시작 → [획득→반납] → [획득→반납] → 메서드 끝
              DB작업1      DB작업2

성능 영향:
- @Transactional: 커넥션 홀딩 시간 ↑, DB 작업 일관성 ✓
- 없음: 커넥션 획득/반납 오버헤드 ↑, 개별 커밋
</pre></table></code></div></div><h2 id="transactional-rollback"><span class="mr-2"><strong>@Transactional rollback</strong></span><a href="#transactional-rollback" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>롤백 처리에 대한 전략을 잘 세워야 한다. 한 트랜잭션 범위 내에서 <code class="language-plaintext highlighter-rouge">Unchecked Exception</code>이 발생하면 자동 롤백되지만, <code class="language-plaintext highlighter-rouge">Checked Exception</code>은 기본적으로 커밋된다. 이는 기본적인 개념이고, @Transactional을 어떻게 사용하느냐에 따라 동작이 어떻게 달라지는지 확실히 알아야 한다.</p><h5 id="transactionaspectsupport의-동작-원리"><span class="mr-2"><strong><em>TransactionAspectSupport의 동작 원리</em></strong></span><a href="#transactionaspectsupport의-동작-원리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p><code class="language-plaintext highlighter-rouge">TransactionAspectSupport</code>는 <code class="language-plaintext highlighter-rouge">@Transactional</code>이 붙은 메소드를 실행할 때 트랜잭션 처리를 담당하는 핵심 클래스이다. Spring은 AOP 프록시 패턴을 통해 실제 메서드 호출 전후로 트랜잭션 시작, 커밋, 롤백 로직을 삽입한다.</p><p><strong>Unchecked Exception 롤백 정책</strong></p><ul><li><strong>Unchecked Exception</strong> (RuntimeException, Error): 자동 롤백<li><strong>Checked Exception</strong> (IOException, SQLException 등): 롤백 안함</ul><p>이는 Unchecked Exception이 예상치 못한 프로그래밍 오류나 시스템 장애를 나타내는 반면, Checked Exception은 예상 가능한 상황으로 개발자가 의도적인 예외 처리 로직을 작성했을 가능성이 높기 때문이다.</p><p><strong>try-catch로 감싸도 롤백되는 이유</strong><br /> <code class="language-plaintext highlighter-rouge">RuntimeException</code>이 발생하는 순간 Spring은 현재 트랜잭션을 “rollback-only” 상태로 마킹한다. 이후 try-catch로 예외를 처리해서 메서드가 정상 종료되어도, 이미 마킹된 트랜잭션은 최종적으로 롤백된다. 트랜잭션 상태는 예외 발생 시점에 결정되며, 예외 처리 여부는 이 결정을 바꾸지 못한다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">authorRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">Author</span><span class="o">(</span><span class="s">"홍길동"</span><span class="o">));</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">actionService</span><span class="o">.</span><span class="na">doAction</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">ignored</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doAction</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="o">(</span><span class="s">"Error"</span><span class="o">);</span>   <span class="c1">// Checked Exception: 롤백 안함</span>
<span class="o">}</span>

<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doAction</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Error"</span><span class="o">);</span>    <span class="c1">// Unchecked Exception: 자동 롤백 </span>
<span class="o">}</span>
</pre></table></code></div></div><h5 id="requires_new를-활용한-독립-트랜잭션"><span class="mr-2"><strong><em>REQUIRES_NEW를 활용한 독립 트랜잭션</em></strong></span><a href="#requires_new를-활용한-독립-트랜잭션" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p><code class="language-plaintext highlighter-rouge">@Transactional(propagation = Propagation.REQUIRES_NEW)</code>를 사용하면 별도의 독립적인 트랜잭션이 생성된다. 이 경우 내부 트랜잭션에서 예외가 발생해도 해당 트랜잭션만 롤백되고, 외부 트랜잭션은 영향받지 않는다. 따라서 로그 저장이나 감사(audit) 기록처럼 메인 비즈니스 로직 실패와 관계없이 반드시 저장되어야 하는 데이터에 활용할 수 있다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">propagation</span> <span class="o">=</span> <span class="nc">Propagation</span><span class="o">.</span><span class="na">REQUIRES_NEW</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doAction</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Error"</span><span class="o">);</span>    <span class="c1">// Unchecked Exception: 자동 롤백 </span>
<span class="o">}</span>
</pre></table></code></div></div><p>그러나 이는 커넥션 풀에서 새로운 커넥션을 얻어온다는 의미이기 때문에, REQUIRES_NEW가 붙은 메소드를 반복문을 통해 호출한다면 로직에 따라 커넥션 풀이 고갈되어 타임아웃이나 대기 상황이 발생할 수 있다. 특히 외부 트랜잭션이 커넥션을 점유한 상태에서 내부적으로 여러 개의 독립 트랜잭션을 동시에 생성하려 할 때 주의해야 한다.</p><h5 id="동일한-클래스-내부-호출-시-transactional-무시"><span class="mr-2"><strong><em>동일한 클래스 내부 호출 시 @Transactional 무시</em></strong></span><a href="#동일한-클래스-내부-호출-시-transactional-무시" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">authorRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">Author</span><span class="o">(</span><span class="s">"홍길동"</span><span class="o">));</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">doAction</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">ignored</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doAction</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Error"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>외부에서 save() 호출 시 프록시를 통해 트랜잭션이 시작되지만, this.doAction() 호출은 직접적인 Java 메서드 호출이므로 Spring 프록시가 개입할 수 없다. 따라서 doAction()의 @Transactional은 무시되고 Unchecked Exception이 발생해도 롤백되지 않는다.</p><p>롤백이 되어야 한다면 다음 방법중 하나를 선택하면 된다.</p><ol><li>try-catch 제거<li>수동 롤백 (TransactionAspectSupport.currentTransactionStatus().setRollbackOnly())<li>별도 서비스로 분리<li>Self Injection 사용 (allow-circular-references: true 필요)<li>AspectJ 위빙 사용 (비추천)</ol><h5 id="transactional-유무에-따른-차이점"><span class="mr-2"><strong><em>@Transactional 유무에 따른 차이점</em></strong></span><a href="#transactional-유무에-따른-차이점" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p><code class="language-plaintext highlighter-rouge">doAction()</code>에 <code class="language-plaintext highlighter-rouge">@Transactional</code>이 있든 없든 Repository 호출 시 기존 트랜잭션에 참여하는 건 동일하다. 하지만 예외 처리에서 중요한 차이가 있다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">authorRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">Author</span><span class="o">(</span><span class="s">"홍길동"</span><span class="o">));</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">actionService</span><span class="o">.</span><span class="na">doAction</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">ignored</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doAction</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">authorRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">Author</span><span class="o">(</span><span class="s">"거북이"</span><span class="o">));</span> <span class="c1">// 기존 트랜잭션 참여</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Error"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>doAction()에 @Transactional이 없다. 그래도 두 데이터 모두 저장된다. RuntimeException이 발생해도 단순히 상위로 전파될 뿐이다. try-catch로 잡으면 <code class="language-plaintext highlighter-rouge">save()</code> 메서드가 정상 종료된 것으로 인식하고 트랜잭션을 커밋한다.</p><p>@Transactional이 있는 경우 RuntimeException 발생 시 Spring이 현재 트랜잭션을 <strong>“rollback-only”로 마킹</strong>한다. 이후 try-catch로 예외를 처리해서 <code class="language-plaintext highlighter-rouge">save()</code> 메서드가 정상 종료되어도, Spring이 커밋을 시도할 때 “rollback-only” 마킹을 발견하고 <code class="language-plaintext highlighter-rouge">UnexpectedRollbackException</code>을 던진다.</p><p><strong>왜 이런 차이가 발생할까?</strong></p><p>Spring의 트랜잭션 처리 방식을 살펴보자.</p><ol><li><strong>@Transactional 없는 경우:</strong> <code class="language-plaintext highlighter-rouge">doAction()</code>은 단순한 Java 메서드다. Repository 호출할 때만 기존 트랜잭션을 사용한다. RuntimeException이 발생해도 Spring은 이를 “트랜잭션적 오류”로 인식하지 않는다. 단지 일반적인 예외일 뿐이고, try-catch로 처리되면 아무 문제없이 커밋한다.<li><strong>@Transactional 있는 경우:</strong> <code class="language-plaintext highlighter-rouge">doAction()</code>도 트랜잭션 관리 대상이 된다. Spring AOP가 메서드를 감싸서 예외를 모니터링한다. RuntimeException 발생 시 “이 트랜잭션은 문제가 있다”고 마킹해둔다. 이후 상위에서 try-catch로 예외를 처리해도 Spring은 “어? 문제가 있었는데 커밋하려고 하네?”라고 인식하고 <code class="language-plaintext highlighter-rouge">UnexpectedRollbackException</code>을 던진다.</ol><p>핵심은 Spring이 <strong>언제 트랜잭션 상태를 추적하느냐</strong>다. @Transactional이 붙어야만 Spring이 해당 메서드의 예외를 “트랜잭션 관점에서” 바라본다.</p><h2 id="transactionalreadonly--true"><span class="mr-2"><strong>@Transactional(readOnly = true)</strong></span><a href="#transactionalreadonly--true" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>개발을 하다 보면 단순한 조회 메서드에 @Transactional(readOnly = true)를 붙일지 말지 고민하게 된다. 특히 OSIV를 비활성화한 환경에서는 이 선택이 더욱 중요하다.</p><p>PostgreSQL 환경에서 실제 쿼리 로그를 통해 두 방식의 차이점을 자세히 알아보자.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre># application.yml
spring:
  jpa:
    open-in-view: false 

# postgresql.conf
log_statement = 'all'
log_line_prefix = '%t [%p] %u@%d: '
logging_collector = on
</pre></table></code></div></div><p>상황별로 코드를 작성하고 로그를 확인해 보자.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">list</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
<span class="o">}</span>

<span class="o">[</span><span class="mi">37380</span><span class="o">]</span> <span class="nl">LOG:</span>  <span class="nl">statement:</span> <span class="no">BEGIN</span> <span class="no">READ</span> <span class="no">ONLY</span>
<span class="o">[</span><span class="mi">37380</span><span class="o">]</span> <span class="nl">LOG:</span>  <span class="n">execute</span> <span class="o">&lt;</span><span class="n">unnamed</span><span class="o">&gt;:</span> <span class="n">select</span> <span class="n">a1_0</span><span class="o">.</span><span class="na">id</span><span class="o">,</span><span class="n">a1_0</span><span class="o">.</span><span class="na">created_at</span><span class="o">,</span><span class="n">a1_0</span><span class="o">.</span><span class="na">name</span> <span class="n">from</span> <span class="n">author</span> <span class="n">a1_0</span>
<span class="o">[</span><span class="mi">37380</span><span class="o">]</span> <span class="nl">LOG:</span>  <span class="n">execute</span> <span class="nl">S_1:</span> <span class="no">COMMIT</span>
</pre></table></code></div></div><p>@Transactional(readOnly = true) 가 붙어있는 경우 트랜잭션이 명시적으로 시작되고 종료된다. 트랜잭션을 <code class="language-plaintext highlighter-rouge">READ ONLY</code> 로 세팅하는 쿼리와, 조회 후 커밋하는 쿼리가 추가로 날라간다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">list</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findAllNonTransactional</span><span class="o">();</span>
    
    <span class="c1">// @Query(value = "SELECT a FROM Author a")</span>
    <span class="c1">// List&lt;Author&gt; findAllNonTransactional();</span>
<span class="o">}</span>
 
<span class="o">[</span><span class="mi">26408</span><span class="o">]</span> <span class="nl">LOG:</span>  <span class="n">execute</span> <span class="o">&lt;</span><span class="n">unnamed</span><span class="o">&gt;:</span> <span class="n">select</span> <span class="n">a1_0</span><span class="o">.</span><span class="na">id</span><span class="o">,</span><span class="n">a1_0</span><span class="o">.</span><span class="na">created_at</span><span class="o">,</span><span class="n">a1_0</span><span class="o">.</span><span class="na">name</span> <span class="n">from</span> <span class="n">author</span> <span class="n">a1_0</span>
</pre></table></code></div></div><p>어노테이션이 없는 경우 autocommit 모드로 동작하여 단일 쿼리만 실행된다.</p><blockquote><p><code class="language-plaintext highlighter-rouge">CrudRepository</code> 인터페이스에 정의된 메소드를 호출하는 경우 구현체인 <code class="language-plaintext highlighter-rouge">SimpleJpaRepository</code> 클래스에 @Transactional(readOnly = true) 가 붙어있기 때문에 기본적으로 readOnly 모드로 동작한다.</p></blockquote><h5 id="기능별-상세-비교"><span class="mr-2"><strong><em>기능별 상세 비교</em></strong></span><a href="#기능별-상세-비교" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p><strong>Hibernate 측면</strong><br /> <em>@Transactional(readOnly = true)</em><br /> 장점</p><ul><li>1차 캐시 활용: 동일한 엔티티를 여러 번 조회해도 캐시에서 가져온다<li>Lazy Loading 지원: 연관관계 엔티티를 필요할 때 로드할 수 있다<li>FlushMode.MANUAL: 불필요한 flush 작업을 방지한다</ul><p>단점</p><ul><li>세션 장기 보유: 메서드 실행 동안 Hibernate 세션을 계속 유지한다<li>메모리 사용량 증가: 1차 캐시와 세션 컨텍스트로 인한 메모리 오버헤드</ul><p><em>어노테이션 제거</em><br /> 장점</p><ul><li>즉시 세션 해제: 쿼리 실행 후 바로 세션을 정리한다<li>최소 메모리 사용: 세션 컨텍스트를 오래 보유하지 않는다</ul><p>단점</p><ul><li>Lazy Loading 불가: LazyInitializationException 발생 위험<li>1차 캐시 미활용: 동일한 엔티티를 여러 번 조회하면 매번 DB 쿼리<li>세션 재생성: 매번 새로운 세션을 생성하는 비용</ul><p><strong>Spring 측면 (프록시)</strong><br /> <em>@Transactional(readOnly = true)</em><br /> 장점</p><ul><li>AOP 기능 활용: 로깅, 모니터링 등 횡단 관심사 처리<li>트랜잭션 전파 규칙: 다른 트랜잭션과의 상호작용을 명확하게 정의<li>일관된 예외 처리: Spring의 트랜잭션 예외 변환 기능 활용</ul><p>단점</p><ul><li>프록시 생성 비용: Spring AOP 프록시 생성과 관리 비용<li>인터셉터 체인 실행: 메서드 호출 시마다 인터셉터 체인을 거침<li>메모리 오버헤드: 프록시 객체와 관련 메타데이터</ul><p><em>어노테이션 제거</em><br /> 장점</p><ul><li>프록시 오버헤드 없음: 직접적인 메서드 호출<li>메모리 효율적: 프록시 관련 메모리 사용 없음<li>단순한 실행 흐름: 복잡한 AOP 처리 과정이 없음</ul><p>단점</p><ul><li>Spring AOP 기능 미사용: 횡단 관심사 처리 불가능<li>트랜잭션 관리 불가: 명시적인 트랜잭션 제어 없음</ul><p><strong>PostgreSQL 측면</strong></p><p><em>BEGIN READ ONLY vs autocommit</em></p><p>PostgreSQL에서 BEGIN READ ONLY는 단순한 플래그 설정이 아니라 실제로 다음과 같은 최적화를 제공한다.</p><ul><li>WAL 생성 방지: Write-Ahead Log를 생성하지 않아 I/O 부하 감소<li>락 획득 회피: 불필요한 락 요청을 하지 않음<li>내부 최적화: PostgreSQL이 읽기 전용임을 알고 여러 최적화 수행</ul><p>반면 autocommit 모드는</p><ul><li>네트워크 호출 최소화: 단일 쿼리만 전송<li>커넥션 즉시 반환: 쿼리 실행 후 바로 커텍션 풀에 반환</ul><p>위와같은 특징을 가지고 있다.</p><h5 id="성능-비교"><span class="mr-2"><strong><em>성능 비교</em></strong></span><a href="#성능-비교" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p>일반적으로 단순 조회에서는 어노테이션 제거가 더 빠른 경우가 많지만, 복잡한 로직에서는 트랜잭션의 이점이 성능 오버헤드를 상쇄한다.</p><h5 id="결론-및-권장사항"><span class="mr-2"><strong><em>결론 및 권장사항</em></strong></span><a href="#결론-및-권장사항" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p><strong>@Transactional(readOnly = true) 언제 사용할까?</strong></p><ul><li>연관관계(Lazy Loading)가 필요한 모든 경우<li>여러 쿼리의 일관성이 중요한 경우<li>복잡한 비즈니스 로직이 있는 경우<li>Spring의 트랜잭션 관리 기능을 활용하고 싶은 경우</ul><p><strong>이럴때는 제거해도 되지 않을까?</strong></p><ul><li>완전히 단순한 단일 조회 (연관관계 없음)<li>DTO 프로젝션만 사용하는 경우<li>극도의 성능 최적화가 필요한 경우<li>대량 데이터 처리에서 메모리 효율성이 중요한 경우</ul><h5 id="개인적인-생각-postgresql-기준"><span class="mr-2"><strong><em>개인적인 생각 (PostgreSQL 기준)</em></strong></span><a href="#개인적인-생각-postgresql-기준" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><ol><li>안전성: Lazy Loading 관련 예외를 방지할 수 있다<li>확장성: 나중에 연관관계나 복잡한 로직이 추가되어도 안전하다<li>일관성: 팀 전체가 동일한 패턴을 사용할 수 있다<li>PostgreSQL 최적화: READ ONLY 모드의 이점을 활용할 수 있다</ol><p>성능이 정말 중요한 특정 API에만 선별적으로 어노테이션을 제거하고, 나머지는 @Transactional(readOnly = true)를 기본으로 사용하는 것이 현실적인것 같다. 실제 성능은 애플리케이션의 특성, 데이터 크기, 인프라 환경에 따라 달라질 수 있으니, 중요한 결정을 내리기 전에는 항상 실제 환경에서 테스트해보는 것을 잊지 말자.</p><h2 id="격리-수준isolation-level-실전-활용"><span class="mr-2"><strong>격리 수준(Isolation Level) 실전 활용</strong></span><a href="#격리-수준isolation-level-실전-활용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>격리 수준은 동시 트랜잭션 간의 데이터 일관성을 얼마나 엄격하게 보장할지를 결정한다. PostgreSQL의 기본 격리 수준은 <code class="language-plaintext highlighter-rouge">READ_COMMITTED</code>이며, 비즈니스 요구사항에 따라 적절한 수준을 선택해야 한다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">READ_COMMITTED</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">readCommittedTest</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// PostgreSQL 기본 격리 수준 - 성능 우선</span>
<span class="o">}</span>

<span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">REPEATABLE_READ</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">repeatableReadTest</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// 일관성 우선 - Snapshot Isolation 제공</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>격리 수준별 현상과 문제점</strong></p><ul><li><strong>Dirty Read:</strong> 커밋되지 않은 변경사항을 읽는 현상<li><strong>Non-repeatable Read:</strong> 같은 트랜잭션 내에서 동일한 데이터를 재조회할 때 다른 값이 나오는 현상<li><strong>Phantom Read:</strong> 범위 조건으로 조회 시 새로운 행이 추가로 조회되는 현상</ul><h5 id="read_committed-기본값"><span class="mr-2"><strong><em>READ_COMMITTED (기본값)</em></strong></span><a href="#read_committed-기본값" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">READ_COMMITTED</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">processOrderWithReadCommitted</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// 첫 번째 조회</span>
    <span class="kt">var</span> <span class="n">product</span> <span class="o">=</span> <span class="n">productRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"첫 번째 재고: "</span> <span class="o">+</span> <span class="n">product</span><span class="o">.</span><span class="na">getStock</span><span class="o">());</span> <span class="c1">// 100</span>

    <span class="c1">// 이 시점에 다른 트랜잭션이 재고를 50으로 변경하고 커밋</span>

    <span class="c1">// 두 번째 조회 - 변경된 값 읽음 (Non-repeatable Read 발생)</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">productRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"두 번째 재고: "</span> <span class="o">+</span> <span class="n">product</span><span class="o">.</span><span class="na">getStock</span><span class="o">());</span> <span class="c1">// 50</span>

    <span class="c1">// 문제: 같은 트랜잭션 내에서 데이터가 달라짐</span>
    <span class="c1">// 첫 번째 조회를 기준으로 비즈니스 로직을 작성했다면 문제가 될 수 있음</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>READ_COMMITTED 특징:</strong></p><ul><li><strong>Dirty Read 방지:</strong> 커밋된 데이터만 읽음<li><strong>Non-repeatable Read 허용:</strong> 다른 트랜잭션의 커밋된 변경사항이 중간에 보임<li><strong>Phantom Read 허용:</strong> 범위 조건에서 새로운 행이 나타날 수 있음<li><strong>성능:</strong> 가장 높음 (잠금이 적음)<li><strong>사용 시기:</strong> 성능이 중요하고 약간의 데이터 불일치를 허용할 수 있는 경우</ul><h5 id="repeatable_read"><span class="mr-2"><strong><em>REPEATABLE_READ</em></strong></span><a href="#repeatable_read" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">REPEATABLE_READ</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">processOrderWithRepeatableRead</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// 첫 번째 조회 - 스냅샷 생성</span>
    <span class="kt">var</span> <span class="n">product</span> <span class="o">=</span> <span class="n">productRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"첫 번째 재고: "</span> <span class="o">+</span> <span class="n">product</span><span class="o">.</span><span class="na">getStock</span><span class="o">());</span> <span class="c1">// 100</span>

    <span class="c1">// 이 시점에 다른 트랜잭션이 재고를 50으로 변경하고 커밋해도</span>

    <span class="c1">// 두 번째 조회 - 스냅샷에 의해 동일한 값 읽음</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">productRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"두 번째 재고: "</span> <span class="o">+</span> <span class="n">product</span><span class="o">.</span><span class="na">getStock</span><span class="o">());</span> <span class="c1">// 100 (동일)</span>

    <span class="c1">// 장점: 트랜잭션 내에서 일관된 데이터 보장</span>
    <span class="c1">// 단점: 다른 트랜잭션의 변경사항을 못 볼 수 있음 (Lost Update 위험)</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>REPEATABLE_READ 특징:</strong></p><ul><li><strong>Snapshot Isolation:</strong> 트랜잭션 시작 시점의 데이터 스냅샷 유지<li><strong>Non-repeatable Read 방지:</strong> 동일한 데이터 반복 읽기 시 일관성 보장<li><strong>Phantom Read 일부 방지:</strong> PostgreSQL에서는 대부분 방지됨<li><strong>성능:</strong> 중간 (스냅샷 유지 오버헤드)<li><strong>사용 시기:</strong> 복잡한 비즈니스 로직에서 데이터 일관성이 중요한 경우</ul><h5 id="실제-비즈니스-활용-사례"><span class="mr-2"><strong><em>실제 비즈니스 활용 사례</em></strong></span><a href="#실제-비즈니스-활용-사례" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p><strong>1. 재고 차감 로직 (동시성 제어)</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">REPEATABLE_READ</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">OrderResult</span> <span class="nf">decreaseStock</span><span class="o">(</span><span class="nc">Long</span> <span class="n">productId</span><span class="o">,</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 스냅샷으로 일관된 데이터 보장</span>
    <span class="kt">var</span> <span class="n">product</span> <span class="o">=</span> <span class="n">productRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">productId</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>

    <span class="c1">// 재고 검증 - 트랜잭션 내에서 일관된 값으로 검증</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getStock</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">OrderResult</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="s">"재고 부족: 현재 "</span> <span class="o">+</span> <span class="n">product</span><span class="o">.</span><span class="na">getStock</span><span class="o">()</span> <span class="o">+</span> <span class="s">"개"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// 재고 차감</span>
    <span class="n">product</span><span class="o">.</span><span class="na">decreaseStock</span><span class="o">(</span><span class="n">quantity</span><span class="o">);</span>
    <span class="n">productRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>

    <span class="k">return</span> <span class="nc">OrderResult</span><span class="o">.</span><span class="na">success</span><span class="o">(</span><span class="s">"주문 완료"</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// 주의: REPEATABLE_READ에서도 Lost Update는 발생할 수 있음</span>
<span class="c1">// 따라서 낙관적 락(@Version) 또는 비관적 락 추가 고려 필요</span>
</pre></table></code></div></div><p><strong>2. 금융 거래 처리</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">REPEATABLE_READ</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">TransferResult</span> <span class="nf">transfer</span><span class="o">(</span><span class="nc">Long</span> <span class="n">fromAccountId</span><span class="o">,</span> <span class="nc">Long</span> <span class="n">toAccountId</span><span class="o">,</span> <span class="nc">BigDecimal</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 일관된 스냅샷으로 계좌 정보 조회</span>
    <span class="kt">var</span> <span class="n">fromAccount</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">fromAccountId</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
    <span class="kt">var</span> <span class="n">toAccount</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">toAccountId</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>

    <span class="c1">// 잔액 검증 - 스냅샷으로 일관성 보장</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">fromAccount</span><span class="o">.</span><span class="na">getBalance</span><span class="o">().</span><span class="na">compareTo</span><span class="o">(</span><span class="n">amount</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">TransferResult</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="s">"잔액 부족"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// 이체 처리</span>
    <span class="n">fromAccount</span><span class="o">.</span><span class="na">withdraw</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
    <span class="n">toAccount</span><span class="o">.</span><span class="na">deposit</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>

    <span class="n">accountRepository</span><span class="o">.</span><span class="na">saveAll</span><span class="o">(</span><span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">fromAccount</span><span class="o">,</span> <span class="n">toAccount</span><span class="o">));</span>

    <span class="k">return</span> <span class="nc">TransferResult</span><span class="o">.</span><span class="na">success</span><span class="o">(</span><span class="s">"이체 완료"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>3. 보고서 생성 (데이터 정합성)</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">REPEATABLE_READ</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">DailySalesReport</span> <span class="nf">generateSalesReport</span><span class="o">(</span><span class="nc">LocalDate</span> <span class="n">date</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 보고서 생성 중 데이터 변경되어도 일관된 스냅샷으로 작업</span>
    <span class="kt">var</span> <span class="n">orders</span> <span class="o">=</span> <span class="n">orderRepository</span><span class="o">.</span><span class="na">findByOrderDate</span><span class="o">(</span><span class="n">date</span><span class="o">);</span>

    <span class="c1">// 주문 총액 계산</span>
    <span class="kt">var</span> <span class="n">totalAmount</span> <span class="o">=</span> <span class="n">orders</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Order:</span><span class="o">:</span><span class="n">getAmount</span><span class="o">)</span>
            <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">ZERO</span><span class="o">,</span> <span class="nl">BigDecimal:</span><span class="o">:</span><span class="n">add</span><span class="o">);</span>

    <span class="c1">// 카테고리별 집계 - 모두 동일한 스냅샷 기준</span>
    <span class="kt">var</span> <span class="n">categoryStats</span> <span class="o">=</span> <span class="n">orders</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">groupingBy</span><span class="o">(</span>
                <span class="nl">Order:</span><span class="o">:</span><span class="n">getCategoryId</span><span class="o">,</span>
                <span class="nc">Collectors</span><span class="o">.</span><span class="na">summingDouble</span><span class="o">(</span><span class="n">order</span> <span class="o">-&gt;</span> <span class="n">order</span><span class="o">.</span><span class="na">getAmount</span><span class="o">().</span><span class="na">doubleValue</span><span class="o">())</span>
            <span class="o">));</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nf">DailySalesReport</span><span class="o">(</span><span class="n">date</span><span class="o">,</span> <span class="n">totalAmount</span><span class="o">,</span> <span class="n">orders</span><span class="o">.</span><span class="na">size</span><span class="o">(),</span> <span class="n">categoryStats</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>4. READ_COMMITTED 적절한 사용 사례</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">READ_COMMITTED</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">logUserActivity</span><span class="o">(</span><span class="nc">Long</span> <span class="n">userId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">activity</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 로깅은 약간의 불일치가 있어도 무관</span>
    <span class="c1">// 성능을 우선시하는 것이 맞음</span>
    <span class="kt">var</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">userId</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">user</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">activityLogRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">ActivityLog</span><span class="o">(</span><span class="n">userId</span><span class="o">,</span> <span class="n">activity</span><span class="o">,</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">()));</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>성능 vs 일관성 선택 가이드</strong></p><ul><li><strong>READ_COMMITTED:</strong> 로깅, 단순 조회, 성능이 중요한 대량 처리<li><strong>REPEATABLE_READ:</strong> 금융 거래, 재고 관리, 복잡한 비즈니스 로직, 보고서 생성<li><strong>SERIALIZABLE:</strong> 극도로 중요한 데이터 (일반적으로 성능상 비추천)</ul><p><strong>주의사항</strong></p><ul><li>격리 수준만으로는 모든 동시성 문제가 해결되지 않음<li>필요시 낙관적 락(@Version) 또는 비관적 락(SELECT FOR UPDATE) 추가 고려<li>격리 수준이 높을수록 데드락 발생 가능성 증가</ul><h2 id="transactional과-lazyinitializationexception"><span class="mr-2"><strong>@Transactional과 LazyInitializationException</strong></span><a href="#transactional과-lazyinitializationexception" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>LazyInitializationException은 Hibernate를 사용할 때 자주 마주치는 문제다. 특히 <code class="language-plaintext highlighter-rouge">spring.jpa.open-in-view: false</code> 설정을 사용하는 환경에서 트랜잭션이 끝난 후 지연 로딩을 시도할 때 발생한다.</p><p><strong>문제 발생 시나리오</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Author</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"author"</span><span class="o">,</span> <span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span> <span class="c1">// 기본값: LAZY</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="c1">// getter, setter...</span>
<span class="o">}</span>

<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Author</span> <span class="nf">findAuthor</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="c1">// 트랜잭션이 여기서 종료됨</span>
<span class="o">}</span>

<span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/authors/{id}"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">AuthorResponse</span><span class="o">&gt;</span> <span class="nf">getAuthor</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">author</span> <span class="o">=</span> <span class="n">authorService</span><span class="o">.</span><span class="na">findAuthor</span><span class="o">(</span><span class="n">id</span><span class="o">);</span> <span class="c1">// 트랜잭션 종료</span>

    <span class="c1">// 여기서 LazyInitializationException 발생!</span>
    <span class="c1">// could not initialize proxy - no Session</span>
    <span class="kt">var</span> <span class="n">bookTitles</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Book:</span><span class="o">:</span><span class="n">getTitle</span><span class="o">)</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>

    <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="k">new</span> <span class="nc">AuthorResponse</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">bookTitles</span><span class="o">));</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>왜 발생하는가?</strong></p><ol><li><strong>JPA Session (EntityManager) 종료</strong>: 트랜잭션이 끝나면 Session도 함께 닫힘<li><strong>프록시 객체의 한계</strong>: Lazy 컬렉션은 프록시로 래핑되어 있어 Session이 필요<li><strong>open-in-view: false</strong>: HTTP 요청 범위에서 Session을 유지하지 않음</ol><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c1">// Author 객체 내부의 books 필드는 실제로 이런 프록시</span>
<span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PersistentBag</span><span class="o">();</span> <span class="c1">// Hibernate의 지연 로딩 컬렉션</span>
<span class="c1">// Session이 없으면 실제 데이터를 가져올 수 없음</span>
</pre></table></code></div></div><p><strong>해결 방법</strong></p><h5 id="1-트랜잭션-범위-확장-controller에-transactional"><span class="mr-2"><strong><em>1. 트랜잭션 범위 확장 (Controller에 @Transactional)</em></strong></span><a href="#1-트랜잭션-범위-확장-controller에-transactional" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/authors/{id}"</span><span class="o">)</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span> <span class="c1">// 트랜잭션을 Controller까지 확장</span>
<span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">AuthorResponse</span><span class="o">&gt;</span> <span class="nf">getAuthor</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">author</span> <span class="o">=</span> <span class="n">authorService</span><span class="o">.</span><span class="na">findAuthor</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>

    <span class="c1">// 트랜잭션 내에서 Lazy Loading 수행 - 정상 동작</span>
    <span class="kt">var</span> <span class="n">bookTitles</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Book:</span><span class="o">:</span><span class="n">getTitle</span><span class="o">)</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>

    <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="k">new</span> <span class="nc">AuthorResponse</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">bookTitles</span><span class="o">));</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>장점:</strong> 간단한 수정<br /> <strong>단점:</strong> Controller에 트랜잭션 로직이 들어감, 레이어 경계가 모호해짐</p><h5 id="2-eager-fetch-join-사용"><span class="mr-2"><strong><em>2. Eager Fetch Join 사용</em></strong></span><a href="#2-eager-fetch-join-사용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AuthorRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Author</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@Query</span><span class="o">(</span><span class="s">"SELECT a FROM Author a JOIN FETCH a.books WHERE a.id = :id"</span><span class="o">)</span>
    <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Author</span><span class="o">&gt;</span> <span class="nf">findByIdWithBooks</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>

    <span class="c1">// 또는 여러 연관관계를 한 번에</span>
    <span class="nd">@Query</span><span class="o">(</span><span class="s">"SELECT DISTINCT a FROM Author a "</span> <span class="o">+</span>
           <span class="s">"JOIN FETCH a.books b "</span> <span class="o">+</span>
           <span class="s">"JOIN FETCH b.category "</span> <span class="o">+</span>
           <span class="s">"WHERE a.id = :id"</span><span class="o">)</span>
    <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Author</span><span class="o">&gt;</span> <span class="nf">findByIdWithBooksAndCategories</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthorService</span> <span class="o">{</span>
    <span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Author</span> <span class="nf">findAuthorWithBooks</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findByIdWithBooks</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="c1">// books 데이터가 이미 로드되어 있어서 Session 종료 후에도 접근 가능</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>장점:</strong> 명확한 데이터 로딩, N+1 문제 해결<br /> <strong>단점:</strong> 항상 연관 데이터를 로드함 (불필요한 경우에도)</p><h5 id="3-entitygraph-활용"><span class="mr-2"><strong><em>3. @EntityGraph 활용</em></strong></span><a href="#3-entitygraph-활용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AuthorRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Author</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@EntityGraph</span><span class="o">(</span><span class="n">attributePaths</span> <span class="o">=</span> <span class="o">{</span><span class="s">"books"</span><span class="o">,</span> <span class="s">"books.category"</span><span class="o">})</span>
    <span class="nd">@Query</span><span class="o">(</span><span class="s">"SELECT a FROM Author a WHERE a.id = :id"</span><span class="o">)</span>
    <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Author</span><span class="o">&gt;</span> <span class="nf">findByIdWithBooks</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>

    <span class="c1">// 여러 시나리오에 대응</span>
    <span class="nd">@EntityGraph</span><span class="o">(</span><span class="n">attributePaths</span> <span class="o">=</span> <span class="o">{</span><span class="s">"books"</span><span class="o">})</span>
    <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Author</span><span class="o">&gt;</span> <span class="nf">findById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">);</span> <span class="c1">// 기본 메서드 오버라이드</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>장점:</strong> 선언적 방식, 유연함<br /> <strong>단점:</strong> 복잡한 그래프에서는 예측이 어려울 수 있음</p><h5 id="4-dto-변환을-트랜잭션-내에서-권장"><span class="mr-2"><strong><em>4. DTO 변환을 트랜잭션 내에서 (권장)</em></strong></span><a href="#4-dto-변환을-트랜잭션-내에서-권장" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">AuthorResponse</span> <span class="nf">findAuthorResponse</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">author</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">author</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 트랜잭션 내에서 필요한 데이터를 모두 접근하여 DTO로 변환</span>
    <span class="kt">var</span> <span class="n">bookTitles</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Book:</span><span class="o">:</span><span class="n">getTitle</span><span class="o">)</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>

    <span class="kt">var</span> <span class="n">authorStats</span> <span class="o">=</span> <span class="nc">AuthorStats</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">totalBooks</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">size</span><span class="o">())</span>
            <span class="o">.</span><span class="na">avgRating</span><span class="o">(</span><span class="n">calculateAverageRating</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getBooks</span><span class="o">()))</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="k">return</span> <span class="nc">AuthorResponse</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">name</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getName</span><span class="o">())</span>
            <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getEmail</span><span class="o">())</span>
            <span class="o">.</span><span class="na">bookTitles</span><span class="o">(</span><span class="n">bookTitles</span><span class="o">)</span>
            <span class="o">.</span><span class="na">stats</span><span class="o">(</span><span class="n">authorStats</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">double</span> <span class="nf">calculateAverageRating</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">books</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">books</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">mapToDouble</span><span class="o">(</span><span class="nl">Book:</span><span class="o">:</span><span class="n">getRating</span><span class="o">)</span>
            <span class="o">.</span><span class="na">average</span><span class="o">()</span>
            <span class="o">.</span><span class="na">orElse</span><span class="o">(</span><span class="mf">0.0</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/authors/{id}"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">AuthorResponse</span><span class="o">&gt;</span> <span class="nf">getAuthor</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">response</span> <span class="o">=</span> <span class="n">authorService</span><span class="o">.</span><span class="na">findAuthorResponse</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">response</span> <span class="o">!=</span> <span class="kc">null</span>
        <span class="o">?</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">response</span><span class="o">)</span>
        <span class="o">:</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">notFound</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>장점:</strong> 명확한 레이어 분리, 필요한 데이터만 노출, 성능 최적화<br /> <strong>단점:</strong> DTO 클래스 추가 필요</p><h5 id="5-batch-fetch-size-설정으로-n1-문제-완화"><span class="mr-2"><strong><em>5. Batch Fetch Size 설정으로 N+1 문제 완화</em></strong></span><a href="#5-batch-fetch-size-설정으로-n1-문제-완화" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="na">spring</span><span class="pi">:</span>
  <span class="na">jpa</span><span class="pi">:</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="na">hibernate</span><span class="pi">:</span>
        <span class="na">default_batch_fetch_size</span><span class="pi">:</span> <span class="m">100</span> <span class="c1"># 한 번에 100개씩 배치로 로딩</span>
        <span class="na">jdbc</span><span class="pi">:</span>
          <span class="na">batch_size</span><span class="pi">:</span> <span class="m">50</span> <span class="c1"># INSERT/UPDATE 배치 크기</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">AuthorResponse</span><span class="o">&gt;</span> <span class="nf">findAllAuthorsWithBooks</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">authors</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span> <span class="c1">// 1번 쿼리</span>

    <span class="k">return</span> <span class="n">authors</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">author</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="c1">// Batch Fetch Size 덕분에 100개씩 묶어서 쿼리 실행</span>
                <span class="c1">// N+1이 아니라 N/100+1 쿼리로 최적화</span>
                <span class="kt">var</span> <span class="n">bookTitles</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Book:</span><span class="o">:</span><span class="n">getTitle</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nf">AuthorResponse</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">bookTitles</span><span class="o">);</span>
            <span class="o">})</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
<span class="o">}</span>
</pre></table></code></div></div><h5 id="6-프로젝션projection-활용"><span class="mr-2"><strong><em>6. 프로젝션(Projection) 활용</em></strong></span><a href="#6-프로젝션projection-활용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AuthorBookProjection</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="nf">getName</span><span class="o">();</span>
    <span class="nc">String</span> <span class="nf">getEmail</span><span class="o">();</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">BookInfo</span><span class="o">&gt;</span> <span class="nf">getBooks</span><span class="o">();</span>

    <span class="kd">interface</span> <span class="nc">BookInfo</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="nf">getTitle</span><span class="o">();</span>
        <span class="nc">String</span> <span class="nf">getIsbn</span><span class="o">();</span>
        <span class="nc">BigDecimal</span> <span class="nf">getPrice</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AuthorRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Author</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@Query</span><span class="o">(</span><span class="s">"SELECT a.name as name, a.email as email, "</span> <span class="o">+</span>
           <span class="s">"b.title as books_title, b.isbn as books_isbn, b.price as books_price "</span> <span class="o">+</span>
           <span class="s">"FROM Author a LEFT JOIN a.books b WHERE a.id = :id"</span><span class="o">)</span>
    <span class="nc">AuthorBookProjection</span> <span class="nf">findAuthorBookProjection</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>성능 최적화 실전 팁</strong></p><p><strong>1. 연관관계 설계 시 고려사항</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Author</span> <span class="o">{</span>
    <span class="c1">// 필수: 양방향 관계에서 연관관계 주인 설정</span>
    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"author"</span><span class="o">,</span> <span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="c1">// 성능 최적화: 컬렉션 초기화</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="nf">getBooks</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">books</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">books</span> <span class="o">:</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// 편의 메서드: Lazy Loading을 위한 크기 체크</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasBooks</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">books</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">books</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getBooksCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">books</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">books</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">:</span> <span class="mi">0</span><span class="o">;</span> <span class="c1">// size() 호출 시 실제 로딩됨</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>2. 조건부 Lazy Loading</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthorService</span> <span class="o">{</span>

    <span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">AuthorResponse</span> <span class="nf">findAuthorResponse</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">includeBooks</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">author</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">author</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>

        <span class="kt">var</span> <span class="n">builder</span> <span class="o">=</span> <span class="nc">AuthorResponse</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">name</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getName</span><span class="o">())</span>
                <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getEmail</span><span class="o">());</span>

        <span class="c1">// 필요한 경우에만 Lazy Loading 수행</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">includeBooks</span> <span class="o">&amp;&amp;</span> <span class="n">author</span><span class="o">.</span><span class="na">hasBooks</span><span class="o">())</span> <span class="o">{</span>
            <span class="kt">var</span> <span class="n">bookTitles</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Book:</span><span class="o">:</span><span class="n">getTitle</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
            <span class="n">builder</span><span class="o">.</span><span class="na">bookTitles</span><span class="o">(</span><span class="n">bookTitles</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>핵심 원칙</strong></p><ul><li><strong>데이터 접근은 트랜잭션 내에서</strong>: Session이 열려있을 때 모든 필요 데이터에 접근<li><strong>명시적 데이터 로딩</strong>: Fetch Join, EntityGraph 등으로 의도를 명확히 표현<li><strong>적절한 DTO 활용</strong>: 필요한 데이터만 추출하여 레이어 간 결합도 감소<li><strong>성능 측정 기반 최적화</strong>: N+1 문제와 메모리 사용량을 모니터링하며 최적화</ul><h2 id="dirty-checking-이해하기"><span class="mr-2"><strong>Dirty Checking 이해하기</strong></span><a href="#dirty-checking-이해하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Hibernate의 핵심 기능 중 하나인 Dirty Checking에 대해 알아보자.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateAuthor</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">author</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>

    <span class="c1">// 엔티티 수정 - 명시적인 save() 호출 없이도 UPDATE 쿼리 실행됨</span>
    <span class="n">author</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"변경된 이름"</span><span class="o">);</span>
    <span class="n">author</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="s">"new@email.com"</span><span class="o">);</span>

    <span class="c1">// 트랜잭션 커밋 시점에 자동으로 UPDATE 쿼리 생성</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>Dirty Checking 동작 원리</strong></p><ol><li><strong>1차 캐시 저장 시점</strong>: 엔티티 조회 시 현재 상태의 스냅샷을 생성<li><strong>트랜잭션 커밋 시점</strong>: 현재 엔티티와 스냅샷을 비교<li><strong>변경 감지</strong>: 달라진 필드가 있으면 UPDATE 쿼리 자동 생성</ol><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">// 내부 동작 개념</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EntityEntry</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Object</span> <span class="n">entity</span><span class="o">;</span>        <span class="c1">// 현재 엔티티</span>
    <span class="kd">private</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">snapshot</span><span class="o">;</span>    <span class="c1">// 조회 시점의 스냅샷</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">requiresUpdate</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 현재 엔티티와 스냅샷 비교</span>
        <span class="k">return</span> <span class="o">!</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">getCurrentState</span><span class="o">(),</span> <span class="n">snapshot</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>성능 고려사항</strong></p><p><strong>1. 불필요한 스냅샷 생성 방지</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">AuthorDto</span><span class="o">&gt;</span> <span class="nf">findAllAuthorsForReport</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">author</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">AuthorDto</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">author</span><span class="o">.</span><span class="na">getEmail</span><span class="o">()))</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
<span class="o">}</span>
</pre></table></code></div></div><p>읽기 전용이므로 스냅샷 생성하지 않음</p><p><strong>2. 대용량 조회 시 주의</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">processAllAuthors</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">authors</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span> <span class="c1">// 1만건 조회</span>

    <span class="c1">// 1만개의 스냅샷 생성 → 메모리 사용량 증가</span>
    <span class="c1">// 실제로는 수정하지 않아도 스냅샷은 생성됨</span>

    <span class="n">authors</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">author</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="c1">// 단순 읽기 작업만 수행</span>
        <span class="n">generateReport</span><span class="o">(</span><span class="n">author</span><span class="o">);</span>
    <span class="o">});</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>3. 선택적 업데이트 vs 전체 필드 업데이트</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">// @DynamicUpdate 없는 경우 - 모든 필드 UPDATE</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Author</span> <span class="o">{</span>
    <span class="c1">// UPDATE author SET name=?, email=?, created_at=? WHERE id=?</span>
<span class="o">}</span>

<span class="c1">// @DynamicUpdate 있는 경우 - 변경된 필드만 UPDATE</span>
<span class="nd">@Entity</span>
<span class="nd">@DynamicUpdate</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Author</span> <span class="o">{</span>
    <span class="c1">// UPDATE author SET name=? WHERE id=?</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>최적화 팁</strong></p><ul><li>단순 조회만 하는 경우: <code class="language-plaintext highlighter-rouge">@Transactional(readOnly = true)</code> 또는 트랜잭션 없이<li>대용량 데이터 처리: 청크 단위로 분할하여 메모리 사용량 제어<li>부분 업데이트: <code class="language-plaintext highlighter-rouge">@DynamicUpdate</code> 활용</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/java/'>Java</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java/" class="post-tag no-text-decoration" >Java</a> <a href="/tags/jpa/" class="post-tag no-text-decoration" >JPA</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=JPA+Transactional+%EC%A0%90%EA%B2%80%ED%95%98%EA%B8%B0+-+keencho%27s+blog&url=https%3A%2F%2Fkeencho.github.io%2Fposts%2Ftransactional-think%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=JPA+Transactional+%EC%A0%90%EA%B2%80%ED%95%98%EA%B8%B0+-+keencho%27s+blog&u=https%3A%2F%2Fkeencho.github.io%2Fposts%2Ftransactional-think%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fkeencho.github.io%2Fposts%2Ftransactional-think%2F&text=JPA+Transactional+%EC%A0%90%EA%B2%80%ED%95%98%EA%B8%B0+-+keencho%27s+blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/jpa-flush/">JPA & Hibernate Flush Mode</a><li><a href="/posts/aws-cicd-1/">AWS를 사용해 무중단 배포 자동화 환경 구축하기 - 1. 개요</a><li><a href="/posts/terraform-aws-infra-6/">Terraform으로 AWS 무중단 배포 인프라 구성하기 - 6. 운영환경 (백엔드)</a><li><a href="/posts/aapt2-arm/">Arm 아키텍처에서 AAPT2 빌드 도구 사용하기</a><li><a href="/posts/terraform-aws-infra-1/">Terraform으로 AWS 무중단 배포 인프라 구성하기 - 1. 개요</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/ecs/">ECS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/querydsl/">QueryDSL</a> <a class="post-tag" href="/tags/react/">React</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/querydsl-qbuilder-qsetter-1/"><div class="card-body"> <em class="small" data-ts="1664316720" data-df="ll" > Sep 28, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>QueryProjection 에서 한단계 더 나아가 QueryProjectionBuilder 만들기 (1)</h3><div class="text-muted small"><p> QueryProjection 에서 한단계 더 나아가 QueryProjectionBuilder 만들기 (1) - 개요 Querydsl을 사용해 db조회를 하는 경우 엔티티 자체를 반환하는 경우는 잘 없습니다. 대부분 필요한 필드만 지정하여 Projections를 사용하여 조회하게 되는것 같습니다. 잘 알려진 projection 방법에는 3가지가 있습니...</p></div></div></a></div><div class="card"> <a href="/posts/querydsl-qbuilder-qsetter-2/"><div class="card-body"> <em class="small" data-ts="1664662320" data-df="ll" > Oct 2, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>QueryProjection 에서 한단계 더 나아가 QueryProjectionBuilder 만들기 (2)</h3><div class="text-muted small"><p> QueryProjection 에서 한단계 더 나아가 QueryProjectionBuilder 만들기 (2) - 개발 과정, 코드 이 포스팅에서 설명하는 코드는 한 프로젝트 내에서 사용할 수 없습니다. 라이브러리 프로젝트 A, 실제 어플리케이션 프로젝트 B 로 나뉘어야 합니다. java17, maven 을 사용합니다. 1. @QueryProj...</p></div></div></a></div><div class="card"> <a href="/posts/proxy-pattern/"><div class="card-body"> <em class="small" data-ts="1625310720" data-df="ll" > Jul 3, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>프록시 패턴 (Proxy Pattern)</h3><div class="text-muted small"><p> 프록시 패턴 프록시(Proxy) 는 대리자 라는 뜻입니다. 실생활서의 의미처럼 프로그램에서의 프록시도 누군가에게 어떤 일을 대신 시키는 것 이란 의미를 가지고 있습니다. 때때로 우리는 객체에 대한 액세스를 제어하는 기능을 필요합니다. 예를 들어 무겁고 많은 자원을 필요로 하는 클래스의 한두가지 메소드만 사용해야 하더라도 생성자로 전체 클래스를 인스턴...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/aws-alb-static-ip/" class="btn btn-outline-primary" prompt="Older"><p>Application Load Balancer에 고정 IP 사용하기 (feat. VPC IPAM 통합)</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/keencho">keencho</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/ecs/">ECS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/querydsl/">QueryDSL</a> <a class="post-tag" href="/tags/react/">React</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
