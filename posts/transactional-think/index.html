<!DOCTYPE html><html lang="ko-KS" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="JPA Transactional ì ê²€í•˜ê¸°" /><meta name="author" content="keencho" /><meta property="og:locale" content="ko_KS" /><meta name="description" content="JPA Transactional ì ê²€í•˜ê¸° JPAë¥¼ ë‹¤ë£¨ëŠ” ê°œë°œìë¼ë©´ Transactionalì˜ ë™ì‘ ì›ë¦¬ë¥¼ ì •í™•íˆ ì´í•´í•´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ ì†”ì§íˆ ë§í•˜ë©´, í”„ë¡œì íŠ¸ ì´ˆê¸°ì— ì„¸ìš´ ê°€ì´ë“œë¼ì¸ì„ ì²˜ìŒì—ëŠ” ì˜ ì§€ì¼°ì§€ë§Œ ê°œë°œì´ ì§„í–‰ë˜ë©´ì„œ ì ì  ì¼ë‹¨ @Transactional ë¶™ì´ê³  ë³´ìëŠ” ì‹ìœ¼ë¡œ ìŠµê´€ì ìœ¼ë¡œ ì‚¬ìš©í–ˆë˜ ì ì´ ë§ë‹¤. ë‹¹ì—°íˆ ì´ëŸ° ë¬´ë¶„ë³„í•œ ì‚¬ìš©ì€ ì—¬ëŸ¬ ë¬¸ì œë¥¼ ì•¼ê¸°í–ˆê³ , ì´ë¥¼ ê³„ê¸°ë¡œ JPA Transactional ì‚¬ìš©ë²•ì„ ë‹¤ì‹œ ì ê²€í•˜ê³  ëª…í™•í•œ ì›ì¹™ì„ ì •ë¦½í•´ë³´ê³ ì í•œë‹¤." /><meta property="og:description" content="JPA Transactional ì ê²€í•˜ê¸° JPAë¥¼ ë‹¤ë£¨ëŠ” ê°œë°œìë¼ë©´ Transactionalì˜ ë™ì‘ ì›ë¦¬ë¥¼ ì •í™•íˆ ì´í•´í•´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ ì†”ì§íˆ ë§í•˜ë©´, í”„ë¡œì íŠ¸ ì´ˆê¸°ì— ì„¸ìš´ ê°€ì´ë“œë¼ì¸ì„ ì²˜ìŒì—ëŠ” ì˜ ì§€ì¼°ì§€ë§Œ ê°œë°œì´ ì§„í–‰ë˜ë©´ì„œ ì ì  ì¼ë‹¨ @Transactional ë¶™ì´ê³  ë³´ìëŠ” ì‹ìœ¼ë¡œ ìŠµê´€ì ìœ¼ë¡œ ì‚¬ìš©í–ˆë˜ ì ì´ ë§ë‹¤. ë‹¹ì—°íˆ ì´ëŸ° ë¬´ë¶„ë³„í•œ ì‚¬ìš©ì€ ì—¬ëŸ¬ ë¬¸ì œë¥¼ ì•¼ê¸°í–ˆê³ , ì´ë¥¼ ê³„ê¸°ë¡œ JPA Transactional ì‚¬ìš©ë²•ì„ ë‹¤ì‹œ ì ê²€í•˜ê³  ëª…í™•í•œ ì›ì¹™ì„ ì •ë¦½í•´ë³´ê³ ì í•œë‹¤." /><link rel="canonical" href="https://keencho.github.io/posts/transactional-think/" /><meta property="og:url" content="https://keencho.github.io/posts/transactional-think/" /><meta property="og:site_name" content="keenchoâ€™s blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-06-27T20:12:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="JPA Transactional ì ê²€í•˜ê¸°" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@keencho" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"keencho"},"dateModified":"2025-06-27T20:12:00+09:00","datePublished":"2025-06-27T20:12:00+09:00","description":"JPA Transactional ì ê²€í•˜ê¸° JPAë¥¼ ë‹¤ë£¨ëŠ” ê°œë°œìë¼ë©´ Transactionalì˜ ë™ì‘ ì›ë¦¬ë¥¼ ì •í™•íˆ ì´í•´í•´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ ì†”ì§íˆ ë§í•˜ë©´, í”„ë¡œì íŠ¸ ì´ˆê¸°ì— ì„¸ìš´ ê°€ì´ë“œë¼ì¸ì„ ì²˜ìŒì—ëŠ” ì˜ ì§€ì¼°ì§€ë§Œ ê°œë°œì´ ì§„í–‰ë˜ë©´ì„œ ì ì  ì¼ë‹¨ @Transactional ë¶™ì´ê³  ë³´ìëŠ” ì‹ìœ¼ë¡œ ìŠµê´€ì ìœ¼ë¡œ ì‚¬ìš©í–ˆë˜ ì ì´ ë§ë‹¤. ë‹¹ì—°íˆ ì´ëŸ° ë¬´ë¶„ë³„í•œ ì‚¬ìš©ì€ ì—¬ëŸ¬ ë¬¸ì œë¥¼ ì•¼ê¸°í–ˆê³ , ì´ë¥¼ ê³„ê¸°ë¡œ JPA Transactional ì‚¬ìš©ë²•ì„ ë‹¤ì‹œ ì ê²€í•˜ê³  ëª…í™•í•œ ì›ì¹™ì„ ì •ë¦½í•´ë³´ê³ ì í•œë‹¤.","headline":"JPA Transactional ì ê²€í•˜ê¸°","mainEntityOfPage":{"@type":"WebPage","@id":"https://keencho.github.io/posts/transactional-think/"},"url":"https://keencho.github.io/posts/transactional-think/"}</script><title>JPA Transactional ì ê²€í•˜ê¸° | keencho's blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="keencho's blog"><meta name="application-name" content="keencho's blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/custom/keencho.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">keencho's blog</a></div><div class="site-subtitle font-italic">ì´ê²ƒì €ê²ƒ ì •ë¦¬í•˜ëŠ” ë¸”ë¡œê·¸.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/keencho" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['seyoung050412','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>JPA Transactional ì ê²€í•˜ê¸°</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>JPA Transactional ì ê²€í•˜ê¸°</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1751022720" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 27, 2025 </em> </span><div class="d-flex justify-content-between"> <span> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="8605 words"> <em>47 min</em> read</span></div></div></div><div class="post-content"><h1 id="jpa-transactional-ì ê²€í•˜ê¸°"><strong>JPA Transactional ì ê²€í•˜ê¸°</strong></h1><p>JPAë¥¼ ë‹¤ë£¨ëŠ” ê°œë°œìë¼ë©´ Transactionalì˜ ë™ì‘ ì›ë¦¬ë¥¼ ì •í™•íˆ ì´í•´í•´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ ì†”ì§íˆ ë§í•˜ë©´, í”„ë¡œì íŠ¸ ì´ˆê¸°ì— ì„¸ìš´ ê°€ì´ë“œë¼ì¸ì„ ì²˜ìŒì—ëŠ” ì˜ ì§€ì¼°ì§€ë§Œ ê°œë°œì´ ì§„í–‰ë˜ë©´ì„œ ì ì  <code class="language-plaintext highlighter-rouge">ì¼ë‹¨ @Transactional ë¶™ì´ê³  ë³´ì</code>ëŠ” ì‹ìœ¼ë¡œ ìŠµê´€ì ìœ¼ë¡œ ì‚¬ìš©í–ˆë˜ ì ì´ ë§ë‹¤. ë‹¹ì—°íˆ ì´ëŸ° ë¬´ë¶„ë³„í•œ ì‚¬ìš©ì€ ì—¬ëŸ¬ ë¬¸ì œë¥¼ ì•¼ê¸°í–ˆê³ , ì´ë¥¼ ê³„ê¸°ë¡œ JPA Transactional ì‚¬ìš©ë²•ì„ ë‹¤ì‹œ ì ê²€í•˜ê³  ëª…í™•í•œ ì›ì¹™ì„ ì •ë¦½í•´ë³´ê³ ì í•œë‹¤.</p><h2 id="transactional-ë‚¨ìš©í•˜ì§€-ì•Šê¸°"><span class="mr-2"><strong>@Transactional ë‚¨ìš©í•˜ì§€ ì•Šê¸°</strong></span><a href="#transactional-ë‚¨ìš©í•˜ì§€-ì•Šê¸°" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>@Transactionalì„ ë‚¨ìš©í•˜ë©´ ì–´ë–¤ ì¼ì´ ì¼ì–´ë‚  ìˆ˜ ìˆëŠ”ì§€ ì•Œì•„ë³´ì. í…ŒìŠ¤íŠ¸ í™˜ê²½ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="nl">hikari:</span>
  <span class="n">maximum</span><span class="o">-</span><span class="n">pool</span><span class="o">-</span><span class="nl">size:</span> <span class="mi">1</span>
  <span class="n">connection</span><span class="o">-</span><span class="nl">timeout:</span> <span class="mi">1000</span>
<span class="nl">jpa:</span>
  <span class="n">open</span><span class="o">-</span><span class="n">in</span><span class="o">-</span><span class="nl">view:</span> <span class="kc">false</span>
  
<span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/concurrent"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;?&gt;</span> <span class="n">concurrentTest</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ğŸš€ ë™ì‹œ í…ŒìŠ¤íŠ¸ ì‹œì‘!"</span><span class="o">);</span>

    <span class="kt">var</span> <span class="n">future1</span> <span class="o">=</span> <span class="nc">CompletableFuture</span><span class="o">.</span><span class="na">supplyAsync</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ğŸ”´ ìŠ¤ë ˆë“œ1 ì‹œì‘: "</span> <span class="o">+</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
            <span class="n">testService</span><span class="o">.</span><span class="na">test</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ğŸŸ¢ ìŠ¤ë ˆë“œ1 ì™„ë£Œ: "</span> <span class="o">+</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
            <span class="k">return</span> <span class="s">"ì™„ë£Œ1"</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"âŒ ìŠ¤ë ˆë“œ1 ì‹¤íŒ¨: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="s">"ì‹¤íŒ¨1: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">});</span>

    <span class="kt">var</span> <span class="n">future2</span> <span class="o">=</span> <span class="nc">CompletableFuture</span><span class="o">.</span><span class="na">supplyAsync</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ğŸ”´ ìŠ¤ë ˆë“œ2 ì‹œì‘: "</span> <span class="o">+</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
            <span class="n">testService</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ğŸŸ¢ ìŠ¤ë ˆë“œ2 ì™„ë£Œ: "</span> <span class="o">+</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
            <span class="k">return</span> <span class="s">"ì™„ë£Œ2"</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"âŒ ìŠ¤ë ˆë“œ2 ì‹¤íŒ¨: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="s">"ì‹¤íŒ¨2: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">});</span>

    <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span>
            <span class="nc">Map</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
                    <span class="s">"result1"</span><span class="o">,</span> <span class="n">future1</span><span class="o">.</span><span class="na">join</span><span class="o">(),</span>
                    <span class="s">"result2"</span><span class="o">,</span> <span class="n">future2</span><span class="o">.</span><span class="na">join</span><span class="o">()</span>
            <span class="o">)</span>
    <span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li>OpenEntityManagerInViewê°€ HTTP ìš”ì²­ë‹¹ í•˜ë‚˜ì˜ EntityManagerë¥¼ ìœ ì§€í•˜ê³ , ì´ëŠ” ì»¤ë„¥ì…˜ì„ ë¨¼ì € ì ìœ í•˜ê¸°ì— open-in-view ë¥¼ ë¹„í™œì„±í™” í•œë‹¤.<li><code class="language-plaintext highlighter-rouge">CompletableFutre.supplyAsync()</code>ë¡œ 2ê°œì˜ ë³„ë„ ìŠ¤ë ˆë“œ í’€ì—ì„œ ë™ì‹œì— <code class="language-plaintext highlighter-rouge">bookService.save()</code>ë¥¼ í˜¸ì¶œí•œë‹¤.</ul><h5 id="db-ì‘ì—…-ì—†ëŠ”-ë©”ì†Œë“œì—-transactional"><span class="mr-2"><strong><em>DB ì‘ì—… ì—†ëŠ” ë©”ì†Œë“œì— @Transactional</em></strong></span><a href="#db-ì‘ì—…-ì—†ëŠ”-ë©”ì†Œë“œì—-transactional" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nd">@SneakyThrows</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">2000</span><span class="o">);</span>

    <span class="kt">var</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
    <span class="kt">var</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
    <span class="kt">var</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="o">;</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>DB ì‘ì—…ì´ ì—†ë‹¤. ê·¸ëŸ¼ì—ë„ @Transactionalì´ íŠ¸ëœì­ì…˜ ì‹œì‘ë¶€í„° ëê¹Œì§€ ì»¤ë„¥ì…˜ì„ í™€ë”©í•˜ê¸°ì— 2ê°œì˜ í˜¸ì¶œì¤‘ í•œê°œëŠ” 1ì´ˆì˜ ì»¤ë„¥ì…˜ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ì¸í•´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤. ë¬¼ë¡  DB ì‘ì—…ì´ ì—†ê¸°ì— ê·¸ë¦¬ ì‹¬ê°í•˜ì§€ ì•Šì€ ë¬¸ì œì´ê¸´ í• ê²ƒì´ë‹¤.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>HikariPool-1 - Connection is not available, request timed out after 1010ms (total=1, active=1, idle=0, waiting=0)
ê²°ê³¼:
{
    "result2": "ì™„ë£Œ2",
    "result1": "ì‹¤íŒ¨1: Could not open JPA EntityManager for transaction"
}
</pre></table></code></div></div><h5 id="ë‚´ë¶€-db-ì‘ì—…ì´-ìˆëŠ”-ë©”ì†Œë“œì—-transactional"><span class="mr-2"><strong><em>ë‚´ë¶€ DB ì‘ì—…ì´ ìˆëŠ” ë©”ì†Œë“œì— @Transactional</em></strong></span><a href="#ë‚´ë¶€-db-ì‘ì—…ì´-ìˆëŠ”-ë©”ì†Œë“œì—-transactional" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nd">@SneakyThrows</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    
    <span class="kt">var</span> <span class="n">order</span> <span class="o">=</span> <span class="n">apiService</span><span class="o">.</span><span class="na">order</span><span class="o">();</span>
    <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">2000</span><span class="o">);</span>
    
    <span class="kt">var</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">orderResult</span><span class="o">();</span>
    <span class="n">result</span><span class="o">.</span><span class="na">setSuccess</span><span class="o">(</span><span class="n">order</span><span class="o">.</span><span class="na">isSuccess</span><span class="o">());</span>
    <span class="n">result</span><span class="o">.</span><span class="na">setMessage</span><span class="o">(</span><span class="n">order</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="n">result</span><span class="o">.</span><span class="na">setOrderNo</span><span class="o">(</span><span class="n">order</span><span class="o">.</span><span class="na">getOrderNo</span><span class="o">());</span>

    <span class="n">orderResultRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>ì´ë²ˆì—” ì™¸ë¶€ APIë¥¼ í˜¸ì¶œí•˜ê³  ê²°ê³¼ë¥¼ DBì— ì €ì¥í•˜ëŠ” ì˜ˆì œì´ë‹¤. ì™¸ë¶€ API í˜¸ì¶œê¹Œì§„ ì„±ê³µí•˜ê² ìœ¼ë‚˜, ë‚´ë¶€ DBì— ê²°ê³¼ë¥¼ ì‘ì—…í•˜ê¸° ìœ„í•´ ëŒ€ê¸°í•˜ëŠ” 2ì´ˆê°„ ì—ëŸ¬ê°€ ë°œìƒí•  ê²ƒì´ë‹¤. DBì—ëŠ” 1ê°œì˜ ê²°ê³¼ë§Œ ì €ì¥ëœë‹¤. ì´ëŠ” ì™¸ë¶€ ì„œë¹„ìŠ¤ì—ëŠ” ì£¼ë¬¸ ì •ë³´ê°€ ìˆê³  ë‚´ë¶€ ì„œë¹„ìŠ¤ì—ëŠ” ì£¼ë¬¸ ê²°ê³¼ê°€ ì—†ëŠ”, ìƒí™©ì— ë”°ë¼ ì‹¬ê°í•œ ë¬¸ì œë¥¼ ì•¼ê¸°í•  ìˆ˜ ìˆë‹¤.</p><p>ë˜í•œ ì™¸ë¶€ API ë™ì‘ì— ì˜í•´ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ê°€ ì§€ì—°ë˜ê³  ê·¸ë§Œí¼ ë‚´ë¶€ ì„œë¹„ìŠ¤ DB ì—°ê²°ì‹œê°„ì— ì˜í–¥ì„ ë°›ê¸° ë•Œë¬¸ì— ë§¤ìš° ì¤‘ìš”í•˜ê²Œ ì ‘ê·¼í•´ì•¼í•  í•„ìš”ê°€ ìˆë‹¤.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>HikariPool-1 - Connection is not available, request timed out after 1011ms (total=1, active=1, idle=0, waiting=0)
{
    "result2": "ì™„ë£Œ2",
    "result1": "ì‹¤íŒ¨1: Could not open JPA EntityManager for transaction"
}
</pre></table></code></div></div><h5 id="ë‹¨ìˆœ-ì¡°íšŒë§Œ-ìˆ˜í–‰í•˜ëŠ”-ë©”ì†Œë“œì—-transactional"><span class="mr-2"><strong><em>ë‹¨ìˆœ ì¡°íšŒë§Œ ìˆ˜í–‰í•˜ëŠ” ë©”ì†Œë“œì— @Transactional</em></strong></span><a href="#ë‹¨ìˆœ-ì¡°íšŒë§Œ-ìˆ˜í–‰í•˜ëŠ”-ë©”ì†Œë“œì—-transactional" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p>ë‹¨ìˆœ ì¡°íšŒë§Œ ìˆ˜í–‰í•˜ëŠ” ë©”ì†Œë“œì— @Transactionalì„ ë¶™ì˜€ì„ë•Œ íŠ¸ëœì­ì…˜ì´ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ì.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TransactionChecker</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>

    <span class="cm">/**
     * 1. íŠ¸ëœì­ì…˜ ìƒíƒœ í™•ì¸
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkTransactionStatus</span><span class="o">(</span><span class="nc">String</span> <span class="n">actionName</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">isTransactionActive</span> <span class="o">=</span> <span class="nc">TransactionSynchronizationManager</span><span class="o">.</span><span class="na">isActualTransactionActive</span><span class="o">();</span>
        <span class="kt">var</span> <span class="n">isSynchronizationActive</span> <span class="o">=</span> <span class="nc">TransactionSynchronizationManager</span><span class="o">.</span><span class="na">isSynchronizationActive</span><span class="o">();</span>
        <span class="kt">var</span> <span class="n">transactionName</span> <span class="o">=</span> <span class="nc">TransactionSynchronizationManager</span><span class="o">.</span><span class="na">getCurrentTransactionName</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"ğŸ” [%s] íŠ¸ëœì­ì…˜ ìƒíƒœ:%n"</span><span class="o">,</span> <span class="n">actionName</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"   â”œâ”€ í™œì„±í™”: %s%n"</span><span class="o">,</span> <span class="n">isTransactionActive</span> <span class="o">?</span> <span class="s">"âœ… YES"</span> <span class="o">:</span> <span class="s">"âŒ NO"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"   â”œâ”€ ë™ê¸°í™”: %s%n"</span><span class="o">,</span> <span class="n">isSynchronizationActive</span> <span class="o">?</span> <span class="s">"âœ… YES"</span> <span class="o">:</span> <span class="s">"âŒ NO"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"   â””â”€ ì´ë¦„: %s%n"</span><span class="o">,</span> <span class="n">transactionName</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">transactionName</span> <span class="o">:</span> <span class="s">"ì—†ìŒ"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 2. HikariCP ì»¤ë„¥ì…˜ í’€ ìƒíƒœ í™•ì¸
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkConnectionPoolStatus</span><span class="o">(</span><span class="nc">String</span> <span class="n">actionName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">dataSource</span> <span class="k">instanceof</span> <span class="nc">HikariDataSource</span> <span class="n">hikariDataSource</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">var</span> <span class="n">poolBean</span> <span class="o">=</span> <span class="n">hikariDataSource</span><span class="o">.</span><span class="na">getHikariPoolMXBean</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"ğŸŠâ€â™‚ï¸ [%s] HikariCP ìƒíƒœ:%n"</span><span class="o">,</span> <span class="n">actionName</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"   â”œâ”€ í™œì„± ì»¤ë„¥ì…˜: %d%n"</span><span class="o">,</span> <span class="n">poolBean</span><span class="o">.</span><span class="na">getActiveConnections</span><span class="o">());</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"   â”œâ”€ ìœ íœ´ ì»¤ë„¥ì…˜: %d%n"</span><span class="o">,</span> <span class="n">poolBean</span><span class="o">.</span><span class="na">getIdleConnections</span><span class="o">());</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"   â”œâ”€ ì „ì²´ ì»¤ë„¥ì…˜: %d%n"</span><span class="o">,</span> <span class="n">poolBean</span><span class="o">.</span><span class="na">getTotalConnections</span><span class="o">());</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"   â”œâ”€ ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œ: %d%n"</span><span class="o">,</span> <span class="n">poolBean</span><span class="o">.</span><span class="na">getThreadsAwaitingConnection</span><span class="o">());</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"   â””â”€ ìµœëŒ€ í’€ í¬ê¸°: %d%n"</span><span class="o">,</span> <span class="n">hikariDataSource</span><span class="o">.</span><span class="na">getMaximumPoolSize</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"ğŸŠâ€â™‚ï¸ [%s] HikariCPê°€ ì•„ë‹˜: %s%n"</span><span class="o">,</span> <span class="n">actionName</span><span class="o">,</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 3. í•œ ë²ˆì— ëª¨ë“  ìƒíƒœ í™•ì¸
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkAll</span><span class="o">(</span><span class="nc">String</span> <span class="n">actionName</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">threadName</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"ğŸ“Š === [%s] %s ìƒíƒœ ì²´í¬ ===%n"</span><span class="o">,</span> <span class="n">actionName</span><span class="o">,</span> <span class="n">threadName</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">checkTransactionStatus</span><span class="o">(</span><span class="n">actionName</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">checkConnectionPoolStatus</span><span class="o">(</span><span class="n">actionName</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ğŸ“Š ========================================"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>íŠ¸ëœì­ì…˜ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” í—¬í¼ í´ë˜ìŠ¤ë‹¤.</p><p><strong><em>1. @Transactional ì—†ì´ ì¡°íšŒ</em></strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">transactionChecker</span><span class="o">.</span><span class="na">checkAll</span><span class="o">(</span><span class="s">"ì½ê¸° ì „"</span><span class="o">);</span>
    <span class="kt">var</span> <span class="n">list</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
    <span class="n">transactionChecker</span><span class="o">.</span><span class="na">checkAll</span><span class="o">(</span><span class="s">"ì½ì€ í›„"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>ğŸ”´ [13:57:07.976] http-nio-8080-exec-1 - ìš”ì²­ ì‹œì‘
ğŸ“Š === [ì½ê¸° ì „] http-nio-8080-exec-1 ìƒíƒœ ì²´í¬ ===
ğŸ” [ì½ê¸° ì „] íŠ¸ëœì­ì…˜ ìƒíƒœ:
   â”œâ”€ í™œì„±í™”: âŒ NO
   â”œâ”€ ë™ê¸°í™”: âŒ NO
   â””â”€ ì´ë¦„: ì—†ìŒ
ğŸŠâ€â™‚ï¸ [ì½ê¸° ì „] HikariCP ìƒíƒœ:
   â”œâ”€ í™œì„± ì»¤ë„¥ì…˜: 0
   â”œâ”€ ìœ íœ´ ì»¤ë„¥ì…˜: 1
   â”œâ”€ ì „ì²´ ì»¤ë„¥ì…˜: 1
   â”œâ”€ ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œ: 0
   â””â”€ ìµœëŒ€ í’€ í¬ê¸°: 1
ğŸ“Š ========================================
13:57:07.980 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
13:57:07.980 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1191829786&lt;open&gt;)] for JPA transaction
13:57:07.983 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@42c003ac]
13:57:08.054 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
13:57:08.054 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1191829786&lt;open&gt;)]
13:57:08.055 DEBUG [http-nio-8080-exec-1] o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1191829786&lt;open&gt;)] after transaction
ğŸ“Š === [ì½ì€ í›„] http-nio-8080-exec-1 ìƒíƒœ ì²´í¬ ===
ğŸ” [ì½ì€ í›„] íŠ¸ëœì­ì…˜ ìƒíƒœ:
   â”œâ”€ í™œì„±í™”: âŒ NO
   â”œâ”€ ë™ê¸°í™”: âŒ NO
   â””â”€ ì´ë¦„: ì—†ìŒ
ğŸŠâ€â™‚ï¸ [ì½ì€ í›„] HikariCP ìƒíƒœ:
   â”œâ”€ í™œì„± ì»¤ë„¥ì…˜: 0
   â”œâ”€ ìœ íœ´ ì»¤ë„¥ì…˜: 1
   â”œâ”€ ì „ì²´ ì»¤ë„¥ì…˜: 1
   â”œâ”€ ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œ: 0
   â””â”€ ìµœëŒ€ í’€ í¬ê¸°: 1
ğŸ“Š ========================================
ğŸŸ¢ [13:57:08.056] http-nio-8080-exec-1 - ìš”ì²­ ì™„ë£Œ (ì†Œìš”: 80ms)
</pre></table></code></div></div><p>ê²°ê³¼ëŠ” ìœ„ì™€ ê°™ë‹¤. <code class="language-plaintext highlighter-rouge">authorRepository.findAll()</code> ë¥¼ ìˆ˜í–‰í• ë•Œ íŠ¸ëœì­ì…˜ì´ ìƒì„±ë˜ê³  ë°”ë¡œ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ëœë‹¤. ë‹¤ì‹œë§í•´, ì´ë•Œ hikari poolì—ì„œ ì»¤ë„¥ì…˜ì„ íšë“í•˜ê³  ë°”ë¡œ ë°˜ë‚©í•œë‹¤ëŠ” ì˜ë¯¸ê°€ ëœë‹¤.</p><p><strong><em>2. @Transactional ë¶™ì´ê³  ì¡°íšŒ</em></strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">transactionChecker</span><span class="o">.</span><span class="na">checkAll</span><span class="o">(</span><span class="s">"ì½ê¸° ì „"</span><span class="o">);</span>
    <span class="kt">var</span> <span class="n">list</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
    <span class="n">transactionChecker</span><span class="o">.</span><span class="na">checkAll</span><span class="o">(</span><span class="s">"ì½ì€ í›„"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre>ğŸ”´ [13:59:19.626] http-nio-8080-exec-3 - ìš”ì²­ ì‹œì‘
13:59:19.628 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.keencho.spring.service.TestService.test]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
13:59:19.628 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(2125691159&lt;open&gt;)] for JPA transaction
13:59:19.631 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@27049398]
ğŸ“Š === [ì½ê¸° ì „] http-nio-8080-exec-3 ìƒíƒœ ì²´í¬ ===
ğŸ” [ì½ê¸° ì „] íŠ¸ëœì­ì…˜ ìƒíƒœ:
   â”œâ”€ í™œì„±í™”: âœ… YES
   â”œâ”€ ë™ê¸°í™”: âœ… YES
   â””â”€ ì´ë¦„: com.keencho.spring.service.TestService.test
ğŸŠâ€â™‚ï¸ [ì½ê¸° ì „] HikariCP ìƒíƒœ:
   â”œâ”€ í™œì„± ì»¤ë„¥ì…˜: 1
   â”œâ”€ ìœ íœ´ ì»¤ë„¥ì…˜: 0
   â”œâ”€ ì „ì²´ ì»¤ë„¥ì…˜: 1
   â”œâ”€ ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œ: 0
   â””â”€ ìµœëŒ€ í’€ í¬ê¸°: 1
ğŸ“Š ========================================
13:59:19.634 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2125691159&lt;open&gt;)] for JPA transaction
13:59:19.634 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
ğŸ“Š === [ì½ì€ í›„] http-nio-8080-exec-3 ìƒíƒœ ì²´í¬ ===
ğŸ” [ì½ì€ í›„] íŠ¸ëœì­ì…˜ ìƒíƒœ:
   â”œâ”€ í™œì„±í™”: âœ… YES
   â”œâ”€ ë™ê¸°í™”: âœ… YES
   â””â”€ ì´ë¦„: com.keencho.spring.service.TestService.test
ğŸŠâ€â™‚ï¸ [ì½ì€ í›„] HikariCP ìƒíƒœ:
   â”œâ”€ í™œì„± ì»¤ë„¥ì…˜: 1
   â”œâ”€ ìœ íœ´ ì»¤ë„¥ì…˜: 0
   â”œâ”€ ì „ì²´ ì»¤ë„¥ì…˜: 1
   â”œâ”€ ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œ: 0
   â””â”€ ìµœëŒ€ í’€ í¬ê¸°: 1
ğŸ“Š ========================================
13:59:19.703 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
13:59:19.704 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(2125691159&lt;open&gt;)]
13:59:19.705 DEBUG [http-nio-8080-exec-3] o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(2125691159&lt;open&gt;)] after transaction
ğŸŸ¢ [13:59:19.705] http-nio-8080-exec-3 - ìš”ì²­ ì™„ë£Œ (ì†Œìš”: 79ms)
</pre></table></code></div></div><p>ê²°ê³¼ëŠ” ìœ„ì™€ ê°™ë‹¤. http ìš”ì²­ì´ ë“¤ì–´ì˜¤ê³  <code class="language-plaintext highlighter-rouge">testService.test()</code> ë©”ì†Œë“œë¥¼ íƒ”ì„ë•Œ íŠ¸ëœì­ì…˜ì´ ìƒì„±ëœë‹¤. ê·¸ í›„ <code class="language-plaintext highlighter-rouge">authRepository.findAll()</code> ìˆ˜í–‰ì‹œ ê¸°ì¡´ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•˜ê³  ë©”ì†Œë“œê°€ ì¢…ë£Œë ë•Œ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ê³  ì¢…ë£Œí•œë‹¤.</p><p>ì •ë¦¬í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>@Transactional ìˆìŒ:
ë©”ì†Œë“œ ì‹œì‘ â†’ [ì»¤ë„¥ì…˜ íšë“] â†’ DBì‘ì—…1 â†’ DBì‘ì—…2 â†’ [ì»¤ë„¥ì…˜ ë°˜ë‚©] â† ë©”ì†Œë“œ ë
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì­‰ í™€ë”© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

@Transactional ì—†ìŒ:
ë©”ì„œë“œ ì‹œì‘ â†’ [íšë“â†’ë°˜ë‚©] â†’ [íšë“â†’ë°˜ë‚©] â†’ ë©”ì„œë“œ ë
              DBì‘ì—…1      DBì‘ì—…2

ì„±ëŠ¥ ì˜í–¥:
- @Transactional: ì»¤ë„¥ì…˜ í™€ë”© ì‹œê°„ â†‘, DB ì‘ì—… ì¼ê´€ì„± âœ“
- ì—†ìŒ: ì»¤ë„¥ì…˜ íšë“/ë°˜ë‚© ì˜¤ë²„í—¤ë“œ â†‘, ê°œë³„ ì»¤ë°‹
</pre></table></code></div></div><h2 id="transactional-rollback"><span class="mr-2"><strong>@Transactional rollback</strong></span><a href="#transactional-rollback" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>ë¡¤ë°± ì²˜ë¦¬ì— ëŒ€í•œ ì „ëµì„ ì˜ ì„¸ì›Œì•¼ í•œë‹¤. í•œ íŠ¸ëœì­ì…˜ ë²”ìœ„ ë‚´ì—ì„œ <code class="language-plaintext highlighter-rouge">Unchecked Exception</code>ì´ ë°œìƒí•˜ë©´ ìë™ ë¡¤ë°±ë˜ì§€ë§Œ, <code class="language-plaintext highlighter-rouge">Checked Exception</code>ì€ ê¸°ë³¸ì ìœ¼ë¡œ ì»¤ë°‹ëœë‹¤. ì´ëŠ” ê¸°ë³¸ì ì¸ ê°œë…ì´ê³ , @Transactionalì„ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠëƒì— ë”°ë¼ ë™ì‘ì´ ì–´ë–»ê²Œ ë‹¬ë¼ì§€ëŠ”ì§€ í™•ì‹¤íˆ ì•Œì•„ì•¼ í•œë‹¤.</p><h5 id="transactionaspectsupportì˜-ë™ì‘-ì›ë¦¬"><span class="mr-2"><strong><em>TransactionAspectSupportì˜ ë™ì‘ ì›ë¦¬</em></strong></span><a href="#transactionaspectsupportì˜-ë™ì‘-ì›ë¦¬" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p><code class="language-plaintext highlighter-rouge">TransactionAspectSupport</code>ëŠ” <code class="language-plaintext highlighter-rouge">@Transactional</code>ì´ ë¶™ì€ ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•  ë•Œ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” í•µì‹¬ í´ë˜ìŠ¤ì´ë‹¤. Springì€ AOP í”„ë¡ì‹œ íŒ¨í„´ì„ í†µí•´ ì‹¤ì œ ë©”ì„œë“œ í˜¸ì¶œ ì „í›„ë¡œ íŠ¸ëœì­ì…˜ ì‹œì‘, ì»¤ë°‹, ë¡¤ë°± ë¡œì§ì„ ì‚½ì…í•œë‹¤.</p><p><strong>Unchecked Exception ë¡¤ë°± ì •ì±…</strong></p><ul><li><strong>Unchecked Exception</strong> (RuntimeException, Error): ìë™ ë¡¤ë°±<li><strong>Checked Exception</strong> (IOException, SQLException ë“±): ë¡¤ë°± ì•ˆí•¨</ul><p>ì´ëŠ” Unchecked Exceptionì´ ì˜ˆìƒì¹˜ ëª»í•œ í”„ë¡œê·¸ë˜ë° ì˜¤ë¥˜ë‚˜ ì‹œìŠ¤í…œ ì¥ì• ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë°˜ë©´, Checked Exceptionì€ ì˜ˆìƒ ê°€ëŠ¥í•œ ìƒí™©ìœ¼ë¡œ ê°œë°œìê°€ ì˜ë„ì ì¸ ì˜ˆì™¸ ì²˜ë¦¬ ë¡œì§ì„ ì‘ì„±í–ˆì„ ê°€ëŠ¥ì„±ì´ ë†’ê¸° ë•Œë¬¸ì´ë‹¤.</p><p><strong>try-catchë¡œ ê°ì‹¸ë„ ë¡¤ë°±ë˜ëŠ” ì´ìœ </strong><br /> <code class="language-plaintext highlighter-rouge">RuntimeException</code>ì´ ë°œìƒí•˜ëŠ” ìˆœê°„ Springì€ í˜„ì¬ íŠ¸ëœì­ì…˜ì„ â€œrollback-onlyâ€ ìƒíƒœë¡œ ë§ˆí‚¹í•œë‹¤. ì´í›„ try-catchë¡œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•´ì„œ ë©”ì„œë“œê°€ ì •ìƒ ì¢…ë£Œë˜ì–´ë„, ì´ë¯¸ ë§ˆí‚¹ëœ íŠ¸ëœì­ì…˜ì€ ìµœì¢…ì ìœ¼ë¡œ ë¡¤ë°±ëœë‹¤. íŠ¸ëœì­ì…˜ ìƒíƒœëŠ” ì˜ˆì™¸ ë°œìƒ ì‹œì ì— ê²°ì •ë˜ë©°, ì˜ˆì™¸ ì²˜ë¦¬ ì—¬ë¶€ëŠ” ì´ ê²°ì •ì„ ë°”ê¾¸ì§€ ëª»í•œë‹¤.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">authorRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">Author</span><span class="o">(</span><span class="s">"í™ê¸¸ë™"</span><span class="o">));</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">actionService</span><span class="o">.</span><span class="na">doAction</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">ignored</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doAction</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="o">(</span><span class="s">"Error"</span><span class="o">);</span>   <span class="c1">// Checked Exception: ë¡¤ë°± ì•ˆí•¨</span>
<span class="o">}</span>

<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doAction</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Error"</span><span class="o">);</span>    <span class="c1">// Unchecked Exception: ìë™ ë¡¤ë°± </span>
<span class="o">}</span>
</pre></table></code></div></div><h5 id="requires_newë¥¼-í™œìš©í•œ-ë…ë¦½-íŠ¸ëœì­ì…˜"><span class="mr-2"><strong><em>REQUIRES_NEWë¥¼ í™œìš©í•œ ë…ë¦½ íŠ¸ëœì­ì…˜</em></strong></span><a href="#requires_newë¥¼-í™œìš©í•œ-ë…ë¦½-íŠ¸ëœì­ì…˜" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p><code class="language-plaintext highlighter-rouge">@Transactional(propagation = Propagation.REQUIRES_NEW)</code>ë¥¼ ì‚¬ìš©í•˜ë©´ ë³„ë„ì˜ ë…ë¦½ì ì¸ íŠ¸ëœì­ì…˜ì´ ìƒì„±ëœë‹¤. ì´ ê²½ìš° ë‚´ë¶€ íŠ¸ëœì­ì…˜ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ í•´ë‹¹ íŠ¸ëœì­ì…˜ë§Œ ë¡¤ë°±ë˜ê³ , ì™¸ë¶€ íŠ¸ëœì­ì…˜ì€ ì˜í–¥ë°›ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ ë¡œê·¸ ì €ì¥ì´ë‚˜ ê°ì‚¬(audit) ê¸°ë¡ì²˜ëŸ¼ ë©”ì¸ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤íŒ¨ì™€ ê´€ê³„ì—†ì´ ë°˜ë“œì‹œ ì €ì¥ë˜ì–´ì•¼ í•˜ëŠ” ë°ì´í„°ì— í™œìš©í•  ìˆ˜ ìˆë‹¤.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">propagation</span> <span class="o">=</span> <span class="nc">Propagation</span><span class="o">.</span><span class="na">REQUIRES_NEW</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doAction</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Error"</span><span class="o">);</span>    <span class="c1">// Unchecked Exception: ìë™ ë¡¤ë°± </span>
<span class="o">}</span>
</pre></table></code></div></div><p>ê·¸ëŸ¬ë‚˜ ì´ëŠ” ì»¤ë„¥ì…˜ í’€ì—ì„œ ìƒˆë¡œìš´ ì»¤ë„¥ì…˜ì„ ì–»ì–´ì˜¨ë‹¤ëŠ” ì˜ë¯¸ì´ê¸° ë•Œë¬¸ì—, REQUIRES_NEWê°€ ë¶™ì€ ë©”ì†Œë“œë¥¼ ë°˜ë³µë¬¸ì„ í†µí•´ í˜¸ì¶œí•œë‹¤ë©´ ë¡œì§ì— ë”°ë¼ ì»¤ë„¥ì…˜ í’€ì´ ê³ ê°ˆë˜ì–´ íƒ€ì„ì•„ì›ƒì´ë‚˜ ëŒ€ê¸° ìƒí™©ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤. íŠ¹íˆ ì™¸ë¶€ íŠ¸ëœì­ì…˜ì´ ì»¤ë„¥ì…˜ì„ ì ìœ í•œ ìƒíƒœì—ì„œ ë‚´ë¶€ì ìœ¼ë¡œ ì—¬ëŸ¬ ê°œì˜ ë…ë¦½ íŠ¸ëœì­ì…˜ì„ ë™ì‹œì— ìƒì„±í•˜ë ¤ í•  ë•Œ ì£¼ì˜í•´ì•¼ í•œë‹¤.</p><h5 id="ë™ì¼í•œ-í´ë˜ìŠ¤-ë‚´ë¶€-í˜¸ì¶œ-ì‹œ-transactional-ë¬´ì‹œ"><span class="mr-2"><strong><em>ë™ì¼í•œ í´ë˜ìŠ¤ ë‚´ë¶€ í˜¸ì¶œ ì‹œ @Transactional ë¬´ì‹œ</em></strong></span><a href="#ë™ì¼í•œ-í´ë˜ìŠ¤-ë‚´ë¶€-í˜¸ì¶œ-ì‹œ-transactional-ë¬´ì‹œ" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">authorRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">Author</span><span class="o">(</span><span class="s">"í™ê¸¸ë™"</span><span class="o">));</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">doAction</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">ignored</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doAction</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Error"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>ì™¸ë¶€ì—ì„œ save() í˜¸ì¶œ ì‹œ í”„ë¡ì‹œë¥¼ í†µí•´ íŠ¸ëœì­ì…˜ì´ ì‹œì‘ë˜ì§€ë§Œ, this.doAction() í˜¸ì¶œì€ ì§ì ‘ì ì¸ Java ë©”ì„œë“œ í˜¸ì¶œì´ë¯€ë¡œ Spring í”„ë¡ì‹œê°€ ê°œì…í•  ìˆ˜ ì—†ë‹¤. ë”°ë¼ì„œ doAction()ì˜ @Transactionalì€ ë¬´ì‹œë˜ê³  Unchecked Exceptionì´ ë°œìƒí•´ë„ ë¡¤ë°±ë˜ì§€ ì•ŠëŠ”ë‹¤.</p><p>ë¡¤ë°±ì´ ë˜ì–´ì•¼ í•œë‹¤ë©´ ë‹¤ìŒ ë°©ë²•ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ë©´ ëœë‹¤.</p><ol><li>try-catch ì œê±°<li>ìˆ˜ë™ ë¡¤ë°± (TransactionAspectSupport.currentTransactionStatus().setRollbackOnly())<li>ë³„ë„ ì„œë¹„ìŠ¤ë¡œ ë¶„ë¦¬<li>Self Injection ì‚¬ìš© (allow-circular-references: true í•„ìš”)<li>AspectJ ìœ„ë¹™ ì‚¬ìš© (ë¹„ì¶”ì²œ)</ol><h5 id="transactional-ìœ ë¬´ì—-ë”°ë¥¸-ì°¨ì´ì "><span class="mr-2"><strong><em>@Transactional ìœ ë¬´ì— ë”°ë¥¸ ì°¨ì´ì </em></strong></span><a href="#transactional-ìœ ë¬´ì—-ë”°ë¥¸-ì°¨ì´ì " class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p><code class="language-plaintext highlighter-rouge">doAction()</code>ì— <code class="language-plaintext highlighter-rouge">@Transactional</code>ì´ ìˆë“  ì—†ë“  Repository í˜¸ì¶œ ì‹œ ê¸°ì¡´ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•˜ëŠ” ê±´ ë™ì¼í•˜ë‹¤. í•˜ì§€ë§Œ ì˜ˆì™¸ ì²˜ë¦¬ì—ì„œ ì¤‘ìš”í•œ ì°¨ì´ê°€ ìˆë‹¤.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">authorRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">Author</span><span class="o">(</span><span class="s">"í™ê¸¸ë™"</span><span class="o">));</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">actionService</span><span class="o">.</span><span class="na">doAction</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">ignored</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doAction</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">authorRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">Author</span><span class="o">(</span><span class="s">"ê±°ë¶ì´"</span><span class="o">));</span> <span class="c1">// ê¸°ì¡´ íŠ¸ëœì­ì…˜ ì°¸ì—¬</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Error"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>doAction()ì— @Transactionalì´ ì—†ë‹¤. ê·¸ë˜ë„ ë‘ ë°ì´í„° ëª¨ë‘ ì €ì¥ëœë‹¤. RuntimeExceptionì´ ë°œìƒí•´ë„ ë‹¨ìˆœíˆ ìƒìœ„ë¡œ ì „íŒŒë  ë¿ì´ë‹¤. try-catchë¡œ ì¡ìœ¼ë©´ <code class="language-plaintext highlighter-rouge">save()</code> ë©”ì„œë“œê°€ ì •ìƒ ì¢…ë£Œëœ ê²ƒìœ¼ë¡œ ì¸ì‹í•˜ê³  íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤.</p><p>@Transactionalì´ ìˆëŠ” ê²½ìš° RuntimeException ë°œìƒ ì‹œ Springì´ í˜„ì¬ íŠ¸ëœì­ì…˜ì„ <strong>â€œrollback-onlyâ€ë¡œ ë§ˆí‚¹</strong>í•œë‹¤. ì´í›„ try-catchë¡œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•´ì„œ <code class="language-plaintext highlighter-rouge">save()</code> ë©”ì„œë“œê°€ ì •ìƒ ì¢…ë£Œë˜ì–´ë„, Springì´ ì»¤ë°‹ì„ ì‹œë„í•  ë•Œ â€œrollback-onlyâ€ ë§ˆí‚¹ì„ ë°œê²¬í•˜ê³  <code class="language-plaintext highlighter-rouge">UnexpectedRollbackException</code>ì„ ë˜ì§„ë‹¤.</p><p><strong>ì™œ ì´ëŸ° ì°¨ì´ê°€ ë°œìƒí• ê¹Œ?</strong></p><p>Springì˜ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ë°©ì‹ì„ ì‚´í´ë³´ì.</p><ol><li><strong>@Transactional ì—†ëŠ” ê²½ìš°:</strong> <code class="language-plaintext highlighter-rouge">doAction()</code>ì€ ë‹¨ìˆœí•œ Java ë©”ì„œë“œë‹¤. Repository í˜¸ì¶œí•  ë•Œë§Œ ê¸°ì¡´ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•œë‹¤. RuntimeExceptionì´ ë°œìƒí•´ë„ Springì€ ì´ë¥¼ â€œíŠ¸ëœì­ì…˜ì  ì˜¤ë¥˜â€ë¡œ ì¸ì‹í•˜ì§€ ì•ŠëŠ”ë‹¤. ë‹¨ì§€ ì¼ë°˜ì ì¸ ì˜ˆì™¸ì¼ ë¿ì´ê³ , try-catchë¡œ ì²˜ë¦¬ë˜ë©´ ì•„ë¬´ ë¬¸ì œì—†ì´ ì»¤ë°‹í•œë‹¤.<li><strong>@Transactional ìˆëŠ” ê²½ìš°:</strong> <code class="language-plaintext highlighter-rouge">doAction()</code>ë„ íŠ¸ëœì­ì…˜ ê´€ë¦¬ ëŒ€ìƒì´ ëœë‹¤. Spring AOPê°€ ë©”ì„œë“œë¥¼ ê°ì‹¸ì„œ ì˜ˆì™¸ë¥¼ ëª¨ë‹ˆí„°ë§í•œë‹¤. RuntimeException ë°œìƒ ì‹œ â€œì´ íŠ¸ëœì­ì…˜ì€ ë¬¸ì œê°€ ìˆë‹¤â€ê³  ë§ˆí‚¹í•´ë‘”ë‹¤. ì´í›„ ìƒìœ„ì—ì„œ try-catchë¡œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•´ë„ Springì€ â€œì–´? ë¬¸ì œê°€ ìˆì—ˆëŠ”ë° ì»¤ë°‹í•˜ë ¤ê³  í•˜ë„¤?â€ë¼ê³  ì¸ì‹í•˜ê³  <code class="language-plaintext highlighter-rouge">UnexpectedRollbackException</code>ì„ ë˜ì§„ë‹¤.</ol><p>í•µì‹¬ì€ Springì´ <strong>ì–¸ì œ íŠ¸ëœì­ì…˜ ìƒíƒœë¥¼ ì¶”ì í•˜ëŠëƒ</strong>ë‹¤. @Transactionalì´ ë¶™ì–´ì•¼ë§Œ Springì´ í•´ë‹¹ ë©”ì„œë“œì˜ ì˜ˆì™¸ë¥¼ â€œíŠ¸ëœì­ì…˜ ê´€ì ì—ì„œâ€ ë°”ë¼ë³¸ë‹¤.</p><h2 id="transactionalreadonly--true"><span class="mr-2"><strong>@Transactional(readOnly = true)</strong></span><a href="#transactionalreadonly--true" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>ê°œë°œì„ í•˜ë‹¤ ë³´ë©´ ë‹¨ìˆœí•œ ì¡°íšŒ ë©”ì„œë“œì— @Transactional(readOnly = true)ë¥¼ ë¶™ì¼ì§€ ë§ì§€ ê³ ë¯¼í•˜ê²Œ ëœë‹¤. íŠ¹íˆ OSIVë¥¼ ë¹„í™œì„±í™”í•œ í™˜ê²½ì—ì„œëŠ” ì´ ì„ íƒì´ ë”ìš± ì¤‘ìš”í•˜ë‹¤.</p><p>PostgreSQL í™˜ê²½ì—ì„œ ì‹¤ì œ ì¿¼ë¦¬ ë¡œê·¸ë¥¼ í†µí•´ ë‘ ë°©ì‹ì˜ ì°¨ì´ì ì„ ìì„¸íˆ ì•Œì•„ë³´ì.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre># application.yml
spring:
  jpa:
    open-in-view: false 

# postgresql.conf
log_statement = 'all'
log_line_prefix = '%t [%p] %u@%d: '
logging_collector = on
</pre></table></code></div></div><p>ìƒí™©ë³„ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ë¡œê·¸ë¥¼ í™•ì¸í•´ ë³´ì.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">list</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
<span class="o">}</span>

<span class="o">[</span><span class="mi">37380</span><span class="o">]</span> <span class="nl">LOG:</span>  <span class="nl">statement:</span> <span class="no">BEGIN</span> <span class="no">READ</span> <span class="no">ONLY</span>
<span class="o">[</span><span class="mi">37380</span><span class="o">]</span> <span class="nl">LOG:</span>  <span class="n">execute</span> <span class="o">&lt;</span><span class="n">unnamed</span><span class="o">&gt;:</span> <span class="n">select</span> <span class="n">a1_0</span><span class="o">.</span><span class="na">id</span><span class="o">,</span><span class="n">a1_0</span><span class="o">.</span><span class="na">created_at</span><span class="o">,</span><span class="n">a1_0</span><span class="o">.</span><span class="na">name</span> <span class="n">from</span> <span class="n">author</span> <span class="n">a1_0</span>
<span class="o">[</span><span class="mi">37380</span><span class="o">]</span> <span class="nl">LOG:</span>  <span class="n">execute</span> <span class="nl">S_1:</span> <span class="no">COMMIT</span>
</pre></table></code></div></div><p>@Transactional(readOnly = true) ê°€ ë¶™ì–´ìˆëŠ” ê²½ìš° íŠ¸ëœì­ì…˜ì´ ëª…ì‹œì ìœ¼ë¡œ ì‹œì‘ë˜ê³  ì¢…ë£Œëœë‹¤. íŠ¸ëœì­ì…˜ì„ <code class="language-plaintext highlighter-rouge">READ ONLY</code> ë¡œ ì„¸íŒ…í•˜ëŠ” ì¿¼ë¦¬ì™€, ì¡°íšŒ í›„ ì»¤ë°‹í•˜ëŠ” ì¿¼ë¦¬ê°€ ì¶”ê°€ë¡œ ë‚ ë¼ê°„ë‹¤.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">list</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findAllNonTransactional</span><span class="o">();</span>
    
    <span class="c1">// @Query(value = "SELECT a FROM Author a")</span>
    <span class="c1">// List&lt;Author&gt; findAllNonTransactional();</span>
<span class="o">}</span>
 
<span class="o">[</span><span class="mi">26408</span><span class="o">]</span> <span class="nl">LOG:</span>  <span class="n">execute</span> <span class="o">&lt;</span><span class="n">unnamed</span><span class="o">&gt;:</span> <span class="n">select</span> <span class="n">a1_0</span><span class="o">.</span><span class="na">id</span><span class="o">,</span><span class="n">a1_0</span><span class="o">.</span><span class="na">created_at</span><span class="o">,</span><span class="n">a1_0</span><span class="o">.</span><span class="na">name</span> <span class="n">from</span> <span class="n">author</span> <span class="n">a1_0</span>
</pre></table></code></div></div><p>ì–´ë…¸í…Œì´ì…˜ì´ ì—†ëŠ” ê²½ìš° autocommit ëª¨ë“œë¡œ ë™ì‘í•˜ì—¬ ë‹¨ì¼ ì¿¼ë¦¬ë§Œ ì‹¤í–‰ëœë‹¤.</p><blockquote><p><code class="language-plaintext highlighter-rouge">CrudRepository</code> ì¸í„°í˜ì´ìŠ¤ì— ì •ì˜ëœ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ê²½ìš° êµ¬í˜„ì²´ì¸ <code class="language-plaintext highlighter-rouge">SimpleJpaRepository</code> í´ë˜ìŠ¤ì— @Transactional(readOnly = true) ê°€ ë¶™ì–´ìˆê¸° ë•Œë¬¸ì— ê¸°ë³¸ì ìœ¼ë¡œ readOnly ëª¨ë“œë¡œ ë™ì‘í•œë‹¤.</p></blockquote><h5 id="ê¸°ëŠ¥ë³„-ìƒì„¸-ë¹„êµ"><span class="mr-2"><strong><em>ê¸°ëŠ¥ë³„ ìƒì„¸ ë¹„êµ</em></strong></span><a href="#ê¸°ëŠ¥ë³„-ìƒì„¸-ë¹„êµ" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p><strong>Hibernate ì¸¡ë©´</strong><br /> <em>@Transactional(readOnly = true)</em><br /> ì¥ì </p><ul><li>1ì°¨ ìºì‹œ í™œìš©: ë™ì¼í•œ ì—”í‹°í‹°ë¥¼ ì—¬ëŸ¬ ë²ˆ ì¡°íšŒí•´ë„ ìºì‹œì—ì„œ ê°€ì ¸ì˜¨ë‹¤<li>Lazy Loading ì§€ì›: ì—°ê´€ê´€ê³„ ì—”í‹°í‹°ë¥¼ í•„ìš”í•  ë•Œ ë¡œë“œí•  ìˆ˜ ìˆë‹¤<li>FlushMode.MANUAL: ë¶ˆí•„ìš”í•œ flush ì‘ì—…ì„ ë°©ì§€í•œë‹¤</ul><p>ë‹¨ì </p><ul><li>ì„¸ì…˜ ì¥ê¸° ë³´ìœ : ë©”ì„œë“œ ì‹¤í–‰ ë™ì•ˆ Hibernate ì„¸ì…˜ì„ ê³„ì† ìœ ì§€í•œë‹¤<li>ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€: 1ì°¨ ìºì‹œì™€ ì„¸ì…˜ ì»¨í…ìŠ¤íŠ¸ë¡œ ì¸í•œ ë©”ëª¨ë¦¬ ì˜¤ë²„í—¤ë“œ</ul><p><em>ì–´ë…¸í…Œì´ì…˜ ì œê±°</em><br /> ì¥ì </p><ul><li>ì¦‰ì‹œ ì„¸ì…˜ í•´ì œ: ì¿¼ë¦¬ ì‹¤í–‰ í›„ ë°”ë¡œ ì„¸ì…˜ì„ ì •ë¦¬í•œë‹¤<li>ìµœì†Œ ë©”ëª¨ë¦¬ ì‚¬ìš©: ì„¸ì…˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì˜¤ë˜ ë³´ìœ í•˜ì§€ ì•ŠëŠ”ë‹¤</ul><p>ë‹¨ì </p><ul><li>Lazy Loading ë¶ˆê°€: LazyInitializationException ë°œìƒ ìœ„í—˜<li>1ì°¨ ìºì‹œ ë¯¸í™œìš©: ë™ì¼í•œ ì—”í‹°í‹°ë¥¼ ì—¬ëŸ¬ ë²ˆ ì¡°íšŒí•˜ë©´ ë§¤ë²ˆ DB ì¿¼ë¦¬<li>ì„¸ì…˜ ì¬ìƒì„±: ë§¤ë²ˆ ìƒˆë¡œìš´ ì„¸ì…˜ì„ ìƒì„±í•˜ëŠ” ë¹„ìš©</ul><p><strong>Spring ì¸¡ë©´ (í”„ë¡ì‹œ)</strong><br /> <em>@Transactional(readOnly = true)</em><br /> ì¥ì </p><ul><li>AOP ê¸°ëŠ¥ í™œìš©: ë¡œê¹…, ëª¨ë‹ˆí„°ë§ ë“± íš¡ë‹¨ ê´€ì‹¬ì‚¬ ì²˜ë¦¬<li>íŠ¸ëœì­ì…˜ ì „íŒŒ ê·œì¹™: ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ê³¼ì˜ ìƒí˜¸ì‘ìš©ì„ ëª…í™•í•˜ê²Œ ì •ì˜<li>ì¼ê´€ëœ ì˜ˆì™¸ ì²˜ë¦¬: Springì˜ íŠ¸ëœì­ì…˜ ì˜ˆì™¸ ë³€í™˜ ê¸°ëŠ¥ í™œìš©</ul><p>ë‹¨ì </p><ul><li>í”„ë¡ì‹œ ìƒì„± ë¹„ìš©: Spring AOP í”„ë¡ì‹œ ìƒì„±ê³¼ ê´€ë¦¬ ë¹„ìš©<li>ì¸í„°ì…‰í„° ì²´ì¸ ì‹¤í–‰: ë©”ì„œë“œ í˜¸ì¶œ ì‹œë§ˆë‹¤ ì¸í„°ì…‰í„° ì²´ì¸ì„ ê±°ì¹¨<li>ë©”ëª¨ë¦¬ ì˜¤ë²„í—¤ë“œ: í”„ë¡ì‹œ ê°ì²´ì™€ ê´€ë ¨ ë©”íƒ€ë°ì´í„°</ul><p><em>ì–´ë…¸í…Œì´ì…˜ ì œê±°</em><br /> ì¥ì </p><ul><li>í”„ë¡ì‹œ ì˜¤ë²„í—¤ë“œ ì—†ìŒ: ì§ì ‘ì ì¸ ë©”ì„œë“œ í˜¸ì¶œ<li>ë©”ëª¨ë¦¬ íš¨ìœ¨ì : í”„ë¡ì‹œ ê´€ë ¨ ë©”ëª¨ë¦¬ ì‚¬ìš© ì—†ìŒ<li>ë‹¨ìˆœí•œ ì‹¤í–‰ íë¦„: ë³µì¡í•œ AOP ì²˜ë¦¬ ê³¼ì •ì´ ì—†ìŒ</ul><p>ë‹¨ì </p><ul><li>Spring AOP ê¸°ëŠ¥ ë¯¸ì‚¬ìš©: íš¡ë‹¨ ê´€ì‹¬ì‚¬ ì²˜ë¦¬ ë¶ˆê°€ëŠ¥<li>íŠ¸ëœì­ì…˜ ê´€ë¦¬ ë¶ˆê°€: ëª…ì‹œì ì¸ íŠ¸ëœì­ì…˜ ì œì–´ ì—†ìŒ</ul><p><strong>PostgreSQL ì¸¡ë©´</strong></p><p><em>BEGIN READ ONLY vs autocommit</em></p><p>PostgreSQLì—ì„œ BEGIN READ ONLYëŠ” ë‹¨ìˆœí•œ í”Œë˜ê·¸ ì„¤ì •ì´ ì•„ë‹ˆë¼ ì‹¤ì œë¡œ ë‹¤ìŒê³¼ ê°™ì€ ìµœì í™”ë¥¼ ì œê³µí•œë‹¤.</p><ul><li>WAL ìƒì„± ë°©ì§€: Write-Ahead Logë¥¼ ìƒì„±í•˜ì§€ ì•Šì•„ I/O ë¶€í•˜ ê°ì†Œ<li>ë½ íšë“ íšŒí”¼: ë¶ˆí•„ìš”í•œ ë½ ìš”ì²­ì„ í•˜ì§€ ì•ŠìŒ<li>ë‚´ë¶€ ìµœì í™”: PostgreSQLì´ ì½ê¸° ì „ìš©ì„ì„ ì•Œê³  ì—¬ëŸ¬ ìµœì í™” ìˆ˜í–‰</ul><p>ë°˜ë©´ autocommit ëª¨ë“œëŠ”</p><ul><li>ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œ ìµœì†Œí™”: ë‹¨ì¼ ì¿¼ë¦¬ë§Œ ì „ì†¡<li>ì»¤ë„¥ì…˜ ì¦‰ì‹œ ë°˜í™˜: ì¿¼ë¦¬ ì‹¤í–‰ í›„ ë°”ë¡œ ì»¤í…ì…˜ í’€ì— ë°˜í™˜</ul><p>ìœ„ì™€ê°™ì€ íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆë‹¤.</p><h5 id="ì„±ëŠ¥-ë¹„êµ"><span class="mr-2"><strong><em>ì„±ëŠ¥ ë¹„êµ</em></strong></span><a href="#ì„±ëŠ¥-ë¹„êµ" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p>ì¼ë°˜ì ìœ¼ë¡œ ë‹¨ìˆœ ì¡°íšŒì—ì„œëŠ” ì–´ë…¸í…Œì´ì…˜ ì œê±°ê°€ ë” ë¹ ë¥¸ ê²½ìš°ê°€ ë§ì§€ë§Œ, ë³µì¡í•œ ë¡œì§ì—ì„œëŠ” íŠ¸ëœì­ì…˜ì˜ ì´ì ì´ ì„±ëŠ¥ ì˜¤ë²„í—¤ë“œë¥¼ ìƒì‡„í•œë‹¤.</p><h5 id="ê²°ë¡ -ë°-ê¶Œì¥ì‚¬í•­"><span class="mr-2"><strong><em>ê²°ë¡  ë° ê¶Œì¥ì‚¬í•­</em></strong></span><a href="#ê²°ë¡ -ë°-ê¶Œì¥ì‚¬í•­" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p><strong>@Transactional(readOnly = true) ì–¸ì œ ì‚¬ìš©í• ê¹Œ?</strong></p><ul><li>ì—°ê´€ê´€ê³„(Lazy Loading)ê°€ í•„ìš”í•œ ëª¨ë“  ê²½ìš°<li>ì—¬ëŸ¬ ì¿¼ë¦¬ì˜ ì¼ê´€ì„±ì´ ì¤‘ìš”í•œ ê²½ìš°<li>ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ìˆëŠ” ê²½ìš°<li>Springì˜ íŠ¸ëœì­ì…˜ ê´€ë¦¬ ê¸°ëŠ¥ì„ í™œìš©í•˜ê³  ì‹¶ì€ ê²½ìš°</ul><p><strong>ì´ëŸ´ë•ŒëŠ” ì œê±°í•´ë„ ë˜ì§€ ì•Šì„ê¹Œ?</strong></p><ul><li>ì™„ì „íˆ ë‹¨ìˆœí•œ ë‹¨ì¼ ì¡°íšŒ (ì—°ê´€ê´€ê³„ ì—†ìŒ)<li>DTO í”„ë¡œì ì…˜ë§Œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°<li>ê·¹ë„ì˜ ì„±ëŠ¥ ìµœì í™”ê°€ í•„ìš”í•œ ê²½ìš°<li>ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ì—ì„œ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±ì´ ì¤‘ìš”í•œ ê²½ìš°</ul><h5 id="ê°œì¸ì ì¸-ìƒê°-postgresql-ê¸°ì¤€"><span class="mr-2"><strong><em>ê°œì¸ì ì¸ ìƒê° (PostgreSQL ê¸°ì¤€)</em></strong></span><a href="#ê°œì¸ì ì¸-ìƒê°-postgresql-ê¸°ì¤€" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><ol><li>ì•ˆì „ì„±: Lazy Loading ê´€ë ¨ ì˜ˆì™¸ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆë‹¤<li>í™•ì¥ì„±: ë‚˜ì¤‘ì— ì—°ê´€ê´€ê³„ë‚˜ ë³µì¡í•œ ë¡œì§ì´ ì¶”ê°€ë˜ì–´ë„ ì•ˆì „í•˜ë‹¤<li>ì¼ê´€ì„±: íŒ€ ì „ì²´ê°€ ë™ì¼í•œ íŒ¨í„´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤<li>PostgreSQL ìµœì í™”: READ ONLY ëª¨ë“œì˜ ì´ì ì„ í™œìš©í•  ìˆ˜ ìˆë‹¤</ol><p>ì„±ëŠ¥ì´ ì •ë§ ì¤‘ìš”í•œ íŠ¹ì • APIì—ë§Œ ì„ ë³„ì ìœ¼ë¡œ ì–´ë…¸í…Œì´ì…˜ì„ ì œê±°í•˜ê³ , ë‚˜ë¨¸ì§€ëŠ” @Transactional(readOnly = true)ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ í˜„ì‹¤ì ì¸ê²ƒ ê°™ë‹¤. ì‹¤ì œ ì„±ëŠ¥ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ íŠ¹ì„±, ë°ì´í„° í¬ê¸°, ì¸í”„ë¼ í™˜ê²½ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ, ì¤‘ìš”í•œ ê²°ì •ì„ ë‚´ë¦¬ê¸° ì „ì—ëŠ” í•­ìƒ ì‹¤ì œ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸í•´ë³´ëŠ” ê²ƒì„ ìŠì§€ ë§ì.</p><h2 id="ê²©ë¦¬-ìˆ˜ì¤€isolation-level-ì‹¤ì „-í™œìš©"><span class="mr-2"><strong>ê²©ë¦¬ ìˆ˜ì¤€(Isolation Level) ì‹¤ì „ í™œìš©</strong></span><a href="#ê²©ë¦¬-ìˆ˜ì¤€isolation-level-ì‹¤ì „-í™œìš©" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>ê²©ë¦¬ ìˆ˜ì¤€ì€ ë™ì‹œ íŠ¸ëœì­ì…˜ ê°„ì˜ ë°ì´í„° ì¼ê´€ì„±ì„ ì–¼ë§ˆë‚˜ ì—„ê²©í•˜ê²Œ ë³´ì¥í• ì§€ë¥¼ ê²°ì •í•œë‹¤. PostgreSQLì˜ ê¸°ë³¸ ê²©ë¦¬ ìˆ˜ì¤€ì€ <code class="language-plaintext highlighter-rouge">READ_COMMITTED</code>ì´ë©°, ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ì ì ˆí•œ ìˆ˜ì¤€ì„ ì„ íƒí•´ì•¼ í•œë‹¤.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">READ_COMMITTED</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">readCommittedTest</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// PostgreSQL ê¸°ë³¸ ê²©ë¦¬ ìˆ˜ì¤€ - ì„±ëŠ¥ ìš°ì„ </span>
<span class="o">}</span>

<span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">REPEATABLE_READ</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">repeatableReadTest</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// ì¼ê´€ì„± ìš°ì„  - Snapshot Isolation ì œê³µ</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>ê²©ë¦¬ ìˆ˜ì¤€ë³„ í˜„ìƒê³¼ ë¬¸ì œì </strong></p><ul><li><strong>Dirty Read:</strong> ì»¤ë°‹ë˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ì„ ì½ëŠ” í˜„ìƒ<li><strong>Non-repeatable Read:</strong> ê°™ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ë™ì¼í•œ ë°ì´í„°ë¥¼ ì¬ì¡°íšŒí•  ë•Œ ë‹¤ë¥¸ ê°’ì´ ë‚˜ì˜¤ëŠ” í˜„ìƒ<li><strong>Phantom Read:</strong> ë²”ìœ„ ì¡°ê±´ìœ¼ë¡œ ì¡°íšŒ ì‹œ ìƒˆë¡œìš´ í–‰ì´ ì¶”ê°€ë¡œ ì¡°íšŒë˜ëŠ” í˜„ìƒ</ul><h5 id="read_committed-ê¸°ë³¸ê°’"><span class="mr-2"><strong><em>READ_COMMITTED (ê¸°ë³¸ê°’)</em></strong></span><a href="#read_committed-ê¸°ë³¸ê°’" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">READ_COMMITTED</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">processOrderWithReadCommitted</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// ì²« ë²ˆì§¸ ì¡°íšŒ</span>
    <span class="kt">var</span> <span class="n">product</span> <span class="o">=</span> <span class="n">productRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ì²« ë²ˆì§¸ ì¬ê³ : "</span> <span class="o">+</span> <span class="n">product</span><span class="o">.</span><span class="na">getStock</span><span class="o">());</span> <span class="c1">// 100</span>

    <span class="c1">// ì´ ì‹œì ì— ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ì¬ê³ ë¥¼ 50ìœ¼ë¡œ ë³€ê²½í•˜ê³  ì»¤ë°‹</span>

    <span class="c1">// ë‘ ë²ˆì§¸ ì¡°íšŒ - ë³€ê²½ëœ ê°’ ì½ìŒ (Non-repeatable Read ë°œìƒ)</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">productRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ë‘ ë²ˆì§¸ ì¬ê³ : "</span> <span class="o">+</span> <span class="n">product</span><span class="o">.</span><span class="na">getStock</span><span class="o">());</span> <span class="c1">// 50</span>

    <span class="c1">// ë¬¸ì œ: ê°™ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ë°ì´í„°ê°€ ë‹¬ë¼ì§</span>
    <span class="c1">// ì²« ë²ˆì§¸ ì¡°íšŒë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì‘ì„±í–ˆë‹¤ë©´ ë¬¸ì œê°€ ë  ìˆ˜ ìˆìŒ</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>READ_COMMITTED íŠ¹ì§•:</strong></p><ul><li><strong>Dirty Read ë°©ì§€:</strong> ì»¤ë°‹ëœ ë°ì´í„°ë§Œ ì½ìŒ<li><strong>Non-repeatable Read í—ˆìš©:</strong> ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì˜ ì»¤ë°‹ëœ ë³€ê²½ì‚¬í•­ì´ ì¤‘ê°„ì— ë³´ì„<li><strong>Phantom Read í—ˆìš©:</strong> ë²”ìœ„ ì¡°ê±´ì—ì„œ ìƒˆë¡œìš´ í–‰ì´ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìŒ<li><strong>ì„±ëŠ¥:</strong> ê°€ì¥ ë†’ìŒ (ì ê¸ˆì´ ì ìŒ)<li><strong>ì‚¬ìš© ì‹œê¸°:</strong> ì„±ëŠ¥ì´ ì¤‘ìš”í•˜ê³  ì•½ê°„ì˜ ë°ì´í„° ë¶ˆì¼ì¹˜ë¥¼ í—ˆìš©í•  ìˆ˜ ìˆëŠ” ê²½ìš°</ul><h5 id="repeatable_read"><span class="mr-2"><strong><em>REPEATABLE_READ</em></strong></span><a href="#repeatable_read" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">REPEATABLE_READ</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">processOrderWithRepeatableRead</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// ì²« ë²ˆì§¸ ì¡°íšŒ - ìŠ¤ëƒ…ìƒ· ìƒì„±</span>
    <span class="kt">var</span> <span class="n">product</span> <span class="o">=</span> <span class="n">productRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ì²« ë²ˆì§¸ ì¬ê³ : "</span> <span class="o">+</span> <span class="n">product</span><span class="o">.</span><span class="na">getStock</span><span class="o">());</span> <span class="c1">// 100</span>

    <span class="c1">// ì´ ì‹œì ì— ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ì¬ê³ ë¥¼ 50ìœ¼ë¡œ ë³€ê²½í•˜ê³  ì»¤ë°‹í•´ë„</span>

    <span class="c1">// ë‘ ë²ˆì§¸ ì¡°íšŒ - ìŠ¤ëƒ…ìƒ·ì— ì˜í•´ ë™ì¼í•œ ê°’ ì½ìŒ</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">productRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ë‘ ë²ˆì§¸ ì¬ê³ : "</span> <span class="o">+</span> <span class="n">product</span><span class="o">.</span><span class="na">getStock</span><span class="o">());</span> <span class="c1">// 100 (ë™ì¼)</span>

    <span class="c1">// ì¥ì : íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì¼ê´€ëœ ë°ì´í„° ë³´ì¥</span>
    <span class="c1">// ë‹¨ì : ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì˜ ë³€ê²½ì‚¬í•­ì„ ëª» ë³¼ ìˆ˜ ìˆìŒ (Lost Update ìœ„í—˜)</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>REPEATABLE_READ íŠ¹ì§•:</strong></p><ul><li><strong>Snapshot Isolation:</strong> íŠ¸ëœì­ì…˜ ì‹œì‘ ì‹œì ì˜ ë°ì´í„° ìŠ¤ëƒ…ìƒ· ìœ ì§€<li><strong>Non-repeatable Read ë°©ì§€:</strong> ë™ì¼í•œ ë°ì´í„° ë°˜ë³µ ì½ê¸° ì‹œ ì¼ê´€ì„± ë³´ì¥<li><strong>Phantom Read ì¼ë¶€ ë°©ì§€:</strong> PostgreSQLì—ì„œëŠ” ëŒ€ë¶€ë¶„ ë°©ì§€ë¨<li><strong>ì„±ëŠ¥:</strong> ì¤‘ê°„ (ìŠ¤ëƒ…ìƒ· ìœ ì§€ ì˜¤ë²„í—¤ë“œ)<li><strong>ì‚¬ìš© ì‹œê¸°:</strong> ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ ë°ì´í„° ì¼ê´€ì„±ì´ ì¤‘ìš”í•œ ê²½ìš°</ul><h5 id="ì‹¤ì œ-ë¹„ì¦ˆë‹ˆìŠ¤-í™œìš©-ì‚¬ë¡€"><span class="mr-2"><strong><em>ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ í™œìš© ì‚¬ë¡€</em></strong></span><a href="#ì‹¤ì œ-ë¹„ì¦ˆë‹ˆìŠ¤-í™œìš©-ì‚¬ë¡€" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p><strong>1. ì¬ê³  ì°¨ê° ë¡œì§ (ë™ì‹œì„± ì œì–´)</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">REPEATABLE_READ</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">OrderResult</span> <span class="nf">decreaseStock</span><span class="o">(</span><span class="nc">Long</span> <span class="n">productId</span><span class="o">,</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ ì¼ê´€ëœ ë°ì´í„° ë³´ì¥</span>
    <span class="kt">var</span> <span class="n">product</span> <span class="o">=</span> <span class="n">productRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">productId</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>

    <span class="c1">// ì¬ê³  ê²€ì¦ - íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì¼ê´€ëœ ê°’ìœ¼ë¡œ ê²€ì¦</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getStock</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">OrderResult</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="s">"ì¬ê³  ë¶€ì¡±: í˜„ì¬ "</span> <span class="o">+</span> <span class="n">product</span><span class="o">.</span><span class="na">getStock</span><span class="o">()</span> <span class="o">+</span> <span class="s">"ê°œ"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// ì¬ê³  ì°¨ê°</span>
    <span class="n">product</span><span class="o">.</span><span class="na">decreaseStock</span><span class="o">(</span><span class="n">quantity</span><span class="o">);</span>
    <span class="n">productRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>

    <span class="k">return</span> <span class="nc">OrderResult</span><span class="o">.</span><span class="na">success</span><span class="o">(</span><span class="s">"ì£¼ë¬¸ ì™„ë£Œ"</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// ì£¼ì˜: REPEATABLE_READì—ì„œë„ Lost UpdateëŠ” ë°œìƒí•  ìˆ˜ ìˆìŒ</span>
<span class="c1">// ë”°ë¼ì„œ ë‚™ê´€ì  ë½(@Version) ë˜ëŠ” ë¹„ê´€ì  ë½ ì¶”ê°€ ê³ ë ¤ í•„ìš”</span>
</pre></table></code></div></div><p><strong>2. ê¸ˆìœµ ê±°ë˜ ì²˜ë¦¬</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">REPEATABLE_READ</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">TransferResult</span> <span class="nf">transfer</span><span class="o">(</span><span class="nc">Long</span> <span class="n">fromAccountId</span><span class="o">,</span> <span class="nc">Long</span> <span class="n">toAccountId</span><span class="o">,</span> <span class="nc">BigDecimal</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ì¼ê´€ëœ ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ ê³„ì¢Œ ì •ë³´ ì¡°íšŒ</span>
    <span class="kt">var</span> <span class="n">fromAccount</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">fromAccountId</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
    <span class="kt">var</span> <span class="n">toAccount</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">toAccountId</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>

    <span class="c1">// ì”ì•¡ ê²€ì¦ - ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ ì¼ê´€ì„± ë³´ì¥</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">fromAccount</span><span class="o">.</span><span class="na">getBalance</span><span class="o">().</span><span class="na">compareTo</span><span class="o">(</span><span class="n">amount</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">TransferResult</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="s">"ì”ì•¡ ë¶€ì¡±"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// ì´ì²´ ì²˜ë¦¬</span>
    <span class="n">fromAccount</span><span class="o">.</span><span class="na">withdraw</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
    <span class="n">toAccount</span><span class="o">.</span><span class="na">deposit</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>

    <span class="n">accountRepository</span><span class="o">.</span><span class="na">saveAll</span><span class="o">(</span><span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">fromAccount</span><span class="o">,</span> <span class="n">toAccount</span><span class="o">));</span>

    <span class="k">return</span> <span class="nc">TransferResult</span><span class="o">.</span><span class="na">success</span><span class="o">(</span><span class="s">"ì´ì²´ ì™„ë£Œ"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>3. ë³´ê³ ì„œ ìƒì„± (ë°ì´í„° ì •í•©ì„±)</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">REPEATABLE_READ</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">DailySalesReport</span> <span class="nf">generateSalesReport</span><span class="o">(</span><span class="nc">LocalDate</span> <span class="n">date</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ë³´ê³ ì„œ ìƒì„± ì¤‘ ë°ì´í„° ë³€ê²½ë˜ì–´ë„ ì¼ê´€ëœ ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ ì‘ì—…</span>
    <span class="kt">var</span> <span class="n">orders</span> <span class="o">=</span> <span class="n">orderRepository</span><span class="o">.</span><span class="na">findByOrderDate</span><span class="o">(</span><span class="n">date</span><span class="o">);</span>

    <span class="c1">// ì£¼ë¬¸ ì´ì•¡ ê³„ì‚°</span>
    <span class="kt">var</span> <span class="n">totalAmount</span> <span class="o">=</span> <span class="n">orders</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Order:</span><span class="o">:</span><span class="n">getAmount</span><span class="o">)</span>
            <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">ZERO</span><span class="o">,</span> <span class="nl">BigDecimal:</span><span class="o">:</span><span class="n">add</span><span class="o">);</span>

    <span class="c1">// ì¹´í…Œê³ ë¦¬ë³„ ì§‘ê³„ - ëª¨ë‘ ë™ì¼í•œ ìŠ¤ëƒ…ìƒ· ê¸°ì¤€</span>
    <span class="kt">var</span> <span class="n">categoryStats</span> <span class="o">=</span> <span class="n">orders</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">groupingBy</span><span class="o">(</span>
                <span class="nl">Order:</span><span class="o">:</span><span class="n">getCategoryId</span><span class="o">,</span>
                <span class="nc">Collectors</span><span class="o">.</span><span class="na">summingDouble</span><span class="o">(</span><span class="n">order</span> <span class="o">-&gt;</span> <span class="n">order</span><span class="o">.</span><span class="na">getAmount</span><span class="o">().</span><span class="na">doubleValue</span><span class="o">())</span>
            <span class="o">));</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nf">DailySalesReport</span><span class="o">(</span><span class="n">date</span><span class="o">,</span> <span class="n">totalAmount</span><span class="o">,</span> <span class="n">orders</span><span class="o">.</span><span class="na">size</span><span class="o">(),</span> <span class="n">categoryStats</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>4. READ_COMMITTED ì ì ˆí•œ ì‚¬ìš© ì‚¬ë¡€</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">READ_COMMITTED</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">logUserActivity</span><span class="o">(</span><span class="nc">Long</span> <span class="n">userId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">activity</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ë¡œê¹…ì€ ì•½ê°„ì˜ ë¶ˆì¼ì¹˜ê°€ ìˆì–´ë„ ë¬´ê´€</span>
    <span class="c1">// ì„±ëŠ¥ì„ ìš°ì„ ì‹œí•˜ëŠ” ê²ƒì´ ë§ìŒ</span>
    <span class="kt">var</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">userId</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">user</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">activityLogRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">ActivityLog</span><span class="o">(</span><span class="n">userId</span><span class="o">,</span> <span class="n">activity</span><span class="o">,</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">()));</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>ì„±ëŠ¥ vs ì¼ê´€ì„± ì„ íƒ ê°€ì´ë“œ</strong></p><ul><li><strong>READ_COMMITTED:</strong> ë¡œê¹…, ë‹¨ìˆœ ì¡°íšŒ, ì„±ëŠ¥ì´ ì¤‘ìš”í•œ ëŒ€ëŸ‰ ì²˜ë¦¬<li><strong>REPEATABLE_READ:</strong> ê¸ˆìœµ ê±°ë˜, ì¬ê³  ê´€ë¦¬, ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ë³´ê³ ì„œ ìƒì„±<li><strong>SERIALIZABLE:</strong> ê·¹ë„ë¡œ ì¤‘ìš”í•œ ë°ì´í„° (ì¼ë°˜ì ìœ¼ë¡œ ì„±ëŠ¥ìƒ ë¹„ì¶”ì²œ)</ul><p><strong>ì£¼ì˜ì‚¬í•­</strong></p><ul><li>ê²©ë¦¬ ìˆ˜ì¤€ë§Œìœ¼ë¡œëŠ” ëª¨ë“  ë™ì‹œì„± ë¬¸ì œê°€ í•´ê²°ë˜ì§€ ì•ŠìŒ<li>í•„ìš”ì‹œ ë‚™ê´€ì  ë½(@Version) ë˜ëŠ” ë¹„ê´€ì  ë½(SELECT FOR UPDATE) ì¶”ê°€ ê³ ë ¤<li>ê²©ë¦¬ ìˆ˜ì¤€ì´ ë†’ì„ìˆ˜ë¡ ë°ë“œë½ ë°œìƒ ê°€ëŠ¥ì„± ì¦ê°€</ul><h2 id="transactionalê³¼-lazyinitializationexception"><span class="mr-2"><strong>@Transactionalê³¼ LazyInitializationException</strong></span><a href="#transactionalê³¼-lazyinitializationexception" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>LazyInitializationExceptionì€ Hibernateë¥¼ ì‚¬ìš©í•  ë•Œ ìì£¼ ë§ˆì£¼ì¹˜ëŠ” ë¬¸ì œë‹¤. íŠ¹íˆ <code class="language-plaintext highlighter-rouge">spring.jpa.open-in-view: false</code> ì„¤ì •ì„ ì‚¬ìš©í•˜ëŠ” í™˜ê²½ì—ì„œ íŠ¸ëœì­ì…˜ì´ ëë‚œ í›„ ì§€ì—° ë¡œë”©ì„ ì‹œë„í•  ë•Œ ë°œìƒí•œë‹¤.</p><p><strong>ë¬¸ì œ ë°œìƒ ì‹œë‚˜ë¦¬ì˜¤</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Author</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"author"</span><span class="o">,</span> <span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span> <span class="c1">// ê¸°ë³¸ê°’: LAZY</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="c1">// getter, setter...</span>
<span class="o">}</span>

<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Author</span> <span class="nf">findAuthor</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="c1">// íŠ¸ëœì­ì…˜ì´ ì—¬ê¸°ì„œ ì¢…ë£Œë¨</span>
<span class="o">}</span>

<span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/authors/{id}"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">AuthorResponse</span><span class="o">&gt;</span> <span class="nf">getAuthor</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">author</span> <span class="o">=</span> <span class="n">authorService</span><span class="o">.</span><span class="na">findAuthor</span><span class="o">(</span><span class="n">id</span><span class="o">);</span> <span class="c1">// íŠ¸ëœì­ì…˜ ì¢…ë£Œ</span>

    <span class="c1">// ì—¬ê¸°ì„œ LazyInitializationException ë°œìƒ!</span>
    <span class="c1">// could not initialize proxy - no Session</span>
    <span class="kt">var</span> <span class="n">bookTitles</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Book:</span><span class="o">:</span><span class="n">getTitle</span><span class="o">)</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>

    <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="k">new</span> <span class="nc">AuthorResponse</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">bookTitles</span><span class="o">));</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>ì™œ ë°œìƒí•˜ëŠ”ê°€?</strong></p><ol><li><strong>JPA Session (EntityManager) ì¢…ë£Œ</strong>: íŠ¸ëœì­ì…˜ì´ ëë‚˜ë©´ Sessionë„ í•¨ê»˜ ë‹«í˜<li><strong>í”„ë¡ì‹œ ê°ì²´ì˜ í•œê³„</strong>: Lazy ì»¬ë ‰ì…˜ì€ í”„ë¡ì‹œë¡œ ë˜í•‘ë˜ì–´ ìˆì–´ Sessionì´ í•„ìš”<li><strong>open-in-view: false</strong>: HTTP ìš”ì²­ ë²”ìœ„ì—ì„œ Sessionì„ ìœ ì§€í•˜ì§€ ì•ŠìŒ</ol><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c1">// Author ê°ì²´ ë‚´ë¶€ì˜ books í•„ë“œëŠ” ì‹¤ì œë¡œ ì´ëŸ° í”„ë¡ì‹œ</span>
<span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PersistentBag</span><span class="o">();</span> <span class="c1">// Hibernateì˜ ì§€ì—° ë¡œë”© ì»¬ë ‰ì…˜</span>
<span class="c1">// Sessionì´ ì—†ìœ¼ë©´ ì‹¤ì œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŒ</span>
</pre></table></code></div></div><p><strong>í•´ê²° ë°©ë²•</strong></p><h5 id="1-íŠ¸ëœì­ì…˜-ë²”ìœ„-í™•ì¥-controllerì—-transactional"><span class="mr-2"><strong><em>1. íŠ¸ëœì­ì…˜ ë²”ìœ„ í™•ì¥ (Controllerì— @Transactional)</em></strong></span><a href="#1-íŠ¸ëœì­ì…˜-ë²”ìœ„-í™•ì¥-controllerì—-transactional" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/authors/{id}"</span><span class="o">)</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span> <span class="c1">// íŠ¸ëœì­ì…˜ì„ Controllerê¹Œì§€ í™•ì¥</span>
<span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">AuthorResponse</span><span class="o">&gt;</span> <span class="nf">getAuthor</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">author</span> <span class="o">=</span> <span class="n">authorService</span><span class="o">.</span><span class="na">findAuthor</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>

    <span class="c1">// íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ Lazy Loading ìˆ˜í–‰ - ì •ìƒ ë™ì‘</span>
    <span class="kt">var</span> <span class="n">bookTitles</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Book:</span><span class="o">:</span><span class="n">getTitle</span><span class="o">)</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>

    <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="k">new</span> <span class="nc">AuthorResponse</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">bookTitles</span><span class="o">));</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>ì¥ì :</strong> ê°„ë‹¨í•œ ìˆ˜ì •<br /> <strong>ë‹¨ì :</strong> Controllerì— íŠ¸ëœì­ì…˜ ë¡œì§ì´ ë“¤ì–´ê°, ë ˆì´ì–´ ê²½ê³„ê°€ ëª¨í˜¸í•´ì§</p><h5 id="2-eager-fetch-join-ì‚¬ìš©"><span class="mr-2"><strong><em>2. Eager Fetch Join ì‚¬ìš©</em></strong></span><a href="#2-eager-fetch-join-ì‚¬ìš©" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AuthorRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Author</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@Query</span><span class="o">(</span><span class="s">"SELECT a FROM Author a JOIN FETCH a.books WHERE a.id = :id"</span><span class="o">)</span>
    <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Author</span><span class="o">&gt;</span> <span class="nf">findByIdWithBooks</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>

    <span class="c1">// ë˜ëŠ” ì—¬ëŸ¬ ì—°ê´€ê´€ê³„ë¥¼ í•œ ë²ˆì—</span>
    <span class="nd">@Query</span><span class="o">(</span><span class="s">"SELECT DISTINCT a FROM Author a "</span> <span class="o">+</span>
           <span class="s">"JOIN FETCH a.books b "</span> <span class="o">+</span>
           <span class="s">"JOIN FETCH b.category "</span> <span class="o">+</span>
           <span class="s">"WHERE a.id = :id"</span><span class="o">)</span>
    <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Author</span><span class="o">&gt;</span> <span class="nf">findByIdWithBooksAndCategories</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthorService</span> <span class="o">{</span>
    <span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Author</span> <span class="nf">findAuthorWithBooks</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findByIdWithBooks</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="c1">// books ë°ì´í„°ê°€ ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆì–´ì„œ Session ì¢…ë£Œ í›„ì—ë„ ì ‘ê·¼ ê°€ëŠ¥</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>ì¥ì :</strong> ëª…í™•í•œ ë°ì´í„° ë¡œë”©, N+1 ë¬¸ì œ í•´ê²°<br /> <strong>ë‹¨ì :</strong> í•­ìƒ ì—°ê´€ ë°ì´í„°ë¥¼ ë¡œë“œí•¨ (ë¶ˆí•„ìš”í•œ ê²½ìš°ì—ë„)</p><h5 id="3-entitygraph-í™œìš©"><span class="mr-2"><strong><em>3. @EntityGraph í™œìš©</em></strong></span><a href="#3-entitygraph-í™œìš©" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AuthorRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Author</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@EntityGraph</span><span class="o">(</span><span class="n">attributePaths</span> <span class="o">=</span> <span class="o">{</span><span class="s">"books"</span><span class="o">,</span> <span class="s">"books.category"</span><span class="o">})</span>
    <span class="nd">@Query</span><span class="o">(</span><span class="s">"SELECT a FROM Author a WHERE a.id = :id"</span><span class="o">)</span>
    <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Author</span><span class="o">&gt;</span> <span class="nf">findByIdWithBooks</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>

    <span class="c1">// ì—¬ëŸ¬ ì‹œë‚˜ë¦¬ì˜¤ì— ëŒ€ì‘</span>
    <span class="nd">@EntityGraph</span><span class="o">(</span><span class="n">attributePaths</span> <span class="o">=</span> <span class="o">{</span><span class="s">"books"</span><span class="o">})</span>
    <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Author</span><span class="o">&gt;</span> <span class="nf">findById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">);</span> <span class="c1">// ê¸°ë³¸ ë©”ì„œë“œ ì˜¤ë²„ë¼ì´ë“œ</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>ì¥ì :</strong> ì„ ì–¸ì  ë°©ì‹, ìœ ì—°í•¨<br /> <strong>ë‹¨ì :</strong> ë³µì¡í•œ ê·¸ë˜í”„ì—ì„œëŠ” ì˜ˆì¸¡ì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŒ</p><h5 id="4-dto-ë³€í™˜ì„-íŠ¸ëœì­ì…˜-ë‚´ì—ì„œ-ê¶Œì¥"><span class="mr-2"><strong><em>4. DTO ë³€í™˜ì„ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ (ê¶Œì¥)</em></strong></span><a href="#4-dto-ë³€í™˜ì„-íŠ¸ëœì­ì…˜-ë‚´ì—ì„œ-ê¶Œì¥" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">AuthorResponse</span> <span class="nf">findAuthorResponse</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">author</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">author</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ëª¨ë‘ ì ‘ê·¼í•˜ì—¬ DTOë¡œ ë³€í™˜</span>
    <span class="kt">var</span> <span class="n">bookTitles</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Book:</span><span class="o">:</span><span class="n">getTitle</span><span class="o">)</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>

    <span class="kt">var</span> <span class="n">authorStats</span> <span class="o">=</span> <span class="nc">AuthorStats</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">totalBooks</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">size</span><span class="o">())</span>
            <span class="o">.</span><span class="na">avgRating</span><span class="o">(</span><span class="n">calculateAverageRating</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getBooks</span><span class="o">()))</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="k">return</span> <span class="nc">AuthorResponse</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">name</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getName</span><span class="o">())</span>
            <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getEmail</span><span class="o">())</span>
            <span class="o">.</span><span class="na">bookTitles</span><span class="o">(</span><span class="n">bookTitles</span><span class="o">)</span>
            <span class="o">.</span><span class="na">stats</span><span class="o">(</span><span class="n">authorStats</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">double</span> <span class="nf">calculateAverageRating</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">books</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">books</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">mapToDouble</span><span class="o">(</span><span class="nl">Book:</span><span class="o">:</span><span class="n">getRating</span><span class="o">)</span>
            <span class="o">.</span><span class="na">average</span><span class="o">()</span>
            <span class="o">.</span><span class="na">orElse</span><span class="o">(</span><span class="mf">0.0</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/authors/{id}"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">AuthorResponse</span><span class="o">&gt;</span> <span class="nf">getAuthor</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">response</span> <span class="o">=</span> <span class="n">authorService</span><span class="o">.</span><span class="na">findAuthorResponse</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">response</span> <span class="o">!=</span> <span class="kc">null</span>
        <span class="o">?</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">response</span><span class="o">)</span>
        <span class="o">:</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">notFound</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>ì¥ì :</strong> ëª…í™•í•œ ë ˆì´ì–´ ë¶„ë¦¬, í•„ìš”í•œ ë°ì´í„°ë§Œ ë…¸ì¶œ, ì„±ëŠ¥ ìµœì í™”<br /> <strong>ë‹¨ì :</strong> DTO í´ë˜ìŠ¤ ì¶”ê°€ í•„ìš”</p><h5 id="5-batch-fetch-size-ì„¤ì •ìœ¼ë¡œ-n1-ë¬¸ì œ-ì™„í™”"><span class="mr-2"><strong><em>5. Batch Fetch Size ì„¤ì •ìœ¼ë¡œ N+1 ë¬¸ì œ ì™„í™”</em></strong></span><a href="#5-batch-fetch-size-ì„¤ì •ìœ¼ë¡œ-n1-ë¬¸ì œ-ì™„í™”" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="na">spring</span><span class="pi">:</span>
  <span class="na">jpa</span><span class="pi">:</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="na">hibernate</span><span class="pi">:</span>
        <span class="na">default_batch_fetch_size</span><span class="pi">:</span> <span class="m">100</span> <span class="c1"># í•œ ë²ˆì— 100ê°œì”© ë°°ì¹˜ë¡œ ë¡œë”©</span>
        <span class="na">jdbc</span><span class="pi">:</span>
          <span class="na">batch_size</span><span class="pi">:</span> <span class="m">50</span> <span class="c1"># INSERT/UPDATE ë°°ì¹˜ í¬ê¸°</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">AuthorResponse</span><span class="o">&gt;</span> <span class="nf">findAllAuthorsWithBooks</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">authors</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span> <span class="c1">// 1ë²ˆ ì¿¼ë¦¬</span>

    <span class="k">return</span> <span class="n">authors</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">author</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="c1">// Batch Fetch Size ë•ë¶„ì— 100ê°œì”© ë¬¶ì–´ì„œ ì¿¼ë¦¬ ì‹¤í–‰</span>
                <span class="c1">// N+1ì´ ì•„ë‹ˆë¼ N/100+1 ì¿¼ë¦¬ë¡œ ìµœì í™”</span>
                <span class="kt">var</span> <span class="n">bookTitles</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Book:</span><span class="o">:</span><span class="n">getTitle</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nf">AuthorResponse</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">bookTitles</span><span class="o">);</span>
            <span class="o">})</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
<span class="o">}</span>
</pre></table></code></div></div><h5 id="6-í”„ë¡œì ì…˜projection-í™œìš©"><span class="mr-2"><strong><em>6. í”„ë¡œì ì…˜(Projection) í™œìš©</em></strong></span><a href="#6-í”„ë¡œì ì…˜projection-í™œìš©" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AuthorBookProjection</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="nf">getName</span><span class="o">();</span>
    <span class="nc">String</span> <span class="nf">getEmail</span><span class="o">();</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">BookInfo</span><span class="o">&gt;</span> <span class="nf">getBooks</span><span class="o">();</span>

    <span class="kd">interface</span> <span class="nc">BookInfo</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="nf">getTitle</span><span class="o">();</span>
        <span class="nc">String</span> <span class="nf">getIsbn</span><span class="o">();</span>
        <span class="nc">BigDecimal</span> <span class="nf">getPrice</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AuthorRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Author</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@Query</span><span class="o">(</span><span class="s">"SELECT a.name as name, a.email as email, "</span> <span class="o">+</span>
           <span class="s">"b.title as books_title, b.isbn as books_isbn, b.price as books_price "</span> <span class="o">+</span>
           <span class="s">"FROM Author a LEFT JOIN a.books b WHERE a.id = :id"</span><span class="o">)</span>
    <span class="nc">AuthorBookProjection</span> <span class="nf">findAuthorBookProjection</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>ì„±ëŠ¥ ìµœì í™” ì‹¤ì „ íŒ</strong></p><p><strong>1. ì—°ê´€ê´€ê³„ ì„¤ê³„ ì‹œ ê³ ë ¤ì‚¬í•­</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Author</span> <span class="o">{</span>
    <span class="c1">// í•„ìˆ˜: ì–‘ë°©í–¥ ê´€ê³„ì—ì„œ ì—°ê´€ê´€ê³„ ì£¼ì¸ ì„¤ì •</span>
    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"author"</span><span class="o">,</span> <span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="c1">// ì„±ëŠ¥ ìµœì í™”: ì»¬ë ‰ì…˜ ì´ˆê¸°í™”</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="nf">getBooks</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">books</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">books</span> <span class="o">:</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// í¸ì˜ ë©”ì„œë“œ: Lazy Loadingì„ ìœ„í•œ í¬ê¸° ì²´í¬</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasBooks</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">books</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">books</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getBooksCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">books</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">books</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">:</span> <span class="mi">0</span><span class="o">;</span> <span class="c1">// size() í˜¸ì¶œ ì‹œ ì‹¤ì œ ë¡œë”©ë¨</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>2. ì¡°ê±´ë¶€ Lazy Loading</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthorService</span> <span class="o">{</span>

    <span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">AuthorResponse</span> <span class="nf">findAuthorResponse</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">includeBooks</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">author</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">author</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>

        <span class="kt">var</span> <span class="n">builder</span> <span class="o">=</span> <span class="nc">AuthorResponse</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">name</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getName</span><span class="o">())</span>
                <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getEmail</span><span class="o">());</span>

        <span class="c1">// í•„ìš”í•œ ê²½ìš°ì—ë§Œ Lazy Loading ìˆ˜í–‰</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">includeBooks</span> <span class="o">&amp;&amp;</span> <span class="n">author</span><span class="o">.</span><span class="na">hasBooks</span><span class="o">())</span> <span class="o">{</span>
            <span class="kt">var</span> <span class="n">bookTitles</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Book:</span><span class="o">:</span><span class="n">getTitle</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
            <span class="n">builder</span><span class="o">.</span><span class="na">bookTitles</span><span class="o">(</span><span class="n">bookTitles</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>í•µì‹¬ ì›ì¹™</strong></p><ul><li><strong>ë°ì´í„° ì ‘ê·¼ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ</strong>: Sessionì´ ì—´ë ¤ìˆì„ ë•Œ ëª¨ë“  í•„ìš” ë°ì´í„°ì— ì ‘ê·¼<li><strong>ëª…ì‹œì  ë°ì´í„° ë¡œë”©</strong>: Fetch Join, EntityGraph ë“±ìœ¼ë¡œ ì˜ë„ë¥¼ ëª…í™•íˆ í‘œí˜„<li><strong>ì ì ˆí•œ DTO í™œìš©</strong>: í•„ìš”í•œ ë°ì´í„°ë§Œ ì¶”ì¶œí•˜ì—¬ ë ˆì´ì–´ ê°„ ê²°í•©ë„ ê°ì†Œ<li><strong>ì„±ëŠ¥ ì¸¡ì • ê¸°ë°˜ ìµœì í™”</strong>: N+1 ë¬¸ì œì™€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ëª¨ë‹ˆí„°ë§í•˜ë©° ìµœì í™”</ul><h2 id="dirty-checking-ì´í•´í•˜ê¸°"><span class="mr-2"><strong>Dirty Checking ì´í•´í•˜ê¸°</strong></span><a href="#dirty-checking-ì´í•´í•˜ê¸°" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Hibernateì˜ í•µì‹¬ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ì¸ Dirty Checkingì— ëŒ€í•´ ì•Œì•„ë³´ì.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateAuthor</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">author</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>

    <span class="c1">// ì—”í‹°í‹° ìˆ˜ì • - ëª…ì‹œì ì¸ save() í˜¸ì¶œ ì—†ì´ë„ UPDATE ì¿¼ë¦¬ ì‹¤í–‰ë¨</span>
    <span class="n">author</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"ë³€ê²½ëœ ì´ë¦„"</span><span class="o">);</span>
    <span class="n">author</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="s">"new@email.com"</span><span class="o">);</span>

    <span class="c1">// íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì ì— ìë™ìœ¼ë¡œ UPDATE ì¿¼ë¦¬ ìƒì„±</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>Dirty Checking ë™ì‘ ì›ë¦¬</strong></p><ol><li><strong>1ì°¨ ìºì‹œ ì €ì¥ ì‹œì </strong>: ì—”í‹°í‹° ì¡°íšŒ ì‹œ í˜„ì¬ ìƒíƒœì˜ ìŠ¤ëƒ…ìƒ·ì„ ìƒì„±<li><strong>íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì </strong>: í˜„ì¬ ì—”í‹°í‹°ì™€ ìŠ¤ëƒ…ìƒ·ì„ ë¹„êµ<li><strong>ë³€ê²½ ê°ì§€</strong>: ë‹¬ë¼ì§„ í•„ë“œê°€ ìˆìœ¼ë©´ UPDATE ì¿¼ë¦¬ ìë™ ìƒì„±</ol><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">// ë‚´ë¶€ ë™ì‘ ê°œë…</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EntityEntry</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Object</span> <span class="n">entity</span><span class="o">;</span>        <span class="c1">// í˜„ì¬ ì—”í‹°í‹°</span>
    <span class="kd">private</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">snapshot</span><span class="o">;</span>    <span class="c1">// ì¡°íšŒ ì‹œì ì˜ ìŠ¤ëƒ…ìƒ·</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">requiresUpdate</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// í˜„ì¬ ì—”í‹°í‹°ì™€ ìŠ¤ëƒ…ìƒ· ë¹„êµ</span>
        <span class="k">return</span> <span class="o">!</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">getCurrentState</span><span class="o">(),</span> <span class="n">snapshot</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­</strong></p><p><strong>1. ë¶ˆí•„ìš”í•œ ìŠ¤ëƒ…ìƒ· ìƒì„± ë°©ì§€</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">AuthorDto</span><span class="o">&gt;</span> <span class="nf">findAllAuthorsForReport</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">author</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">AuthorDto</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">author</span><span class="o">.</span><span class="na">getEmail</span><span class="o">()))</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
<span class="o">}</span>
</pre></table></code></div></div><p>ì½ê¸° ì „ìš©ì´ë¯€ë¡œ ìŠ¤ëƒ…ìƒ· ìƒì„±í•˜ì§€ ì•ŠìŒ</p><p><strong>2. ëŒ€ìš©ëŸ‰ ì¡°íšŒ ì‹œ ì£¼ì˜</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">processAllAuthors</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">authors</span> <span class="o">=</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span> <span class="c1">// 1ë§Œê±´ ì¡°íšŒ</span>

    <span class="c1">// 1ë§Œê°œì˜ ìŠ¤ëƒ…ìƒ· ìƒì„± â†’ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€</span>
    <span class="c1">// ì‹¤ì œë¡œëŠ” ìˆ˜ì •í•˜ì§€ ì•Šì•„ë„ ìŠ¤ëƒ…ìƒ·ì€ ìƒì„±ë¨</span>

    <span class="n">authors</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">author</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="c1">// ë‹¨ìˆœ ì½ê¸° ì‘ì—…ë§Œ ìˆ˜í–‰</span>
        <span class="n">generateReport</span><span class="o">(</span><span class="n">author</span><span class="o">);</span>
    <span class="o">});</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>3. ì„ íƒì  ì—…ë°ì´íŠ¸ vs ì „ì²´ í•„ë“œ ì—…ë°ì´íŠ¸</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">// @DynamicUpdate ì—†ëŠ” ê²½ìš° - ëª¨ë“  í•„ë“œ UPDATE</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Author</span> <span class="o">{</span>
    <span class="c1">// UPDATE author SET name=?, email=?, created_at=? WHERE id=?</span>
<span class="o">}</span>

<span class="c1">// @DynamicUpdate ìˆëŠ” ê²½ìš° - ë³€ê²½ëœ í•„ë“œë§Œ UPDATE</span>
<span class="nd">@Entity</span>
<span class="nd">@DynamicUpdate</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Author</span> <span class="o">{</span>
    <span class="c1">// UPDATE author SET name=? WHERE id=?</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>ìµœì í™” íŒ</strong></p><ul><li>ë‹¨ìˆœ ì¡°íšŒë§Œ í•˜ëŠ” ê²½ìš°: <code class="language-plaintext highlighter-rouge">@Transactional(readOnly = true)</code> ë˜ëŠ” íŠ¸ëœì­ì…˜ ì—†ì´<li>ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬: ì²­í¬ ë‹¨ìœ„ë¡œ ë¶„í• í•˜ì—¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì œì–´<li>ë¶€ë¶„ ì—…ë°ì´íŠ¸: <code class="language-plaintext highlighter-rouge">@DynamicUpdate</code> í™œìš©</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/java/'>Java</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java/" class="post-tag no-text-decoration" >Java</a> <a href="/tags/jpa/" class="post-tag no-text-decoration" >JPA</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=JPA+Transactional+%EC%A0%90%EA%B2%80%ED%95%98%EA%B8%B0+-+keencho%27s+blog&url=https%3A%2F%2Fkeencho.github.io%2Fposts%2Ftransactional-think%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=JPA+Transactional+%EC%A0%90%EA%B2%80%ED%95%98%EA%B8%B0+-+keencho%27s+blog&u=https%3A%2F%2Fkeencho.github.io%2Fposts%2Ftransactional-think%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fkeencho.github.io%2Fposts%2Ftransactional-think%2F&text=JPA+Transactional+%EC%A0%90%EA%B2%80%ED%95%98%EA%B8%B0+-+keencho%27s+blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/jpa-flush/">JPA & Hibernate Flush Mode</a><li><a href="/posts/aws-cicd-1/">AWSë¥¼ ì‚¬ìš©í•´ ë¬´ì¤‘ë‹¨ ë°°í¬ ìë™í™” í™˜ê²½ êµ¬ì¶•í•˜ê¸° - 1. ê°œìš”</a><li><a href="/posts/terraform-aws-infra-6/">Terraformìœ¼ë¡œ AWS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° - 6. ìš´ì˜í™˜ê²½ (ë°±ì—”ë“œ)</a><li><a href="/posts/aapt2-arm/">Arm ì•„í‚¤í…ì²˜ì—ì„œ AAPT2 ë¹Œë“œ ë„êµ¬ ì‚¬ìš©í•˜ê¸°</a><li><a href="/posts/terraform-aws-infra-1/">Terraformìœ¼ë¡œ AWS ë¬´ì¤‘ë‹¨ ë°°í¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸° - 1. ê°œìš”</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/ecs/">ECS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/querydsl/">QueryDSL</a> <a class="post-tag" href="/tags/react/">React</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/querydsl-qbuilder-qsetter-1/"><div class="card-body"> <em class="small" data-ts="1664316720" data-df="ll" > Sep 28, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>QueryProjection ì—ì„œ í•œë‹¨ê³„ ë” ë‚˜ì•„ê°€ QueryProjectionBuilder ë§Œë“¤ê¸° (1)</h3><div class="text-muted small"><p> QueryProjection ì—ì„œ í•œë‹¨ê³„ ë” ë‚˜ì•„ê°€ QueryProjectionBuilder ë§Œë“¤ê¸° (1) - ê°œìš” Querydslì„ ì‚¬ìš©í•´ dbì¡°íšŒë¥¼ í•˜ëŠ” ê²½ìš° ì—”í‹°í‹° ìì²´ë¥¼ ë°˜í™˜í•˜ëŠ” ê²½ìš°ëŠ” ì˜ ì—†ìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ í•„ìš”í•œ í•„ë“œë§Œ ì§€ì •í•˜ì—¬ Projectionsë¥¼ ì‚¬ìš©í•˜ì—¬ ì¡°íšŒí•˜ê²Œ ë˜ëŠ”ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì˜ ì•Œë ¤ì§„ projection ë°©ë²•ì—ëŠ” 3ê°€ì§€ê°€ ìˆìŠµë‹ˆ...</p></div></div></a></div><div class="card"> <a href="/posts/querydsl-qbuilder-qsetter-2/"><div class="card-body"> <em class="small" data-ts="1664662320" data-df="ll" > Oct 2, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>QueryProjection ì—ì„œ í•œë‹¨ê³„ ë” ë‚˜ì•„ê°€ QueryProjectionBuilder ë§Œë“¤ê¸° (2)</h3><div class="text-muted small"><p> QueryProjection ì—ì„œ í•œë‹¨ê³„ ë” ë‚˜ì•„ê°€ QueryProjectionBuilder ë§Œë“¤ê¸° (2) - ê°œë°œ ê³¼ì •, ì½”ë“œ ì´ í¬ìŠ¤íŒ…ì—ì„œ ì„¤ëª…í•˜ëŠ” ì½”ë“œëŠ” í•œ í”„ë¡œì íŠ¸ ë‚´ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¼ì´ë¸ŒëŸ¬ë¦¬ í”„ë¡œì íŠ¸ A, ì‹¤ì œ ì–´í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œì íŠ¸ B ë¡œ ë‚˜ë‰˜ì–´ì•¼ í•©ë‹ˆë‹¤. java17, maven ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. 1. @QueryProj...</p></div></div></a></div><div class="card"> <a href="/posts/proxy-pattern/"><div class="card-body"> <em class="small" data-ts="1625310720" data-df="ll" > Jul 3, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>í”„ë¡ì‹œ íŒ¨í„´ (Proxy Pattern)</h3><div class="text-muted small"><p> í”„ë¡ì‹œ íŒ¨í„´ í”„ë¡ì‹œ(Proxy) ëŠ” ëŒ€ë¦¬ì ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤. ì‹¤ìƒí™œì„œì˜ ì˜ë¯¸ì²˜ëŸ¼ í”„ë¡œê·¸ë¨ì—ì„œì˜ í”„ë¡ì‹œë„ ëˆ„êµ°ê°€ì—ê²Œ ì–´ë–¤ ì¼ì„ ëŒ€ì‹  ì‹œí‚¤ëŠ” ê²ƒ ì´ë€ ì˜ë¯¸ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ë•Œë•Œë¡œ ìš°ë¦¬ëŠ” ê°ì²´ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ì œì–´í•˜ëŠ” ê¸°ëŠ¥ì„ í•„ìš”í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë¬´ê²ê³  ë§ì€ ìì›ì„ í•„ìš”ë¡œ í•˜ëŠ” í´ë˜ìŠ¤ì˜ í•œë‘ê°€ì§€ ë©”ì†Œë“œë§Œ ì‚¬ìš©í•´ì•¼ í•˜ë”ë¼ë„ ìƒì„±ìë¡œ ì „ì²´ í´ë˜ìŠ¤ë¥¼ ì¸ìŠ¤í„´...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/aws-alb-static-ip/" class="btn btn-outline-primary" prompt="Older"><p>Application Load Balancerì— ê³ ì • IP ì‚¬ìš©í•˜ê¸° (feat. VPC IPAM í†µí•©)</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> Â© 2025 <a href="https://github.com/keencho">keencho</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/ecs/">ECS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/querydsl/">QueryDSL</a> <a class="post-tag" href="/tags/react/">React</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
